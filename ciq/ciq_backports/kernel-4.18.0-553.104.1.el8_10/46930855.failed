ipv4: add RCU protection to ip4_dst_hoplimit()

jira KERNEL-609
Rebuild_History Non-Buildable kernel-4.18.0-553.104.1.el8_10
commit-author Eric Dumazet <edumazet@google.com>
commit 469308552ca4560176cfc100e7ca84add1bebd7c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.104.1.el8_10/46930855.failed

ip4_dst_hoplimit() must use RCU protection to make
sure the net structure it reads does not disappear.

Fixes: fa50d974d104 ("ipv4: Namespaceify ip_default_ttl sysctl knob")
	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Reviewed-by: Kuniyuki Iwashima <kuniyu@amazon.com>
Link: https://patch.msgid.link/20250205155120.1676781-3-edumazet@google.com
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 469308552ca4560176cfc100e7ca84add1bebd7c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/route.h
diff --cc include/net/route.h
index c1eb8e8e4b16,c605fd5ec0c0..000000000000
--- a/include/net/route.h
+++ b/include/net/route.h
@@@ -353,10 -382,15 +353,20 @@@ static inline int inet_iif(const struc
  static inline int ip4_dst_hoplimit(const struct dst_entry *dst)
  {
  	int hoplimit = dst_metric_raw(dst, RTAX_HOPLIMIT);
- 	struct net *net = dev_net(dst->dev);
  
++<<<<<<< HEAD
 +	if (hoplimit == 0)
 +		hoplimit = net->ipv4.sysctl_ip_default_ttl;
++=======
+ 	if (hoplimit == 0) {
+ 		const struct net *net;
+ 
+ 		rcu_read_lock();
+ 		net = dev_net_rcu(dst->dev);
+ 		hoplimit = READ_ONCE(net->ipv4.sysctl_ip_default_ttl);
+ 		rcu_read_unlock();
+ 	}
++>>>>>>> 469308552ca4 (ipv4: add RCU protection to ip4_dst_hoplimit())
  	return hoplimit;
  }
  
* Unmerged path include/net/route.h
