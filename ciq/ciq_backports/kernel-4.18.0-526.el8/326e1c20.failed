usb: typec: ucsi: acpi: add quirk for ASUS Zenbook UM325

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-526.el8
commit-author Samuel Čavoj <samuel@cavoj.net>
commit 326e1c208f3f24d14b93f910b8ae32c94923d22c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-526.el8/326e1c20.failed

On some ACPI platforms (namely the ASUS Zenbook UM325) the _DSM method must
not be called after a notification is received but instead the mailbox
should be read immediately from RAM. This is because the ACPI interrupt
handler destroys the CCI in ERAM after copying to system memory, and when
_DSM is later called to perform a second copy, it retrieves a garbage
value.

Instead, the _DSM(read) method should only be called when necessary, i.e.
for polling the state after reset and for retrieving the version. Other
reads should not call _DSM and only peek into the RAM region.

This adds a separate read operation for the Zenbook that syncs the
ACPI mailbox only with polled commands.

Link: https://lore.kernel.org/linux-usb/20210823180626.tb6m7h5tp6adhvt2@fastboi.localdomain/
	Signed-off-by: Samuel Čavoj <samuel@cavoj.net>
[ heikki : handling everything in ucsi_acpi.c with DMI quirk ]
	Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
Link: https://lore.kernel.org/r/20230405134456.49607-1-heikki.krogerus@linux.intel.com
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 326e1c208f3f24d14b93f910b8ae32c94923d22c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/typec/ucsi/ucsi_acpi.c
diff --cc drivers/usb/typec/ucsi/ucsi_acpi.c
index f07610cb48aa,217355f1f9b9..000000000000
--- a/drivers/usb/typec/ucsi/ucsi_acpi.c
+++ b/drivers/usb/typec/ucsi/ucsi_acpi.c
@@@ -61,7 -63,8 +63,12 @@@ static int ucsi_acpi_async_write(struc
  {
  	struct ucsi_acpi *ua = ucsi_get_drvdata(ucsi);
  
++<<<<<<< HEAD
 +	memcpy((void __force *)(ua->base + offset), val, val_len);
++=======
+ 	memcpy(ua->base + offset, val, val_len);
+ 	ua->cmd = *(u64 *)val;
++>>>>>>> 326e1c208f3f (usb: typec: ucsi: acpi: add quirk for ASUS Zenbook UM325)
  
  	return ucsi_acpi_dsm(ua, UCSI_DSM_FUNC_WRITE);
  }
* Unmerged path drivers/usb/typec/ucsi/ucsi_acpi.c
