x86/bugs: Restructure RFDS mitigation

jira KERNEL-156
Rebuild_History Non-Buildable kernel-6.12.0-124.2.1.el10_1
commit-author David Kaplan <david.kaplan@amd.com>
commit 203d81f8e167a9e82747a14dace40e0abbd5c791
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-6.12.0-124.2.1.el10_1/203d81f8.failed

Restructure RFDS mitigation to use select/update/apply functions to
create consistent vulnerability handling.

  [ bp: Rename the oneline helper to what it checks. ]

	Signed-off-by: David Kaplan <david.kaplan@amd.com>
	Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
	Reviewed-by: Josh Poimboeuf <jpoimboe@kernel.org>
Link: https://lore.kernel.org/20250418161721.1855190-5-david.kaplan@amd.com
(cherry picked from commit 203d81f8e167a9e82747a14dace40e0abbd5c791)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/bugs.c
diff --cc arch/x86/kernel/cpu/bugs.c
index f2cbc864a5e8,2705105d9a5e..000000000000
--- a/arch/x86/kernel/cpu/bugs.c
+++ b/arch/x86/kernel/cpu/bugs.c
@@@ -44,7 -63,16 +44,15 @@@ static void __init mds_select_mitigatio
  static void __init md_clear_update_mitigation(void);
  static void __init md_clear_select_mitigation(void);
  static void __init taa_select_mitigation(void);
 -static void __init taa_update_mitigation(void);
 -static void __init taa_apply_mitigation(void);
  static void __init mmio_select_mitigation(void);
++<<<<<<< HEAD
++=======
+ static void __init mmio_update_mitigation(void);
+ static void __init mmio_apply_mitigation(void);
+ static void __init rfds_select_mitigation(void);
+ static void __init rfds_update_mitigation(void);
+ static void __init rfds_apply_mitigation(void);
++>>>>>>> 203d81f8e167 (x86/bugs: Restructure RFDS mitigation)
  static void __init srbds_select_mitigation(void);
  static void __init l1d_flush_select_mitigation(void);
  static void __init srso_select_mitigation(void);
@@@ -181,6 -200,10 +189,13 @@@ void __init cpu_select_mitigations(void
  	spectre_v2_user_select_mitigation();
  	ssb_select_mitigation();
  	l1tf_select_mitigation();
++<<<<<<< HEAD
++=======
+ 	mds_select_mitigation();
+ 	taa_select_mitigation();
+ 	mmio_select_mitigation();
+ 	rfds_select_mitigation();
++>>>>>>> 203d81f8e167 (x86/bugs: Restructure RFDS mitigation)
  	md_clear_select_mitigation();
  	srbds_select_mitigation();
  	l1d_flush_select_mitigation();
@@@ -191,7 -214,20 +206,24 @@@
  	 */
  	srso_select_mitigation();
  	gds_select_mitigation();
++<<<<<<< HEAD
 +	its_select_mitigation();
++=======
+ 
+ 	/*
+ 	 * After mitigations are selected, some may need to update their
+ 	 * choices.
+ 	 */
+ 	mds_update_mitigation();
+ 	taa_update_mitigation();
+ 	mmio_update_mitigation();
+ 	rfds_update_mitigation();
+ 
+ 	mds_apply_mitigation();
+ 	taa_apply_mitigation();
+ 	mmio_apply_mitigation();
+ 	rfds_apply_mitigation();
++>>>>>>> 203d81f8e167 (x86/bugs: Restructure RFDS mitigation)
  }
  
  /*
@@@ -612,10 -744,6 +670,13 @@@ out
  
  static void __init md_clear_select_mitigation(void)
  {
++<<<<<<< HEAD
 +	mds_select_mitigation();
 +	taa_select_mitigation();
 +	mmio_select_mitigation();
 +	rfds_select_mitigation();
++=======
++>>>>>>> 203d81f8e167 (x86/bugs: Restructure RFDS mitigation)
  
  	/*
  	 * As these mitigations are inter-related and rely on VERW instruction
* Unmerged path arch/x86/kernel/cpu/bugs.c
