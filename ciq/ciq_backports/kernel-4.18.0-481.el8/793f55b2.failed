kunit: fix Kconfig for build-in tests USB4 and Nitro Enclaves

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Nico Pache <npache@redhat.com>
commit 793f55b2971e3a95d77ad08e9da2a3dc6c946cd7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/793f55b2.failed

Both the USB4 and Nitro Enclaves KUNIT tests are now able to be compiled
if KUNIT is compiled as a module. This leads to issues if KUNIT is being
packaged separately from the core kernel and when KUNIT is run baremetal
without the required driver compiled into the kernel.

Fixes: 635dcd16844b ("thunderbolt: test: Use kunit_test_suite() macro")
Fixes: fe5be808fa6c ("nitro_enclaves: test: Use kunit_test_suite() macro")
	Signed-off-by: Nico Pache <npache@redhat.com>
	Reviewed-by: David Gow <davidgow@google.com>
	Reviewed-by: Andra Paraschiv <andraprs@amazon.com>
	Acked-by: Brendan Higgins <brendanhiggins@google.com>
	Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
(cherry picked from commit 793f55b2971e3a95d77ad08e9da2a3dc6c946cd7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/virt/nitro_enclaves/Kconfig
diff --cc drivers/virt/nitro_enclaves/Kconfig
index f53740b941c0,dc4d25c26256..000000000000
--- a/drivers/virt/nitro_enclaves/Kconfig
+++ b/drivers/virt/nitro_enclaves/Kconfig
@@@ -14,3 -14,13 +14,16 @@@ config NITRO_ENCLAVE
  
  	  To compile this driver as a module, choose M here.
  	  The module will be called nitro_enclaves.
++<<<<<<< HEAD
++=======
+ 
+ config NITRO_ENCLAVES_MISC_DEV_TEST
+ 	bool "Tests for the misc device functionality of the Nitro Enclaves" if !KUNIT_ALL_TESTS
+ 	depends on NITRO_ENCLAVES && KUNIT=y
+ 	default KUNIT_ALL_TESTS
+ 	help
+ 	  Enable KUnit tests for the misc device functionality of the Nitro
+ 	  Enclaves. Select this option only if you will boot the kernel for
+ 	  the purpose of running unit tests (e.g. under UML or qemu). If
+ 	  unsure, say N.
++>>>>>>> 793f55b2971e (kunit: fix Kconfig for build-in tests USB4 and Nitro Enclaves)
diff --git a/drivers/thunderbolt/Kconfig b/drivers/thunderbolt/Kconfig
index e76a6c173637..f12d0a3ee3e2 100644
--- a/drivers/thunderbolt/Kconfig
+++ b/drivers/thunderbolt/Kconfig
@@ -29,8 +29,7 @@ config USB4_DEBUGFS_WRITE
 
 config USB4_KUNIT_TEST
 	bool "KUnit tests" if !KUNIT_ALL_TESTS
-	depends on (USB4=m || KUNIT=y)
-	depends on KUNIT
+	depends on USB4 && KUNIT=y
 	default KUNIT_ALL_TESTS
 
 config USB4_DMA_TEST
* Unmerged path drivers/virt/nitro_enclaves/Kconfig
