net/mlx5: Lag, Fix for loop when checking lag

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Chris Mi <cmi@nvidia.com>
commit 0e682f04b4b59eac0b0a030251513589c4607458
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/0e682f04.failed

The cited commit adds a for loop to check if each port supports lag
or not. But dev is not initialized correctly. Fix it by initializing
dev for each iteration.

Fixes: e87c6a832f88 ("net/mlx5: E-switch, Fix duplicate lag creation")
	Signed-off-by: Chris Mi <cmi@nvidia.com>
	Reported-by: Jacob Keller <jacob.e.keller@intel.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Link: https://lore.kernel.org/r/20221129093006.378840-2-saeed@kernel.org
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 0e682f04b4b59eac0b0a030251513589c4607458)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c
index d98acd68af2e,32c3e0a649a7..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c
@@@ -647,11 -700,14 +647,22 @@@ static bool mlx5_lag_check_prereq(struc
  			return false;
  
  #ifdef CONFIG_MLX5_ESWITCH
++<<<<<<< HEAD
 +	mode = mlx5_eswitch_mode(ldev->pf[MLX5_LAG_P1].dev);
 +
 +	if (mode != MLX5_ESWITCH_NONE && mode != MLX5_ESWITCH_OFFLOADS)
 +		return false;
 +
++=======
+ 	for (i = 0; i < ldev->ports; i++) {
+ 		dev = ldev->pf[i].dev;
+ 		if (mlx5_eswitch_num_vfs(dev->priv.eswitch) && !is_mdev_switchdev_mode(dev))
+ 			return false;
+ 	}
+ 
+ 	dev = ldev->pf[MLX5_LAG_P1].dev;
+ 	mode = mlx5_eswitch_mode(dev);
++>>>>>>> 0e682f04b4b5 (net/mlx5: Lag, Fix for loop when checking lag)
  	for (i = 0; i < ldev->ports; i++)
  		if (mlx5_eswitch_mode(ldev->pf[i].dev) != mode)
  			return false;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/lag/lag.c
