drm/amd/display: Wait for VBLANK during pipe programming

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Alvin Lee <Alvin.Lee2@amd.com>
commit 00efc965a7b7990e63e3506e6d240e6271bd8571
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/00efc965.failed

[Description]
- Wait for vblank during front end programming
  for global sync to ensure all double buffer
  updates take.
- This prevents underflow in some cases.

	Reviewed-by: Martin Leung <Martin.Leung@amd.com>
	Acked-by: Alan Liu <HaoPing.Liu@amd.com>
	Signed-off-by: Alvin Lee <Alvin.Lee2@amd.com>
	Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit 00efc965a7b7990e63e3506e6d240e6271bd8571)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c
diff --cc drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c
index 0f30df523fdf,b465a83bde6f..000000000000
--- a/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c
+++ b/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c
@@@ -1632,10 -1663,8 +1632,15 @@@ static void dcn20_program_pipe
  				pipe_ctx->pipe_dlg_param.vupdate_width);
  
  		if (pipe_ctx->stream->mall_stream_config.type != SUBVP_PHANTOM) {
++<<<<<<< HEAD
 +			pipe_ctx->stream_res.tg->funcs->wait_for_state(
 +				pipe_ctx->stream_res.tg, CRTC_STATE_VBLANK);
 +			pipe_ctx->stream_res.tg->funcs->wait_for_state(
 +				pipe_ctx->stream_res.tg, CRTC_STATE_VACTIVE);
++=======
+ 			pipe_ctx->stream_res.tg->funcs->wait_for_state(pipe_ctx->stream_res.tg, CRTC_STATE_VBLANK);
+ 			pipe_ctx->stream_res.tg->funcs->wait_for_state(pipe_ctx->stream_res.tg, CRTC_STATE_VACTIVE);
++>>>>>>> 00efc965a7b7 (drm/amd/display: Wait for VBLANK during pipe programming)
  		}
  
  		pipe_ctx->stream_res.tg->funcs->set_vtg_params(
* Unmerged path drivers/gpu/drm/amd/display/dc/dcn20/dcn20_hwseq.c
