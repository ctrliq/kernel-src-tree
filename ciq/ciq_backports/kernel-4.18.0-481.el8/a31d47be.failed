netfilter: ipset: fix hash:net,port,net hang with /0 subnet

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Jozsef Kadlecsik <kadlec@netfilter.org>
commit a31d47be64b9b74f8cfedffe03e0a8a1f9e51f23
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/a31d47be.failed

The hash:net,port,net set type supports /0 subnets. However, the patch
commit 5f7b51bf09baca8e titled "netfilter: ipset: Limit the maximal range
of consecutive elements to add/delete" did not take into account it and
resulted in an endless loop. The bug is actually older but the patch
5f7b51bf09baca8e brings it out earlier.

Handle /0 subnets properly in hash:net,port,net set types.

Fixes: 5f7b51bf09ba ("netfilter: ipset: Limit the maximal range of consecutive elements to add/delete")
	Reported-by: Марк Коренберг <socketpair@gmail.com>
	Signed-off-by: Jozsef Kadlecsik <kadlec@netfilter.org>
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit a31d47be64b9b74f8cfedffe03e0a8a1f9e51f23)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/ipset/ip_set_hash_netportnet.c
diff --cc net/netfilter/ipset/ip_set_hash_netportnet.c
index 613e18e720a4,005a7ce87217..000000000000
--- a/net/netfilter/ipset/ip_set_hash_netportnet.c
+++ b/net/netfilter/ipset/ip_set_hash_netportnet.c
@@@ -185,7 -192,7 +195,11 @@@ hash_netportnet4_uadt(struct ip_set *se
  	struct hash_netportnet4_elem e = { };
  	struct ip_set_ext ext = IP_SET_INIT_UEXT(set);
  	u32 ip = 0, ip_to = 0, p = 0, port, port_to;
++<<<<<<< HEAD
 +	u32 ip2_from = 0, ip2_to = 0, ip2;
++=======
+ 	u32 ip2_from = 0, ip2_to = 0, ip2, i = 0;
++>>>>>>> a31d47be64b9 (netfilter: ipset: fix hash:net,port,net hang with /0 subnet)
  	bool with_ports = false;
  	int ret;
  
* Unmerged path net/netfilter/ipset/ip_set_hash_netportnet.c
