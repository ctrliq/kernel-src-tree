RDMA/bnxt_re: Reduce the delay in polling for hwrm command completion

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Selvin Xavier <selvin.xavier@broadcom.com>
commit b9b43ad3ce883f6d9f0fc3c24e2a0d2d94d7eb49
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/b9b43ad3.failed

Driver has 1ms delay between the polling for atomic command completion.
Polling immediately after issuing command usually doesn't report any
completions. So all commands in the blocking path needs two iterations. So
effectively 1ms spend on each command. HW requires much lesser time for
each command. So reduce the delay to 1us and increase the iteration count
to wait for the same time.

Link: https://lore.kernel.org/r/1631709163-2287-5-git-send-email-selvin.xavier@broadcom.com
	Reviewed-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: Selvin Xavier <selvin.xavier@broadcom.com>
	Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
(cherry picked from commit b9b43ad3ce883f6d9f0fc3c24e2a0d2d94d7eb49)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/hw/bnxt_re/qplib_rcfw.c
diff --cc drivers/infiniband/hw/bnxt_re/qplib_rcfw.c
index 4aa8729e4de1,947e8c55c303..000000000000
--- a/drivers/infiniband/hw/bnxt_re/qplib_rcfw.c
+++ b/drivers/infiniband/hw/bnxt_re/qplib_rcfw.c
@@@ -78,8 -78,8 +78,13 @@@ static int __block_for_resp(struct bnxt
  	if (!test_bit(cbit, cmdq->cmdq_bitmap))
  		goto done;
  	do {
++<<<<<<< HEAD
 +		mdelay(1); /* 1m sec */
 +		bnxt_qplib_service_creq((unsigned long)rcfw);
++=======
+ 		udelay(1);
+ 		bnxt_qplib_service_creq(&rcfw->creq.creq_tasklet);
++>>>>>>> b9b43ad3ce88 (RDMA/bnxt_re: Reduce the delay in polling for hwrm command completion)
  	} while (test_bit(cbit, cmdq->cmdq_bitmap) && --count);
  done:
  	return count ? 0 : -ETIMEDOUT;
* Unmerged path drivers/infiniband/hw/bnxt_re/qplib_rcfw.c
diff --git a/drivers/infiniband/hw/bnxt_re/qplib_rcfw.h b/drivers/infiniband/hw/bnxt_re/qplib_rcfw.h
index 9474c0046582..82faa4e4cda8 100644
--- a/drivers/infiniband/hw/bnxt_re/qplib_rcfw.h
+++ b/drivers/infiniband/hw/bnxt_re/qplib_rcfw.h
@@ -96,7 +96,7 @@ static inline void bnxt_qplib_set_cmd_slots(struct cmdq_base *req)
 
 #define RCFW_MAX_COOKIE_VALUE		0x7FFF
 #define RCFW_CMD_IS_BLOCKING		0x8000
-#define RCFW_BLOCKED_CMD_WAIT_COUNT	0x4E20
+#define RCFW_BLOCKED_CMD_WAIT_COUNT	20000000UL /* 20 sec */
 
 #define HWRM_VERSION_RCFW_CMDQ_DEPTH_CHECK 0x1000900020011ULL
 
