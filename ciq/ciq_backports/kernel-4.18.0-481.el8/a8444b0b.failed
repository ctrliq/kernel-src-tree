net/mlx5: Don't advertise IPsec netdev support for non-IPsec device

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-481.el8
commit-author Leon Romanovsky <leonro@nvidia.com>
commit a8444b0bdd1ae9c437fe6d3ef44f1ba4721c4329
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-481.el8/a8444b0b.failed

Device that lacks proper IPsec capabilities won't pass mlx5e_ipsec_init()
later, so no need to advertise HW netdev offload support for something that
isn't going to work anyway.

Fixes: 8ad893e516a7 ("net/mlx5e: Remove dependency in IPsec initialization flows")
	Reviewed-by: Raed Salem <raeds@nvidia.com>
	Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit a8444b0bdd1ae9c437fe6d3ef44f1ba4721c4329)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec.c
index 027d80b77b28,28729b1cc6e6..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec.c
@@@ -508,7 -454,10 +508,14 @@@ void mlx5e_ipsec_build_netdev(struct ml
  	struct mlx5_core_dev *mdev = priv->mdev;
  	struct net_device *netdev = priv->netdev;
  
++<<<<<<< HEAD
 +	if (!(mlx5_accel_ipsec_device_caps(mdev) & MLX5_ACCEL_IPSEC_CAP_ESP) ||
++=======
+ 	if (!mlx5_ipsec_device_caps(mdev))
+ 		return;
+ 
+ 	if (!(mlx5_ipsec_device_caps(mdev) & MLX5_ACCEL_IPSEC_CAP_ESP) ||
++>>>>>>> a8444b0bdd1a (net/mlx5: Don't advertise IPsec netdev support for non-IPsec device)
  	    !MLX5_CAP_ETH(mdev, swp)) {
  		mlx5_core_dbg(mdev, "mlx5e: ESP and SWP offload not supported\n");
  		return;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec.c
