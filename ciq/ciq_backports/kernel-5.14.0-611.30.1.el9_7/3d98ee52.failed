net: bonding: add broadcast_neighbor netlink option

jira KERNEL-619
Rebuild_History Non-Buildable kernel-5.14.0-611.30.1.el9_7
commit-author Tonghao Zhang <tonghao@bamaicloud.com>
commit 3d98ee52659c3f1d3913ae5b97f7743c5247752c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-611.30.1.el9_7/3d98ee52.failed

User can config or display the bonding broadcast_neighbor option via
iproute2/netlink.

	Cc: Jay Vosburgh <jv@jvosburgh.net>
	Cc: "David S. Miller" <davem@davemloft.net>
	Cc: Eric Dumazet <edumazet@google.com>
	Cc: Jakub Kicinski <kuba@kernel.org>
	Cc: Paolo Abeni <pabeni@redhat.com>
	Cc: Simon Horman <horms@kernel.org>
	Cc: Jonathan Corbet <corbet@lwn.net>
	Cc: Andrew Lunn <andrew+netdev@lunn.ch>
	Cc: Steven Rostedt <rostedt@goodmis.org>
	Cc: Masami Hiramatsu <mhiramat@kernel.org>
	Cc: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
	Cc: Nikolay Aleksandrov <razor@blackwall.org>
	Signed-off-by: Tonghao Zhang <tonghao@bamaicloud.com>
	Signed-off-by: Zengbing Tu <tuzengbing@didiglobal.com>
	Reviewed-by: Nikolay Aleksandrov <razor@blackwall.org>
Link: https://patch.msgid.link/76b90700ba5b98027dfb51a2f3c5cfea0440a21b.1751031306.git.tonghao@bamaicloud.com
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>

(cherry picked from commit 3d98ee52659c3f1d3913ae5b97f7743c5247752c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/bonding/bond_netlink.c
#	include/uapi/linux/if_link.h
diff --cc drivers/net/bonding/bond_netlink.c
index cfa74cf8bb1a,57fff2421f1b..000000000000
--- a/drivers/net/bonding/bond_netlink.c
+++ b/drivers/net/bonding/bond_netlink.c
@@@ -122,6 -123,8 +122,11 @@@ static const struct nla_policy bond_pol
  	[IFLA_BOND_PEER_NOTIF_DELAY]    = NLA_POLICY_FULL_RANGE(NLA_U32, &delay_range),
  	[IFLA_BOND_MISSED_MAX]		= { .type = NLA_U8 },
  	[IFLA_BOND_NS_IP6_TARGET]	= { .type = NLA_NESTED },
++<<<<<<< HEAD
++=======
+ 	[IFLA_BOND_COUPLED_CONTROL]	= { .type = NLA_U8 },
+ 	[IFLA_BOND_BROADCAST_NEIGH]	= { .type = NLA_U8 },
++>>>>>>> 3d98ee52659c (net: bonding: add broadcast_neighbor netlink option)
  };
  
  static const struct nla_policy bond_slave_policy[IFLA_BOND_SLAVE_MAX + 1] = {
@@@ -549,6 -552,26 +554,29 @@@ static int bond_changelink(struct net_d
  			return err;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (data[IFLA_BOND_COUPLED_CONTROL]) {
+ 		int coupled_control = nla_get_u8(data[IFLA_BOND_COUPLED_CONTROL]);
+ 
+ 		bond_opt_initval(&newval, coupled_control);
+ 		err = __bond_opt_set(bond, BOND_OPT_COUPLED_CONTROL, &newval,
+ 				     data[IFLA_BOND_COUPLED_CONTROL], extack);
+ 		if (err)
+ 			return err;
+ 	}
+ 
+ 	if (data[IFLA_BOND_BROADCAST_NEIGH]) {
+ 		int broadcast_neigh = nla_get_u8(data[IFLA_BOND_BROADCAST_NEIGH]);
+ 
+ 		bond_opt_initval(&newval, broadcast_neigh);
+ 		err = __bond_opt_set(bond, BOND_OPT_BROADCAST_NEIGH, &newval,
+ 				     data[IFLA_BOND_BROADCAST_NEIGH], extack);
+ 		if (err)
+ 			return err;
+ 	}
+ 
++>>>>>>> 3d98ee52659c (net: bonding: add broadcast_neighbor netlink option)
  	return 0;
  }
  
@@@ -615,6 -640,8 +643,11 @@@ static size_t bond_get_size(const struc
  						/* IFLA_BOND_NS_IP6_TARGET */
  		nla_total_size(sizeof(struct nlattr)) +
  		nla_total_size(sizeof(struct in6_addr)) * BOND_MAX_NS_TARGETS +
++<<<<<<< HEAD
++=======
+ 		nla_total_size(sizeof(u8)) +	/* IFLA_BOND_COUPLED_CONTROL */
+ 		nla_total_size(sizeof(u8)) +	/* IFLA_BOND_BROADCAST_NEIGH */
++>>>>>>> 3d98ee52659c (net: bonding: add broadcast_neighbor netlink option)
  		0;
  }
  
@@@ -774,6 -801,14 +807,17 @@@ static int bond_fill_info(struct sk_buf
  		       bond->params.missed_max))
  		goto nla_put_failure;
  
++<<<<<<< HEAD
++=======
+ 	if (nla_put_u8(skb, IFLA_BOND_COUPLED_CONTROL,
+ 		       bond->params.coupled_control))
+ 		goto nla_put_failure;
+ 
+ 	if (nla_put_u8(skb, IFLA_BOND_BROADCAST_NEIGH,
+ 		       bond->params.broadcast_neighbor))
+ 		goto nla_put_failure;
+ 
++>>>>>>> 3d98ee52659c (net: bonding: add broadcast_neighbor netlink option)
  	if (BOND_MODE(bond) == BOND_MODE_8023AD) {
  		struct ad_info info;
  
diff --cc include/uapi/linux/if_link.h
index cbdeb8390e3f,784ace3a519c..000000000000
--- a/include/uapi/linux/if_link.h
+++ b/include/uapi/linux/if_link.h
@@@ -1496,6 -1534,8 +1496,11 @@@ enum 
  	IFLA_BOND_AD_LACP_ACTIVE,
  	IFLA_BOND_MISSED_MAX,
  	IFLA_BOND_NS_IP6_TARGET,
++<<<<<<< HEAD
++=======
+ 	IFLA_BOND_COUPLED_CONTROL,
+ 	IFLA_BOND_BROADCAST_NEIGH,
++>>>>>>> 3d98ee52659c (net: bonding: add broadcast_neighbor netlink option)
  	__IFLA_BOND_MAX,
  };
  
* Unmerged path drivers/net/bonding/bond_netlink.c
* Unmerged path include/uapi/linux/if_link.h
