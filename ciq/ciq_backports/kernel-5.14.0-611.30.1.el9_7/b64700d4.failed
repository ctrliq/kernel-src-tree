squashfs: fix memory leak in squashfs_fill_super

jira KERNEL-619
cve CVE-2025-38415
Rebuild_History Non-Buildable kernel-5.14.0-611.30.1.el9_7
commit-author Phillip Lougher <phillip@squashfs.org.uk>
commit b64700d41bdc4e9f82f1346c15a3678ebb91a89c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-611.30.1.el9_7/b64700d4.failed

If sb_min_blocksize returns 0, squashfs_fill_super exits without freeing
allocated memory (sb->s_fs_info).

Fix this by moving the call to sb_min_blocksize to before memory is
allocated.

Link: https://lkml.kernel.org/r/20250811223740.110392-1-phillip@squashfs.org.uk
Fixes: 734aa85390ea ("Squashfs: check return result of sb_min_blocksize")
	Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>
	Reported-by: Scott GUO <scottzhguo@tencent.com>
Closes: https://lore.kernel.org/all/20250811061921.3807353-1-scott_gzh@163.com
	Cc: <stable@vger.kernel.org>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
(cherry picked from commit b64700d41bdc4e9f82f1346c15a3678ebb91a89c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/squashfs/super.c
diff --cc fs/squashfs/super.c
index 80d664267af0,4465cf05603a..000000000000
--- a/fs/squashfs/super.c
+++ b/fs/squashfs/super.c
@@@ -146,18 -191,9 +146,24 @@@ static int squashfs_fill_super(struct s
  
  	TRACE("Entered squashfs_fill_superblock\n");
  
++<<<<<<< HEAD
 +	/*
 +	 * squashfs provides 'backing_dev_info' in order to disable read-ahead. For
 +	 * squashfs, I/O is not deferred, it is done immediately in read_folio,
 +	 * which means the user would always have to wait their own I/O. So the effect
 +	 * of readahead is very weak for squashfs. squashfs_bdi_init will set
 +	 * sb->s_bdi->ra_pages and sb->s_bdi->io_pages to 0 and close readahead for
 +	 * squashfs.
 +	 */
 +	err = squashfs_bdi_init(sb);
 +	if (err) {
 +		errorf(fc, "squashfs init bdi failed");
 +		return err;
++=======
+ 	if (!devblksize) {
+ 		errorf(fc, "squashfs: unable to set blocksize\n");
+ 		return -EINVAL;
++>>>>>>> b64700d41bdc (squashfs: fix memory leak in squashfs_fill_super)
  	}
  
  	sb->s_fs_info = kzalloc(sizeof(*msblk), GFP_KERNEL);
* Unmerged path fs/squashfs/super.c
