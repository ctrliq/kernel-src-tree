s390: Disable ARCH_WANT_OPTIMIZE_HUGETLB_VMEMMAP

jira KERNEL-619
Rebuild_History Non-Buildable kernel-5.14.0-611.30.1.el9_7
commit-author Heiko Carstens <hca@linux.ibm.com>
commit 64e2f60f355e556337fcffe80b9bcff1b22c9c42
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-611.30.1.el9_7/64e2f60f.failed

As reported by Luiz Capitulino enabling HVO on s390 leads to reproducible
crashes. The problem is that kernel page tables are modified without
flushing corresponding TLB entries.

Even if it looks like the empty flush_tlb_all() implementation on s390 is
the problem, it is actually a different problem: on s390 it is not allowed
to replace an active/valid page table entry with another valid page table
entry without the detour over an invalid entry. A direct replacement may
lead to random crashes and/or data corruption.

In order to invalidate an entry special instructions have to be used
(e.g. ipte or idte). Alternatively there are also special instructions
available which allow to replace a valid entry with a different valid
entry (e.g. crdte or cspg).

Given that the HVO code currently does not provide the hooks to allow for
an implementation which is compliant with the s390 architecture
requirements, disable ARCH_WANT_OPTIMIZE_HUGETLB_VMEMMAP again, which is
basically a revert of the original patch which enabled it.

	Reported-by: Luiz Capitulino <luizcap@redhat.com>
Closes: https://lore.kernel.org/all/20251028153930.37107-1-luizcap@redhat.com/
Fixes: 00a34d5a99c0 ("s390: select ARCH_WANT_HUGETLB_PAGE_OPTIMIZE_VMEMMAP")
	Cc: stable@vger.kernel.org
	Tested-by: Luiz Capitulino <luizcap@redhat.com>
	Reviewed-by: Gerald Schaefer <gerald.schaefer@linux.ibm.com>
	Reviewed-by: David Hildenbrand <david@redhat.com>
	Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
(cherry picked from commit 64e2f60f355e556337fcffe80b9bcff1b22c9c42)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/Kconfig
diff --cc arch/s390/Kconfig
index 8ef1849b4c60,df22b10d9141..000000000000
--- a/arch/s390/Kconfig
+++ b/arch/s390/Kconfig
@@@ -132,9 -155,10 +132,13 @@@ config S39
  	select ARCH_WANTS_NO_INSTR
  	select ARCH_WANT_DEFAULT_BPF_JIT
  	select ARCH_WANT_IPC_PARSE_VERSION
 -	select ARCH_WANT_IRQS_OFF_ACTIVATE_MM
  	select ARCH_WANT_KERNEL_PMD_MKWRITE
  	select ARCH_WANT_LD_ORPHAN_WARN
++<<<<<<< HEAD
 +	select ARCH_WANT_OPTIMIZE_HUGETLB_VMEMMAP
++=======
+ 	select ARCH_WANTS_THP_SWAP
++>>>>>>> 64e2f60f355e (s390: Disable ARCH_WANT_OPTIMIZE_HUGETLB_VMEMMAP)
  	select BUILDTIME_TABLE_SORT
  	select CLONE_BACKWARDS2
  	select DCACHE_WORD_ACCESS if !KMSAN
* Unmerged path arch/s390/Kconfig
