xen/blkfront: fix memory allocation flags in blkfront_setup_indirect()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-533.el8
commit-author Juergen Gross <jgross@suse.com>
commit 3a169c0be75b59dd85d159493634870cdec6d3c4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-533.el8/3a169c0b.failed

Commit 1d5c76e664333 ("xen-blkfront: switch kcalloc to kvcalloc for
large array allocation") didn't fix the issue it was meant to, as the
flags for allocating the memory are GFP_NOIO, which will lead the
memory allocation falling back to kmalloc().

So instead of GFP_NOIO use GFP_KERNEL and do all the memory allocation
in blkfront_setup_indirect() in a memalloc_noio_{save,restore} section.

Fixes: 1d5c76e664333 ("xen-blkfront: switch kcalloc to kvcalloc for large array allocation")
	Cc: stable@vger.kernel.org
	Signed-off-by: Juergen Gross <jgross@suse.com>
	Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
	Acked-by: Roger Pau Monn√© <roger.pau@citrix.com>
Link: https://lore.kernel.org/r/20200403090034.8753-1-jgross@suse.com
	Signed-off-by: Juergen Gross <jgross@suse.com>
(cherry picked from commit 3a169c0be75b59dd85d159493634870cdec6d3c4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/block/xen-blkfront.c
diff --cc drivers/block/xen-blkfront.c
index 229d1b6c43b1,b32877e0b384..000000000000
--- a/drivers/block/xen-blkfront.c
+++ b/drivers/block/xen-blkfront.c
@@@ -46,6 -46,8 +46,11 @@@
  #include <linux/scatterlist.h>
  #include <linux/bitmap.h>
  #include <linux/list.h>
++<<<<<<< HEAD
++=======
+ #include <linux/workqueue.h>
+ #include <linux/sched/mm.h>
++>>>>>>> 3a169c0be75b (xen/blkfront: fix memory allocation flags in blkfront_setup_indirect())
  
  #include <xen/xen.h>
  #include <xen/xenbus.h>
* Unmerged path drivers/block/xen-blkfront.c
