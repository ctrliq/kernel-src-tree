fork: fix pidfd_poll()'s return type

jira LE-1907
Rebuild_History Non-Buildable kernel-rt-4.18.0-372.26.1.rt7.183.el8_6
commit-author Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
commit 9e77716a75bc6cf54965e5ec069ba7c02b32251c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-372.26.1.rt7.183.el8_6/9e77716a.failed

pidfd_poll() is defined as returning 'unsigned int' but the
.poll method is declared as returning '__poll_t', a bitwise type.

Fix this by using the proper return type and using the EPOLL
constants instead of the POLL ones, as required for __poll_t.

Fixes: b53b0b9d9a61 ("pidfd: add polling support")
	Cc: Joel Fernandes (Google) <joel@joelfernandes.org>
	Cc: stable@vger.kernel.org # 5.3
	Signed-off-by: Luc Van Oostenryck <luc.vanoostenryck@gmail.com>
	Reviewed-by: Christian Brauner <christian.brauner@ubuntu.com>
Link: https://lore.kernel.org/r/20191120003320.31138-1-luc.vanoostenryck@gmail.com
	Signed-off-by: Christian Brauner <christian.brauner@ubuntu.com>
(cherry picked from commit 9e77716a75bc6cf54965e5ec069ba7c02b32251c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/fork.c
diff --cc kernel/fork.c
index 2f2eeb19562e,13b38794efb5..000000000000
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@@ -1769,8 -1705,34 +1769,36 @@@ static void pidfd_show_fdinfo(struct se
  }
  #endif
  
++<<<<<<< HEAD
++=======
+ /*
+  * Poll support for process exit notification.
+  */
+ static __poll_t pidfd_poll(struct file *file, struct poll_table_struct *pts)
+ {
+ 	struct task_struct *task;
+ 	struct pid *pid = file->private_data;
+ 	__poll_t poll_flags = 0;
+ 
+ 	poll_wait(file, &pid->wait_pidfd, pts);
+ 
+ 	rcu_read_lock();
+ 	task = pid_task(pid, PIDTYPE_PID);
+ 	/*
+ 	 * Inform pollers only when the whole thread group exits.
+ 	 * If the thread group leader exits before all other threads in the
+ 	 * group, then poll(2) should block, similar to the wait(2) family.
+ 	 */
+ 	if (!task || (task->exit_state && thread_group_empty(task)))
+ 		poll_flags = EPOLLIN | EPOLLRDNORM;
+ 	rcu_read_unlock();
+ 
+ 	return poll_flags;
+ }
+ 
++>>>>>>> 9e77716a75bc (fork: fix pidfd_poll()'s return type)
  const struct file_operations pidfd_fops = {
  	.release = pidfd_release,
 -	.poll = pidfd_poll,
  #ifdef CONFIG_PROC_FS
  	.show_fdinfo = pidfd_show_fdinfo,
  #endif
* Unmerged path kernel/fork.c
