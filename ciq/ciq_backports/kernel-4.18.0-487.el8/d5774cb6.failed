net/sched: act_ct: set ctinfo in meta action depending on ct state

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-487.el8
commit-author Vlad Buslov <vladbu@nvidia.com>
commit d5774cb6c55c8721c2daf57cc5e5345e3af286ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-487.el8/d5774cb6.failed

Currently tcf_ct_flow_table_fill_actions() function assumes that only
established connections can be offloaded and always sets ctinfo to either
IP_CT_ESTABLISHED or IP_CT_ESTABLISHED_REPLY strictly based on direction
without checking actual connection state. To enable UDP NEW connection
offload set the ctinfo, metadata cookie and NF_FLOW_HW_ESTABLISHED
flow_offload flags bit based on ct->status value.

	Signed-off-by: Vlad Buslov <vladbu@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d5774cb6c55c8721c2daf57cc5e5345e3af286ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_ct.c
diff --cc net/sched/act_ct.c
index 76785fdbe97a,2cee3f9f83de..000000000000
--- a/net/sched/act_ct.c
+++ b/net/sched/act_ct.c
@@@ -248,6 -249,10 +248,13 @@@ static int tcf_ct_flow_table_fill_actio
  	switch (tdir) {
  	case FLOW_OFFLOAD_DIR_ORIGINAL:
  		dir = IP_CT_DIR_ORIGINAL;
++<<<<<<< HEAD
++=======
+ 		ctinfo = test_bit(IPS_SEEN_REPLY_BIT, &ct->status) ?
+ 			IP_CT_ESTABLISHED : IP_CT_NEW;
+ 		if (ctinfo == IP_CT_ESTABLISHED)
+ 			set_bit(NF_FLOW_HW_ESTABLISHED, &flow->flags);
++>>>>>>> d5774cb6c55c (net/sched: act_ct: set ctinfo in meta action depending on ct state)
  		break;
  	case FLOW_OFFLOAD_DIR_REPLY:
  		dir = IP_CT_DIR_REPLY;
* Unmerged path net/sched/act_ct.c
