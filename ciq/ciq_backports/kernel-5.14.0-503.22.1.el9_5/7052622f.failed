netfilter: nft_socket: Fix a NULL vs IS_ERR() bug in nft_socket_cgroup_subtree_level()

jira LE-2290
Rebuild_History Non-Buildable kernel-5.14.0-503.22.1.el9_5
commit-author Dan Carpenter <dan.carpenter@linaro.org>
commit 7052622fccb1efb850c6b55de477f65d03525a30
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-503.22.1.el9_5/7052622f.failed

The cgroup_get_from_path() function never returns NULL, it returns error
pointers.  Update the error handling to match.

Fixes: 7f3287db6543 ("netfilter: nft_socket: make cgroupsv2 matching work with namespaces")
	Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
	Acked-by: Florian Westphal <fw@strlen.de>
	Acked-by: Pablo Neira Ayuso <pablo@netfilter.org>
Link: https://patch.msgid.link/bbc0c4e0-05cc-4f44-8797-2f4b3920a820@stanley.mountain
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 7052622fccb1efb850c6b55de477f65d03525a30)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nft_socket.c
diff --cc net/netfilter/nft_socket.c
index 7605b96d8ebc,0a8883a93e83..000000000000
--- a/net/netfilter/nft_socket.c
+++ b/net/netfilter/nft_socket.c
@@@ -52,6 -54,28 +52,31 @@@ nft_sock_get_eval_cgroupv2(u32 *dest, s
  	memcpy(dest, &cgid, sizeof(u64));
  	return true;
  }
++<<<<<<< HEAD
++=======
+ 
+ /* process context only, uses current->nsproxy. */
+ static noinline int nft_socket_cgroup_subtree_level(void)
+ {
+ 	struct cgroup *cgrp = cgroup_get_from_path("/");
+ 	int level;
+ 
+ 	if (IS_ERR(cgrp))
+ 		return PTR_ERR(cgrp);
+ 
+ 	level = cgrp->level;
+ 
+ 	cgroup_put(cgrp);
+ 
+ 	if (WARN_ON_ONCE(level > 255))
+ 		return -ERANGE;
+ 
+ 	if (WARN_ON_ONCE(level < 0))
+ 		return -EINVAL;
+ 
+ 	return level;
+ }
++>>>>>>> 7052622fccb1 (netfilter: nft_socket: Fix a NULL vs IS_ERR() bug in nft_socket_cgroup_subtree_level())
  #endif
  
  static struct sock *nft_socket_do_lookup(const struct nft_pktinfo *pkt)
* Unmerged path net/netfilter/nft_socket.c
