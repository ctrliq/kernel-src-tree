powerpc/fsl: Update Spectre v2 reporting

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-193.el8
Rebuild_CHGLOG: - [powerpc] fsl: Update Spectre v2 reporting (Gustavo Duarte) [1777686]
Rebuild_FUZZ: 88.89%
commit-author Diana Craciun <diana.craciun@nxp.com>
commit dfa88658fb0583abb92e062c7a9cd5a5b94f2a46
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-193.el8/dfa88658.failed

Report branch predictor state flush as a mitigation for
Spectre variant 2.

	Signed-off-by: Diana Craciun <diana.craciun@nxp.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit dfa88658fb0583abb92e062c7a9cd5a5b94f2a46)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/kernel/security.c
diff --cc arch/powerpc/kernel/security.c
index d465307cccdd,9b8631533e02..000000000000
--- a/arch/powerpc/kernel/security.c
+++ b/arch/powerpc/kernel/security.c
@@@ -169,24 -190,34 +169,32 @@@ ssize_t cpu_show_spectre_v2(struct devi
  	bcs = security_ftr_enabled(SEC_FTR_BCCTRL_SERIALISED);
  	ccd = security_ftr_enabled(SEC_FTR_COUNT_CACHE_DISABLED);
  
 -	if (bcs || ccd || count_cache_flush_type != COUNT_CACHE_FLUSH_NONE) {
 -		bool comma = false;
 +	if (bcs || ccd) {
  		seq_buf_printf(&s, "Mitigation: ");
  
 -		if (bcs) {
 +		if (bcs)
  			seq_buf_printf(&s, "Indirect branch serialisation (kernel only)");
 -			comma = true;
 -		}
 -
 -		if (ccd) {
 -			if (comma)
 -				seq_buf_printf(&s, ", ");
 -			seq_buf_printf(&s, "Indirect branch cache disabled");
 -			comma = true;
 -		}
  
 -		if (comma)
 +		if (bcs && ccd)
  			seq_buf_printf(&s, ", ");
  
 -		seq_buf_printf(&s, "Software count cache flush");
 +		if (ccd)
 +			seq_buf_printf(&s, "Indirect branch cache disabled");
 +	} else if (count_cache_flush_type != COUNT_CACHE_FLUSH_NONE) {
 +		seq_buf_printf(&s, "Mitigation: Software count cache flush");
  
  		if (count_cache_flush_type == COUNT_CACHE_FLUSH_HW)
++<<<<<<< HEAD
 +			seq_buf_printf(&s, " (hardware accelerated)");
 +	} else
++=======
+ 			seq_buf_printf(&s, "(hardware accelerated)");
+ 	} else if (btb_flush_enabled) {
+ 		seq_buf_printf(&s, "Mitigation: Branch predictor state flush");
+ 	} else {
++>>>>>>> dfa88658fb05 (powerpc/fsl: Update Spectre v2 reporting)
  		seq_buf_printf(&s, "Vulnerable");
+ 	}
  
  	seq_buf_printf(&s, "\n");
  
* Unmerged path arch/powerpc/kernel/security.c
