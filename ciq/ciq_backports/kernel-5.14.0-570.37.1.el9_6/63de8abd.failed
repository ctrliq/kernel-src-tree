arm64: insn: Add support for encoding DSB

jira LE-4018
Rebuild_History Non-Buildable kernel-5.14.0-570.37.1.el9_6
commit-author James Morse <james.morse@arm.com>
commit 63de8abd97ddb9b758bd8f915ecbd18e1f1a87a0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-570.37.1.el9_6/63de8abd.failed

To generate code in the eBPF epilogue that uses the DSB instruction,
insn.c needs a heler to encode the type and domain.

Re-use the crm encoding logic from the DMB instruction.

	Signed-off-by: James Morse <james.morse@arm.com>
	Reviewed-by: Catalin Marinas <catalin.marinas@arm.com>
(cherry picked from commit 63de8abd97ddb9b758bd8f915ecbd18e1f1a87a0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/include/asm/insn.h
#	arch/arm64/lib/insn.c
diff --cc arch/arm64/include/asm/insn.h
index db1aeacd4cd9,18c7811774d3..000000000000
--- a/arch/arm64/include/asm/insn.h
+++ b/arch/arm64/include/asm/insn.h
@@@ -686,6 -706,9 +686,12 @@@ u32 aarch64_insn_gen_cas(enum aarch64_i
  }
  #endif
  u32 aarch64_insn_gen_dmb(enum aarch64_insn_mb_type type);
++<<<<<<< HEAD
++=======
+ u32 aarch64_insn_gen_dsb(enum aarch64_insn_mb_type type);
+ u32 aarch64_insn_gen_mrs(enum aarch64_insn_register result,
+ 			 enum aarch64_insn_system_register sysreg);
++>>>>>>> 63de8abd97dd (arm64: insn: Add support for encoding DSB)
  
  s32 aarch64_get_branch_offset(u32 insn);
  u32 aarch64_set_branch_offset(u32 insn, s32 offset);
diff --cc arch/arm64/lib/insn.c
index a635ab83fee3,4e298baddc2e..000000000000
--- a/arch/arm64/lib/insn.c
+++ b/arch/arm64/lib/insn.c
@@@ -1515,3 -1543,29 +1514,32 @@@ u32 aarch64_insn_gen_dmb(enum aarch64_i
  
  	return insn;
  }
++<<<<<<< HEAD
++=======
+ 
+ u32 aarch64_insn_gen_dsb(enum aarch64_insn_mb_type type)
+ {
+ 	u32 opt, insn;
+ 
+ 	opt = __get_barrier_crm_val(type);
+ 	if (opt == AARCH64_BREAK_FAULT)
+ 		return AARCH64_BREAK_FAULT;
+ 
+ 	insn = aarch64_insn_get_dsb_base_value();
+ 	insn &= ~GENMASK(11, 8);
+ 	insn |= (opt << 8);
+ 
+ 	return insn;
+ }
+ 
+ u32 aarch64_insn_gen_mrs(enum aarch64_insn_register result,
+ 			 enum aarch64_insn_system_register sysreg)
+ {
+ 	u32 insn = aarch64_insn_get_mrs_value();
+ 
+ 	insn &= ~GENMASK(19, 0);
+ 	insn |= sysreg << 5;
+ 	return aarch64_insn_encode_register(AARCH64_INSN_REGTYPE_RT,
+ 					    insn, result);
+ }
++>>>>>>> 63de8abd97dd (arm64: insn: Add support for encoding DSB)
* Unmerged path arch/arm64/include/asm/insn.h
* Unmerged path arch/arm64/lib/insn.c
