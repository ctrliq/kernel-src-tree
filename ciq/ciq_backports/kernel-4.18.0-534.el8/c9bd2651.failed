netfilter: nf_tables: disable toggling dormant table state more than once

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-534.el8
commit-author Florian Westphal <fw@strlen.de>
commit c9bd26513b3a11b3adb3c2ed8a31a01a87173ff1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-534.el8/c9bd2651.failed

nft -f -<<EOF
add table ip t
add table ip t { flags dormant; }
add chain ip t c { type filter hook input priority 0; }
add table ip t
EOF

Triggers a splat from nf core on next table delete because we lose
track of right hook register state:

WARNING: CPU: 2 PID: 1597 at net/netfilter/core.c:501 __nf_unregister_net_hook
RIP: 0010:__nf_unregister_net_hook+0x41b/0x570
 nf_unregister_net_hook+0xb4/0xf0
 __nf_tables_unregister_hook+0x160/0x1d0
[..]

The above should have table in *active* state, but in fact no
hooks were registered.

Reject on/off/on games rather than attempting to fix this.

Fixes: 179d9ba5559a ("netfilter: nf_tables: fix table flag updates")
	Reported-by: "Lee, Cherie-Anne" <cherie.lee@starlabs.sg>
	Cc: Bing-Jhong Billy Jheng <billy@starlabs.sg>
	Cc: info@starlabs.sg
	Signed-off-by: Florian Westphal <fw@strlen.de>
(cherry picked from commit c9bd26513b3a11b3adb3c2ed8a31a01a87173ff1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nf_tables_api.c
diff --cc net/netfilter/nf_tables_api.c
index 4dd3d2e4449b,a3680638ec60..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -955,6 -1213,16 +955,19 @@@ static int nf_tables_updtable(struct nf
  	if (flags == ctx->table->flags)
  		return 0;
  
++<<<<<<< HEAD
++=======
+ 	if ((nft_table_has_owner(ctx->table) &&
+ 	     !(flags & NFT_TABLE_F_OWNER)) ||
+ 	    (!nft_table_has_owner(ctx->table) &&
+ 	     flags & NFT_TABLE_F_OWNER))
+ 		return -EOPNOTSUPP;
+ 
+ 	/* No dormant off/on/off/on games in single transaction */
+ 	if (ctx->table->flags & __NFT_TABLE_F_UPDATE)
+ 		return -EINVAL;
+ 
++>>>>>>> c9bd26513b3a (netfilter: nf_tables: disable toggling dormant table state more than once)
  	trans = nft_trans_alloc(ctx, NFT_MSG_NEWTABLE,
  				sizeof(struct nft_trans_table));
  	if (trans == NULL)
* Unmerged path net/netfilter/nf_tables_api.c
