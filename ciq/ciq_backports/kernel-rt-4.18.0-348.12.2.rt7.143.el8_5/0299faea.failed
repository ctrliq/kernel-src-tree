ice: Remove toggling of antispoof for VF trusted promiscuous mode

jira NONE_AUTOMATION
Rebuild_History Non-Buildable kernel-rt-4.18.0-348.12.2.rt7.143.el8_5
commit-author Brett Creeley <brett.creeley@intel.com>
commit 0299faeaf8eb982103e4388af61fd94feb9c2d9f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-348.12.2.rt7.143.el8_5/0299faea.failed

Currently when a trusted VF enables promiscuous mode spoofchk will be
disabled. This is wrong and should only be modified from the
ndo_set_vf_spoofchk callback. Fix this by removing the call to toggle
spoofchk for trusted VFs.

Fixes: 01b5e89aab49 ("ice: Add VF promiscuous support")
	Signed-off-by: Brett Creeley <brett.creeley@intel.com>
	Tested-by: Tony Brelinski <tony.brelinski@intel.com>
	Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
(cherry picked from commit 0299faeaf8eb982103e4388af61fd94feb9c2d9f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ice/ice_virtchnl_pf.c
diff --cc drivers/net/ethernet/intel/ice/ice_virtchnl_pf.c
index a34c9478adcf,3f8f94732a1f..000000000000
--- a/drivers/net/ethernet/intel/ice/ice_virtchnl_pf.c
+++ b/drivers/net/ethernet/intel/ice/ice_virtchnl_pf.c
@@@ -2988,25 -3055,10 +2988,32 @@@ static int ice_vc_cfg_promiscuous_mode_
  	rm_promisc = !allmulti && !alluni;
  
  	if (vsi->num_vlan || vf->port_vlan_info) {
++<<<<<<< HEAD
 +		struct ice_vsi *pf_vsi = ice_get_main_vsi(pf);
 +		struct net_device *pf_netdev;
 +
 +		if (!pf_vsi) {
 +			v_ret = VIRTCHNL_STATUS_ERR_PARAM;
 +			goto error_param;
 +		}
 +
 +		pf_netdev = pf_vsi->netdev;
 +
 +		ret = ice_set_vf_spoofchk(pf_netdev, vf->vf_id, rm_promisc);
 +		if (ret) {
 +			dev_err(dev, "Failed to update spoofchk to %s for VF %d VSI %d when setting promiscuous mode\n",
 +				rm_promisc ? "ON" : "OFF", vf->vf_id,
 +				vsi->vsi_num);
 +			v_ret = VIRTCHNL_STATUS_ERR_PARAM;
 +		}
 +
 +		ret = ice_cfg_vlan_pruning(vsi, true, !rm_promisc);
++=======
+ 		if (rm_promisc)
+ 			ret = ice_cfg_vlan_pruning(vsi, true);
+ 		else
+ 			ret = ice_cfg_vlan_pruning(vsi, false);
++>>>>>>> 0299faeaf8eb (ice: Remove toggling of antispoof for VF trusted promiscuous mode)
  		if (ret) {
  			dev_err(dev, "Failed to configure VLAN pruning in promiscuous mode\n");
  			v_ret = VIRTCHNL_STATUS_ERR_PARAM;
* Unmerged path drivers/net/ethernet/intel/ice/ice_virtchnl_pf.c
