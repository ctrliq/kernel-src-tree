net: sched: act_mirred: drop dst for the direction from egress to ingress

jira NONE_AUTOMATION
Rebuild_History Non-Buildable kernel-rt-4.18.0-348.12.2.rt7.143.el8_5
commit-author Xin Long <lucien.xin@gmail.com>
commit f799ada6bf2397c351220088b9b0980125c77280
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-348.12.2.rt7.143.el8_5/f799ada6.failed

Without dropping dst, the packets sent from local mirred/redirected
to ingress will may still use the old dst. ip_rcv() will drop it as
the old dst is for output and its .input is dst_discard.

This patch is to fix by also dropping dst for those packets that are
mirred or redirected from egress to ingress in act_mirred.

Note that we don't drop it for the direction change from ingress to
egress, as on which there might be a user case attaching a metadata
dst by act_tunnel_key that would be used later.

Fixes: b57dc7c13ea9 ("net/sched: Introduce action ct")
	Signed-off-by: Xin Long <lucien.xin@gmail.com>
	Acked-by: Cong Wang <cong.wang@bytedance.com>
	Reviewed-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit f799ada6bf2397c351220088b9b0980125c77280)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/act_mirred.c
diff --cc net/sched/act_mirred.c
index d9c5d44d4f4a,efc963ab995a..000000000000
--- a/net/sched/act_mirred.c
+++ b/net/sched/act_mirred.c
@@@ -278,10 -274,12 +281,18 @@@ static int tcf_mirred_act(struct sk_buf
  			goto out;
  	}
  
+ 	want_ingress = tcf_mirred_act_wants_ingress(m_eaction);
+ 
  	/* All mirred/redirected skbs should clear previous ct info */
++<<<<<<< HEAD
 +	nf_reset(skb2);
 +
 +	want_ingress = tcf_mirred_act_wants_ingress(m_eaction);
++=======
+ 	nf_reset_ct(skb2);
+ 	if (want_ingress && !at_ingress) /* drop dst for egress -> ingress */
+ 		skb_dst_drop(skb2);
++>>>>>>> f799ada6bf23 (net: sched: act_mirred: drop dst for the direction from egress to ingress)
  
  	expects_nh = want_ingress || !m_mac_header_xmit;
  	at_nh = skb->data == skb_network_header(skb);
* Unmerged path net/sched/act_mirred.c
