wifi: mt76: mt7915: fix memory leak in mt7915_mmio_wed_init_rx_buf

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-496.el8
commit-author Lorenzo Bianconi <lorenzo@kernel.org>
commit 412d19b42042fb7e7148ee5293a7ce682a76a0f2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-496.el8/412d19b4.failed

Free mt76_txwi_cache pointer in mt7915_mmio_wed_init_rx_buf routine in
case of failure.

Fixes: 4f831d18d12d ("wifi: mt76: mt7915: enable WED RX support")
	Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
	Signed-off-by: Felix Fietkau <nbd@nbd.name>
(cherry picked from commit 412d19b42042fb7e7148ee5293a7ce682a76a0f2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/mediatek/mt76/mt7915/mmio.c
diff --cc drivers/net/wireless/mediatek/mt76/mt7915/mmio.c
index f6597b0b0587,65b5f3c4a05e..000000000000
--- a/drivers/net/wireless/mediatek/mt76/mt7915/mmio.c
+++ b/drivers/net/wireless/mediatek/mt76/mt7915/mmio.c
@@@ -638,16 -634,23 +638,34 @@@ static u32 mt7915_mmio_wed_init_rx_buf(
  		int token;
  		void *ptr;
  
++<<<<<<< HEAD
 +		ptr = page_frag_alloc(&wed->rx_buf_ring.rx_page, length,
 +				      GFP_KERNEL);
 +		if (!ptr)
 +			goto unmap;
 +
++=======
+ 		if (!t)
+ 			goto unmap;
+ 
+ 		page = __dev_alloc_pages(GFP_KERNEL, get_order(length));
+ 		if (!page) {
+ 			mt76_put_rxwi(&dev->mt76, t);
+ 			goto unmap;
+ 		}
+ 
+ 		ptr = page_address(page);
++>>>>>>> 412d19b42042 (wifi: mt76: mt7915: fix memory leak in mt7915_mmio_wed_init_rx_buf)
  		phy_addr = dma_map_single(dev->mt76.dma_dev, ptr,
  					  wed->wlan.rx_size,
  					  DMA_TO_DEVICE);
  		if (unlikely(dma_mapping_error(dev->mt76.dev, phy_addr))) {
++<<<<<<< HEAD
 +			skb_free_frag(ptr);
++=======
+ 			__free_pages(page, get_order(length));
+ 			mt76_put_rxwi(&dev->mt76, t);
++>>>>>>> 412d19b42042 (wifi: mt76: mt7915: fix memory leak in mt7915_mmio_wed_init_rx_buf)
  			goto unmap;
  		}
  
@@@ -656,7 -659,8 +674,12 @@@
  		if (token < 0) {
  			dma_unmap_single(dev->mt76.dma_dev, phy_addr,
  					 wed->wlan.rx_size, DMA_TO_DEVICE);
++<<<<<<< HEAD
 +			skb_free_frag(ptr);
++=======
+ 			__free_pages(page, get_order(length));
+ 			mt76_put_rxwi(&dev->mt76, t);
++>>>>>>> 412d19b42042 (wifi: mt76: mt7915: fix memory leak in mt7915_mmio_wed_init_rx_buf)
  			goto unmap;
  		}
  
* Unmerged path drivers/net/wireless/mediatek/mt76/mt7915/mmio.c
