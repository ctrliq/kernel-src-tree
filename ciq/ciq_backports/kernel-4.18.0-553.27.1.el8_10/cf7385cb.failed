of: module: add buffer overflow check in of_modalias()

jira LE-2169
cve CVE-2024-38541
Rebuild_History Non-Buildable kernel-4.18.0-553.27.1.el8_10
commit-author Sergey Shtylyov <s.shtylyov@omp.ru>
commit cf7385cb26ac4f0ee6c7385960525ad534323252
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.27.1.el8_10/cf7385cb.failed

In of_modalias(), if the buffer happens to be too small even for the 1st
snprintf() call, the len parameter will become negative and str parameter
(if not NULL initially) will point beyond the buffer's end. Add the buffer
overflow check after the 1st snprintf() call and fix such check after the
strlen() call (accounting for the terminating NUL char).

Fixes: bc575064d688 ("of/device: use of_property_for_each_string to parse compatible strings")
	Signed-off-by: Sergey Shtylyov <s.shtylyov@omp.ru>
Link: https://lore.kernel.org/r/bbfc6be0-c687-62b6-d015-5141b93f313e@omp.ru
	Signed-off-by: Rob Herring <robh@kernel.org>
(cherry picked from commit cf7385cb26ac4f0ee6c7385960525ad534323252)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/of/module.c
* Unmerged path drivers/of/module.c
* Unmerged path drivers/of/module.c
