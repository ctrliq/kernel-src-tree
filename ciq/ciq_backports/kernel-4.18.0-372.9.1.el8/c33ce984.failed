efi/x86: Call efi_parse_options() from efi_main()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-372.9.1.el8
commit-author Hans de Goede <hdegoede@redhat.com>
commit c33ce984435bb6142792802d75513a71e55d1969
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-372.9.1.el8/c33ce984.failed

Before this commit we were only calling efi_parse_options() from
make_boot_params(), but make_boot_params() only gets called if the
kernel gets booted directly as an EFI executable. So when booted through
e.g. grub we ended up not parsing the commandline in the boot code.

This makes the drivers/firmware/efi/libstub code ignore the "quiet"
commandline argument resulting in the following message being printed:
"EFI stub: UEFI Secure Boot is enabled."

Despite the quiet request. This commits adds an extra call to
efi_parse_options() to efi_main() to make sure that the options are
always processed. This fixes quiet not working.

This also fixes the libstub code ignoring nokaslr and efi=nochunk.

	Reported-by: Peter Robinson <pbrobinson@redhat.com>
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
	Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
(cherry picked from commit c33ce984435bb6142792802d75513a71e55d1969)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/compressed/eboot.c
diff --cc arch/x86/boot/compressed/eboot.c
index 5371d39c184d,8b4c5e001157..000000000000
--- a/arch/x86/boot/compressed/eboot.c
+++ b/arch/x86/boot/compressed/eboot.c
@@@ -754,7 -738,7 +754,11 @@@ efi_main(struct efi_config *c, struct b
  	struct desc_struct *desc;
  	void *handle;
  	efi_system_table_t *_table;
++<<<<<<< HEAD
 +	bool is64;
++=======
+ 	unsigned long cmdline_paddr;
++>>>>>>> c33ce984435b (efi/x86: Call efi_parse_options() from efi_main())
  
  	efi_early = c;
  
* Unmerged path arch/x86/boot/compressed/eboot.c
