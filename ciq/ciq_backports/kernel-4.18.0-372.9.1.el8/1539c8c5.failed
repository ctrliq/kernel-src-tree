ASoC: SOF: core: debug: force all processing on primary core

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-372.9.1.el8
commit-author Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
commit 1539c8c5fcca217e3de063e7fbec97f83c7938a7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-372.9.1.el8/1539c8c5.failed

The topology file currently provides information on which
pipeline/processing is to be scheduled on which DSP core.

To help diagnose potential issues, this patch provides an override of
the 'core' tokens to use the primary core (typically core0). Of course
this may result in a Core0 activity that exceeds hardware
capabilities, so this should only be used when the total processing
fits on DSP - possibly using firmware mockup processing and stubs.

No new dmesg log was added to avoid adding noise during topology
parsing, but the existing logs will show the primary core being used.

This is strictly for validation/debug, products should NEVER use this
override, the topology is assumed to be the description of the
firmware graph.

	Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Reviewed-by: Bard Liao <bard.liao@intel.com>
	Reviewed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
Link: https://lore.kernel.org/r/20211006110645.26679-2-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 1539c8c5fcca217e3de063e7fbec97f83c7938a7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/sof-priv.h
#	sound/soc/sof/topology.c
diff --cc sound/soc/sof/sof-priv.h
index 94632a45d6b0,0ca64f0f8873..000000000000
--- a/sound/soc/sof/sof-priv.h
+++ b/sound/soc/sof/sof-priv.h
@@@ -23,6 -23,16 +23,19 @@@
  /* debug flags */
  #define SOF_DBG_ENABLE_TRACE	BIT(0)
  #define SOF_DBG_RETAIN_CTX	BIT(1)	/* prevent DSP D3 on FW exception */
++<<<<<<< HEAD
++=======
+ #define SOF_DBG_VERIFY_TPLG	BIT(2) /* verify topology during load */
+ #define SOF_DBG_DYNAMIC_PIPELINES_OVERRIDE	BIT(3) /* 0: use topology token
+ 							* 1: override topology
+ 							*/
+ #define SOF_DBG_DYNAMIC_PIPELINES_ENABLE	BIT(4) /* 0: use static pipelines
+ 							* 1: use dynamic pipelines
+ 							*/
+ #define SOF_DBG_DISABLE_MULTICORE		BIT(5) /* schedule all pipelines/widgets
+ 							* on primary core
+ 							*/
++>>>>>>> 1539c8c5fcca (ASoC: SOF: core: debug: force all processing on primary core)
  
  #define SOF_DBG_DUMP_REGS		BIT(0)
  #define SOF_DBG_DUMP_MBOX		BIT(1)
diff --cc sound/soc/sof/topology.c
index 87a2664abf33,73c0ee7b88ac..000000000000
--- a/sound/soc/sof/topology.c
+++ b/sound/soc/sof/topology.c
@@@ -1757,9 -1759,17 +1757,20 @@@ static int sof_widget_load_pipeline(str
  		goto err;
  	}
  
++<<<<<<< HEAD
 +	dev_dbg(scomp->dev, "pipeline %s: period %d pri %d mips %d core %d frames %d\n",
++=======
+ 	if (sof_core_debug & SOF_DBG_DISABLE_MULTICORE)
+ 		pipeline->core = SOF_DSP_PRIMARY_CORE;
+ 
+ 	if (sof_core_debug & SOF_DBG_DYNAMIC_PIPELINES_OVERRIDE)
+ 		swidget->dynamic_pipeline_widget = sof_core_debug &
+ 			SOF_DBG_DYNAMIC_PIPELINES_ENABLE;
+ 
+ 	dev_dbg(scomp->dev, "pipeline %s: period %d pri %d mips %d core %d frames %d dynamic %d\n",
++>>>>>>> 1539c8c5fcca (ASoC: SOF: core: debug: force all processing on primary core)
  		swidget->widget->name, pipeline->period, pipeline->priority,
 -		pipeline->period_mips, pipeline->core, pipeline->frames_per_sched,
 -		swidget->dynamic_pipeline_widget);
 +		pipeline->period_mips, pipeline->core, pipeline->frames_per_sched);
  
  	swidget->private = pipeline;
  
* Unmerged path sound/soc/sof/sof-priv.h
* Unmerged path sound/soc/sof/topology.c
