dm: revert partial fix for redundant bio-based IO accounting

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-372.9.1.el8
commit-author Mike Snitzer <snitzer@redhat.com>
commit f524d9c95fab54783d0038f7a3e8c014d5b56857
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-372.9.1.el8/f524d9c9.failed

Reverts a1e1cb72d9649 ("dm: fix redundant IO accounting for bios that
need splitting") because it was too narrow in scope (only addressed
redundant 'sectors[]' accounting and not ios, nsecs[], etc).

	Cc: stable@vger.kernel.org
	Signed-off-by: Mike Snitzer <snitzer@redhat.com>
Link: https://lore.kernel.org/r/20220128155841.39644-3-snitzer@redhat.com
	Signed-off-by: Jens Axboe <axboe@kernel.dk>
(cherry picked from commit f524d9c95fab54783d0038f7a3e8c014d5b56857)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm.c
diff --cc drivers/md/dm.c
index a0a8d24fb33f,9849114b3c08..000000000000
--- a/drivers/md/dm.c
+++ b/drivers/md/dm.c
@@@ -1620,21 -1477,9 +1617,24 @@@ static blk_qc_t __split_and_process_bio
  						  GFP_NOIO, &md->queue->bio_split);
  			ci.io->orig_bio = b;
  
++<<<<<<< HEAD
 +			/*
 +			 * Adjust IO stats for each split, otherwise upon queue
 +			 * reentry there will be redundant IO accounting.
 +			 * NOTE: this is a stop-gap fix, a proper fix involves
 +			 * significant refactoring of DM core's bio splitting
 +			 * (by eliminating DM's splitting and just using bio_split)
 +			 */
 +			part_stat_lock();
 +			__dm_part_stat_sub(&dm_disk(md)->part0,
 +					   sectors[op_stat_group(bio_op(bio))], ci.sector_count);
 +			part_stat_unlock();
 +
++=======
++>>>>>>> f524d9c95fab (dm: revert partial fix for redundant bio-based IO accounting)
  			bio_chain(b, bio);
 -			trace_block_split(b, bio->bi_iter.bi_sector);
 -			submit_bio_noacct(bio);
 +			trace_block_split(md->queue, b, bio->bi_iter.bi_sector);
 +			ret = generic_make_request(bio);
  		}
  	}
  
* Unmerged path drivers/md/dm.c
