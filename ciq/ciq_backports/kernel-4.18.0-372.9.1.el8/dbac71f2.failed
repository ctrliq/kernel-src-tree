net/mlx5e: Accept action skbedit in the tc actions list

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-372.9.1.el8
commit-author Ariel Levkovich <lariel@nvidia.com>
commit dbac71f22954276633e525f958994f84a7bd303f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-372.9.1.el8/dbac71f2.failed

Setting the skb packet type field to host is usually
done when performing forwarding to ingress device.

This is required since the receive handling that is used
by the redirect to ingress action checks whether the packet
doesn't belong to this host and drops the packet in such case.

In order to be able to offload action redirect ingress, tc offload
code needs to accept the skbedit ptype action as well.

There's no special handling in HW for such action since it will
be followed by a redirect action and therefore, this code
only allows us to accept such action in the actions list but
not performing anything specific in HW for it.

	Signed-off-by: Ariel Levkovich <lariel@nvidia.com>
	Reviewed-by: Paul Blakey <paulb@nvidia.com>
	Reviewed-by: Vlad Buslov <vladbu@nvidia.com>
	Reviewed-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit dbac71f22954276633e525f958994f84a7bd303f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index ff4d59984b35,3242eba67047..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -3758,6 -3851,18 +3758,21 @@@ static int parse_tc_fdb_actions(struct 
  
  	flow_action_for_each(i, act, flow_action) {
  		switch (act->id) {
++<<<<<<< HEAD
++=======
+ 		case FLOW_ACTION_ACCEPT:
+ 			action |= MLX5_FLOW_CONTEXT_ACTION_FWD_DEST |
+ 				MLX5_FLOW_CONTEXT_ACTION_COUNT;
+ 			attr->flags |= MLX5_ESW_ATTR_FLAG_ACCEPT;
+ 			break;
+ 		case FLOW_ACTION_PTYPE:
+ 			if (act->ptype != PACKET_HOST) {
+ 				NL_SET_ERR_MSG_MOD(extack,
+ 						   "skbedit ptype is only supported with type host");
+ 				return -EOPNOTSUPP;
+ 			}
+ 			break;
++>>>>>>> dbac71f22954 (net/mlx5e: Accept action skbedit in the tc actions list)
  		case FLOW_ACTION_DROP:
  			action |= MLX5_FLOW_CONTEXT_ACTION_DROP |
  				  MLX5_FLOW_CONTEXT_ACTION_COUNT;
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
