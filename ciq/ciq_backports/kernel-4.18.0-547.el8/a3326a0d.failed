efi/x86: Use symbolic constants in PE header instead of bare numbers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-547.el8
commit-author Ard Biesheuvel <ardb@kernel.org>
commit a3326a0d878c433d69981c504f8c8ade60cd2b51
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-547.el8/a3326a0d.failed

Replace bare numbers in the PE/COFF header structure with symbolic
constants so they become self documenting.

	Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
(cherry picked from commit a3326a0d878c433d69981c504f8c8ade60cd2b51)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/header.S
diff --cc arch/x86/boot/header.S
index 763bed306fcf,f65661a58cf8..000000000000
--- a/arch/x86/boot/header.S
+++ b/arch/x86/boot/header.S
@@@ -102,11 -100,15 +100,15 @@@ pe_header
  
  coff_header:
  #ifdef CONFIG_X86_32
- 	.word	0x14c				# i386
+ 	.set	image_file_add_flags, IMAGE_FILE_32BIT_MACHINE
+ 	.set	pe_opt_magic, PE_OPT_MAGIC_PE32
+ 	.word	IMAGE_FILE_MACHINE_I386
  #else
- 	.word	0x8664				# x86-64
+ 	.set	image_file_add_flags, 0
+ 	.set	pe_opt_magic, PE_OPT_MAGIC_PE32PLUS
+ 	.word	IMAGE_FILE_MACHINE_AMD64
  #endif
 -	.word	section_count			# nr_sections
 +	.word	3				# nr_sections
  	.long	0 				# TimeDateStamp
  	.long	0				# PointerToSymbolTable
  	.long	1				# NumberOfSymbols
@@@ -228,8 -221,31 +221,34 @@@ section_table
  	.long	0				# PointerToLineNumbers
  	.word	0				# NumberOfRelocations
  	.word	0				# NumberOfLineNumbers
- 	.long	0x42100040			# Characteristics (section flags)
+ 	.long	IMAGE_SCN_CNT_INITIALIZED_DATA	| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_DISCARDABLE	| \
+ 		IMAGE_SCN_ALIGN_1BYTES		# Characteristics
+ 
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_EFI_MIXED
+ 	#
+ 	# The offset & size fields are filled in by build.c.
+ 	#
+ 	.asciz	".compat"
+ 	.long	0
+ 	.long	0x0
+ 	.long	0				# Size of initialized data
+ 						# on disk
+ 	.long	0x0
+ 	.long	0				# PointerToRelocations
+ 	.long	0				# PointerToLineNumbers
+ 	.word	0				# NumberOfRelocations
+ 	.word	0				# NumberOfLineNumbers
+ 	.long	IMAGE_SCN_CNT_INITIALIZED_DATA	| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_DISCARDABLE	| \
+ 		IMAGE_SCN_ALIGN_1BYTES		# Characteristics
+ #endif
  
++>>>>>>> a3326a0d878c (efi/x86: Use symbolic constants in PE header instead of bare numbers)
  	#
  	# The offset & size fields are filled in by build.c.
  	#
@@@ -246,8 -262,12 +265,11 @@@
  	.long	0				# PointerToLineNumbers
  	.word	0				# NumberOfRelocations
  	.word	0				# NumberOfLineNumbers
- 	.long	0x60500020			# Characteristics (section flags)
+ 	.long	IMAGE_SCN_CNT_CODE		| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_EXECUTE		| \
+ 		IMAGE_SCN_ALIGN_16BYTES		# Characteristics
  
 -	.set	section_count, (. - section_table) / 40
  #endif /* CONFIG_EFI_STUB */
  
  	# Kernel attributes; used by setup.  This is part 1 of the
* Unmerged path arch/x86/boot/header.S
