x86/efi: Drop alignment flags from PE section headers

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-547.el8
commit-author Ard Biesheuvel <ardb@kernel.org>
commit bfab35f552ab3dd6d017165bf9de1d1d20f198cc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-547.el8/bfab35f5.failed

The section header flags for alignment are documented in the PE/COFF
spec as being applicable to PE object files only, not to PE executables
such as the Linux bzImage, so let's drop them from the PE header.

	Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
Link: https://lore.kernel.org/r/20230912090051.4014114-20-ardb@google.com
(cherry picked from commit bfab35f552ab3dd6d017165bf9de1d1d20f198cc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/header.S
diff --cc arch/x86/boot/header.S
index 4df6cba47914,8c8148d751c6..000000000000
--- a/arch/x86/boot/header.S
+++ b/arch/x86/boot/header.S
@@@ -212,7 -207,9 +212,13 @@@ section_table
  	.long	0				# PointerToLineNumbers
  	.word	0				# NumberOfRelocations
  	.word	0				# NumberOfLineNumbers
++<<<<<<< HEAD
 +	.long	0x60500020			# Characteristics (section flags)
++=======
+ 	.long	IMAGE_SCN_CNT_CODE		| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_EXECUTE		# Characteristics
++>>>>>>> bfab35f552ab (x86/efi: Drop alignment flags from PE section headers)
  
  	#
  	# The EFI application loader requires a relocation section
@@@ -230,7 -227,28 +236,32 @@@
  	.long	0				# PointerToLineNumbers
  	.word	0				# NumberOfRelocations
  	.word	0				# NumberOfLineNumbers
++<<<<<<< HEAD
 +	.long	0x42100040			# Characteristics (section flags)
++=======
+ 	.long	IMAGE_SCN_CNT_INITIALIZED_DATA	| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_DISCARDABLE	# Characteristics
+ 
+ #ifdef CONFIG_EFI_MIXED
+ 	#
+ 	# The offset & size fields are filled in by build.c.
+ 	#
+ 	.asciz	".compat"
+ 	.long	0
+ 	.long	0x0
+ 	.long	0				# Size of initialized data
+ 						# on disk
+ 	.long	0x0
+ 	.long	0				# PointerToRelocations
+ 	.long	0				# PointerToLineNumbers
+ 	.word	0				# NumberOfRelocations
+ 	.word	0				# NumberOfLineNumbers
+ 	.long	IMAGE_SCN_CNT_INITIALIZED_DATA	| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_DISCARDABLE	# Characteristics
+ #endif
++>>>>>>> bfab35f552ab (x86/efi: Drop alignment flags from PE section headers)
  
  	#
  	# The offset & size fields are filled in by build.c.
@@@ -248,8 -266,11 +279,14 @@@
  	.long	0				# PointerToLineNumbers
  	.word	0				# NumberOfRelocations
  	.word	0				# NumberOfLineNumbers
++<<<<<<< HEAD
 +	.long	0x60500020			# Characteristics (section flags)
++=======
+ 	.long	IMAGE_SCN_CNT_CODE		| \
+ 		IMAGE_SCN_MEM_READ		| \
+ 		IMAGE_SCN_MEM_EXECUTE		# Characteristics
++>>>>>>> bfab35f552ab (x86/efi: Drop alignment flags from PE section headers)
  
 -	.set	section_count, (. - section_table) / 40
  #endif /* CONFIG_EFI_STUB */
  
  	# Kernel attributes; used by setup.  This is part 1 of the
* Unmerged path arch/x86/boot/header.S
