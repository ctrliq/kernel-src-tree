efi: x86: Set the NX-compatibility flag in the PE header

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-547.el8
commit-author Peter Jones <pjones@redhat.com>
commit 24b72bb12e84c75e297a5a81f24b921d7a011575
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-547.el8/24b72bb1.failed

Following Baskov Evgeniy's "Handle UEFI NX-restricted page tables"
patches, it's safe to set this compatibility flag to let loaders know
they don't need to make special accommodations for kernel to load if
pre-boot NX is enabled.

	Signed-off-by: Peter Jones <pjones@redhat.com>
Link: https://lore.kernel.org/all/20220329184743.798513-1-pjones@redhat.com/
	Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
(cherry picked from commit 24b72bb12e84c75e297a5a81f24b921d7a011575)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/boot/header.S
diff --cc arch/x86/boot/header.S
index 4df6cba47914,0352e4589efa..000000000000
--- a/arch/x86/boot/header.S
+++ b/arch/x86/boot/header.S
@@@ -172,8 -162,12 +172,16 @@@ extra_header_fields
  
  	.long	0x200				# SizeOfHeaders
  	.long	0				# CheckSum
++<<<<<<< HEAD
 +	.word	0xa				# Subsystem (EFI application)
++=======
+ 	.word	IMAGE_SUBSYSTEM_EFI_APPLICATION	# Subsystem (EFI application)
+ #ifdef CONFIG_DXE_MEM_ATTRIBUTES
+ 	.word	IMAGE_DLL_CHARACTERISTICS_NX_COMPAT	# DllCharacteristics
+ #else
++>>>>>>> 24b72bb12e84 (efi: x86: Set the NX-compatibility flag in the PE header)
  	.word	0				# DllCharacteristics
+ #endif
  #ifdef CONFIG_X86_32
  	.long	0				# SizeOfStackReserve
  	.long	0				# SizeOfStackCommit
* Unmerged path arch/x86/boot/header.S
