cifs: update iface_last_update on each query-and-update

jira LE-4669
Rebuild_History Non-Buildable kernel-4.18.0-553.82.1.el8_10
commit-author Shyam Prasad N <sprasad@microsoft.com>
commit 78e727e58e54efca4c23863fbd9e16e9d2d83f81
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.82.1.el8_10/78e727e5.failed

iface_last_update was an unused field when it was introduced.
Later, when we had periodic update of server interface list,
this field was used regularly to decide when to update next.

However, with the new logic of updating the interfaces, it
becomes crucial that this field be updated whenever
parse_server_interfaces runs successfully.

This change updates this field when either the server does
not support query of interfaces; so that we do not query
the interfaces repeatedly. It also updates the field when
the function reaches the end.

Fixes: aa45dadd34e4 ("cifs: change iface_list from array to sorted linked list")
	Signed-off-by: Shyam Prasad N <sprasad@microsoft.com>
	Signed-off-by: Steve French <stfrench@microsoft.com>
(cherry picked from commit 78e727e58e54efca4c23863fbd9e16e9d2d83f81)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/smb2ops.c
diff --cc fs/cifs/smb2ops.c
index dec2f3bd2cdb,d9553c2556a2..000000000000
--- a/fs/cifs/smb2ops.c
+++ b/fs/cifs/smb2ops.c
@@@ -558,7 -614,8 +558,12 @@@ parse_server_interfaces(struct network_
  				 "multichannel not available\n"
  				 "Empty network interface list returned by server %s\n",
  				 ses->server->hostname);
++<<<<<<< HEAD:fs/cifs/smb2ops.c
 +		rc = -EINVAL;
++=======
+ 		rc = -EOPNOTSUPP;
+ 		ses->iface_last_update = jiffies;
++>>>>>>> 78e727e58e54 (cifs: update iface_last_update on each query-and-update):fs/smb/client/smb2ops.c
  		goto out;
  	}
  
@@@ -679,11 -734,7 +683,15 @@@ next_iface
  	if ((bytes_left > 8) || p->Next)
  		cifs_dbg(VFS, "%s: incomplete interface info\n", __func__);
  
++<<<<<<< HEAD:fs/cifs/smb2ops.c
 +
 +	if (!ses->iface_count) {
 +		rc = -EINVAL;
 +		goto out;
 +	}
++=======
+ 	ses->iface_last_update = jiffies;
++>>>>>>> 78e727e58e54 (cifs: update iface_last_update on each query-and-update):fs/smb/client/smb2ops.c
  
  out:
  	/*
* Unmerged path fs/cifs/smb2ops.c
