cifs: remove unused server parameter from calc_smb_size()

jira LE-4669
Rebuild_History Non-Buildable kernel-4.18.0-553.82.1.el8_10
commit-author Enzo Matsumiya <ematsumiya@suse.de>
commit 68ed14496b032b0c9ef21b38ee45c6c8f3a18ff1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.82.1.el8_10/68ed1449.failed

This parameter is unused by the called function

	Reviewed-by: Paulo Alcantara (SUSE) <pc@cjr.nz>
	Signed-off-by: Enzo Matsumiya <ematsumiya@suse.de>
	Signed-off-by: Steve French <stfrench@microsoft.com>
(cherry picked from commit 68ed14496b032b0c9ef21b38ee45c6c8f3a18ff1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/cifs_debug.c
#	fs/cifs/smb2ops.c
diff --cc fs/cifs/cifs_debug.c
index 3f6f269506f0,c05477e28cff..000000000000
--- a/fs/cifs/cifs_debug.c
+++ b/fs/cifs/cifs_debug.c
@@@ -51,13 -38,11 +51,21 @@@ void cifs_dump_detail(void *buf, struc
  #ifdef CONFIG_CIFS_DEBUG2
  	struct smb_hdr *smb = buf;
  
++<<<<<<< HEAD
 +	cifs_dbg(VFS, "Cmd: %d Err: 0x%x Flags: 0x%x Flgs2: 0x%x Mid: %d Pid: %d Wct: %d\n",
 +		 smb->Command, smb->Status.CifsError, smb->Flags,
 +		 smb->Flags2, smb->Mid, smb->Pid, smb->WordCount);
 +	if (!server->ops->check_message(buf, server->total_read, server)) {
 +		cifs_dbg(VFS, "smb buf %p len %u\n", smb,
 +			 server->ops->calc_smb_size(smb, server));
 +	}
++=======
+ 	cifs_dbg(VFS, "Cmd: %d Err: 0x%x Flags: 0x%x Flgs2: 0x%x Mid: %d Pid: %d\n",
+ 		 smb->Command, smb->Status.CifsError,
+ 		 smb->Flags, smb->Flags2, smb->Mid, smb->Pid);
+ 	cifs_dbg(VFS, "smb buf %p len %u\n", smb,
+ 		 server->ops->calc_smb_size(smb));
++>>>>>>> 68ed14496b03 (cifs: remove unused server parameter from calc_smb_size())
  #endif /* CONFIG_CIFS_DEBUG2 */
  }
  
diff --cc fs/cifs/smb2ops.c
index ed042b9ee7a1,293fdfdf374b..000000000000
--- a/fs/cifs/smb2ops.c
+++ b/fs/cifs/smb2ops.c
@@@ -384,10 -386,8 +384,15 @@@ smb2_dump_detail(void *buf, struct TCP_
  	cifs_server_dbg(VFS, "Cmd: %d Err: 0x%x Flags: 0x%x Mid: %llu Pid: %d\n",
  		 shdr->Command, shdr->Status, shdr->Flags, shdr->MessageId,
  		 shdr->Id.SyncId.ProcessId);
++<<<<<<< HEAD
 +	if (!server->ops->check_message(buf, server->total_read, server)) {
 +		cifs_server_dbg(VFS, "smb buf %p len %u\n", buf,
 +				server->ops->calc_smb_size(buf, server));
 +	}
++=======
+ 	cifs_server_dbg(VFS, "smb buf %p len %u\n", buf,
+ 		 server->ops->calc_smb_size(buf));
++>>>>>>> 68ed14496b03 (cifs: remove unused server parameter from calc_smb_size())
  #endif
  }
  
* Unmerged path fs/cifs/cifs_debug.c
diff --git a/fs/cifs/cifsglob.h b/fs/cifs/cifsglob.h
index 9e7f8c48e52c..1e2bcfdb13f2 100644
--- a/fs/cifs/cifsglob.h
+++ b/fs/cifs/cifsglob.h
@@ -399,7 +399,7 @@ struct smb_version_operations {
 	int (*close_dir)(const unsigned int, struct cifs_tcon *,
 			 struct cifs_fid *);
 	/* calculate a size of SMB message */
-	unsigned int (*calc_smb_size)(void *buf, struct TCP_Server_Info *ptcpi);
+	unsigned int (*calc_smb_size)(void *buf);
 	/* check for STATUS_PENDING and process the response if yes */
 	bool (*is_status_pending)(char *buf, struct TCP_Server_Info *server);
 	/* check for STATUS_NETWORK_SESSION_EXPIRED */
diff --git a/fs/cifs/cifsproto.h b/fs/cifs/cifsproto.h
index 6bf63b7632f7..610150d68902 100644
--- a/fs/cifs/cifsproto.h
+++ b/fs/cifs/cifsproto.h
@@ -144,7 +144,7 @@ extern int cifs_get_writable_path(struct cifs_tcon *tcon, const char *name,
 extern struct cifsFileInfo *find_readable_file(struct cifsInodeInfo *, bool);
 extern int cifs_get_readable_path(struct cifs_tcon *tcon, const char *name,
 				  struct cifsFileInfo **ret_file);
-extern unsigned int smbCalcSize(void *buf, struct TCP_Server_Info *server);
+extern unsigned int smbCalcSize(void *buf);
 extern int decode_negTokenInit(unsigned char *security_blob, int length,
 			struct TCP_Server_Info *server);
 extern int cifs_convert_address(struct sockaddr *dst, const char *src, int len);
diff --git a/fs/cifs/misc.c b/fs/cifs/misc.c
index 8fdd91a0addb..2112052922b9 100644
--- a/fs/cifs/misc.c
+++ b/fs/cifs/misc.c
@@ -356,7 +356,7 @@ checkSMB(char *buf, unsigned int total_read, struct TCP_Server_Info *server)
 	/* otherwise, there is enough to get to the BCC */
 	if (check_smb_hdr(smb))
 		return -EIO;
-	clc_len = smbCalcSize(smb, server);
+	clc_len = smbCalcSize(smb);
 
 	if (4 + rfclen != total_read) {
 		cifs_dbg(VFS, "Length read does not match RFC1001 length %d\n",
diff --git a/fs/cifs/netmisc.c b/fs/cifs/netmisc.c
index e248a6427665..df48771cd1b0 100644
--- a/fs/cifs/netmisc.c
+++ b/fs/cifs/netmisc.c
@@ -925,7 +925,7 @@ map_and_check_smb_error(struct mid_q_entry *mid, bool logErr)
  * portion, the number of word parameters and the data portion of the message
  */
 unsigned int
-smbCalcSize(void *buf, struct TCP_Server_Info *server)
+smbCalcSize(void *buf)
 {
 	struct smb_hdr *ptr = buf;
 	return (sizeof(struct smb_hdr) + (2 * ptr->WordCount) +
diff --git a/fs/cifs/readdir.c b/fs/cifs/readdir.c
index 8831d64ff2d2..5f39d8b46790 100644
--- a/fs/cifs/readdir.c
+++ b/fs/cifs/readdir.c
@@ -805,8 +805,7 @@ find_cifs_entry(const unsigned int xid, struct cifs_tcon *tcon, loff_t pos,
 
 		end_of_smb = cfile->srch_inf.ntwrk_buf_start +
 			server->ops->calc_smb_size(
-					cfile->srch_inf.ntwrk_buf_start,
-					server);
+					cfile->srch_inf.ntwrk_buf_start);
 
 		cur_ent = cfile->srch_inf.srch_entries_start;
 		first_entry_in_buffer = cfile->srch_inf.index_of_last_entry
@@ -1005,8 +1004,7 @@ int cifs_readdir(struct file *file, struct dir_context *ctx)
 	cifs_dbg(FYI, "loop through %d times filling dir for net buf %p\n",
 		 num_to_fill, cifsFile->srch_inf.ntwrk_buf_start);
 	max_len = tcon->ses->server->ops->calc_smb_size(
-			cifsFile->srch_inf.ntwrk_buf_start,
-			tcon->ses->server);
+			cifsFile->srch_inf.ntwrk_buf_start);
 	end_of_smb = cifsFile->srch_inf.ntwrk_buf_start + max_len;
 
 	tmp_buf = kmalloc(UNICODE_NAME_MAX, GFP_KERNEL);
diff --git a/fs/cifs/smb2misc.c b/fs/cifs/smb2misc.c
index a3424673fd30..76017a131132 100644
--- a/fs/cifs/smb2misc.c
+++ b/fs/cifs/smb2misc.c
@@ -225,7 +225,7 @@ smb2_check_message(char *buf, unsigned int len, struct TCP_Server_Info *server)
 		}
 	}
 
-	calc_len = smb2_calc_size(buf, server);
+	calc_len = smb2_calc_size(buf);
 
 	/* For SMB2_IOCTL, OutputOffset and OutputLength are optional, so might
 	 * be 0, and not a real miscalculation */
@@ -413,7 +413,7 @@ smb2_get_data_area_len(int *off, int *len, struct smb2_hdr *shdr)
  * portion, the number of word parameters and the data portion of the message.
  */
 unsigned int
-smb2_calc_size(void *buf, struct TCP_Server_Info *srvr)
+smb2_calc_size(void *buf)
 {
 	struct smb2_pdu *pdu = buf;
 	struct smb2_hdr *shdr = &pdu->hdr;
* Unmerged path fs/cifs/smb2ops.c
diff --git a/fs/cifs/smb2proto.h b/fs/cifs/smb2proto.h
index e5e808350790..f454d9432942 100644
--- a/fs/cifs/smb2proto.h
+++ b/fs/cifs/smb2proto.h
@@ -23,7 +23,7 @@ struct smb_rqst;
 extern int map_smb2_to_linux_error(char *buf, bool log_err);
 extern int smb2_check_message(char *buf, unsigned int length,
 			      struct TCP_Server_Info *server);
-extern unsigned int smb2_calc_size(void *buf, struct TCP_Server_Info *server);
+extern unsigned int smb2_calc_size(void *buf);
 extern char *smb2_get_data_area_len(int *off, int *len,
 				    struct smb2_hdr *shdr);
 extern __le16 *cifs_convert_path_to_utf16(const char *from,
