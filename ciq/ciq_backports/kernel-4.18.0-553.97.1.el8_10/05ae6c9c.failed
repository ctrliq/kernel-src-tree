scsi: lpfc: Fix lpfc_check_sli_ndlp() handling for GEN_REQUEST64 commands

jira KERNEL-548
Rebuild_History Non-Buildable kernel-4.18.0-553.97.1.el8_10
commit-author Justin Tee <justin.tee@broadcom.com>
commit 05ae6c9c7315d844fbc15afe393f5ba5e5771126
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.97.1.el8_10/05ae6c9c.failed

In lpfc_check_sli_ndlp(), the get_job_els_rsp64_did remote_id assignment
does not apply for GEN_REQUEST64 commands as it only has meaning for a
ELS_REQUEST64 command.  So, if (iocb->ndlp == ndlp) is false, we could
erroneously return the wrong value.  Fix by replacing the fallthrough
statement with a break statement before the remote_id check.

	Signed-off-by: Justin Tee <justin.tee@broadcom.com>
Link: https://lore.kernel.org/r/20250425194806.3585-2-justintee8345@gmail.com
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 05ae6c9c7315d844fbc15afe393f5ba5e5771126)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/lpfc/lpfc_hbadisc.c
diff --cc drivers/scsi/lpfc/lpfc_hbadisc.c
index 0c20ab745390,b5273cb1adbd..000000000000
--- a/drivers/scsi/lpfc/lpfc_hbadisc.c
+++ b/drivers/scsi/lpfc/lpfc_hbadisc.c
@@@ -5211,20 -5044,23 +5211,24 @@@ lpfc_check_sli_ndlp(struct lpfc_hba *ph
  	if (iocb->vport != vport)
  		return 0;
  
 -	ulp_command = get_job_cmnd(phba, iocb);
 -	ulp_context = get_job_ulpcontext(phba, iocb);
 -	remote_id = get_job_els_rsp64_did(phba, iocb);
 -
  	if (pring->ringno == LPFC_ELS_RING) {
 -		switch (ulp_command) {
 +		switch (icmd->ulpCommand) {
  		case CMD_GEN_REQUEST64_CR:
 -			if (iocb->ndlp == ndlp)
 +			if (iocb->context_un.ndlp == ndlp)
  				return 1;
++<<<<<<< HEAD
 +			/* fall through */
++=======
+ 			break;
++>>>>>>> 05ae6c9c7315 (scsi: lpfc: Fix lpfc_check_sli_ndlp() handling for GEN_REQUEST64 commands)
  		case CMD_ELS_REQUEST64_CR:
 -			if (remote_id == ndlp->nlp_DID)
 +			if (icmd->un.elsreq64.remoteID == ndlp->nlp_DID)
  				return 1;
 -			fallthrough;
 +			/* fall through */
  		case CMD_XMIT_ELS_RSP64_CX:
 -			if (iocb->ndlp == ndlp)
 +			if (iocb->context1 == (uint8_t *) ndlp)
  				return 1;
 +			/* fall through */
  		}
  	} else if (pring->ringno == LPFC_FCP_RING) {
  		/* Skip match check if waiting to relogin to FCP target */
* Unmerged path drivers/scsi/lpfc/lpfc_hbadisc.c
