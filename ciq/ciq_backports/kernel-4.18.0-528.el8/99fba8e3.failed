Bluetooth: btqca: Moved extracting rom version info to common place

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-528.el8
commit-author Venkata Lakshmi Narayana Gubba <gubbaven@codeaurora.org>
commit 99fba8e3f1d1fd60042187a90ba2381efc1833f7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-528.el8/99fba8e3.failed

Moved extracting rom version info to common place as this code is
common in all if else ladder in qca_uart_setup.

	Signed-off-by: Venkata Lakshmi Narayana Gubba <gubbaven@codeaurora.org>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit 99fba8e3f1d1fd60042187a90ba2381efc1833f7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/bluetooth/btqca.c
diff --cc drivers/bluetooth/btqca.c
index 424366e6f3e3,be04d74037d2..000000000000
--- a/drivers/bluetooth/btqca.c
+++ b/drivers/bluetooth/btqca.c
@@@ -528,18 -539,33 +528,31 @@@ int qca_uart_setup(struct hci_dev *hdev
  
  	bt_dev_dbg(hdev, "QCA setup on UART");
  
 -	soc_ver = get_soc_ver(ver.soc_id, ver.rom_ver);
 -
 -	bt_dev_info(hdev, "QCA controller version 0x%08x", soc_ver);
 -
  	config.user_baud_rate = baudrate;
  
+ 	/* Firmware files to download are based on ROM version.
+ 	 * ROM version is derived from last two bytes of soc_ver.
+ 	 */
+ 	rom_ver = ((soc_ver & 0x00000f00) >> 0x04) | (soc_ver & 0x0000000f);
+ 
  	/* Download rampatch file */
  	config.type = TLV_TYPE_PATCH;
  	if (qca_is_wcn399x(soc_type)) {
- 		/* Firmware files to download are based on ROM version.
- 		 * ROM version is derived from last two bytes of soc_ver.
- 		 */
- 		rom_ver = ((soc_ver & 0x00000f00) >> 0x04) |
- 			    (soc_ver & 0x0000000f);
  		snprintf(config.fwname, sizeof(config.fwname),
  			 "qca/crbtfw%02x.tlv", rom_ver);
++<<<<<<< HEAD
++=======
+ 	} else if (soc_type == QCA_QCA6390) {
+ 		snprintf(config.fwname, sizeof(config.fwname),
+ 			 "qca/htbtfw%02x.tlv", rom_ver);
+ 	} else if (soc_type == QCA_WCN6750) {
+ 		/* Choose mbn file by default.If mbn file is not found
+ 		 * then choose tlv file
+ 		 */
+ 		config.type = ELF_TYPE_PATCH;
+ 		snprintf(config.fwname, sizeof(config.fwname),
+ 			 "qca/msbtfw%02x.mbn", rom_ver);
++>>>>>>> 99fba8e3f1d1 (Bluetooth: btqca: Moved extracting rom version info to common place)
  	} else {
  		snprintf(config.fwname, sizeof(config.fwname),
  			 "qca/rampatch_%08x.bin", soc_ver);
* Unmerged path drivers/bluetooth/btqca.c
