Bluetooth: btqca: Add valid le states quirk

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-528.el8
commit-author Abhishek Pandit-Subedi <abhishekpandit@chromium.org>
commit 547801380ec7e6104ea679f599d03c342b4b39a0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-528.el8/54780138.failed

WCN3991 supports connectable advertisements so we need to add the valid
le states quirk so the 'central-peripheral' role is exposed in
userspace.

	Signed-off-by: Abhishek Pandit-Subedi <abhishekpandit@chromium.org>
	Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
(cherry picked from commit 547801380ec7e6104ea679f599d03c342b4b39a0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/bluetooth/hci_qca.c
diff --cc drivers/bluetooth/hci_qca.c
index a33d551040f0,2d3f1f179a1e..000000000000
--- a/drivers/bluetooth/hci_qca.c
+++ b/drivers/bluetooth/hci_qca.c
@@@ -88,11 -73,13 +88,18 @@@ enum qca_flags 
  	QCA_SUSPENDING,
  	QCA_MEMDUMP_COLLECTION,
  	QCA_HW_ERROR_EVENT,
 -	QCA_SSR_TRIGGERED
 +	QCA_SSR_TRIGGERED,
 +	QCA_BT_OFF,
 +	QCA_ROM_FW
  };
  
++<<<<<<< HEAD
++=======
+ enum qca_capabilities {
+ 	QCA_CAP_WIDEBAND_SPEECH = BIT(0),
+ 	QCA_CAP_VALID_LE_STATES = BIT(1),
+ };
++>>>>>>> 547801380ec7 (Bluetooth: btqca: Add valid le states quirk)
  
  /* HCI_IBS transmit side sleep protocol states */
  enum tx_ibs_states {
@@@ -1822,9 -1781,10 +1829,13 @@@ static const struct qca_vreg_data qca_s
  		{ "vddch0", 450000 },
  	},
  	.num_vregs = 4,
++<<<<<<< HEAD
++=======
+ 	.capabilities = QCA_CAP_WIDEBAND_SPEECH | QCA_CAP_VALID_LE_STATES,
++>>>>>>> 547801380ec7 (Bluetooth: btqca: Add valid le states quirk)
  };
  
 -static const struct qca_device_data qca_soc_data_wcn3998 = {
 +static const struct qca_vreg_data qca_soc_data_wcn3998 = {
  	.soc_type = QCA_WCN3998,
  	.vregs = (struct qca_vreg []) {
  		{ "vddio", 10000  },
@@@ -2051,6 -2018,18 +2062,21 @@@ static int qca_serdev_probe(struct serd
  		hdev->shutdown = qca_power_off;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (data) {
+ 		/* Wideband speech support must be set per driver since it can't
+ 		 * be queried via hci. Same with the valid le states quirk.
+ 		 */
+ 		if (data->capabilities & QCA_CAP_WIDEBAND_SPEECH)
+ 			set_bit(HCI_QUIRK_WIDEBAND_SPEECH_SUPPORTED,
+ 				&hdev->quirks);
+ 
+ 		if (data->capabilities & QCA_CAP_VALID_LE_STATES)
+ 			set_bit(HCI_QUIRK_VALID_LE_STATES, &hdev->quirks);
+ 	}
+ 
++>>>>>>> 547801380ec7 (Bluetooth: btqca: Add valid le states quirk)
  	return 0;
  }
  
* Unmerged path drivers/bluetooth/hci_qca.c
