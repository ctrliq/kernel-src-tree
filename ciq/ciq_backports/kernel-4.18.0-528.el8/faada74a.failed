gfs2: Factor out duplicate quota data disposal code

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-528.el8
commit-author Andreas Gruenbacher <agruenba@redhat.com>
commit faada74a90563183cb57af3e4604ed183d71a81c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-528.el8/faada74a.failed

Rename gfs2_qd_dispose() to gfs2_qd_dispose_list().  Move some code
duplicated in gfs2_qd_dispose_list() and gfs2_quota_cleanup() into a
new gfs2_qd_dispose() function.

	Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
(cherry picked from commit faada74a90563183cb57af3e4604ed183d71a81c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/gfs2/quota.c
diff --cc fs/gfs2/quota.c
index afe74218885d,01fae6b030e9..000000000000
--- a/fs/gfs2/quota.c
+++ b/fs/gfs2/quota.c
@@@ -121,29 -138,10 +141,15 @@@ static void gfs2_qd_list_dispose(struc
  
  	while (!list_empty(list)) {
  		qd = list_first_entry(list, struct gfs2_quota_data, qd_lru);
++<<<<<<< HEAD
 +		sdp = qd->qd_gl->gl_name.ln_sbd;
 +
++=======
++>>>>>>> faada74a9056 (gfs2: Factor out duplicate quota data disposal code)
  		list_del(&qd->qd_lru);
  
- 		/* Free from the filesystem-specific list */
- 		spin_lock(&qd_lock);
- 		list_del(&qd->qd_list);
- 		spin_unlock(&qd_lock);
- 
- 		spin_lock_bucket(qd->qd_hash);
- 		hlist_bl_del_rcu(&qd->qd_hlist);
- 		spin_unlock_bucket(qd->qd_hash);
- 
- 		gfs2_assert_warn(sdp, !qd->qd_change);
- 		gfs2_assert_warn(sdp, !qd->qd_slot_count);
- 		gfs2_assert_warn(sdp, !qd->qd_bh_count);
- 
- 		gfs2_glock_put(qd->qd_gl);
+ 		gfs2_qd_dispose(qd);
  		atomic_dec(&sdp->sd_quota_count);
- 
- 		/* Delete it from the common reclaim list */
- 		call_rcu(&qd->qd_rcu, gfs2_qd_dealloc);
  	}
  }
  
* Unmerged path fs/gfs2/quota.c
