KVM: selftests: Make hyperv_clock require TSC based system clocksource

jira LE-3201
Rebuild_History Non-Buildable kernel-rt-4.18.0-553.22.1.rt7.363.el8_10
commit-author Vitaly Kuznetsov <vkuznets@redhat.com>
commit b6831a108be1206cd9f0e7905b48677b4147d5f9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-553.22.1.rt7.363.el8_10/b6831a10.failed

KVM sets up Hyper-V TSC page clocksource for its guests when system
clocksource is 'based on TSC' (see gtod_is_based_on_tsc()), running
hyperv_clock with any other clocksource leads to imminent failure.

Add the missing requirement to make the test skip gracefully.

	Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Link: https://lore.kernel.org/r/20240109141121.1619463-5-vkuznets@redhat.com
	Signed-off-by: Sean Christopherson <seanjc@google.com>
(cherry picked from commit b6831a108be1206cd9f0e7905b48677b4147d5f9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/x86_64/hyperv_clock.c
diff --cc tools/testing/selftests/kvm/x86_64/hyperv_clock.c
index e0b2bb1339b1,e058bc676cd6..000000000000
--- a/tools/testing/selftests/kvm/x86_64/hyperv_clock.c
+++ b/tools/testing/selftests/kvm/x86_64/hyperv_clock.c
@@@ -209,10 -211,12 +209,15 @@@ int main(void
  	vm_vaddr_t tsc_page_gva;
  	int stage;
  
++<<<<<<< HEAD
 +	vm = vm_create_default(VCPU_ID, 0, guest_main);
 +	run = vcpu_state(vm, VCPU_ID);
++=======
+ 	TEST_REQUIRE(kvm_has_cap(KVM_CAP_HYPERV_TIME));
+ 	TEST_REQUIRE(sys_clocksource_is_based_on_tsc());
++>>>>>>> b6831a108be1 (KVM: selftests: Make hyperv_clock require TSC based system clocksource)
  
 -	vm = vm_create_with_one_vcpu(&vcpu, guest_main);
 -
 -	vcpu_set_hv_cpuid(vcpu);
 +	vcpu_set_hv_cpuid(vm, VCPU_ID);
  
  	tsc_page_gva = vm_vaddr_alloc_page(vm);
  	memset(addr_gva2hva(vm, tsc_page_gva), 0x0, getpagesize());
* Unmerged path tools/testing/selftests/kvm/x86_64/hyperv_clock.c
