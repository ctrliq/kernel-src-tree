gfs2: run_queue cleanup

jira KERNEL-428
Rebuild_History Non-Buildable kernel-4.18.0-553.92.1.el8_10
commit-author Andreas Gruenbacher <agruenba@redhat.com>
commit cd493dcf4f827700b66d1adb43f20d3838759beb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.92.1.el8_10/cd493dcf.failed

Transform the code in run_queue() to make it more readable.  No change
in functionality.

	Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
	Reviewed-by: Andrew Price <anprice@redhat.com>
(cherry picked from commit cd493dcf4f827700b66d1adb43f20d3838759beb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/gfs2/glock.c
diff --cc fs/gfs2/glock.c
index 6ce0b8ced9b0,1eba27bb5f3c..000000000000
--- a/fs/gfs2/glock.c
+++ b/fs/gfs2/glock.c
@@@ -868,24 -850,23 +872,40 @@@ __acquires(&gl->gl_lockref.lock
  		gl->gl_target = gl->gl_demote_state;
  		do_xmote(gl, NULL, gl->gl_target);
  		return;
++<<<<<<< HEAD
 +	} else {
 +		if (test_bit(GLF_DEMOTE, &gl->gl_flags))
 +			gfs2_demote_wake(gl);
 +		if (do_promote(gl))
 +			goto out_unlock;
 +		gh = find_first_waiter(gl);
 +		if (!gh)
 +			goto out_unlock;
 +		gl->gl_target = gh->gh_state;
 +		if (!(gh->gh_flags & (LM_FLAG_TRY | LM_FLAG_TRY_1CB)))
 +			do_error(gl, 0); /* Fail queued try locks */
 +		do_xmote(gl, gh, gl->gl_target);
 +		return;
++=======
++>>>>>>> cd493dcf4f82 (gfs2: run_queue cleanup)
  	}
  
+ promote:
+ 	do_promote(gl);
+ 	if (find_first_holder(gl))
+ 		goto out_unlock;
+ 	gh = find_first_waiter(gl);
+ 	if (!gh)
+ 		goto out_unlock;
+ 	gl->gl_target = gh->gh_state;
+ 	if (!(gh->gh_flags & (LM_FLAG_TRY | LM_FLAG_TRY_1CB)))
+ 		do_error(gl, 0); /* Fail queued try locks */
+ 	do_xmote(gl, gh, gl->gl_target);
+ 	return;
+ 
  out_sched:
  	clear_bit(GLF_LOCK, &gl->gl_flags);
 +	smp_mb__after_atomic();
  	gl->gl_lockref.count++;
  	gfs2_glock_queue_work(gl, 0);
  	return;
* Unmerged path fs/gfs2/glock.c
