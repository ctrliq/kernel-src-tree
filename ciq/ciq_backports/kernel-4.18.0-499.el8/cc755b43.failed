ASoC: SOF: keep prepare/unprepare widgets in sink path

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Bard Liao <yung-chuan.liao@linux.intel.com>
commit cc755b4377b0520d594ae573497cf0824baea648
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/cc755b43.failed

The existing code return when a widget doesn't need to
prepare/unprepare. This will prevent widgets in the sink path from being
prepared/unprepared.

	Cc: <stable@vger.kernel.org> # 6.1
Link: https://github.com/thesofproject/linux/issues/4021
	Signed-off-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Reviewed-by: Rander Wang <rander.wang@intel.com>
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
Link: https://lore.kernel.org/r/20230118101255.29139-4-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit cc755b4377b0520d594ae573497cf0824baea648)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/sof-audio.c
diff --cc sound/soc/sof/sof-audio.c
index 381bbcb04dbe,ff716bfbcb67..000000000000
--- a/sound/soc/sof/sof-audio.c
+++ b/sound/soc/sof/sof-audio.c
@@@ -268,17 -266,16 +268,23 @@@ static int sof_setup_pipeline_connectio
  static void
  sof_unprepare_widgets_in_path(struct snd_sof_dev *sdev, struct snd_soc_dapm_widget *widget)
  {
 -	const struct sof_ipc_tplg_ops *ipc_tplg_ops = sdev->ipc->ops->tplg;
 -	const struct sof_ipc_tplg_widget_ops *widget_ops = ipc_tplg_ops->widget;
 +	const struct sof_ipc_tplg_ops *tplg_ops = sof_ipc_get_ops(sdev, tplg);
  	struct snd_sof_widget *swidget = widget->dobj.private;
 +	const struct sof_ipc_tplg_widget_ops *widget_ops;
  	struct snd_soc_dapm_path *p;
  
++<<<<<<< HEAD
 +	/* return if the widget is in use or if it is already unprepared */
 +	if (!swidget->prepared || swidget->use_count > 0)
 +		return;
++=======
+ 	/* skip if the widget is in use or if it is already unprepared */
+ 	if (!swidget || !swidget->prepared || swidget->use_count > 0)
+ 		goto sink_unprepare;
++>>>>>>> cc755b4377b0 (ASoC: SOF: keep prepare/unprepare widgets in sink path)
  
 -	if (widget_ops[widget->id].ipc_unprepare)
 +	widget_ops = tplg_ops ? tplg_ops->widget : NULL;
 +	if (widget_ops && widget_ops[widget->id].ipc_unprepare)
  		/* unprepare the source widget */
  		widget_ops[widget->id].ipc_unprepare(swidget);
  
* Unmerged path sound/soc/sof/sof-audio.c
