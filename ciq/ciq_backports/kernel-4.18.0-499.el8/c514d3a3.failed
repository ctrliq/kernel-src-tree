KVM: SVM: Update avic_kick_target_vcpus to support 32-bit APIC ID

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
commit c514d3a348ac4358215fdfb9ed17d4c01dd39731
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/c514d3a3.failed

In x2APIC mode, ICRH contains 32-bit destination APIC ID.
So, update the avic_kick_target_vcpus() accordingly.

	Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
	Signed-off-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Message-Id: <20220519102709.24125-6-suravee.suthikulpanit@amd.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit c514d3a348ac4358215fdfb9ed17d4c01dd39731)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/svm/avic.c
diff --cc arch/x86/kvm/svm/avic.c
index 4648844140fe,8b8a221cd635..000000000000
--- a/arch/x86/kvm/svm/avic.c
+++ b/arch/x86/kvm/svm/avic.c
@@@ -401,9 -402,15 +401,20 @@@ static void avic_kick_target_vcpus(stru
  	 * since entered the guest will have processed pending IRQs at VMRUN.
  	 */
  	kvm_for_each_vcpu(i, vcpu, kvm) {
+ 		u32 dest;
+ 
+ 		if (apic_x2apic_mode(vcpu->arch.apic))
+ 			dest = icrh;
+ 		else
+ 			dest = GET_XAPIC_DEST_FIELD(icrh);
+ 
  		if (kvm_apic_match_dest(vcpu, source, icrl & APIC_SHORT_MASK,
++<<<<<<< HEAD
 +					GET_APIC_DEST_FIELD(icrh),
 +					icrl & APIC_DEST_MASK)) {
++=======
+ 					dest, icrl & APIC_DEST_MASK)) {
++>>>>>>> c514d3a348ac (KVM: SVM: Update avic_kick_target_vcpus to support 32-bit APIC ID)
  			vcpu->arch.apic->irr_pending = true;
  			svm_complete_interrupt_delivery(vcpu,
  							icrl & APIC_MODE_MASK,
* Unmerged path arch/x86/kvm/svm/avic.c
