ASoC: SOF: amd: Fix NULL pointer crash in acp_sof_ipc_msg_data function

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author V sujith kumar Reddy <Vsujithkumar.Reddy@amd.com>
commit 051d71e073614a72ad423d6dacba37a7eeff274d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/051d71e0.failed

Check substream and runtime variables before assigning.

	Signed-off-by: V sujith kumar Reddy <Vsujithkumar.Reddy@amd.com
Link: https://lore.kernel.org/r/20230508070510.6100-1-Vsujithkumar.Reddy@amd.com
	Signed-off-by: Mark Brown <broonie@kernel.org
(cherry picked from commit 051d71e073614a72ad423d6dacba37a7eeff274d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/amd/acp-ipc.c
diff --cc sound/soc/sof/amd/acp-ipc.c
index 92f660afad80,749e856dc601..000000000000
--- a/sound/soc/sof/amd/acp-ipc.c
+++ b/sound/soc/sof/amd/acp-ipc.c
@@@ -170,15 -198,29 +170,32 @@@ irqreturn_t acp_sof_ipc_irq_thread(int 
  
  	return IRQ_HANDLED;
  }
 -EXPORT_SYMBOL_NS(acp_sof_ipc_irq_thread, SND_SOC_SOF_AMD_COMMON);
 +EXPORT_SYMBOL(acp_sof_ipc_irq_thread);
  
 -int acp_sof_ipc_msg_data(struct snd_sof_dev *sdev, struct snd_sof_pcm_stream *sps,
 +int acp_sof_ipc_msg_data(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream,
  			 void *p, size_t sz)
  {
 -	unsigned int offset = sdev->dsp_box.offset;
 +	unsigned int offset = offsetof(struct scratch_ipc_conf, sof_out_box);
  
 -	if (!sps || !sdev->stream_box.size) {
 +	if (!substream || !sdev->stream_box.size)
  		acp_mailbox_read(sdev, offset, p, sz);
++<<<<<<< HEAD
++=======
+ 	} else {
+ 		struct snd_pcm_substream *substream = sps->substream;
+ 		struct acp_dsp_stream *stream;
+ 
+ 		if (!substream || !substream->runtime)
+ 			return -ESTRPIPE;
+ 
+ 		stream = substream->runtime->private_data;
+ 
+ 		if (!stream)
+ 			return -ESTRPIPE;
+ 
+ 		acp_mailbox_read(sdev, stream->posn_offset, p, sz);
+ 	}
++>>>>>>> 051d71e07361 (ASoC: SOF: amd: Fix NULL pointer crash in acp_sof_ipc_msg_data function)
  
  	return 0;
  }
* Unmerged path sound/soc/sof/amd/acp-ipc.c
