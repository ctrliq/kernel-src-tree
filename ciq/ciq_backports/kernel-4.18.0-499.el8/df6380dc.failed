ASoC: SOF: amd: Add pcm pointer callback for amd platforms.

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author V sujith kumar Reddy <Vsujithkumar.Reddy@amd.com>
commit df6380dca2727bca62efdf332eaadd2e225f7c4d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/df6380dc.failed

Add pcm pointer callback for amd platforms to read host position
update from stream box.

	Signed-off-by: V sujith kumar Reddy <Vsujithkumar.Reddy@amd.com>
Link: https://lore.kernel.org/r/20230308084509.1496256-2-Vsujithkumar.Reddy@amd.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit df6380dca2727bca62efdf332eaadd2e225f7c4d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/amd/acp-common.c
#	sound/soc/sof/amd/acp-pcm.c
diff --cc sound/soc/sof/amd/acp-pcm.c
index 5392db39f701,f342f0bac4a3..000000000000
--- a/sound/soc/sof/amd/acp-pcm.c
+++ b/sound/soc/sof/amd/acp-pcm.c
@@@ -82,4 -83,37 +82,41 @@@ int acp_pcm_close(struct snd_sof_dev *s
  
  	return acp_dsp_stream_put(sdev, stream);
  }
++<<<<<<< HEAD
 +EXPORT_SYMBOL(acp_pcm_close);
++=======
+ EXPORT_SYMBOL_NS(acp_pcm_close, SND_SOC_SOF_AMD_COMMON);
+ 
+ snd_pcm_uframes_t acp_pcm_pointer(struct snd_sof_dev *sdev,
+ 				  struct snd_pcm_substream *substream)
+ {
+ 	struct snd_soc_pcm_runtime *rtd = asoc_substream_to_rtd(substream);
+ 	struct snd_soc_component *scomp = sdev->component;
+ 	struct snd_sof_pcm_stream *stream;
+ 	struct sof_ipc_stream_posn posn;
+ 	struct snd_sof_pcm *spcm;
+ 	snd_pcm_uframes_t pos;
+ 	int ret;
+ 
+ 	spcm = snd_sof_find_spcm_dai(scomp, rtd);
+ 	if (!spcm) {
+ 		dev_warn_ratelimited(sdev->dev, "warn: can't find PCM with DAI ID %d\n",
+ 				     rtd->dai_link->id);
+ 		return 0;
+ 	}
+ 
+ 	stream = &spcm->stream[substream->stream];
+ 	ret = snd_sof_ipc_msg_data(sdev, stream, &posn, sizeof(posn));
+ 	if (ret < 0) {
+ 		dev_warn(sdev->dev, "failed to read stream position: %d\n", ret);
+ 		return 0;
+ 	}
+ 
+ 	memcpy(&stream->posn, &posn, sizeof(posn));
+ 	pos = spcm->stream[substream->stream].posn.host_posn;
+ 	pos = bytes_to_frames(substream->runtime, pos);
+ 
+ 	return pos;
+ }
+ EXPORT_SYMBOL_NS(acp_pcm_pointer, SND_SOC_SOF_AMD_COMMON);
++>>>>>>> df6380dca272 (ASoC: SOF: amd: Add pcm pointer callback for amd platforms.)
* Unmerged path sound/soc/sof/amd/acp-common.c
* Unmerged path sound/soc/sof/amd/acp-common.c
* Unmerged path sound/soc/sof/amd/acp-pcm.c
diff --git a/sound/soc/sof/amd/acp.h b/sound/soc/sof/amd/acp.h
index 4c42b8fd6abf..93805df64e4b 100644
--- a/sound/soc/sof/amd/acp.h
+++ b/sound/soc/sof/amd/acp.h
@@ -205,6 +205,8 @@ int acp_pcm_close(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream)
 int acp_pcm_hw_params(struct snd_sof_dev *sdev, struct snd_pcm_substream *substream,
 		      struct snd_pcm_hw_params *params,
 		      struct snd_sof_platform_stream_params *platform_params);
+snd_pcm_uframes_t acp_pcm_pointer(struct snd_sof_dev *sdev,
+				  struct snd_pcm_substream *substream);
 
 extern struct snd_sof_dsp_ops sof_renoir_ops;
 
