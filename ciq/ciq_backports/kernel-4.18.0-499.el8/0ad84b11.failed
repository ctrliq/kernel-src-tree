ASoC: SOF: sof-audio: skip prepare/unprepare if swidget is NULL

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
commit 0ad84b11f2f8dd19d62d0b2ffd95ece897e6c3dc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/0ad84b11.failed

Skip preparing/unpreparing widgets if the swidget pointer is NULL. This
will be true in the case of virtual widgets in topology that were added
for reusing the legacy HDA machine driver with SOF.

Fixes: 9862dcf70245 ("ASoC: SOF: don't unprepare widget used other pipelines")
	Cc: <stable@vger.kernel.org> # 6.1
	Signed-off-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Rander Wang <rander.wang@intel.com>
	Reviewed-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
	Tested-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
Link: https://lore.kernel.org/r/20230118101255.29139-3-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 0ad84b11f2f8dd19d62d0b2ffd95ece897e6c3dc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/sof-audio.c
diff --cc sound/soc/sof/sof-audio.c
index 381bbcb04dbe,8c114e6a23c6..000000000000
--- a/sound/soc/sof/sof-audio.c
+++ b/sound/soc/sof/sof-audio.c
@@@ -274,11 -272,10 +274,11 @@@ sof_unprepare_widgets_in_path(struct sn
  	struct snd_soc_dapm_path *p;
  
  	/* return if the widget is in use or if it is already unprepared */
- 	if (!swidget->prepared || swidget->use_count > 0)
+ 	if (!swidget || !swidget->prepared || swidget->use_count > 0)
  		return;
  
 -	if (widget_ops[widget->id].ipc_unprepare)
 +	widget_ops = tplg_ops ? tplg_ops->widget : NULL;
 +	if (widget_ops && widget_ops[widget->id].ipc_unprepare)
  		/* unprepare the source widget */
  		widget_ops[widget->id].ipc_unprepare(swidget);
  
@@@ -306,11 -303,7 +306,15 @@@ sof_prepare_widgets_in_path(struct snd_
  	struct snd_soc_dapm_path *p;
  	int ret;
  
++<<<<<<< HEAD
 +	widget_ops = tplg_ops ? tplg_ops->widget : NULL;
 +	if (!widget_ops)
 +		return 0;
 +
 +	if (!widget_ops[widget->id].ipc_prepare || swidget->prepared)
++=======
+ 	if (!swidget || !widget_ops[widget->id].ipc_prepare || swidget->prepared)
++>>>>>>> 0ad84b11f2f8 (ASoC: SOF: sof-audio: skip prepare/unprepare if swidget is NULL)
  		goto sink_prepare;
  
  	/* prepare the source widget */
* Unmerged path sound/soc/sof/sof-audio.c
