ALSA: memalloc: Drop special handling of GFP for CONTINUOUS allocation

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Takashi Iwai <tiwai@suse.de>
commit dd164fbfdc20ccf17be9186b1a5a4b2bc11b6a97
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/dd164fbf.failed

Now that all users of snd_dma_continuous_data() is gone, let's drop
this ugly (and dangerous) way.

After this commit, SNDRV_DMA_TYPE_CONTINUOUS may take the standard
device pointer instead of the hacked pointer by the macro above, and
the memalloc core refers to the coherent_dma_mask of the given
device like other SNDRV_DMA_TYPE.  It's still allowed to pass NULL
there, and in that case, the allocation is performed always in the
normal zone.

For SNDRV_DMA_TYPE_VMALLOC, the device pointer is simply ignored.

Link: https://lore.kernel.org/r/20220823115740.14123-5-tiwai@suse.de
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit dd164fbfdc20ccf17be9186b1a5a4b2bc11b6a97)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/core/memalloc.c
diff --cc sound/core/memalloc.c
index 01c95b0dffa9,39561faef6e9..000000000000
--- a/sound/core/memalloc.c
+++ b/sound/core/memalloc.c
@@@ -325,9 -347,7 +348,13 @@@ static const struct snd_malloc_ops snd_
   */
  static void *snd_dma_vmalloc_alloc(struct snd_dma_buffer *dmab, size_t size)
  {
++<<<<<<< HEAD
 +	gfp_t gfp = snd_mem_get_gfp_flags(dmab, GFP_KERNEL | __GFP_HIGHMEM);
 +
 +	return __vmalloc(size, gfp, PAGE_KERNEL);
++=======
+ 	return vmalloc(size);
++>>>>>>> dd164fbfdc20 (ALSA: memalloc: Drop special handling of GFP for CONTINUOUS allocation)
  }
  
  static void snd_dma_vmalloc_free(struct snd_dma_buffer *dmab)
diff --git a/include/sound/memalloc.h b/include/sound/memalloc.h
index 8d79cebf95f3..43d524580bd2 100644
--- a/include/sound/memalloc.h
+++ b/include/sound/memalloc.h
@@ -26,9 +26,6 @@ struct snd_dma_device {
 	struct device *dev;		/* generic device */
 };
 
-#define snd_dma_continuous_data(x)	((struct device *)(__force unsigned long)(x))
-
-
 /*
  * buffer types
  */
* Unmerged path sound/core/memalloc.c
