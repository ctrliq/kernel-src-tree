ASoC: SOF: Intel: hda-codec: fix possible memory leak in hda_codec_device_init()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Yang Yingliang <yangyingliang@huawei.com>
commit e9441675edc1bb8dbfadacf68aafacca60d65a25
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/e9441675.failed

If snd_hdac_device_register() fails, 'codec' and name allocated in
dev_set_name() called in snd_hdac_device_init() are leaked. Fix this
by calling put_device(), so they can be freed in snd_hda_codec_dev_release()
and kobject_cleanup().

Fixes: 829c67319806 ("ASoC: SOF: Intel: Introduce HDA codec init and exit routines")
Fixes: dfe66a18780d ("ALSA: hdac_ext: add extended HDA bus")
	Signed-off-by: Yang Yingliang <yangyingliang@huawei.com>
	Reviewed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
Link: https://lore.kernel.org/r/20221020110157.1450191-1-yangyingliang@huawei.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit e9441675edc1bb8dbfadacf68aafacca60d65a25)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/intel/hda-codec.c
diff --cc sound/soc/sof/intel/hda-codec.c
index 46149e4094ed,f2ec2a6c2e0f..000000000000
--- a/sound/soc/sof/intel/hda-codec.c
+++ b/sound/soc/sof/intel/hda-codec.c
@@@ -109,13 -109,7 +109,17 @@@ EXPORT_SYMBOL(hda_codec_jack_check)
  #define is_generic_config(x)	0
  #endif
  
++<<<<<<< HEAD
 +static void hda_codec_device_exit(struct device *dev)
 +{
 +	snd_hdac_device_exit(dev_to_hdac_dev(dev));
 +}
 +
 +static __maybe_unused struct hda_codec *
 +hda_codec_device_init(struct hdac_bus *bus, int addr, int type)
++=======
+ static struct hda_codec *hda_codec_device_init(struct hdac_bus *bus, int addr, int type)
++>>>>>>> e9441675edc1 (ASoC: SOF: Intel: hda-codec: fix possible memory leak in hda_codec_device_init())
  {
  	struct hda_codec *codec;
  	int ret;
* Unmerged path sound/soc/sof/intel/hda-codec.c
