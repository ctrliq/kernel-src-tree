ipv6: icmp6: add SKB_DROP_REASON_IPV6_NDISC_NS_OTHERHOST

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-499.el8
commit-author Eric Dumazet <edumazet@google.com>
commit c34b8bb11ebc135e970653bd6fc8e3f863fb6a81
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-499.el8/c34b8bb1.failed

Hosts can often receive neighbour discovery messages
that are not for them.

Use a dedicated drop reason to make clear the packet is dropped
for this normal case.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c34b8bb11ebc135e970653bd6fc8e3f863fb6a81)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/dropreason.h
diff --cc include/net/dropreason.h
index 70539288f995,c0a3ea806cd5..000000000000
--- a/include/net/dropreason.h
+++ b/include/net/dropreason.h
@@@ -71,6 -71,13 +71,16 @@@
  	FN(DUP_FRAG)			\
  	FN(FRAG_REASM_TIMEOUT)		\
  	FN(FRAG_TOO_FAR)		\
++<<<<<<< HEAD
++=======
+ 	FN(TCP_MINTTL)			\
+ 	FN(IPV6_BAD_EXTHDR)		\
+ 	FN(IPV6_NDISC_FRAG)		\
+ 	FN(IPV6_NDISC_HOP_LIMIT)	\
+ 	FN(IPV6_NDISC_BAD_CODE)		\
+ 	FN(IPV6_NDISC_BAD_OPTIONS)	\
+ 	FN(IPV6_NDISC_NS_OTHERHOST)	\
++>>>>>>> c34b8bb11ebc (ipv6: icmp6: add SKB_DROP_REASON_IPV6_NDISC_NS_OTHERHOST)
  	FNe(MAX)
  
  /**
@@@ -313,6 -320,25 +323,28 @@@ enum skb_drop_reason 
  	 */
  	SKB_DROP_REASON_FRAG_TOO_FAR,
  	/**
++<<<<<<< HEAD
++=======
+ 	 * @SKB_DROP_REASON_TCP_MINTTL: ipv4 ttl or ipv6 hoplimit below
+ 	 * the threshold (IP_MINTTL or IPV6_MINHOPCOUNT).
+ 	 */
+ 	SKB_DROP_REASON_TCP_MINTTL,
+ 	/** @SKB_DROP_REASON_IPV6_BAD_EXTHDR: Bad IPv6 extension header. */
+ 	SKB_DROP_REASON_IPV6_BAD_EXTHDR,
+ 	/** @SKB_DROP_REASON_IPV6_NDISC_FRAG: invalid frag (suppress_frag_ndisc). */
+ 	SKB_DROP_REASON_IPV6_NDISC_FRAG,
+ 	/** @SKB_DROP_REASON_IPV6_NDISC_HOP_LIMIT: invalid hop limit. */
+ 	SKB_DROP_REASON_IPV6_NDISC_HOP_LIMIT,
+ 	/** @SKB_DROP_REASON_IPV6_NDISC_BAD_CODE: invalid NDISC icmp6 code. */
+ 	SKB_DROP_REASON_IPV6_NDISC_BAD_CODE,
+ 	/** @SKB_DROP_REASON_IPV6_NDISC_BAD_OPTIONS: invalid NDISC options. */
+ 	SKB_DROP_REASON_IPV6_NDISC_BAD_OPTIONS,
+ 	/** @SKB_DROP_REASON_IPV6_NDISC_NS_OTHERHOST: NEIGHBOUR SOLICITATION
+ 	 * for another host.
+ 	 */
+ 	SKB_DROP_REASON_IPV6_NDISC_NS_OTHERHOST,
+ 	/**
++>>>>>>> c34b8bb11ebc (ipv6: icmp6: add SKB_DROP_REASON_IPV6_NDISC_NS_OTHERHOST)
  	 * @SKB_DROP_REASON_MAX: the maximum of drop reason, which shouldn't be
  	 * used as a real 'reason'
  	 */
* Unmerged path include/net/dropreason.h
diff --git a/net/ipv6/ndisc.c b/net/ipv6/ndisc.c
index 33b2d2fbbba7..48a4cf8636b5 100644
--- a/net/ipv6/ndisc.c
+++ b/net/ipv6/ndisc.c
@@ -893,8 +893,10 @@ static enum skb_drop_reason ndisc_recv_ns(struct sk_buff *skb)
 					pneigh_enqueue(&nd_tbl, idev->nd_parms, n);
 				goto out;
 			}
-		} else
+		} else {
+			SKB_DR_SET(reason, IPV6_NDISC_NS_OTHERHOST);
 			goto out;
+		}
 	}
 
 	if (is_router < 0)
