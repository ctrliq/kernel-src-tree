dm flakey: add an "error_reads" option

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-494.el8
commit-author Mikulas Patocka <mpatocka@redhat.com>
commit aa7d7bc99fed71664e9a241b32294ee15a88d938
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-494.el8/aa7d7bc9.failed

dm-flakey returns error on reads if no other argument is specified.
This commit simplifies associated logic while formalizing an
"error_reads" argument and an ERROR_READS flag.

If no argument is specified, set ERROR_READS flag so that it behaves
just like before this commit.

	Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
	Signed-off-by: Mike Snitzer <snitzer@kernel.org>
(cherry picked from commit aa7d7bc99fed71664e9a241b32294ee15a88d938)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-flakey.c
diff --cc drivers/md/dm-flakey.c
index f71ffd0c3fa7,bd80bcafbe50..000000000000
--- a/drivers/md/dm-flakey.c
+++ b/drivers/md/dm-flakey.c
@@@ -413,11 -430,11 +425,15 @@@ static int flakey_end_io(struct dm_targ
  }
  
  static void flakey_status(struct dm_target *ti, status_type_t type,
 -			  unsigned int status_flags, char *result, unsigned int maxlen)
 +			  unsigned status_flags, char *result, unsigned maxlen)
  {
 -	unsigned int sz = 0;
 +	unsigned sz = 0;
  	struct flakey_c *fc = ti->private;
++<<<<<<< HEAD
 +	unsigned drop_writes, error_writes;
++=======
+ 	unsigned int error_reads, drop_writes, error_writes;
++>>>>>>> aa7d7bc99fed (dm flakey: add an "error_reads" option)
  
  	switch (type) {
  	case STATUSTYPE_INFO:
diff --git a/Documentation/admin-guide/device-mapper/dm-flakey.rst b/Documentation/admin-guide/device-mapper/dm-flakey.rst
index 655520affc96..3e55399f3aa7 100644
--- a/Documentation/admin-guide/device-mapper/dm-flakey.rst
+++ b/Documentation/admin-guide/device-mapper/dm-flakey.rst
@@ -39,6 +39,10 @@ Optional feature parameters:
   If no feature parameters are present, during the periods of
   unreliability, all I/O returns errors.
 
+  error_reads:
+	All read I/O is failed with an error signalled.
+	Write I/O is handled correctly.
+
   drop_writes:
 	All write I/O is silently ignored.
 	Read I/O is handled correctly.
* Unmerged path drivers/md/dm-flakey.c
