net: dropreason: add SKB_DROP_REASON_FRAG_TOO_FAR

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-477.10.1.el8_8
commit-author Eric Dumazet <edumazet@google.com>
commit 3bdfb04f13ebdd4ae50fc5dc595663874781e48c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-477.10.1.el8_8/3bdfb04f.failed

IPv4 reassembly unit can decide to drop frags based on
/proc/sys/net/ipv4/ipfrag_max_dist sysctl.

Add a specific drop reason to track this specific
and weird case.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 3bdfb04f13ebdd4ae50fc5dc595663874781e48c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/net/dropreason.h
#	net/ipv4/ip_fragment.c
diff --cc include/net/dropreason.h
index 602d555a5f83,70539288f995..000000000000
--- a/include/net/dropreason.h
+++ b/include/net/dropreason.h
@@@ -69,6 -69,8 +69,11 @@@
  	FN(IP_INNOROUTES)		\
  	FN(PKT_TOO_BIG)			\
  	FN(DUP_FRAG)			\
++<<<<<<< HEAD
++=======
+ 	FN(FRAG_REASM_TIMEOUT)		\
+ 	FN(FRAG_TOO_FAR)		\
++>>>>>>> 3bdfb04f13eb (net: dropreason: add SKB_DROP_REASON_FRAG_TOO_FAR)
  	FNe(MAX)
  
  /**
@@@ -303,6 -305,13 +308,11 @@@ enum skb_drop_reason 
  	SKB_DROP_REASON_PKT_TOO_BIG,
  	/** @SKB_DROP_REASON_DUP_FRAG: duplicate fragment */
  	SKB_DROP_REASON_DUP_FRAG,
 -	/** @SKB_DROP_REASON_FRAG_REASM_TIMEOUT: fragment reassembly timeout */
 -	SKB_DROP_REASON_FRAG_REASM_TIMEOUT,
+ 	/**
+ 	 * @SKB_DROP_REASON_FRAG_TOO_FAR: ipv4 fragment too far.
+ 	 * (/proc/sys/net/ipv4/ipfrag_max_dist)
+ 	 */
+ 	SKB_DROP_REASON_FRAG_TOO_FAR,
  	/**
  	 * @SKB_DROP_REASON_MAX: the maximum of drop reason, which shouldn't be
  	 * used as a real 'reason'
diff --cc net/ipv4/ip_fragment.c
index 6753750b346d,69c00ffdcf3e..000000000000
--- a/net/ipv4/ip_fragment.c
+++ b/net/ipv4/ip_fragment.c
@@@ -255,8 -255,9 +255,14 @@@ static int ip_frag_reinit(struct ipq *q
  		return -ETIMEDOUT;
  	}
  
++<<<<<<< HEAD
 +	sum_truesize = inet_frag_rbtree_purge(&qp->q.rb_fragments);
 +	sub_frag_mem_limit(qp->q.net, sum_truesize);
++=======
+ 	sum_truesize = inet_frag_rbtree_purge(&qp->q.rb_fragments,
+ 					      SKB_DROP_REASON_FRAG_TOO_FAR);
+ 	sub_frag_mem_limit(qp->q.fqdir, sum_truesize);
++>>>>>>> 3bdfb04f13eb (net: dropreason: add SKB_DROP_REASON_FRAG_TOO_FAR)
  
  	qp->q.flags = 0;
  	qp->q.len = 0;
* Unmerged path include/net/dropreason.h
* Unmerged path net/ipv4/ip_fragment.c
