PM: domains: Clean up some code in pm_genpd_init() and genpd_remove()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-477.10.1.el8_8
commit-author Ulf Hansson <ulf.hansson@linaro.org>
commit ba43d6db6e5c6d0b5f58d6487285ed58ba94c5df
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-477.10.1.el8_8/ba43d6db.failed

To improve the readability of the code, let's move the parts that deals
with allocation/freeing of data, into two separate functions.

	Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit ba43d6db6e5c6d0b5f58d6487285ed58ba94c5df)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/base/power/domain.c
diff --cc drivers/base/power/domain.c
index 9e2b595b8793,ac1eb7d2470b..000000000000
--- a/drivers/base/power/domain.c
+++ b/drivers/base/power/domain.c
@@@ -2058,21 -2068,13 +2089,31 @@@ int pm_genpd_init(struct generic_pm_dom
  			!genpd_status_on(genpd))
  		return -EINVAL;
  
++<<<<<<< HEAD
 +	if (genpd_is_cpu_domain(genpd) &&
 +	    !zalloc_cpumask_var(&genpd->cpus, GFP_KERNEL))
 +		return -ENOMEM;
 +
 +	/* Use only one "off" state if there were no states declared */
 +	if (genpd->state_count == 0) {
 +		ret = genpd_set_default_power_state(genpd);
 +		if (ret) {
 +			if (genpd_is_cpu_domain(genpd))
 +				free_cpumask_var(genpd->cpus);
 +			return ret;
 +		}
 +	} else if (!gov && genpd->state_count > 1) {
 +		pr_warn("%s : no governor for states\n", genpd->name);
 +	}
++=======
+ 	/* Multiple states but no governor doesn't make sense. */
+ 	if (!gov && genpd->state_count > 1)
+ 		pr_warn("%s: no governor for states\n", genpd->name);
+ 
+ 	ret = genpd_alloc_data(genpd);
+ 	if (ret)
+ 		return ret;
++>>>>>>> ba43d6db6e5c (PM: domains: Clean up some code in pm_genpd_init() and genpd_remove())
  
  	device_initialize(&genpd->dev);
  	dev_set_name(&genpd->dev, "%s", genpd->name);
* Unmerged path drivers/base/power/domain.c
