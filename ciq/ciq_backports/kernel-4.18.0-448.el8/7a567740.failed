ASoC: SOF: Intel: Switch to use the generic pm_ops.set_core_state

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
commit 7a5677407300e8ba6af95e66f4e8cfe23059f4a7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/7a567740.failed

Instead of craft and send an IPC(3) message in hda_dsp_core_get(),
tgl_dsp_core_get() and tgl_dsp_core_put(), use the generic ops for handling
the IPC dependent implementation of core power on/off.

	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20220610083549.16773-6-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 7a5677407300e8ba6af95e66f4e8cfe23059f4a7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/intel/hda-dsp.c
#	sound/soc/sof/intel/tgl.c
diff --cc sound/soc/sof/intel/hda-dsp.c
index 47cfc2c6ab2f,3a70f441a8d5..000000000000
--- a/sound/soc/sof/intel/hda-dsp.c
+++ b/sound/soc/sof/intel/hda-dsp.c
@@@ -962,10 -947,12 +956,18 @@@ int hda_dsp_core_get(struct snd_sof_de
  	if (sdev->fw_state != SOF_FW_BOOT_COMPLETE || core == SOF_DSP_PRIMARY_CORE)
  		return 0;
  
+ 	/* No need to continue the set_core_state ops is not available */
+ 	if (!pm_ops->set_core_state)
+ 		return 0;
+ 
  	/* Now notify DSP for secondary cores */
++<<<<<<< HEAD
 +	ret = sof_ipc_tx_message(sdev->ipc, pm_core_config.hdr.cmd,
 +				 &pm_core_config, sizeof(pm_core_config),
 +				 &pm_core_config, sizeof(pm_core_config));
++=======
+ 	ret = pm_ops->set_core_state(sdev, core, true);
++>>>>>>> 7a5677407300 (ASoC: SOF: Intel: Switch to use the generic pm_ops.set_core_state)
  	if (ret < 0) {
  		dev_err(sdev->dev, "failed to enable secondary core '%d' failed with %d\n",
  			core, ret);
diff --cc sound/soc/sof/intel/tgl.c
index fceb528ed5d9,dcad7c382de6..000000000000
--- a/sound/soc/sof/intel/tgl.c
+++ b/sound/soc/sof/intel/tgl.c
@@@ -34,10 -30,10 +28,17 @@@ static int tgl_dsp_core_get(struct snd_
  	if (core == SOF_DSP_PRIMARY_CORE)
  		return hda_dsp_enable_core(sdev, BIT(core));
  
++<<<<<<< HEAD
 +	/* notify DSP for secondary cores */
 +	return sof_ipc_tx_message(sdev->ipc, pm_core_config.hdr.cmd,
 +				 &pm_core_config, sizeof(pm_core_config),
 +				 &pm_core_config, sizeof(pm_core_config));
++=======
+ 	if (pm_ops->set_core_state)
+ 		return pm_ops->set_core_state(sdev, core, true);
+ 
+ 	return 0;
++>>>>>>> 7a5677407300 (ASoC: SOF: Intel: Switch to use the generic pm_ops.set_core_state)
  }
  
  static int tgl_dsp_core_put(struct snd_sof_dev *sdev, int core)
@@@ -54,10 -44,10 +49,17 @@@
  	if (core == SOF_DSP_PRIMARY_CORE)
  		return hda_dsp_core_reset_power_down(sdev, BIT(core));
  
++<<<<<<< HEAD
 +	/* notify DSP for secondary cores */
 +	return sof_ipc_tx_message(sdev->ipc, pm_core_config.hdr.cmd,
 +				 &pm_core_config, sizeof(pm_core_config),
 +				 &pm_core_config, sizeof(pm_core_config));
++=======
+ 	if (pm_ops->set_core_state)
+ 		return pm_ops->set_core_state(sdev, core, false);
+ 
+ 	return 0;
++>>>>>>> 7a5677407300 (ASoC: SOF: Intel: Switch to use the generic pm_ops.set_core_state)
  }
  
  /* Tigerlake ops */
* Unmerged path sound/soc/sof/intel/hda-dsp.c
* Unmerged path sound/soc/sof/intel/tgl.c
