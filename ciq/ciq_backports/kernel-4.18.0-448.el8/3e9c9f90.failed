soundwire: intel: use pm_runtime_resume() on component probe

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
commit 3e9c9f90573f4633ec8270d0d02bcea4fad1e802
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/3e9c9f90.failed

During the card registration, transactions on the SoundWire bus can be
initiated. If the ALSA card is registered after the bus suspends,
timeouts can be seen while reading/writing codec registers. This is
extremely easy to reproduce in driver bind/unbind tests.

In an initial experiment, the ASoC soc-component.c code was modified
to initiate a pm_runtime resume on a component probe. The results
showed this was too invasive. Instead this patch suggests resuming the
SoundWire component only.

Because of the parent-child hierarchy enforced by the pm_runtime
framework, it can be argued that the codec component probe should be
enough to resume all necessary devices, and indeed the same resume
will be applied to SoundWire codecs used on Intel platforms.

Calling pm_runtime_resume() on both the Intel and codec sides has the
benefit of resuming the bus without assuming any order during the card
registration. The first component on a dailink to be probed will
resume the bus. In addition, if a codec driver did not implement this
transition, the Intel component would still resume the bus and avoid
timeouts on card registration.

BugLink: https://github.com/thesofproject/linux/issues/3651
	Reviewed-by: Rander Wang <rander.wang@intel.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Reviewed-by: PÃ©ter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20220621225641.221170-4-pierre-louis.bossart@linux.intel.com
	Signed-off-by: Vinod Koul <vkoul@kernel.org>
(cherry picked from commit 3e9c9f90573f4633ec8270d0d02bcea4fad1e802)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/soundwire/intel.c
diff --cc drivers/soundwire/intel.c
index 2816d9026f43,95ce292994cc..000000000000
--- a/drivers/soundwire/intel.c
+++ b/drivers/soundwire/intel.c
@@@ -1152,9 -1114,9 +1169,15 @@@ static const struct snd_soc_dai_ops int
  };
  
  static const struct snd_soc_component_driver dai_component = {
++<<<<<<< HEAD
 +	.name			= "soundwire",
 +	.suspend		= intel_component_dais_suspend,
 +	.legacy_dai_naming	= 1,
++=======
+ 	.name           = "soundwire",
+ 	.probe		= intel_component_probe,
+ 	.suspend	= intel_component_dais_suspend
++>>>>>>> 3e9c9f90573f (soundwire: intel: use pm_runtime_resume() on component probe)
  };
  
  static int intel_create_dai(struct sdw_cdns *cdns,
* Unmerged path drivers/soundwire/intel.c
