net: skb: introduce the function kfree_skb_list_reason()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Menglong Dong <imagedong@tencent.com>
commit 215b0f1963d4e34fccac6992b3debe26f78a6eb8
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/215b0f19.failed

To report reasons of skb drops, introduce the function
kfree_skb_list_reason() and make kfree_skb_list() an inline call to
it. This function will be used in the next commit in
__dev_xmit_skb().

	Signed-off-by: Menglong Dong <imagedong@tencent.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 215b0f1963d4e34fccac6992b3debe26f78a6eb8)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/skbuff.h
diff --cc include/linux/skbuff.h
index 6050fa383222,1f2de153755c..000000000000
--- a/include/linux/skbuff.h
+++ b/include/linux/skbuff.h
@@@ -1115,10 -1202,25 +1115,21 @@@ static inline void kfree_skb(struct sk_
  }
  
  void skb_release_head_state(struct sk_buff *skb);
- void kfree_skb_list(struct sk_buff *segs);
+ void kfree_skb_list_reason(struct sk_buff *segs,
+ 			   enum skb_drop_reason reason);
  void skb_dump(const char *level, const struct sk_buff *skb, bool full_pkt);
  void skb_tx_error(struct sk_buff *skb);
++<<<<<<< HEAD
++=======
+ 
+ static inline void kfree_skb_list(struct sk_buff *segs)
+ {
+ 	kfree_skb_list_reason(segs, SKB_DROP_REASON_NOT_SPECIFIED);
+ }
+ 
+ #ifdef CONFIG_TRACEPOINTS
++>>>>>>> 215b0f1963d4 (net: skb: introduce the function kfree_skb_list_reason())
  void consume_skb(struct sk_buff *skb);
 -#else
 -static inline void consume_skb(struct sk_buff *skb)
 -{
 -	return kfree_skb(skb);
 -}
 -#endif
 -
  void __consume_stateless_skb(struct sk_buff *skb);
  void  __kfree_skb(struct sk_buff *skb);
  extern struct kmem_cache *skbuff_head_cache;
* Unmerged path include/linux/skbuff.h
diff --git a/net/core/skbuff.c b/net/core/skbuff.c
index d5485075d4a9..8b6fb5b6190e 100644
--- a/net/core/skbuff.c
+++ b/net/core/skbuff.c
@@ -768,16 +768,17 @@ void kfree_skb_reason(struct sk_buff *skb, enum skb_drop_reason reason)
 }
 EXPORT_SYMBOL(kfree_skb_reason);
 
-void kfree_skb_list(struct sk_buff *segs)
+void kfree_skb_list_reason(struct sk_buff *segs,
+			   enum skb_drop_reason reason)
 {
 	while (segs) {
 		struct sk_buff *next = segs->next;
 
-		kfree_skb(segs);
+		kfree_skb_reason(segs, reason);
 		segs = next;
 	}
 }
-EXPORT_SYMBOL(kfree_skb_list);
+EXPORT_SYMBOL(kfree_skb_list_reason);
 
 /* Dump skb information and contents.
  *
