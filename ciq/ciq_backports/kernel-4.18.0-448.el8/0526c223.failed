fbdev: Call fbcon_get_requirement directly

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Daniel Vetter <daniel.vetter@ffwll.ch>
commit 0526c2239ad8ceef98652fe8e059044c24c62ea7
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/0526c223.failed

Pretty simple case really.

v2: Forgot to remove a break;

v3: Add static inline to the dummy versions.

	Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
	Reviewed-by: Sam Ravnborg <sam@ravnborg.org>
	Reviewed-by: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
	Cc: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
	Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
	Cc: Hans de Goede <hdegoede@redhat.com>
	Cc: "Steven Rostedt (VMware)" <rostedt@goodmis.org>
	Cc: Prarit Bhargava <prarit@redhat.com>
	Cc: Kees Cook <keescook@chromium.org>
	Cc: Yisheng Xie <ysxie@foxmail.com>
	Cc: "Michał Mirosław" <mirq-linux@rere.qmqm.pl>
	Cc: Peter Rosin <peda@axentia.se>
	Cc: Mikulas Patocka <mpatocka@redhat.com>
	Cc: linux-fbdev@vger.kernel.org
Link: https://patchwork.freedesktop.org/patch/msgid/20190528090304.9388-24-daniel.vetter@ffwll.ch
(cherry picked from commit 0526c2239ad8ceef98652fe8e059044c24c62ea7)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/video/fbdev/core/fbcon.c
#	include/linux/fb.h
#	include/linux/fbcon.h
diff --cc drivers/video/fbdev/core/fbcon.c
index 689e13ab3084,ee0bed9571aa..000000000000
--- a/drivers/video/fbdev/core/fbcon.c
+++ b/drivers/video/fbdev/core/fbcon.c
@@@ -3343,9 -3324,7 +3343,8 @@@ static int fbcon_event_notify(struct no
  {
  	struct fb_event *event = data;
  	struct fb_info *info = event->info;
 +	struct fb_videomode *mode;
  	struct fb_con2fbmap *con2fb;
- 	struct fb_blit_caps *caps;
  	int idx, ret = 0;
  
  	switch(action) {
@@@ -3382,12 -3347,9 +3381,18 @@@
  	case FB_EVENT_BLANK:
  		fbcon_fb_blanked(info, *(int *)event->data);
  		break;
++<<<<<<< HEAD
 +	case FB_EVENT_NEW_MODELIST:
 +		fbcon_new_modelist(info);
 +		break;
 +	case FB_EVENT_GET_REQ:
 +		caps = event->data;
 +		fbcon_get_requirement(info, caps);
++=======
+ 	case FB_EVENT_REMAP_ALL_CONSOLE:
+ 		idx = info->node;
+ 		fbcon_remap_all(idx);
++>>>>>>> 0526c2239ad8 (fbdev: Call fbcon_get_requirement directly)
  		break;
  	}
  	return ret;
diff --cc include/linux/fb.h
index 5bd1a6c3d119,0d86aa31bf8d..000000000000
--- a/include/linux/fb.h
+++ b/include/linux/fb.h
@@@ -156,13 -143,11 +156,19 @@@ struct fb_cursor_user 
  #define FB_EVENT_MODE_CHANGE_ALL	0x0B
  /*	A software display blank change occurred */
  #define FB_EVENT_CONBLANK               0x0C
++<<<<<<< HEAD
 +/*      Get drawing requirements        */
 +#define FB_EVENT_GET_REQ                0x0D
 +/*      Unbind from the console if possible */
 +#define FB_EVENT_FB_UNBIND              0x0E
 +/*      A hardware display blank early change occured */
++=======
+ /*      CONSOLE-SPECIFIC: remap all consoles to new fb - for vga_switcheroo */
+ #define FB_EVENT_REMAP_ALL_CONSOLE      0x0F
+ /*      A hardware display blank early change occurred */
++>>>>>>> 0526c2239ad8 (fbdev: Call fbcon_get_requirement directly)
  #define FB_EARLY_EVENT_BLANK		0x10
 -/*      A hardware display blank revert early change occurred */
 +/*      A hardware display blank revert early change occured */
  #define FB_R_EARLY_EVENT_BLANK		0x11
  
  struct fb_event {
diff --cc include/linux/fbcon.h
index 34abc144f9f8,305e4f2eddac..000000000000
--- a/include/linux/fbcon.h
+++ b/include/linux/fbcon.h
@@@ -6,13 -6,27 +6,35 @@@ void __init fb_console_init(void)
  void __exit fb_console_exit(void);
  int fbcon_fb_registered(struct fb_info *info);
  void fbcon_fb_unregistered(struct fb_info *info);
++<<<<<<< HEAD
 +void fbcon_remap_all(struct fb_info *info);
++=======
+ void fbcon_fb_unbind(struct fb_info *info);
+ void fbcon_suspended(struct fb_info *info);
+ void fbcon_resumed(struct fb_info *info);
+ int fbcon_mode_deleted(struct fb_info *info,
+ 		       struct fb_videomode *mode);
+ void fbcon_new_modelist(struct fb_info *info);
+ void fbcon_get_requirement(struct fb_info *info,
+ 			   struct fb_blit_caps *caps);
++>>>>>>> 0526c2239ad8 (fbdev: Call fbcon_get_requirement directly)
  #else
  static inline void fb_console_init(void) {}
  static inline void fb_console_exit(void) {}
  static inline int fbcon_fb_registered(struct fb_info *info) { return 0; }
  static inline void fbcon_fb_unregistered(struct fb_info *info) {}
++<<<<<<< HEAD
 +static inline void fbcon_remap_all(struct fb_info *info) {}
++=======
+ static inline void fbcon_fb_unbind(struct fb_info *info) {}
+ static inline void fbcon_suspended(struct fb_info *info) {}
+ static inline void fbcon_resumed(struct fb_info *info) {}
+ static inline int fbcon_mode_deleted(struct fb_info *info,
+ 				     struct fb_videomode *mode) { return 0; }
+ static inline void fbcon_new_modelist(struct fb_info *info) {}
+ static inline void fbcon_get_requirement(struct fb_info *info,
+ 					 struct fb_blit_caps *caps) {}
++>>>>>>> 0526c2239ad8 (fbdev: Call fbcon_get_requirement directly)
  #endif
  
  #endif /* _LINUX_FBCON_H */
* Unmerged path drivers/video/fbdev/core/fbcon.c
diff --git a/drivers/video/fbdev/core/fbmem.c b/drivers/video/fbdev/core/fbmem.c
index e0a48e4a47a0..ff53bf1a762d 100644
--- a/drivers/video/fbdev/core/fbmem.c
+++ b/drivers/video/fbdev/core/fbmem.c
@@ -904,16 +904,13 @@ EXPORT_SYMBOL(fb_pan_display);
 static int fb_check_caps(struct fb_info *info, struct fb_var_screeninfo *var,
 			 u32 activate)
 {
-	struct fb_event event;
 	struct fb_blit_caps caps, fbcaps;
 	int err = 0;
 
 	memset(&caps, 0, sizeof(caps));
 	memset(&fbcaps, 0, sizeof(fbcaps));
 	caps.flags = (activate & FB_ACTIVATE_ALL) ? 1 : 0;
-	event.info = info;
-	event.data = &caps;
-	fb_notifier_call_chain(FB_EVENT_GET_REQ, &event);
+	fbcon_get_requirement(info, &caps);
 	info->fbops->fb_get_caps(info, &fbcaps, var);
 
 	if (((fbcaps.x ^ caps.x) & caps.x) ||
* Unmerged path include/linux/fb.h
* Unmerged path include/linux/fbcon.h
