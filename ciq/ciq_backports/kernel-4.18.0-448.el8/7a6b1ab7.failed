neighbour: allow NUD_NOARP entries to be forced GCed

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author David Ahern <dsahern@kernel.org>
commit 7a6b1ab7475fd6478eeaf5c9d1163e7a18125c8f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/7a6b1ab7.failed

IFF_POINTOPOINT interfaces use NUD_NOARP entries for IPv6. It's possible to
fill up the neighbour table with enough entries that it will overflow for
valid connections after that.

This behaviour is more prevalent after commit 58956317c8de ("neighbor:
Improve garbage collection") is applied, as it prevents removal from
entries that are not NUD_FAILED, unless they are more than 5s old.

Fixes: 58956317c8de (neighbor: Improve garbage collection)
	Reported-by: Kasper Dupont <kasperd@gjkwv.06.feb.2021.kasperd.net>
	Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
	Signed-off-by: David Ahern <dsahern@kernel.org>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 7a6b1ab7475fd6478eeaf5c9d1163e7a18125c8f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/neighbour.c
diff --cc net/core/neighbour.c
index ec6f4e0b2be6,bf774575ad71..000000000000
--- a/net/core/neighbour.c
+++ b/net/core/neighbour.c
@@@ -242,6 -238,9 +242,12 @@@ static int neigh_forced_gc(struct neigh
  
  			write_lock(&n->lock);
  			if ((n->nud_state == NUD_FAILED) ||
++<<<<<<< HEAD
++=======
+ 			    (n->nud_state == NUD_NOARP) ||
+ 			    (tbl->is_multicast &&
+ 			     tbl->is_multicast(n->primary_key)) ||
++>>>>>>> 7a6b1ab7475f (neighbour: allow NUD_NOARP entries to be forced GCed)
  			    time_after(tref, n->updated))
  				remove = true;
  			write_unlock(&n->lock);
* Unmerged path net/core/neighbour.c
