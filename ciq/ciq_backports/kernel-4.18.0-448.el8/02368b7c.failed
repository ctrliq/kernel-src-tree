s390/pci: cleanup resources only if necessary

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Niklas Schnelle <schnelle@linux.ibm.com>
commit 02368b7cf6c7badefa13741aed7a8b91d9a11b19
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/02368b7c.failed

It's currently safe to call zpci_cleanup_bus_resources() even if the
resources were never created but it makes no sense so check
zdev->has_resources before we call zpci_cleanup_bus_resources() in
zpci_release_device().

	Reviewed-by: Matthew Rosato <mjrosato@linux.ibm.com>
	Acked-by: Pierre Morel <pmorel@linux.ibm.com>
	Signed-off-by: Niklas Schnelle <schnelle@linux.ibm.com>
	Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
(cherry picked from commit 02368b7cf6c7badefa13741aed7a8b91d9a11b19)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/pci/pci.c
diff --cc arch/s390/pci/pci.c
index 6af47e2fa8a9,67dc5b1379c1..000000000000
--- a/arch/s390/pci/pci.c
+++ b/arch/s390/pci/pci.c
@@@ -824,16 -822,11 +824,21 @@@ void zpci_release_device(struct kref *k
  	case ZPCI_FN_STATE_STANDBY:
  		if (zdev->has_hp_slot)
  			zpci_exit_slot(zdev);
++<<<<<<< HEAD
 +		spin_lock(&zpci_list_lock);
 +		list_del(&zdev->entry);
 +		spin_unlock(&zpci_list_lock);
 +		zpci_dbg(3, "rsv fid:%x\n", zdev->fid);
 +		fallthrough;
 +	case ZPCI_FN_STATE_RESERVED:
 +		zpci_cleanup_bus_resources(zdev);
++=======
+ 		if (zdev->has_resources)
+ 			zpci_cleanup_bus_resources(zdev);
++>>>>>>> 02368b7cf6c7 (s390/pci: cleanup resources only if necessary)
  		zpci_bus_device_unregister(zdev);
  		zpci_destroy_iommu(zdev);
 -		fallthrough;
 +		/* fallthrough */
  	default:
  		break;
  	}
* Unmerged path arch/s390/pci/pci.c
