ACPI: bus: Drop driver member of struct acpi_device

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
commit d6fb6ee1820cb9c49717b8d28c5b2e940cb2e439
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/d6fb6ee1.failed

struct acpi_device::driver tracks the same information as the driver
member of struct acpi_device::dev.

Fix all users of the former to use the latter and drop the redundant
data from struct acpi_device.

	Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit d6fb6ee1820cb9c49717b8d28c5b2e940cb2e439)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/acpi/bus.c
diff --cc drivers/acpi/bus.c
index 4d938271a71e,90cabe4fd4d0..000000000000
--- a/drivers/acpi/bus.c
+++ b/drivers/acpi/bus.c
@@@ -1047,10 -1036,8 +1050,15 @@@ static int acpi_device_probe(struct dev
  	if (ret)
  		return ret;
  
++<<<<<<< HEAD
 +	acpi_dev->driver = acpi_drv;
 +	ACPI_DEBUG_PRINT((ACPI_DB_INFO,
 +			  "Driver [%s] successfully bound to device [%s]\n",
 +			  acpi_drv->name, acpi_dev->pnp.bus_id));
++=======
+ 	pr_debug("Driver [%s] successfully bound to device [%s]\n",
+ 		 acpi_drv->name, acpi_dev->pnp.bus_id);
++>>>>>>> d6fb6ee1820c (ACPI: bus: Drop driver member of struct acpi_device)
  
  	if (acpi_drv->ops.notify) {
  		ret = acpi_device_install_notify_handler(acpi_dev);
@@@ -1070,10 -1057,10 +1077,10 @@@
  	return 0;
  }
  
 -static void acpi_device_remove(struct device *dev)
 +static int acpi_device_remove(struct device *dev)
  {
  	struct acpi_device *acpi_dev = to_acpi_device(dev);
- 	struct acpi_driver *acpi_drv = acpi_dev->driver;
+ 	struct acpi_driver *acpi_drv = to_acpi_driver(dev->driver);
  
  	if (acpi_drv->ops.notify)
  		acpi_device_remove_notify_handler(acpi_dev);
* Unmerged path drivers/acpi/bus.c
diff --git a/drivers/acpi/device_sysfs.c b/drivers/acpi/device_sysfs.c
index 7c0a8303edc6..07a001666e08 100644
--- a/drivers/acpi/device_sysfs.c
+++ b/drivers/acpi/device_sysfs.c
@@ -384,7 +384,7 @@ eject_store(struct device *d, struct device_attribute *attr,
 		return -EINVAL;
 
 	if ((!acpi_device->handler || !acpi_device->handler->hotplug.enabled)
-	    && !acpi_device->driver)
+	    && !d->driver)
 		return -ENODEV;
 
 	status = acpi_get_type(acpi_device->handle, &not_used);
diff --git a/include/acpi/acpi_bus.h b/include/acpi/acpi_bus.h
index c5ed6c83bb83..43cd17a30dd5 100644
--- a/include/acpi/acpi_bus.h
+++ b/include/acpi/acpi_bus.h
@@ -388,7 +388,6 @@ struct acpi_device {
 	struct acpi_device_data data;
 	struct acpi_scan_handler *handler;
 	struct acpi_hotplug_context *hp;
-	struct acpi_driver *driver;
 	const struct acpi_gpio_mapping *driver_gpios;
 	void *driver_data;
 	struct device dev;
