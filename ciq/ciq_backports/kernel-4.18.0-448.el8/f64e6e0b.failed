Revert "drm/amdgpu/display: set vblank_disable_immediate for DC"

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Alex Deucher <alexander.deucher@amd.com>
commit f64e6e0b6afe047cb0d34a5369597fe0d188e94d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/f64e6e0b.failed

This reverts commit 92020e81ddbeac351ea4a19bcf01743f32b9c800.

This causes stuttering and timeouts with DMCUB for some users
so revert it until we understand why and safely enable it
to save power.

Bug: https://gitlab.freedesktop.org/drm/amd/-/issues/1887
	Acked-by: Harry Wentland <harry.wentland@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: Nicholas Kazlauskas <nicholas.kazlauskas@amd.com>
(cherry picked from commit f64e6e0b6afe047cb0d34a5369597fe0d188e94d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
diff --cc drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 7b19d6e48c14,2f7982fd7082..000000000000
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@@ -3830,9 -4230,26 +3830,29 @@@ static int amdgpu_dm_initialize_drm_dev
  		}
  		break;
  	default:
 -		DRM_DEBUG_KMS("Unsupported DCN IP version for outbox: 0x%X\n",
 -			      adev->ip_versions[DCE_HWIP][0]);
 +		DRM_DEBUG_KMS("Unsupported ASIC type for outbox: 0x%X\n", adev->asic_type);
  	}
++<<<<<<< HEAD
 +#endif
++=======
+ 
+ 	/* Determine whether to enable PSR support by default. */
+ 	if (!(amdgpu_dc_debug_mask & DC_DISABLE_PSR)) {
+ 		switch (adev->ip_versions[DCE_HWIP][0]) {
+ 		case IP_VERSION(3, 1, 2):
+ 		case IP_VERSION(3, 1, 3):
+ 		case IP_VERSION(3, 1, 5):
+ 		case IP_VERSION(3, 1, 6):
+ 		case IP_VERSION(3, 2, 0):
+ 		case IP_VERSION(3, 2, 1):
+ 			psr_feature_enabled = true;
+ 			break;
+ 		default:
+ 			psr_feature_enabled = amdgpu_dc_feature_mask & DC_PSR_MASK;
+ 			break;
+ 		}
+ 	}
++>>>>>>> f64e6e0b6afe (Revert "drm/amdgpu/display: set vblank_disable_immediate for DC")
  
  	/* loops over all connectors on the board */
  	for (i = 0; i < link_cnt; i++) {
diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_irq.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_irq.c
index a74c42ad1b0c..83af307e97cd 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_irq.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_irq.c
@@ -333,6 +333,7 @@ int amdgpu_irq_init(struct amdgpu_device *adev)
 	if (!amdgpu_device_has_dc_support(adev)) {
 		if (!adev->enable_virtual_display)
 			/* Disable vblank IRQs aggressively for power-saving */
+			/* XXX: can this be enabled for DC? */
 			adev_to_drm(adev)->vblank_disable_immediate = true;
 
 		r = drm_vblank_init(adev_to_drm(adev), adev->mode_info.num_crtc);
* Unmerged path drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
