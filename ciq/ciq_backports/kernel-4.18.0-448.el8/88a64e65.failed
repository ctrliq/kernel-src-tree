KVM: selftests: memslot_perf_test: Consolidate memory

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Gavin Shan <gshan@redhat.com>
commit 88a64e65484ef6b5cb09fe545d0dd00c950a1131
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/88a64e65.failed

The addresses and sizes passed to vm_userspace_mem_region_add() and
madvise() should be aligned to host page size, which can be 64KB on
aarch64. So it's wrong by passing additional fixed 4KB memory area
to various tests.

Fix it by passing additional fixed 64KB memory area to various tests.
We also add checks to ensure that none of host/guest page size exceeds
64KB. MEM_TEST_MOVE_SIZE is fixed up to 192KB either.

With this, the following command works fine on 64KB-page-size-host and
4KB-page-size-guest.

  # ./memslot_perf_test -v -s 512

	Signed-off-by: Gavin Shan <gshan@redhat.com>
	Reviewed-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: https://lore.kernel.org/r/20221020071209.559062-6-gshan@redhat.com
(cherry picked from commit 88a64e65484ef6b5cb09fe545d0dd00c950a1131)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/memslot_perf_test.c
diff --cc tools/testing/selftests/kvm/memslot_perf_test.c
index 401cc9c00daa,daebc264de5a..000000000000
--- a/tools/testing/selftests/kvm/memslot_perf_test.c
+++ b/tools/testing/selftests/kvm/memslot_perf_test.c
@@@ -25,14 -26,14 +26,21 @@@
  #include <kvm_util.h>
  #include <processor.h>
  
++<<<<<<< HEAD
 +#define VCPU_ID 0
 +
 +#define MEM_SIZE		((512U << 20) + 4096)
 +#define MEM_GPA		0x10000000UL
++=======
+ #define MEM_EXTRA_SIZE		SZ_64K
+ 
+ #define MEM_SIZE		(SZ_512M + MEM_EXTRA_SIZE)
+ #define MEM_GPA			SZ_256M
++>>>>>>> 88a64e65484e (KVM: selftests: memslot_perf_test: Consolidate memory)
  #define MEM_AUX_GPA		MEM_GPA
  #define MEM_SYNC_GPA		MEM_AUX_GPA
- #define MEM_TEST_GPA		(MEM_AUX_GPA + 4096)
- #define MEM_TEST_SIZE		(MEM_SIZE - 4096)
+ #define MEM_TEST_GPA		(MEM_AUX_GPA + MEM_EXTRA_SIZE)
+ #define MEM_TEST_SIZE		(MEM_SIZE - MEM_EXTRA_SIZE)
  
  /*
   * 32 MiB is max size that gets well over 100 iterations on 509 slots.
* Unmerged path tools/testing/selftests/kvm/memslot_perf_test.c
