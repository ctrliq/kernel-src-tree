iommu/vt-d: Prepare for multiple DMA domain types

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Robin Murphy <robin.murphy@arm.com>
commit 78ca078459d779319a22a8e2a18fc491da8a229b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/78ca0784.failed

In preparation for the strict vs. non-strict decision for DMA domains
to be expressed in the domain type, make sure we expose our flush queue
awareness by accepting the new domain type, and test the specific
feature flag where we want to identify DMA domains in general. The DMA
ops reset/setup can simply be made unconditional, since iommu-dma
already knows only to touch DMA domains.

	Reviewed-by: Lu Baolu <baolu.lu@linux.intel.com>
	Signed-off-by: Robin Murphy <robin.murphy@arm.com>
Link: https://lore.kernel.org/r/31a8ef868d593a2f3826a6a120edee81815375a7.1628682049.git.robin.murphy@arm.com
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 78ca078459d779319a22a8e2a18fc491da8a229b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/intel/iommu.c
diff --cc drivers/iommu/intel/iommu.c
index 46171dfe60a5,8fc46c9d6b96..000000000000
--- a/drivers/iommu/intel/iommu.c
+++ b/drivers/iommu/intel/iommu.c
@@@ -2480,9 -2343,13 +2480,19 @@@ __domain_mapping(struct dmar_domain *do
  	attr = prot & (DMA_PTE_READ | DMA_PTE_WRITE | DMA_PTE_SNP);
  	attr |= DMA_FL_PTE_PRESENT;
  	if (domain_use_first_level(domain)) {
++<<<<<<< HEAD
 +		attr |= DMA_FL_PTE_XD | DMA_FL_PTE_US | DMA_FL_PTE_ACCESS;
 +		if (prot & DMA_PTE_WRITE)
 +			attr |= DMA_FL_PTE_DIRTY;
++=======
+ 		attr |= DMA_FL_PTE_XD | DMA_FL_PTE_US;
+ 
+ 		if (iommu_is_dma_domain(&domain->domain)) {
+ 			attr |= DMA_FL_PTE_ACCESS;
+ 			if (prot & DMA_PTE_WRITE)
+ 				attr |= DMA_FL_PTE_DIRTY;
+ 		}
++>>>>>>> 78ca078459d7 (iommu/vt-d: Prepare for multiple DMA domain types)
  	}
  
  	pteval = ((phys_addr_t)phys_pfn << VTD_PAGE_SHIFT) | attr;
* Unmerged path drivers/iommu/intel/iommu.c
