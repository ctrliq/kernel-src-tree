selftests: cgroup: Add task migration tests

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Michal Koutný <mkoutny@suse.com>
commit 11318989c381d2b08b4e361a03df09d54434b26c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/11318989.failed

Add two new tests that verify that thread and threadgroup migrations
work as expected.

	Signed-off-by: Michal Koutný <mkoutny@suse.com>
	Signed-off-by: Tejun Heo <tj@kernel.org>
(cherry picked from commit 11318989c381d2b08b4e361a03df09d54434b26c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/cgroup/cgroup_util.c
#	tools/testing/selftests/cgroup/cgroup_util.h
#	tools/testing/selftests/cgroup/test_core.c
diff --cc tools/testing/selftests/cgroup/cgroup_util.c
index 4cb8e4717357,8f7131dcf1ff..000000000000
--- a/tools/testing/selftests/cgroup/cgroup_util.c
+++ b/tools/testing/selftests/cgroup/cgroup_util.c
@@@ -358,3 -427,26 +374,29 @@@ int set_oom_adj_score(int pid, int scor
  	close(fd);
  	return 0;
  }
++<<<<<<< HEAD
++=======
+ 
+ ssize_t proc_read_text(int pid, bool thread, const char *item, char *buf, size_t size)
+ {
+ 	char path[PATH_MAX];
+ 
+ 	if (!pid)
+ 		snprintf(path, sizeof(path), "/proc/%s/%s",
+ 			 thread ? "thread-self" : "self", item);
+ 	else
+ 		snprintf(path, sizeof(path), "/proc/%d/%s", pid, item);
+ 
+ 	return read_text(path, buf, size);
+ }
+ 
+ int proc_read_strstr(int pid, bool thread, const char *item, const char *needle)
+ {
+ 	char buf[PAGE_SIZE];
+ 
+ 	if (proc_read_text(pid, thread, item, buf, sizeof(buf)) < 0)
+ 		return -1;
+ 
+ 	return strstr(buf, needle) ? 0 : -1;
+ }
++>>>>>>> 11318989c381 (selftests: cgroup: Add task migration tests)
diff --cc tools/testing/selftests/cgroup/cgroup_util.h
index cabd43fd137a,49c54fbdb229..000000000000
--- a/tools/testing/selftests/cgroup/cgroup_util.h
+++ b/tools/testing/selftests/cgroup/cgroup_util.h
@@@ -40,3 -46,7 +41,10 @@@ extern int alloc_pagecache(int fd, size
  extern int alloc_anon(const char *cgroup, void *arg);
  extern int is_swap_enabled(void);
  extern int set_oom_adj_score(int pid, int score);
++<<<<<<< HEAD
++=======
+ extern int cg_wait_for_proc_count(const char *cgroup, int count);
+ extern int cg_killall(const char *cgroup);
+ extern ssize_t proc_read_text(int pid, bool thread, const char *item, char *buf, size_t size);
+ extern int proc_read_strstr(int pid, bool thread, const char *item, const char *needle);
++>>>>>>> 11318989c381 (selftests: cgroup: Add task migration tests)
* Unmerged path tools/testing/selftests/cgroup/test_core.c
diff --git a/tools/testing/selftests/cgroup/Makefile b/tools/testing/selftests/cgroup/Makefile
index 03d3aae560aa..c69673f29780 100644
--- a/tools/testing/selftests/cgroup/Makefile
+++ b/tools/testing/selftests/cgroup/Makefile
@@ -1,5 +1,5 @@
 # SPDX-License-Identifier: GPL-2.0
-CFLAGS += -Wall
+CFLAGS += -Wall -pthread
 
 all:
 
* Unmerged path tools/testing/selftests/cgroup/cgroup_util.c
* Unmerged path tools/testing/selftests/cgroup/cgroup_util.h
* Unmerged path tools/testing/selftests/cgroup/test_core.c
