ASoC: Intel: sof_es8336: remove hard-coded SSP selection

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
commit 24913664b5103c3dd454081f79ba663ec18f65a1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/24913664.failed

For some reason we open-coded the SSP selection and only supported
SSP0, 1 and 2. On ApolloLake platforms, the SSP5 can be used as well
for the ES8336 hardware link.

Remove hard-coded if/else code and align with same code already used
in the SOF driver.

BugLink: https://github.com/thesofproject/sof/issues/6015
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20220725194909.145418-8-pierre-louis.bossart@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 24913664b5103c3dd454081f79ba663ec18f65a1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/intel/boards/sof_es8336.c
diff --cc sound/soc/intel/boards/sof_es8336.c
index d803509030e3,c7f33c89588e..000000000000
--- a/sound/soc/intel/boards/sof_es8336.c
+++ b/sound/soc/intel/boards/sof_es8336.c
@@@ -534,26 -590,31 +534,48 @@@ static int sof_es8336_probe(struct plat
  	/* check GPIO DMI quirks */
  	dmi_check_system(sof_es8336_quirk_table);
  
++<<<<<<< HEAD
 +	if (!mach->mach_params.i2s_link_mask) {
 +		dev_warn(dev, "No I2S link information provided, using SSP0. This may need to be modified with the quirk module parameter\n");
 +	} else {
 +		/*
 +		 * Set configuration based on platform NHLT.
 +		 * In this machine driver, we can only support one SSP for the
 +		 * ES8336 link, the else-if below are intentional.
 +		 * In some cases multiple SSPs can be reported by NHLT, starting MSB-first
 +		 * seems to pick the right connection.
 +		 */
 +		unsigned long ssp = 0;
 +
 +		if (mach->mach_params.i2s_link_mask & BIT(2))
 +			ssp = SOF_ES8336_SSP_CODEC(2);
 +		else if (mach->mach_params.i2s_link_mask & BIT(1))
 +			ssp = SOF_ES8336_SSP_CODEC(1);
 +		else  if (mach->mach_params.i2s_link_mask & BIT(0))
 +			ssp = SOF_ES8336_SSP_CODEC(0);
++=======
+ 	/* Use NHLT configuration only for Non-HDMI capture use case.
+ 	 * Because more than one SSP will be enabled for HDMI capture hence wrong codec
+ 	 * SSP will be set.
+ 	 */
+ 	if (mach->tplg_quirk_mask & SND_SOC_ACPI_TPLG_INTEL_SSP_NUMBER) {
+ 		if (!mach->mach_params.i2s_link_mask) {
+ 			dev_warn(dev, "No I2S link information provided, using SSP0. This may need to be modified with the quirk module parameter\n");
+ 		} else {
+ 			/*
+ 			 * Set configuration based on platform NHLT.
+ 			 * In this machine driver, we can only support one SSP for the
+ 			 * ES8336 link.
+ 			 * In some cases multiple SSPs can be reported by NHLT, starting MSB-first
+ 			 * seems to pick the right connection.
+ 			 */
+ 			unsigned long ssp;
+ 
+ 			/* fls returns 1-based results, SSPs indices are 0-based */
+ 			ssp = fls(mach->mach_params.i2s_link_mask) - 1;
++>>>>>>> 24913664b510 (ASoC: Intel: sof_es8336: remove hard-coded SSP selection)
  
 -			quirk |= ssp;
 -		}
 +		quirk |= ssp;
  	}
  
  	if (mach->mach_params.dmic_num)
* Unmerged path sound/soc/intel/boards/sof_es8336.c
