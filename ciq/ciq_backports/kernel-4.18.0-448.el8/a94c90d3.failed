wifi: mac80211: mlme: fix disassoc with MLO

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit a94c90d32193ceac2aa5fc36f3833deeeb85bf8d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/a94c90d3.failed

In MLO we shouldn't call ieee80211_bss_info_change_notify(),
call that only (for backward compatibility) without MLO, and
otherwise ieee80211_vif_cfg_change_notify().

Similarly, ieee80211_reset_erp_info() only applies to the
current link, and in MLO we assume the driver doesn't really
need that.

	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit a94c90d32193ceac2aa5fc36f3833deeeb85bf8d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mac80211/mlme.c
diff --cc net/mac80211/mlme.c
index 446accddbebd,3d4ab711f0d1..000000000000
--- a/net/mac80211/mlme.c
+++ b/net/mac80211/mlme.c
@@@ -2497,14 -2917,17 +2498,26 @@@ static void ieee80211_set_disassoc(stru
  		changed |= BSS_CHANGED_ARP_FILTER;
  
  	sdata->vif.bss_conf.qos = false;
++<<<<<<< HEAD
 +	changed |= BSS_CHANGED_QOS;
 +
 +	/* The BSSID (not really interesting) and HT changed */
 +	changed |= BSS_CHANGED_BSSID | BSS_CHANGED_HT;
 +	ieee80211_bss_info_change_notify(sdata, changed);
 +
++=======
+ 	if (!sdata->vif.valid_links) {
+ 		changed |= BSS_CHANGED_QOS;
+ 		/* The BSSID (not really interesting) and HT changed */
+ 		changed |= BSS_CHANGED_BSSID | BSS_CHANGED_HT;
+ 		ieee80211_bss_info_change_notify(sdata, changed);
+ 	} else {
+ 		ieee80211_vif_cfg_change_notify(sdata, changed);
+ 	}
+ 
++>>>>>>> a94c90d32193 (wifi: mac80211: mlme: fix disassoc with MLO)
  	/* disassociated - set to defaults now */
 -	ieee80211_set_wmm_default(&sdata->deflink, false, false);
 +	ieee80211_set_wmm_default(sdata, false, false);
  
  	del_timer_sync(&sdata->u.mgd.conn_mon_timer);
  	del_timer_sync(&sdata->u.mgd.bcn_mon_timer);
* Unmerged path net/mac80211/mlme.c
