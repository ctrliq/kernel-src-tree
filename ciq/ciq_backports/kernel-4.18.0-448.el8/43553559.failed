fbcon: Consistently protect deferred_takeover with console_lock()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Daniel Vetter <daniel.vetter@ffwll.ch>
commit 43553559121ca90965b572cf8a1d6d0fd618b449
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/43553559.failed

This shouldn't be a problem in practice since until we've actually
taken over the console there's nothing we've registered with the
console/vt subsystem, so the exit/unbind path that check this can't
do the wrong thing. But it's confusing, so fix it by moving it a tad
later.

	Acked-by: Sam Ravnborg <sam@ravnborg.org>
	Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>
	Cc: Daniel Vetter <daniel@ffwll.ch>
	Cc: Du Cheng <ducheng2@gmail.com>
	Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
	Cc: Claudio Suarez <cssk@net-c.es>
	Cc: Thomas Zimmermann <tzimmermann@suse.de>
Link: https://patchwork.freedesktop.org/patch/msgid/20220405210335.3434130-14-daniel.vetter@ffwll.ch
(cherry picked from commit 43553559121ca90965b572cf8a1d6d0fd618b449)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/video/fbdev/core/fbcon.c
diff --cc drivers/video/fbdev/core/fbcon.c
index 1a25ce50a9fd,4f9752ee9189..000000000000
--- a/drivers/video/fbdev/core/fbcon.c
+++ b/drivers/video/fbdev/core/fbcon.c
@@@ -3613,10 -3227,11 +3613,18 @@@ static void fbcon_register_existing_fbs
  
  	console_lock();
  
++<<<<<<< HEAD
 +	for (i = 0; i < FB_MAX; i++) {
 +		if (registered_fb[i])
 +			fbcon_fb_registered(registered_fb[i]);
 +	}
++=======
+ 	deferred_takeover = false;
+ 	logo_shown = FBCON_LOGO_DONTSHOW;
+ 
+ 	for_each_registered_fb(i)
+ 		fbcon_fb_registered(registered_fb[i]);
++>>>>>>> 43553559121c (fbcon: Consistently protect deferred_takeover with console_lock())
  
  	console_unlock();
  }
* Unmerged path drivers/video/fbdev/core/fbcon.c
