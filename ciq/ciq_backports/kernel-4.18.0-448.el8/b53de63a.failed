kvm: selftests: aarch64: use a tighter assert in vgic_poke_irq()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Ricardo Koller <ricarkol@google.com>
commit b53de63a89244c196d8a2ea76b6754e3fdb4b626
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/b53de63a.failed

vgic_poke_irq() checks that the attr argument passed to the vgic device
ioctl is sane. Make this check tighter by moving it to after the last
attr update.

	Signed-off-by: Ricardo Koller <ricarkol@google.com>
	Reported-by: Reiji Watanabe <reijiw@google.com>
	Cc: Andrew Jones <drjones@redhat.com>
	Reviewed-by: Andrew Jones <drjones@redhat.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: https://lore.kernel.org/r/20220127030858.3269036-6-ricarkol@google.com
(cherry picked from commit b53de63a89244c196d8a2ea76b6754e3fdb4b626)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/lib/aarch64/vgic.c
diff --cc tools/testing/selftests/kvm/lib/aarch64/vgic.c
index a1f1f6c8e2e0,f365c32a7296..000000000000
--- a/tools/testing/selftests/kvm/lib/aarch64/vgic.c
+++ b/tools/testing/selftests/kvm/lib/aarch64/vgic.c
@@@ -142,7 -147,11 +139,15 @@@ static void vgic_poke_irq(int gic_fd, u
  		attr += SZ_64K;
  	}
  
++<<<<<<< HEAD
 +	/* All calls will succeed, even with invalid intid's, as long as the
++=======
+ 	/* Check that the addr part of the attr is within 32 bits. */
+ 	assert((attr & ~KVM_DEV_ARM_VGIC_OFFSET_MASK) == 0);
+ 
+ 	/*
+ 	 * All calls will succeed, even with invalid intid's, as long as the
++>>>>>>> b53de63a8924 (kvm: selftests: aarch64: use a tighter assert in vgic_poke_irq())
  	 * addr part of the attr is within 32 bits (checked above). An invalid
  	 * intid will just make the read/writes point to above the intended
  	 * register space (i.e., ICPENDR after ISPENDR).
* Unmerged path tools/testing/selftests/kvm/lib/aarch64/vgic.c
