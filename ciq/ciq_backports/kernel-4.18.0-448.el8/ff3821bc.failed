wifi: nl80211: Fix reading NL80211_ATTR_MLO_LINK_ID in nl80211_pre_doit

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Veerendranath Jakkam <quic_vjakkam@quicinc.com>
commit ff3821bc355275ada757dd2be8654dd0aae9c2f9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/ff3821bc.failed

nl80211_pre_doit() using nla_get_u16() to read u8 attribute
NL80211_ATTR_MLO_LINK_ID. Fix this by using nla_get_u8() to
read NL80211_ATTR_MLO_LINK_ID attribute.

	Signed-off-by: Veerendranath Jakkam <quic_vjakkam@quicinc.com>
Link: https://lore.kernel.org/r/1657517683-5724-1-git-send-email-quic_vjakkam@quicinc.com
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit ff3821bc355275ada757dd2be8654dd0aae9c2f9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index 1ee5ef214b30,e20d0fc9678a..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -15485,6 -15824,37 +15485,40 @@@ static int nl80211_pre_doit(const struc
  		info->user_ptr[0] = rdev;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (internal_flags & NL80211_FLAG_MLO_VALID_LINK_ID) {
+ 		struct nlattr *link_id = info->attrs[NL80211_ATTR_MLO_LINK_ID];
+ 
+ 		if (!wdev) {
+ 			err = -EINVAL;
+ 			goto out_unlock;
+ 		}
+ 
+ 		/* MLO -> require valid link ID */
+ 		if (wdev->valid_links &&
+ 		    (!link_id ||
+ 		     !(wdev->valid_links & BIT(nla_get_u8(link_id))))) {
+ 			err = -EINVAL;
+ 			goto out_unlock;
+ 		}
+ 
+ 		/* non-MLO -> no link ID attribute accepted */
+ 		if (!wdev->valid_links && link_id) {
+ 			err = -EINVAL;
+ 			goto out_unlock;
+ 		}
+ 	}
+ 
+ 	if (internal_flags & NL80211_FLAG_MLO_UNSUPPORTED) {
+ 		if (info->attrs[NL80211_ATTR_MLO_LINK_ID] ||
+ 		    (wdev && wdev->valid_links)) {
+ 			err = -EINVAL;
+ 			goto out_unlock;
+ 		}
+ 	}
+ 
++>>>>>>> ff3821bc3552 (wifi: nl80211: Fix reading NL80211_ATTR_MLO_LINK_ID in nl80211_pre_doit)
  	if (rdev && !(internal_flags & NL80211_FLAG_NO_WIPHY_MTX)) {
  		wiphy_lock(&rdev->wiphy);
  		/* we keep the mutex locked until post_doit */
* Unmerged path net/wireless/nl80211.c
