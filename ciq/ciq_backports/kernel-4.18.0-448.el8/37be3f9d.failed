scsi: qla2xxx: edif: Reduce N2N thrashing at app_start time

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Quinn Tran <qutran@marvell.com>
commit 37be3f9d6993a721bc019f03c97ea0fe66319997
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/37be3f9d.failed

For N2N + remote WWPN is bigger than local adapter, remote adapter will
login to local adapter while authentication application is not running.
When authentication application starts, the current session in FW needs to
to be invalidated.

Make sure the old session is torn down before triggering a relogin.

Link: https://lore.kernel.org/r/20220608115849.16693-9-njavali@marvell.com
Fixes: 4de067e5df12 ("scsi: qla2xxx: edif: Add N2N support for EDIF")
	Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
	Signed-off-by: Quinn Tran <qutran@marvell.com>
	Signed-off-by: Nilesh Javali <njavali@marvell.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 37be3f9d6993a721bc019f03c97ea0fe66319997)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/qla2xxx/qla_edif.c
diff --cc drivers/scsi/qla2xxx/qla_edif.c
index 88d1efc3b7b6,400a8b6f3982..000000000000
--- a/drivers/scsi/qla2xxx/qla_edif.c
+++ b/drivers/scsi/qla2xxx/qla_edif.c
@@@ -886,20 -937,21 +903,29 @@@ qla_edif_app_getfcinfo(scsi_qla_host_t 
  			if (tdid.b24 != 0 && tdid.b24 != fcport->d_id.b24)
  				continue;
  
++<<<<<<< HEAD
 +			app_reply->ports[pcnt].rekey_count =
 +				fcport->edif.rekey_cnt;
 +
 +			if (fcport->scan_state != QLA_FCPORT_FOUND)
 +				continue;
- 
- 			if (fcport->port_type == FCT_UNKNOWN && !fcport->fc4_features)
- 				rval = qla24xx_async_gffid(vha, fcport, true);
- 
- 			if (!rval &&
- 			    !(fcport->fc4_features & FC4_FF_TARGET ||
- 			      fcport->port_type &
- 			      (FCT_TARGET | FCT_NVME_TARGET)))
- 				continue;
++=======
+ 			if (!N2N_TOPO(vha->hw)) {
+ 				if (fcport->scan_state != QLA_FCPORT_FOUND)
+ 					continue;
++>>>>>>> 37be3f9d6993 (scsi: qla2xxx: edif: Reduce N2N thrashing at app_start time)
+ 
+ 				if (fcport->port_type == FCT_UNKNOWN &&
+ 				    !fcport->fc4_features)
+ 					rval = qla24xx_async_gffid(vha, fcport,
+ 								   true);
+ 
+ 				if (!rval &&
+ 				    !(fcport->fc4_features & FC4_FF_TARGET ||
+ 				      fcport->port_type &
+ 				      (FCT_TARGET | FCT_NVME_TARGET)))
+ 					continue;
+ 			}
  
  			rval = 0;
  
* Unmerged path drivers/scsi/qla2xxx/qla_edif.c
