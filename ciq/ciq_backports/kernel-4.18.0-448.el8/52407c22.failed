drm/i915/rpl-s: Add PCI IDS for Raptor Lake S

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Anusha Srivatsa <anusha.srivatsa@intel.com>
commit 52407c220c44c8dcc6aa8aa35ffc8a2db3c849a9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/52407c22.failed

Raptor Lake S(RPL-S) is a version 12
Display, Media and Render. For all i915
purposes it is the same as Alder Lake S (ADL-S).

Introduce RPL-S as a subplatform
of ADL-S. This patch adds PCI ids for RPL-S.

BSpec: 53655
	Cc: x86@kernel.org
	Cc: dri-devel@lists.freedesktop.org
	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: Borislav Petkov <bp@alien8.de>
	Cc: Dave Hansen <dave.hansen@linux.intel.com>
	Cc: Joonas Lahtinen <joonas.lahtinen@linux.intel.com>
	Cc: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
	Cc: Matt Roper <matthew.d.roper@intel.com>
	Cc: Jani Nikula <jani.nikula@linux.intel.com>
	Signed-off-by: Anusha Srivatsa <anusha.srivatsa@intel.com>
	Reviewed-by: José Roberto de Souza <jose.souza@intel.com>
	Acked-by: Dave Hansen <dave.hansen@linux.intel.com> # arch/x86
	Acked-by: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
	Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20211203063545.2254380-2-anusha.srivatsa@intel.com
(cherry picked from commit 52407c220c44c8dcc6aa8aa35ffc8a2db3c849a9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/i915/i915_drv.h
#	drivers/gpu/drm/i915/i915_pci.c
#	drivers/gpu/drm/i915/intel_device_info.h
diff --cc drivers/gpu/drm/i915/i915_drv.h
index 4120fd31e1b9,c10e2c81baea..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@@ -1445,7 -1275,14 +1445,18 @@@ IS_SUBPLATFORM(const struct drm_i915_pr
  #define IS_DG1(dev_priv)        IS_PLATFORM(dev_priv, INTEL_DG1)
  #define IS_ALDERLAKE_S(dev_priv) IS_PLATFORM(dev_priv, INTEL_ALDERLAKE_S)
  #define IS_ALDERLAKE_P(dev_priv) IS_PLATFORM(dev_priv, INTEL_ALDERLAKE_P)
++<<<<<<< HEAD
 +#define IS_DG2(dev_priv)	0
++=======
+ #define IS_XEHPSDV(dev_priv) IS_PLATFORM(dev_priv, INTEL_XEHPSDV)
+ #define IS_DG2(dev_priv)	IS_PLATFORM(dev_priv, INTEL_DG2)
+ #define IS_DG2_G10(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_DG2, INTEL_SUBPLATFORM_G10)
+ #define IS_DG2_G11(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_DG2, INTEL_SUBPLATFORM_G11)
+ #define IS_ADLS_RPLS(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_ALDERLAKE_S, INTEL_SUBPLATFORM_RPL_S)
++>>>>>>> 52407c220c44 (drm/i915/rpl-s: Add PCI IDS for Raptor Lake S)
  #define IS_HSW_EARLY_SDV(dev_priv) (IS_HASWELL(dev_priv) && \
  				    (INTEL_DEVID(dev_priv) & 0xFF00) == 0x0C00)
  #define IS_BDW_ULT(dev_priv) \
diff --cc drivers/gpu/drm/i915/i915_pci.c
index abdff274a70a,a98941b512e5..000000000000
--- a/drivers/gpu/drm/i915/i915_pci.c
+++ b/drivers/gpu/drm/i915/i915_pci.c
@@@ -1072,6 -1132,8 +1072,11 @@@ static const struct pci_device_id pciid
  	INTEL_RKL_IDS(&rkl_info),
  	INTEL_ADLS_IDS(&adl_s_info),
  	INTEL_ADLP_IDS(&adl_p_info),
++<<<<<<< HEAD
++=======
+ 	INTEL_DG1_IDS(&dg1_info),
+ 	INTEL_RPLS_IDS(&adl_s_info),
++>>>>>>> 52407c220c44 (drm/i915/rpl-s: Add PCI IDS for Raptor Lake S)
  	{0, 0, 0}
  };
  MODULE_DEVICE_TABLE(pci, pciidlist);
diff --cc drivers/gpu/drm/i915/intel_device_info.h
index b326aff65cd6,ac427d6ae305..000000000000
--- a/drivers/gpu/drm/i915/intel_device_info.h
+++ b/drivers/gpu/drm/i915/intel_device_info.h
@@@ -103,9 -103,16 +103,19 @@@ enum intel_platform 
  #define INTEL_SUBPLATFORM_ULT	(0)
  #define INTEL_SUBPLATFORM_ULX	(1)
  
 -/* ICL */
 +/* CNL/ICL */
  #define INTEL_SUBPLATFORM_PORTF	(0)
  
++<<<<<<< HEAD
++=======
+ /* DG2 */
+ #define INTEL_SUBPLATFORM_G10	0
+ #define INTEL_SUBPLATFORM_G11	1
+ 
+ /* ADL-S */
+ #define INTEL_SUBPLATFORM_RPL_S	0
+ 
++>>>>>>> 52407c220c44 (drm/i915/rpl-s: Add PCI IDS for Raptor Lake S)
  enum intel_ppgtt_type {
  	INTEL_PPGTT_NONE = I915_GEM_PPGTT_NONE,
  	INTEL_PPGTT_ALIASING = I915_GEM_PPGTT_ALIASING,
diff --git a/arch/x86/kernel/early-quirks.c b/arch/x86/kernel/early-quirks.c
index 391a4e2b8604..fd2d3ab38ebb 100644
--- a/arch/x86/kernel/early-quirks.c
+++ b/arch/x86/kernel/early-quirks.c
@@ -554,6 +554,7 @@ static const struct pci_device_id intel_early_ids[] __initconst = {
 	INTEL_RKL_IDS(&gen11_early_ops),
 	INTEL_ADLS_IDS(&gen11_early_ops),
 	INTEL_ADLP_IDS(&gen11_early_ops),
+	INTEL_RPLS_IDS(&gen11_early_ops),
 };
 
 struct resource intel_graphics_stolen_res __ro_after_init = DEFINE_RES_MEM(0, 0);
* Unmerged path drivers/gpu/drm/i915/i915_drv.h
* Unmerged path drivers/gpu/drm/i915/i915_pci.c
diff --git a/drivers/gpu/drm/i915/intel_device_info.c b/drivers/gpu/drm/i915/intel_device_info.c
index 2dc3859f6acd..be14841d0dad 100644
--- a/drivers/gpu/drm/i915/intel_device_info.c
+++ b/drivers/gpu/drm/i915/intel_device_info.c
@@ -169,6 +169,10 @@ static const u16 subplatform_portf_ids[] = {
 	INTEL_ICL_PORT_F_IDS(0),
 };
 
+static const u16 subplatform_rpls_ids[] = {
+	INTEL_RPLS_IDS(0),
+};
+
 static bool find_devid(u16 id, const u16 *p, unsigned int num)
 {
 	for (; num; num--, p++) {
@@ -205,6 +209,9 @@ void intel_device_info_subplatform_init(struct drm_i915_private *i915)
 	} else if (find_devid(devid, subplatform_portf_ids,
 			      ARRAY_SIZE(subplatform_portf_ids))) {
 		mask = BIT(INTEL_SUBPLATFORM_PORTF);
+	} else if (find_devid(devid, subplatform_rpls_ids,
+			      ARRAY_SIZE(subplatform_rpls_ids))) {
+		mask = BIT(INTEL_SUBPLATFORM_RPL_S);
 	}
 
 	if (IS_TIGERLAKE(i915)) {
* Unmerged path drivers/gpu/drm/i915/intel_device_info.h
diff --git a/include/drm/i915_pciids.h b/include/drm/i915_pciids.h
index cb45af9f2c44..a0b00d6fa3cd 100644
--- a/include/drm/i915_pciids.h
+++ b/include/drm/i915_pciids.h
@@ -665,4 +665,13 @@
 	INTEL_VGA_DEVICE(0x46C2, info), \
 	INTEL_VGA_DEVICE(0x46C3, info)
 
+/* RPL-S */
+#define INTEL_RPLS_IDS(info) \
+	INTEL_VGA_DEVICE(0xA780, info), \
+	INTEL_VGA_DEVICE(0xA781, info), \
+	INTEL_VGA_DEVICE(0xA782, info), \
+	INTEL_VGA_DEVICE(0xA783, info), \
+	INTEL_VGA_DEVICE(0xA788, info), \
+	INTEL_VGA_DEVICE(0xA789, info)
+
 #endif /* _I915_PCIIDS_H */
