wifi: nl80211: check MLO support in authenticate

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit 45aaf17c0c3471efa3100dadfc65e3d459821443
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/45aaf17c.failed

We should check that MLO connections are supported before
attempting to authenticate with MLO parameters, check that.

Fixes: d648c23024bd ("wifi: nl80211: support MLO in auth/assoc")
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 45aaf17c0c3471efa3100dadfc65e3d459821443)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index 7060846918e1,ee3826e8e52b..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -10219,12 -10404,31 +10219,34 @@@ static int nl80211_authenticate(struct 
  	if (local_state_change)
  		return 0;
  
++<<<<<<< HEAD
++=======
+ 	req.auth_type = auth_type;
+ 	req.key = key.p.key;
+ 	req.key_len = key.p.key_len;
+ 	req.key_idx = key.idx;
+ 	req.link_id = nl80211_link_id_or_invalid(info->attrs);
+ 	if (req.link_id >= 0) {
+ 		if (!(rdev->wiphy.flags & WIPHY_FLAG_SUPPORTS_MLO))
+ 			return -EINVAL;
+ 		if (!info->attrs[NL80211_ATTR_MLD_ADDR])
+ 			return -EINVAL;
+ 		req.ap_mld_addr = nla_data(info->attrs[NL80211_ATTR_MLD_ADDR]);
+ 	}
+ 
+ 	req.bss = cfg80211_get_bss(&rdev->wiphy, chan, bssid, ssid, ssid_len,
+ 				   IEEE80211_BSS_TYPE_ESS,
+ 				   IEEE80211_PRIVACY_ANY);
+ 	if (!req.bss)
+ 		return -ENOENT;
+ 
++>>>>>>> 45aaf17c0c34 (wifi: nl80211: check MLO support in authenticate)
  	wdev_lock(dev->ieee80211_ptr);
 -	err = cfg80211_mlme_auth(rdev, dev, &req);
 +	err = cfg80211_mlme_auth(rdev, dev, chan, auth_type, bssid,
 +				 ssid, ssid_len, ie, ie_len,
 +				 key.p.key, key.p.key_len, key.idx,
 +				 auth_data, auth_data_len);
  	wdev_unlock(dev->ieee80211_ptr);
 -
 -	cfg80211_put_bss(&rdev->wiphy, req.bss);
 -
  	return err;
  }
  
* Unmerged path net/wireless/nl80211.c
