drm/i915/rpl-p: Add PCI IDs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Matt Atwood <matthew.s.atwood@intel.com>
commit 72c3c8d6e5275b19fd2d32ec787e8135a421c7ec
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/72c3c8d6.failed

Adding initial PCI ids for RPL-P.
RPL-P behaves identically to ADL-P from i915's point of view.

Changes since V1 :
	- SUBPLATFORM ADL_N and RPL_P clash as both are ADLP
	  based - Matthew R

Bspec: 55376
	Signed-off-by: Matt Atwood <matthew.s.atwood@intel.com>
	Signed-off-by: Madhumitha Tolakanahalli Pradeep <madhumitha.tolakanahalli.pradeep@intel.com>
	Signed-off-by: Tejas Upadhyay <tejaskumarx.surendrakumar.upadhyay@intel.com>
[mattrope: Corrected comment formatting to match coding style]
	Signed-off-by: Matt Roper <matthew.d.roper@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20220418062157.2974665-1-tejaskumarx.surendrakumar.upadhyay@intel.com
(cherry picked from commit 72c3c8d6e5275b19fd2d32ec787e8135a421c7ec)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/early-quirks.c
#	drivers/gpu/drm/i915/i915_drv.h
#	drivers/gpu/drm/i915/i915_pci.c
#	drivers/gpu/drm/i915/intel_device_info.c
#	drivers/gpu/drm/i915/intel_device_info.h
#	include/drm/i915_pciids.h
diff --cc arch/x86/kernel/early-quirks.c
index a031b7689085,a6c1867fc7aa..000000000000
--- a/arch/x86/kernel/early-quirks.c
+++ b/arch/x86/kernel/early-quirks.c
@@@ -556,6 -556,9 +556,12 @@@ static const struct pci_device_id intel
  	INTEL_RKL_IDS(&gen11_early_ops),
  	INTEL_ADLS_IDS(&gen11_early_ops),
  	INTEL_ADLP_IDS(&gen11_early_ops),
++<<<<<<< HEAD
++=======
+ 	INTEL_ADLN_IDS(&gen11_early_ops),
+ 	INTEL_RPLS_IDS(&gen11_early_ops),
+ 	INTEL_RPLP_IDS(&gen11_early_ops),
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  };
  
  struct resource intel_graphics_stolen_res __ro_after_init = DEFINE_RES_MEM(0, 0);
diff --cc drivers/gpu/drm/i915/i915_drv.h
index 4120fd31e1b9,3711d618a372..000000000000
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@@ -1445,7 -1045,20 +1445,24 @@@ IS_SUBPLATFORM(const struct drm_i915_pr
  #define IS_DG1(dev_priv)        IS_PLATFORM(dev_priv, INTEL_DG1)
  #define IS_ALDERLAKE_S(dev_priv) IS_PLATFORM(dev_priv, INTEL_ALDERLAKE_S)
  #define IS_ALDERLAKE_P(dev_priv) IS_PLATFORM(dev_priv, INTEL_ALDERLAKE_P)
++<<<<<<< HEAD
 +#define IS_DG2(dev_priv)	0
++=======
+ #define IS_XEHPSDV(dev_priv) IS_PLATFORM(dev_priv, INTEL_XEHPSDV)
+ #define IS_DG2(dev_priv)	IS_PLATFORM(dev_priv, INTEL_DG2)
+ #define IS_DG2_G10(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_DG2, INTEL_SUBPLATFORM_G10)
+ #define IS_DG2_G11(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_DG2, INTEL_SUBPLATFORM_G11)
+ #define IS_DG2_G12(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_DG2, INTEL_SUBPLATFORM_G12)
+ #define IS_ADLS_RPLS(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_ALDERLAKE_S, INTEL_SUBPLATFORM_RPL)
+ #define IS_ADLP_N(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_ALDERLAKE_P, INTEL_SUBPLATFORM_N)
+ #define IS_ADLP_RPLP(dev_priv) \
+ 	IS_SUBPLATFORM(dev_priv, INTEL_ALDERLAKE_P, INTEL_SUBPLATFORM_RPL)
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  #define IS_HSW_EARLY_SDV(dev_priv) (IS_HASWELL(dev_priv) && \
  				    (INTEL_DEVID(dev_priv) & 0xFF00) == 0x0C00)
  #define IS_BDW_ULT(dev_priv) \
diff --cc drivers/gpu/drm/i915/i915_pci.c
index abdff274a70a,f59e526b03fc..000000000000
--- a/drivers/gpu/drm/i915/i915_pci.c
+++ b/drivers/gpu/drm/i915/i915_pci.c
@@@ -1072,6 -1148,10 +1072,13 @@@ static const struct pci_device_id pciid
  	INTEL_RKL_IDS(&rkl_info),
  	INTEL_ADLS_IDS(&adl_s_info),
  	INTEL_ADLP_IDS(&adl_p_info),
++<<<<<<< HEAD
++=======
+ 	INTEL_ADLN_IDS(&adl_p_info),
+ 	INTEL_DG1_IDS(&dg1_info),
+ 	INTEL_RPLS_IDS(&adl_s_info),
+ 	INTEL_RPLP_IDS(&adl_p_info),
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  	{0, 0, 0}
  };
  MODULE_DEVICE_TABLE(pci, pciidlist);
diff --cc drivers/gpu/drm/i915/intel_device_info.c
index 2dc3859f6acd,74c3ffb66b8d..000000000000
--- a/drivers/gpu/drm/i915/intel_device_info.c
+++ b/drivers/gpu/drm/i915/intel_device_info.c
@@@ -169,6 -173,19 +169,22 @@@ static const u16 subplatform_portf_ids[
  	INTEL_ICL_PORT_F_IDS(0),
  };
  
++<<<<<<< HEAD
++=======
+ static const u16 subplatform_uy_ids[] = {
+ 	INTEL_TGL_12_GT2_IDS(0),
+ };
+ 
+ static const u16 subplatform_n_ids[] = {
+ 	INTEL_ADLN_IDS(0),
+ };
+ 
+ static const u16 subplatform_rpl_ids[] = {
+ 	INTEL_RPLS_IDS(0),
+ 	INTEL_RPLP_IDS(0),
+ };
+ 
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  static bool find_devid(u16 id, const u16 *p, unsigned int num)
  {
  	for (; num; num--, p++) {
@@@ -205,25 -222,15 +221,37 @@@ void intel_device_info_subplatform_init
  	} else if (find_devid(devid, subplatform_portf_ids,
  			      ARRAY_SIZE(subplatform_portf_ids))) {
  		mask = BIT(INTEL_SUBPLATFORM_PORTF);
++<<<<<<< HEAD
 +	}
 +
 +	if (IS_TIGERLAKE(i915)) {
 +		struct pci_dev *root, *pdev = to_pci_dev(i915->drm.dev);
 +
 +		root = list_first_entry(&pdev->bus->devices, typeof(*root), bus_list);
 +
 +		drm_WARN_ON(&i915->drm, mask);
 +		drm_WARN_ON(&i915->drm, (root->device & TGL_ROOT_DEVICE_MASK) !=
 +			    TGL_ROOT_DEVICE_ID);
 +
 +		switch (root->device & TGL_ROOT_DEVICE_SKU_MASK) {
 +		case TGL_ROOT_DEVICE_SKU_ULX:
 +			mask = BIT(INTEL_SUBPLATFORM_ULX);
 +			break;
 +		case TGL_ROOT_DEVICE_SKU_ULT:
 +			mask = BIT(INTEL_SUBPLATFORM_ULT);
 +			break;
 +		}
++=======
+ 	} else if (find_devid(devid, subplatform_uy_ids,
+ 			   ARRAY_SIZE(subplatform_uy_ids))) {
+ 		mask = BIT(INTEL_SUBPLATFORM_UY);
+ 	} else if (find_devid(devid, subplatform_n_ids,
+ 				ARRAY_SIZE(subplatform_n_ids))) {
+ 		mask = BIT(INTEL_SUBPLATFORM_N);
+ 	} else if (find_devid(devid, subplatform_rpl_ids,
+ 			      ARRAY_SIZE(subplatform_rpl_ids))) {
+ 		mask = BIT(INTEL_SUBPLATFORM_RPL);
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  	}
  
  	GEM_BUG_ON(mask & ~INTEL_SUBPLATFORM_MASK);
diff --cc drivers/gpu/drm/i915/intel_device_info.h
index b326aff65cd6,4053efaa55da..000000000000
--- a/drivers/gpu/drm/i915/intel_device_info.h
+++ b/drivers/gpu/drm/i915/intel_device_info.h
@@@ -103,9 -103,28 +103,31 @@@ enum intel_platform 
  #define INTEL_SUBPLATFORM_ULT	(0)
  #define INTEL_SUBPLATFORM_ULX	(1)
  
 -/* ICL */
 +/* CNL/ICL */
  #define INTEL_SUBPLATFORM_PORTF	(0)
  
++<<<<<<< HEAD
++=======
+ /* TGL */
+ #define INTEL_SUBPLATFORM_UY	(0)
+ 
+ /* DG2 */
+ #define INTEL_SUBPLATFORM_G10	0
+ #define INTEL_SUBPLATFORM_G11	1
+ #define INTEL_SUBPLATFORM_G12	2
+ 
+ /* ADL */
+ #define INTEL_SUBPLATFORM_RPL	0
+ 
+ /* ADL-P */
+ /*
+  * As #define INTEL_SUBPLATFORM_RPL 0 will apply
+  * here too, SUBPLATFORM_N will have different
+  * bit set
+  */
+ #define INTEL_SUBPLATFORM_N    1
+ 
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  enum intel_ppgtt_type {
  	INTEL_PPGTT_NONE = I915_GEM_PPGTT_NONE,
  	INTEL_PPGTT_ALIASING = I915_GEM_PPGTT_ALIASING,
diff --cc include/drm/i915_pciids.h
index cb45af9f2c44,a7b5eea7ffaa..000000000000
--- a/include/drm/i915_pciids.h
+++ b/include/drm/i915_pciids.h
@@@ -665,4 -666,30 +665,33 @@@
  	INTEL_VGA_DEVICE(0x46C2, info), \
  	INTEL_VGA_DEVICE(0x46C3, info)
  
++<<<<<<< HEAD
++=======
+ /* ADL-N */
+ #define INTEL_ADLN_IDS(info) \
+ 	INTEL_VGA_DEVICE(0x46D0, info), \
+ 	INTEL_VGA_DEVICE(0x46D1, info), \
+ 	INTEL_VGA_DEVICE(0x46D2, info)
+ 
+ /* RPL-S */
+ #define INTEL_RPLS_IDS(info) \
+ 	INTEL_VGA_DEVICE(0xA780, info), \
+ 	INTEL_VGA_DEVICE(0xA781, info), \
+ 	INTEL_VGA_DEVICE(0xA782, info), \
+ 	INTEL_VGA_DEVICE(0xA783, info), \
+ 	INTEL_VGA_DEVICE(0xA788, info), \
+ 	INTEL_VGA_DEVICE(0xA789, info), \
+ 	INTEL_VGA_DEVICE(0xA78A, info), \
+ 	INTEL_VGA_DEVICE(0xA78B, info)
+ 
+ /* RPL-P */
+ #define INTEL_RPLP_IDS(info) \
+ 	INTEL_VGA_DEVICE(0xA720, info), \
+ 	INTEL_VGA_DEVICE(0xA721, info), \
+ 	INTEL_VGA_DEVICE(0xA7A0, info), \
+ 	INTEL_VGA_DEVICE(0xA7A1, info), \
+ 	INTEL_VGA_DEVICE(0xA7A8, info), \
+ 	INTEL_VGA_DEVICE(0xA7A9, info)
+ 
++>>>>>>> 72c3c8d6e527 (drm/i915/rpl-p: Add PCI IDs)
  #endif /* _I915_PCIIDS_H */
* Unmerged path arch/x86/kernel/early-quirks.c
* Unmerged path drivers/gpu/drm/i915/i915_drv.h
* Unmerged path drivers/gpu/drm/i915/i915_pci.c
* Unmerged path drivers/gpu/drm/i915/intel_device_info.c
* Unmerged path drivers/gpu/drm/i915/intel_device_info.h
* Unmerged path include/drm/i915_pciids.h
