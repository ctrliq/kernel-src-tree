gve: Add consumed counts to ethtool stats

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Jordan Kim <jrkim@google.com>
commit 2c9198356d56a8e035702cfd1a0fde27edbcc338
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/2c919835.failed

Being able to see how many descriptors are in-use is helpful
when diagnosing certain issues.

	Signed-off-by: Jeroen de Borst <jeroendb@google.com>
	Signed-off-by: Jordan Kim <jrkim@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 2c9198356d56a8e035702cfd1a0fde27edbcc338)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/google/gve/gve_ethtool.c
diff --cc drivers/net/ethernet/google/gve/gve_ethtool.c
index e8a09d3163e6,e0815bb031e9..000000000000
--- a/drivers/net/ethernet/google/gve/gve_ethtool.c
+++ b/drivers/net/ethernet/google/gve/gve_ethtool.c
@@@ -41,15 -42,17 +41,20 @@@ static const char gve_gstrings_main_sta
  };
  
  static const char gve_gstrings_rx_stats[][ETH_GSTRING_LEN] = {
++<<<<<<< HEAD
 +	"rx_posted_desc[%u]", "rx_completed_desc[%u]", "rx_bytes[%u]",
++=======
+ 	"rx_posted_desc[%u]", "rx_completed_desc[%u]", "rx_consumed_desc[%u]", "rx_bytes[%u]",
+ 	"rx_cont_packet_cnt[%u]", "rx_frag_flip_cnt[%u]", "rx_frag_copy_cnt[%u]",
++>>>>>>> 2c9198356d56 (gve: Add consumed counts to ethtool stats)
  	"rx_dropped_pkt[%u]", "rx_copybreak_pkt[%u]", "rx_copied_pkt[%u]",
  	"rx_queue_drop_cnt[%u]", "rx_no_buffers_posted[%u]",
  	"rx_drops_packet_over_mru[%u]", "rx_drops_invalid_checksum[%u]",
  };
  
  static const char gve_gstrings_tx_stats[][ETH_GSTRING_LEN] = {
- 	"tx_posted_desc[%u]", "tx_completed_desc[%u]", "tx_bytes[%u]",
+ 	"tx_posted_desc[%u]", "tx_completed_desc[%u]", "tx_consumed_desc[%u]", "tx_bytes[%u]",
  	"tx_wake[%u]", "tx_stop[%u]", "tx_event_counter[%u]",
 -	"tx_dma_mapping_error[%u]",
  };
  
  static const char gve_gstrings_adminq_stats[][ETH_GSTRING_LEN] = {
@@@ -309,8 -316,18 +315,23 @@@ gve_get_ethtool_stats(struct net_devic
  		for (ring = 0; ring < priv->tx_cfg.num_queues; ring++) {
  			struct gve_tx_ring *tx = &priv->tx[ring];
  
++<<<<<<< HEAD
 +			data[i++] = tx->req;
 +			data[i++] = tx->done;
++=======
+ 			if (gve_is_gqi(priv)) {
+ 				data[i++] = tx->req;
+ 				data[i++] = tx->done;
+ 				data[i++] = tx->req - tx->done;
+ 			} else {
+ 				/* DQO doesn't currently support
+ 				 * posted/completed descriptor counts;
+ 				 */
+ 				data[i++] = 0;
+ 				data[i++] = 0;
+ 				data[i++] = tx->dqo_tx.tail - tx->dqo_tx.head;
+ 			}
++>>>>>>> 2c9198356d56 (gve: Add consumed counts to ethtool stats)
  			do {
  				start =
  				  u64_stats_fetch_begin(&priv->tx[ring].statss);
* Unmerged path drivers/net/ethernet/google/gve/gve_ethtool.c
