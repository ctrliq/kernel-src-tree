ASoC: SOF: topology: add code to parse config params for ACPDMIC dai

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Ajit Kumar Pandey <AjitKumar.Pandey@amd.com>
commit 689614ce48b0310b50d8d6c9a64f8a98cfc6f195
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/689614ce.failed

Add sof_ipc_dai_acpdmic_params and tokens to parse dmic channels and
rate params from topology file

	Signed-off-by: Ajit Kumar Pandey <AjitKumar.Pandey@amd.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: PÃ©ter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
Link: https://lore.kernel.org/r/20220614075251.21499-1-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 689614ce48b0310b50d8d6c9a64f8a98cfc6f195)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/ipc3-pcm.c
#	sound/soc/sof/ipc3-topology.c
#	sound/soc/sof/sof-audio.h
diff --cc sound/soc/sof/sof-audio.h
index 12d531df1752,4284ea2f3a1f..000000000000
--- a/sound/soc/sof/sof-audio.h
+++ b/sound/soc/sof/sof-audio.h
@@@ -130,6 -228,15 +130,18 @@@ enum sof_tokens 
  	SOF_AFE_TOKENS,
  	SOF_CORE_TOKENS,
  	SOF_COMP_EXT_TOKENS,
++<<<<<<< HEAD
++=======
+ 	SOF_IN_AUDIO_FORMAT_TOKENS,
+ 	SOF_OUT_AUDIO_FORMAT_TOKENS,
+ 	SOF_AUDIO_FORMAT_BUFFER_SIZE_TOKENS,
+ 	SOF_COPIER_GATEWAY_CFG_TOKENS,
+ 	SOF_COPIER_TOKENS,
+ 	SOF_AUDIO_FMT_NUM_TOKENS,
+ 	SOF_COPIER_FORMAT_TOKENS,
+ 	SOF_GAIN_TOKENS,
+ 	SOF_ACPDMIC_TOKENS,
++>>>>>>> 689614ce48b0 (ASoC: SOF: topology: add code to parse config params for ACPDMIC dai)
  
  	/* this should be the last */
  	SOF_TOKEN_COUNT,
* Unmerged path sound/soc/sof/ipc3-pcm.c
* Unmerged path sound/soc/sof/ipc3-topology.c
diff --git a/include/sound/sof/dai-amd.h b/include/sound/sof/dai-amd.h
index 90d09dbdd709..92f45c180b7c 100644
--- a/include/sound/sof/dai-amd.h
+++ b/include/sound/sof/dai-amd.h
@@ -18,4 +18,11 @@ struct sof_ipc_dai_acp_params {
 	uint32_t fsync_rate;    /* FSYNC frequency in Hz */
 	uint32_t tdm_slots;
 } __packed;
+
+/* ACPDMIC Configuration Request - SOF_IPC_DAI_AMD_CONFIG */
+struct sof_ipc_dai_acpdmic_params {
+	uint32_t pdm_rate;
+	uint32_t pdm_ch;
+} __packed;
+
 #endif
diff --git a/include/sound/sof/dai.h b/include/sound/sof/dai.h
index b0ff33fb063f..52e9849afc35 100644
--- a/include/sound/sof/dai.h
+++ b/include/sound/sof/dai.h
@@ -98,7 +98,7 @@ struct sof_ipc_dai_config {
 		struct sof_ipc_dai_sai_params sai;
 		struct sof_ipc_dai_acp_params acpbt;
 		struct sof_ipc_dai_acp_params acpsp;
-		struct sof_ipc_dai_acp_params acpdmic;
+		struct sof_ipc_dai_acpdmic_params acpdmic;
 		struct sof_ipc_dai_mtk_afe_params afe;
 	};
 } __packed;
diff --git a/include/uapi/sound/sof/tokens.h b/include/uapi/sound/sof/tokens.h
index f7b2019065ad..5caf75cadaf8 100644
--- a/include/uapi/sound/sof/tokens.h
+++ b/include/uapi/sound/sof/tokens.h
@@ -157,6 +157,10 @@
 /* MIXER */
 #define SOF_TKN_MIXER_TYPE			1700
 
+/* ACPDMIC */
+#define SOF_TKN_AMD_ACPDMIC_RATE		1800
+#define SOF_TKN_AMD_ACPDMIC_CH			1801
+
 /* CAVS AUDIO FORMAT */
 #define SOF_TKN_CAVS_AUDIO_FORMAT_IN_RATE	1900
 #define SOF_TKN_CAVS_AUDIO_FORMAT_IN_BIT_DEPTH	1901
* Unmerged path sound/soc/sof/ipc3-pcm.c
* Unmerged path sound/soc/sof/ipc3-topology.c
* Unmerged path sound/soc/sof/sof-audio.h
diff --git a/sound/soc/sof/topology.c b/sound/soc/sof/topology.c
index 9d9e8416c0b0..cde83b843cfc 100644
--- a/sound/soc/sof/topology.c
+++ b/sound/soc/sof/topology.c
@@ -3446,6 +3446,10 @@ static int sof_link_load(struct snd_soc_component *scomp, int index,
 	case SOF_DAI_MEDIATEK_AFE:
 		ret = sof_link_afe_load(scomp, index, link, cfg, hw_config + curr_conf, config);
 		break;
+	case SOF_DAI_AMD_DMIC:
+		token_id = SOF_ACPDMIC_TOKENS;
+		num_tuples += token_list[SOF_ACPDMIC_TOKENS].count;
+		break;
 	default:
 		dev_err(scomp->dev, "error: invalid DAI type %d\n", common_config.type);
 		ret = -EINVAL;
