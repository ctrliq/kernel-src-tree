wifi: nl80211: enable setting the link address at new station

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Shaul Triebitz <shaul.triebitz@intel.com>
commit c0d6701261dbfa29902ca64c7b57b1cc5f0c2533
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/c0d67012.failed

Since for an MLD station the default link is added together
with the add station command, allow also setting the link
MAC address.
Otherwise, it is needed to use the modify link API only
for setting the link MAC address.

	Signed-off-by: Shaul Triebitz <shaul.triebitz@intel.com>
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit c0d6701261dbfa29902ca64c7b57b1cc5f0c2533)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index 64fc5550f07f,b50ba1803595..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -6905,10 -7014,31 +6905,36 @@@ static int nl80211_new_station(struct s
  	    !info->attrs[NL80211_ATTR_PEER_AID])
  		return -EINVAL;
  
++<<<<<<< HEAD
 +	mac_addr = nla_data(info->attrs[NL80211_ATTR_MAC]);
 +	params.supported_rates =
++=======
+ 	params.link_sta_params.link_id =
+ 		nl80211_link_id_or_invalid(info->attrs);
+ 
+ 	if (info->attrs[NL80211_ATTR_MLD_ADDR]) {
+ 		/* If MLD_ADDR attribute is set then this is an MLD station
+ 		 * and the MLD_ADDR attribute holds the MLD address and the
+ 		 * MAC attribute holds for the LINK address.
+ 		 * In that case, the link_id is also expected to be valid.
+ 		 */
+ 		if (params.link_sta_params.link_id < 0)
+ 			return -EINVAL;
+ 
+ 		mac_addr = nla_data(info->attrs[NL80211_ATTR_MLD_ADDR]);
+ 		params.link_sta_params.mld_mac = mac_addr;
+ 		params.link_sta_params.link_mac =
+ 			nla_data(info->attrs[NL80211_ATTR_MAC]);
+ 		if (!is_valid_ether_addr(params.link_sta_params.link_mac))
+ 			return -EINVAL;
+ 	} else {
+ 		mac_addr = nla_data(info->attrs[NL80211_ATTR_MAC]);
+ 	}
+ 
+ 	params.link_sta_params.supported_rates =
++>>>>>>> c0d6701261db (wifi: nl80211: enable setting the link address at new station)
  		nla_data(info->attrs[NL80211_ATTR_STA_SUPPORTED_RATES]);
 -	params.link_sta_params.supported_rates_len =
 +	params.supported_rates_len =
  		nla_len(info->attrs[NL80211_ATTR_STA_SUPPORTED_RATES]);
  	params.listen_interval =
  		nla_get_u16(info->attrs[NL80211_ATTR_STA_LISTEN_INTERVAL]);
* Unmerged path net/wireless/nl80211.c
