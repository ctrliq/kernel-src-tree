wifi: mac80211: fix link sta hash table handling

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit 0ad49045f28474b3cbc1f27ec7a4238970734764
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/0ad49045.failed

There are two issues here: we unhash the link stations only
directly before freeing the station they belong to, and we
also don't unhash all the links correctly in all cases. Fix
these issues.

Fixes: ba6ddab94fc6 ("wifi: mac80211: maintain link-sta hash table")
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 0ad49045f28474b3cbc1f27ec7a4238970734764)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mac80211/sta_info.c
diff --cc net/mac80211/sta_info.c
index d25b297851c4,44e21dee6077..000000000000
--- a/net/mac80211/sta_info.c
+++ b/net/mac80211/sta_info.c
@@@ -258,6 -352,15 +258,18 @@@ struct sta_info *sta_info_get_by_idx(st
   */
  void sta_info_free(struct ieee80211_local *local, struct sta_info *sta)
  {
++<<<<<<< HEAD
++=======
+ 	int i;
+ 
+ 	for (i = 0; i < ARRAY_SIZE(sta->link); i++) {
+ 		if (!(sta->sta.valid_links & BIT(i)))
+ 			continue;
+ 
+ 		sta_remove_link(sta, i, false);
+ 	}
+ 
++>>>>>>> 0ad49045f284 (wifi: mac80211: fix link sta hash table handling)
  	/*
  	 * If we had used sta_info_pre_move_state() then we might not
  	 * have gone through the state transitions down again, so do
* Unmerged path net/mac80211/sta_info.c
