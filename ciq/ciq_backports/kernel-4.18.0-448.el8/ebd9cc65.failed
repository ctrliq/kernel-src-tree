s390/pci: fix clp_get_state() handling of -ENODEV

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Niklas Schnelle <schnelle@linux.ibm.com>
commit ebd9cc6593691e6bc8526e368cedbdfc8034f403
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/ebd9cc65.failed

With commit cc049eecfb7a ("s390/pci: simplify CLP List PCI handling")
clp_get_state() was changed to make use of the new clp_find_pci() helper
function to query a specific function. This however returns -ENODEV when
the device is not found at all and this error was passed to the caller.
It was missed however that the callers actually expect a success return
from clp_get_state() if the device is gone.

Fix this by handling the -ENODEV return of clp_find_pci() explicitly in
clp_get_state() returning success and setting the state parameter to
ZPCI_FN_STATE_RESERVED matching the design concept that a PCI function
that disappeared must have been resverved elsewhere. For all other error
returns continue to just pass them on to the caller.

	Reviewed-by: Matthew Rosato <mjrosato@linux.ibm.com>
Fixes: cc049eecfb7a ("s390/pci: simplify CLP List PCI handling")
	Signed-off-by: Niklas Schnelle <schnelle@linux.ibm.com>
	Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
(cherry picked from commit ebd9cc6593691e6bc8526e368cedbdfc8034f403)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/pci/pci_clp.c
diff --cc arch/s390/pci/pci_clp.c
index 45c5438cc74b,df895d98a56b..000000000000
--- a/arch/s390/pci/pci_clp.c
+++ b/arch/s390/pci/pci_clp.c
@@@ -449,9 -453,13 +449,19 @@@ int clp_get_state(u32 fid, enum zpci_st
  	if (!rrb)
  		return -ENOMEM;
  
++<<<<<<< HEAD
 +	rc = clp_list_pci(rrb, &sd, __clp_get_state);
 +	if (!rc)
 +		*state = sd.state;
++=======
+ 	rc = clp_find_pci(rrb, fid, &entry);
+ 	if (!rc) {
+ 		*state = entry.config_state;
+ 	} else if (rc == -ENODEV) {
+ 		*state = ZPCI_FN_STATE_RESERVED;
+ 		rc = 0;
+ 	}
++>>>>>>> ebd9cc659369 (s390/pci: fix clp_get_state() handling of -ENODEV)
  
  	clp_free_block(rrb);
  	return rc;
* Unmerged path arch/s390/pci/pci_clp.c
