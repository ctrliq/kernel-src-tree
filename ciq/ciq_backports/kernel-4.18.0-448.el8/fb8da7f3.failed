drm/bridge: anx7625: Use uint8 for lane-swing arrays

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Nícolas F. R. A. Prado <nfraprado@collabora.com>
commit fb8da7f3111ab500606960bef1bb32450c664750
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/fb8da7f3.failed

As defined in the anx7625 dt-binding, the analogix,lane0-swing and
analogix,lane1-swing properties are uint8 arrays. Yet, the driver was
reading the array as if it were of uint32 and masking to 8-bit before
writing to the registers. This means that a devicetree written in
accordance to the dt-binding would have its values incorrectly parsed.

Fix the issue by reading the array as uint8 and storing them as uint8
internally, so that we can also drop the masking when writing the
registers.

Fixes: fd0310b6fe7d ("drm/bridge: anx7625: add MIPI DPI input feature")
	Signed-off-by: Nícolas F. R. A. Prado <nfraprado@collabora.com>
	Reviewed-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
	Signed-off-by: Robert Foss <robert.foss@linaro.org>
Link: https://patchwork.freedesktop.org/patch/msgid/20220408013034.673418-1-nfraprado@collabora.com
(cherry picked from commit fb8da7f3111ab500606960bef1bb32450c664750)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/bridge/analogix/anx7625.c
#	drivers/gpu/drm/bridge/analogix/anx7625.h
diff --cc drivers/gpu/drm/bridge/analogix/anx7625.c
index 439c7bed33ff,376da01243a3..000000000000
--- a/drivers/gpu/drm/bridge/analogix/anx7625.c
+++ b/drivers/gpu/drm/bridge/analogix/anx7625.c
@@@ -1107,6 -1479,21 +1107,24 @@@ static void anx7625_remove_edid(struct 
  	ctx->slimport_edid_p.edid_block_num = -1;
  }
  
++<<<<<<< HEAD
++=======
+ static void anx7625_dp_adjust_swing(struct anx7625_data *ctx)
+ {
+ 	int i;
+ 
+ 	for (i = 0; i < ctx->pdata.dp_lane0_swing_reg_cnt; i++)
+ 		anx7625_reg_write(ctx, ctx->i2c.tx_p1_client,
+ 				  DP_TX_LANE0_SWING_REG0 + i,
+ 				  ctx->pdata.lane0_reg_data[i]);
+ 
+ 	for (i = 0; i < ctx->pdata.dp_lane1_swing_reg_cnt; i++)
+ 		anx7625_reg_write(ctx, ctx->i2c.tx_p1_client,
+ 				  DP_TX_LANE1_SWING_REG0 + i,
+ 				  ctx->pdata.lane1_reg_data[i]);
+ }
+ 
++>>>>>>> fb8da7f3111a (drm/bridge: anx7625: Use uint8 for lane-swing arrays)
  static void dp_hpd_change_handler(struct anx7625_data *ctx, bool on)
  {
  	struct device *dev = &ctx->client->dev;
@@@ -1201,6 -1587,34 +1219,37 @@@ static irqreturn_t anx7625_intr_hpd_isr
  	return IRQ_HANDLED;
  }
  
++<<<<<<< HEAD
++=======
+ static int anx7625_get_swing_setting(struct device *dev,
+ 				     struct anx7625_platform_data *pdata)
+ {
+ 	int num_regs;
+ 
+ 	if (of_get_property(dev->of_node,
+ 			    "analogix,lane0-swing", &num_regs)) {
+ 		if (num_regs > DP_TX_SWING_REG_CNT)
+ 			num_regs = DP_TX_SWING_REG_CNT;
+ 
+ 		pdata->dp_lane0_swing_reg_cnt = num_regs;
+ 		of_property_read_u8_array(dev->of_node, "analogix,lane0-swing",
+ 					  pdata->lane0_reg_data, num_regs);
+ 	}
+ 
+ 	if (of_get_property(dev->of_node,
+ 			    "analogix,lane1-swing", &num_regs)) {
+ 		if (num_regs > DP_TX_SWING_REG_CNT)
+ 			num_regs = DP_TX_SWING_REG_CNT;
+ 
+ 		pdata->dp_lane1_swing_reg_cnt = num_regs;
+ 		of_property_read_u8_array(dev->of_node, "analogix,lane1-swing",
+ 					  pdata->lane1_reg_data, num_regs);
+ 	}
+ 
+ 	return 0;
+ }
+ 
++>>>>>>> fb8da7f3111a (drm/bridge: anx7625: Use uint8 for lane-swing arrays)
  static int anx7625_parse_dt(struct device *dev,
  			    struct anx7625_platform_data *pdata)
  {
diff --cc drivers/gpu/drm/bridge/analogix/anx7625.h
index 034c3840028f,e257a84db962..000000000000
--- a/drivers/gpu/drm/bridge/analogix/anx7625.h
+++ b/drivers/gpu/drm/bridge/analogix/anx7625.h
@@@ -353,6 -422,13 +353,16 @@@ struct anx7625_platform_data 
  	struct regulator_bulk_data supplies[3];
  	struct drm_bridge *panel_bridge;
  	int intp_irq;
++<<<<<<< HEAD
++=======
+ 	int is_dpi;
+ 	int mipi_lanes;
+ 	int audio_en;
+ 	int dp_lane0_swing_reg_cnt;
+ 	u8 lane0_reg_data[DP_TX_SWING_REG_CNT];
+ 	int dp_lane1_swing_reg_cnt;
+ 	u8 lane1_reg_data[DP_TX_SWING_REG_CNT];
++>>>>>>> fb8da7f3111a (drm/bridge: anx7625: Use uint8 for lane-swing arrays)
  	u32 low_power_mode;
  	struct device_node *mipi_host_node;
  };
* Unmerged path drivers/gpu/drm/bridge/analogix/anx7625.c
* Unmerged path drivers/gpu/drm/bridge/analogix/anx7625.h
