wifi: nl80211: fix sending link ID info of associated BSS

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Veerendranath Jakkam <quic_vjakkam@quicinc.com>
commit 3c512307de4097aaaab3f4741c7a98fe88afa469
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/3c512307.failed

commit dd374f84baec ("wifi: nl80211: expose link ID for associated
BSSes") used a top-level attribute to send link ID of the associated
BSS in the nested attribute NL80211_ATTR_BSS. But since NL80211_ATTR_BSS
is a nested attribute of the attributes defined in enum nl80211_bss,
define a new attribute in enum nl80211_bss and use it for sending the
link ID of the BSS.

Fixes: dd374f84baec ("wifi: nl80211: expose link ID for associated BSSes")
	Signed-off-by: Veerendranath Jakkam <quic_vjakkam@quicinc.com>
	Reviewed-by: Jeff Johnson <quic_jjohnson@quicinc.com>
Link: https://lore.kernel.org/r/20220708122607.1836958-1-quic_vjakkam@quicinc.com
	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
(cherry picked from commit 3c512307de4097aaaab3f4741c7a98fe88afa469)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/wireless/nl80211.c
diff --cc net/wireless/nl80211.c
index 1ee5ef214b30,22c4cf6fbb57..000000000000
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@@ -9867,13 -9986,18 +9867,25 @@@ static int nl80211_send_bss(struct sk_b
  	switch (wdev->iftype) {
  	case NL80211_IFTYPE_P2P_CLIENT:
  	case NL80211_IFTYPE_STATION:
++<<<<<<< HEAD
 +		if (intbss == wdev->current_bss &&
 +		    nla_put_u32(msg, NL80211_BSS_STATUS,
 +				NL80211_BSS_STATUS_ASSOCIATED))
 +			goto nla_put_failure;
++=======
+ 		for_each_valid_link(wdev, link_id) {
+ 			if (intbss == wdev->links[link_id].client.current_bss &&
+ 			    (nla_put_u32(msg, NL80211_BSS_STATUS,
+ 					 NL80211_BSS_STATUS_ASSOCIATED) ||
+ 			     (wdev->valid_links &&
+ 			      nla_put_u8(msg, NL80211_BSS_MLO_LINK_ID,
+ 					 link_id))))
+ 				goto nla_put_failure;
+ 		}
++>>>>>>> 3c512307de40 (wifi: nl80211: fix sending link ID info of associated BSS)
  		break;
  	case NL80211_IFTYPE_ADHOC:
 -		if (intbss == wdev->u.ibss.current_bss &&
 +		if (intbss == wdev->current_bss &&
  		    nla_put_u32(msg, NL80211_BSS_STATUS,
  				NL80211_BSS_STATUS_IBSS_JOINED))
  			goto nla_put_failure;
diff --git a/include/uapi/linux/nl80211.h b/include/uapi/linux/nl80211.h
index 89c2cfb97539..fef1dec4b25b 100644
--- a/include/uapi/linux/nl80211.h
+++ b/include/uapi/linux/nl80211.h
@@ -4843,6 +4843,7 @@ enum nl80211_bss_scan_width {
  *	Contains a nested array of signal strength attributes (u8, dBm),
  *	using the nesting index as the antenna number.
  * @NL80211_BSS_FREQUENCY_OFFSET: frequency offset in KHz
+ * @NL80211_BSS_MLO_LINK_ID: MLO link ID of the BSS (u8).
  * @__NL80211_BSS_AFTER_LAST: internal
  * @NL80211_BSS_MAX: highest BSS attribute
  */
@@ -4868,6 +4869,7 @@ enum nl80211_bss {
 	NL80211_BSS_PARENT_BSSID,
 	NL80211_BSS_CHAIN_SIGNAL,
 	NL80211_BSS_FREQUENCY_OFFSET,
+	NL80211_BSS_MLO_LINK_ID,
 
 	/* keep last */
 	__NL80211_BSS_AFTER_LAST,
* Unmerged path net/wireless/nl80211.c
