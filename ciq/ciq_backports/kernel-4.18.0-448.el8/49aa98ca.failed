drm/amd/amdgpu: Only reserve vram for firmware with vega9 MS_HYPERV host.

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Yongqiang Sun <yongqiang.sun@amd.com>
commit 49aa98ca30cd186ab33fc5802066e2024d3bfa39
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/49aa98ca.failed

driver loading failed on VEGA10 SRIOV VF with linux host due to a wide
range of stolen reserved vram.
Since VEGA10 SRIOV VF need to reserve vram for firmware with windows
Hyper_V host specifically, check hypervisor type to only reserve
memory for it, and the range of the reserved vram can be limited
to between 5M-7M area.

Fixes: faad5ccac1eaae ("drm/amdgpu: Add stolen reserved memory for MI25 SRIOV.")
	Signed-off-by: Yongqiang Sun <yongqiang.sun@amd.com>
	Acked-by: Alex Deucher <alexander.deucher@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit 49aa98ca30cd186ab33fc5802066e2024d3bfa39)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
diff --cc drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
index d0b8d415b63b,3e9582c245bb..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
@@@ -668,6 -646,15 +669,18 @@@ void amdgpu_gmc_get_vbios_allocations(s
  	 */
  	switch (adev->asic_type) {
  	case CHIP_VEGA10:
++<<<<<<< HEAD
++=======
+ 		adev->mman.keep_stolen_vga_memory = true;
+ 		/*
+ 		 * VEGA10 SRIOV VF with MS_HYPERV host needs some firmware reserved area.
+ 		 */
+ 		if (amdgpu_sriov_vf(adev) && hypervisor_is_type(X86_HYPER_MS_HYPERV)) {
+ 			adev->mman.stolen_reserved_offset = 0x500000;
+ 			adev->mman.stolen_reserved_size = 0x200000;
+ 		}
+ 		break;
++>>>>>>> 49aa98ca30cd (drm/amd/amdgpu: Only reserve vram for firmware with vega9 MS_HYPERV host.)
  	case CHIP_RAVEN:
  	case CHIP_RENOIR:
  		adev->mman.keep_stolen_vga_memory = true;
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.c
