iommu/amd: Use put_pages_list

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Matthew Wilcox (Oracle) <willy@infradead.org>
commit ce00eece6909c266da123fd147172d745a4f14a0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/ce00eece.failed

page->freelist is for the use of slab.  We already have the ability
to free a list of pages in the core mm, but it requires the use of a
list_head and for the pages to be chained together through page->lru.
Switch the AMD IOMMU code over to using free_pages_list().

	Signed-off-by: Matthew Wilcox (Oracle) <willy@infradead.org>
[rm: split from original patch, cosmetic tweaks]
	Signed-off-by: Robin Murphy <robin.murphy@arm.com>
Link: https://lore.kernel.org/r/73af128f651aaa1f38f69e586c66765a88ad2de0.1639753638.git.robin.murphy@arm.com
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit ce00eece6909c266da123fd147172d745a4f14a0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd/io_pgtable.c
diff --cc drivers/iommu/amd/io_pgtable.c
index d4a0c63ef817,b1bf4125b0f7..000000000000
--- a/drivers/iommu/amd/io_pgtable.c
+++ b/drivers/iommu/amd/io_pgtable.c
@@@ -510,15 -502,9 +496,19 @@@ static void v1_free_pgtable(struct io_p
  	BUG_ON(pgtable->mode < PAGE_MODE_NONE ||
  	       pgtable->mode > PAGE_MODE_6_LEVEL);
  
- 	freelist = free_sub_pt(pgtable->root, pgtable->mode, freelist);
+ 	free_sub_pt(pgtable->root, pgtable->mode, &freelist);
  
++<<<<<<< HEAD
 +	/* Update data structure */
 +	amd_iommu_domain_clr_pt_root(dom);
 +
 +	/* Make changes visible to IOMMUs */
 +	amd_iommu_domain_update(dom);
 +
 +	free_page_list(freelist);
++=======
+ 	put_pages_list(&freelist);
++>>>>>>> ce00eece6909 (iommu/amd: Use put_pages_list)
  }
  
  static struct io_pgtable *v1_alloc_pgtable(struct io_pgtable_cfg *cfg, void *cookie)
* Unmerged path drivers/iommu/amd/io_pgtable.c
