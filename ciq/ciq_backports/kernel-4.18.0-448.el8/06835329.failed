ASoC: SOF: ipc3-dtrace: Move dtrace related variables local from sof_dev

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
commit 0683532999ab3890f44f832cd47feee9e2374c22
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/06835329.failed

The variables and structs for DMA trace can be moved local to ipc3-dtrace.c
and the storage can be allocated dynamically, stored behind the
fw_trace_data pointer.

	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Paul Olaru <paul.olaru@oss.nxp.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Reviewed-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
Link: https://lore.kernel.org/r/20220516104711.26115-9-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 0683532999ab3890f44f832cd47feee9e2374c22)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/ipc3-dtrace.c
#	sound/soc/sof/sof-priv.h
diff --cc sound/soc/sof/sof-priv.h
index 0972440dcebe,9d7f53ff9c70..000000000000
--- a/sound/soc/sof/sof-priv.h
+++ b/sound/soc/sof/sof-priv.h
@@@ -501,23 -541,48 +495,26 @@@ struct snd_sof_dev 
  	int ipc_timeout;
  	int boot_timeout;
  
 -	/* firmwre tracing */
 -	bool fw_trace_is_supported; /* set with Kconfig or module parameter */
 -	void *fw_trace_data; /* private data used by firmware tracing implementation */
 +#if IS_ENABLED(CONFIG_SND_SOC_SOF_DEBUG_PROBES)
 +	unsigned int extractor_stream_tag;
 +#endif
  
++<<<<<<< HEAD
 +	/* DMA for Trace */
 +	struct snd_dma_buffer dmatb;
 +	struct snd_dma_buffer dmatp;
 +	int dma_trace_pages;
 +	wait_queue_head_t trace_sleep;
 +	u32 host_offset;
 +	bool dtrace_is_supported; /* set with Kconfig or module parameter */
 +	bool dtrace_error;
 +	bool dtrace_draining;
 +	enum sof_dtrace_state dtrace_state;
 +
++=======
++>>>>>>> 0683532999ab (ASoC: SOF: ipc3-dtrace: Move dtrace related variables local from sof_dev)
  	bool msi_enabled;
  
 -	/* DSP core context */
 -	u32 num_cores;
 -
 -	/*
 -	 * ref count per core that will be modified during system suspend/resume and during pcm
 -	 * hw_params/hw_free. This doesn't need to be protected with a mutex because pcm
 -	 * hw_params/hw_free are already protected by the PCM mutex in the ALSA framework in
 -	 * sound/core/ when streams are active and during system suspend/resume, streams are
 -	 * already suspended.
 -	 */
 -	int dsp_core_ref_count[SOF_MAX_DSP_NUM_CORES];
 -
 -	/*
 -	 * Used to keep track of registered IPC client devices so that they can
 -	 * be removed when the parent SOF module is removed.
 -	 */
 -	struct list_head ipc_client_list;
 -
 -	/* mutex to protect client list */
 -	struct mutex ipc_client_mutex;
 -
 -	/*
 -	 * Used for tracking the IPC client's RX registration for DSP initiated
 -	 * message handling.
 -	 */
 -	struct list_head ipc_rx_handler_list;
 -
 -	/*
 -	 * Used for tracking the IPC client's registration for DSP state change
 -	 * notification
 -	 */
 -	struct list_head fw_state_handler_list;
 -
 -	/* to protect the ipc_rx_handler_list  and  dsp_state_handler_list list */
 -	struct mutex client_event_handler_mutex;
 -
  	void *private;			/* core does not touch this */
  };
  
* Unmerged path sound/soc/sof/ipc3-dtrace.c
* Unmerged path sound/soc/sof/ipc3-dtrace.c
* Unmerged path sound/soc/sof/sof-priv.h
