net/mlx5e: kTLS, Use CHECKSUM_UNNECESSARY for device-offloaded packets

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Tariq Toukan <tariqt@nvidia.com>
commit 7eaf1f37b8817c608c4e959d69986ef459d345cd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/7eaf1f37.failed

For RX TLS device-offloaded packets, the HW spec guarantees checksum
validation for the offloaded packets, but does not define whether the
CQE.checksum field matches the original packet (ciphertext) or
the decrypted one (plaintext). This latitude allows architetctural
improvements between generations of chips, resulting in different decisions
regarding the value type of CQE.checksum.

Hence, for these packets, the device driver should not make use of this CQE
field. Here we block CHECKSUM_COMPLETE usage for RX TLS device-offloaded
packets, and use CHECKSUM_UNNECESSARY instead.

Value of the packet's tcp_hdr.csum is not modified by the HW, and it always
matches the original ciphertext.

Fixes: 1182f3659357 ("net/mlx5e: kTLS, Add kTLS RX HW offload support")
	Signed-off-by: Tariq Toukan <tariqt@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 7eaf1f37b8817c608c4e959d69986ef459d345cd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
index 19d50353de25,6530d7bd5045..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
@@@ -991,6 -1348,11 +991,14 @@@ static inline void mlx5e_handle_csum(st
  		return;
  	}
  
++<<<<<<< HEAD
++=======
+ 	/* True when explicitly set via priv flag, or XDP prog is loaded */
+ 	if (test_bit(MLX5E_RQ_STATE_NO_CSUM_COMPLETE, &rq->state) ||
+ 	    get_cqe_tls_offload(cqe))
+ 		goto csum_unnecessary;
+ 
++>>>>>>> 7eaf1f37b881 (net/mlx5e: kTLS, Use CHECKSUM_UNNECESSARY for device-offloaded packets)
  	/* CQE csum doesn't cover padding octets in short ethernet
  	 * frames. And the pad field is appended prior to calculating
  	 * and appending the FCS field.
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_rx.c
