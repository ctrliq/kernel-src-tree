PM / arch: x86: MSR_IA32_ENERGY_PERF_BIAS sysfs interface

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-448.el8
commit-author Rafael J. Wysocki <rafael.j.wysocki@intel.com>
commit b9c273babce791cf228fc466577f55056a699f9c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-448.el8/b9c273ba.failed

The Performance and Energy Bias Hint (EPB) is expected to be set by
user space through the generic MSR interface, but that interface is
not particularly nice and there are security concerns regarding it,
so it is not always available.

For this reason, add a sysfs interface for reading and updating the
EPB, in the form of a new attribute, energy_perf_bias, located
under /sys/devices/system/cpu/cpu#/power/ for online CPUs that
support the EPB feature.

	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Reviewed-by: Hannes Reinecke <hare@suse.com>
	Acked-by: Borislav Petkov <bp@suse.de>
(cherry picked from commit b9c273babce791cf228fc466577f55056a699f9c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/ABI/testing/sysfs-devices-system-cpu
#	Documentation/admin-guide/pm/intel_epb.rst
#	arch/x86/kernel/cpu/intel_epb.c
diff --cc Documentation/ABI/testing/sysfs-devices-system-cpu
index 7924584ed25f,7f4af7da3fbc..000000000000
--- a/Documentation/ABI/testing/sysfs-devices-system-cpu
+++ b/Documentation/ABI/testing/sysfs-devices-system-cpu
@@@ -531,74 -519,20 +531,94 @@@ Description:	Control Symetric Multi Thr
  			 If control status is "forceoff" or "notsupported" writes
  			 are rejected.
  
++<<<<<<< HEAD
 +What:		/sys/devices/system/cpu/umwait_control
 +		/sys/devices/system/cpu/umwait_control/enable_c02
 +		/sys/devices/system/cpu/umwait_control/max_time
 +Date:		May 2019
 +Contact:	Linux kernel mailing list <linux-kernel@vger.kernel.org>
 +Description:	Umwait control
 +
 +		enable_c02: Read/write interface to control umwait C0.2 state
 +			Read returns C0.2 state status:
 +				0: C0.2 is disabled
 +				1: C0.2 is enabled
 +
 +			Write 'y' or '1'  or 'on' to enable C0.2 state.
 +			Write 'n' or '0'  or 'off' to disable C0.2 state.
 +
 +			The interface is case insensitive.
 +
 +		max_time: Read/write interface to control umwait maximum time
 +			  in TSC-quanta that the CPU can reside in either C0.1
 +			  or C0.2 state. The time is an unsigned 32-bit number.
 +			  Note that a value of zero means there is no limit.
 +			  Low order two bits must be zero.
 +
 +What:		/sys/devices/system/cpu/cpuX/purr
 +Date:		Apr 2005
 +Contact:	Linux for PowerPC mailing list <linuxppc-dev@ozlabs.org>
 +Description:	PURR ticks for this CPU since the system boot.
 +
 +		The Processor Utilization Resources Register (PURR) is
 +		a 64-bit counter which provides an estimate of the
 +		resources used by the CPU thread. The contents of this
 +		register increases monotonically. This sysfs interface
 +		exposes the number of PURR ticks for cpuX.
 +
 +What:		/sys/devices/system/cpu/cpuX/spurr
 +Date:		Dec 2006
 +Contact:	Linux for PowerPC mailing list <linuxppc-dev@ozlabs.org>
 +Description:	SPURR ticks for this CPU since the system boot.
 +
 +		The Scaled Processor Utilization Resources Register
 +		(SPURR) is a 64-bit counter that provides a frequency
 +		invariant estimate of the resources used by the CPU
 +		thread. The contents of this register increases
 +		monotonically. This sysfs interface exposes the number
 +		of SPURR ticks for cpuX.
 +
 +What:		/sys/devices/system/cpu/cpuX/idle_purr
 +Date:		Apr 2020
 +Contact:	Linux for PowerPC mailing list <linuxppc-dev@ozlabs.org>
 +Description:	PURR ticks for cpuX when it was idle.
 +
 +		This sysfs interface exposes the number of PURR ticks
 +		for cpuX when it was idle.
 +
 +What:		/sys/devices/system/cpu/cpuX/idle_spurr
 +Date:		Apr 2020
 +Contact:	Linux for PowerPC mailing list <linuxppc-dev@ozlabs.org>
 +Description:	SPURR ticks for cpuX when it was idle.
 +
 +		This sysfs interface exposes the number of SPURR ticks
 +		for cpuX when it was idle.
 +
 +What:		/sys/devices/system/cpu/svm
 +Date:		August 2019
 +Contact:	Linux kernel mailing list <linux-kernel@vger.kernel.org>
 +		Linux for PowerPC mailing list <linuxppc-dev@ozlabs.org>
 +Description:	Secure Virtual Machine
 +
 +		If 1, it means the system is using the Protected Execution
 +		Facility in POWER9 and newer processors. i.e., it is a Secure
 +		Virtual Machine.
++=======
+ What:		/sys/devices/system/cpu/cpu#/power/energy_perf_bias
+ Date:		March 2019
+ Contact:	linux-pm@vger.kernel.org
+ Description:	Intel Energy and Performance Bias Hint (EPB)
+ 
+ 		EPB for the given CPU in a sliding scale 0 - 15, where a value
+ 		of 0 corresponds to a hint preference for highest performance
+ 		and a value of 15 corresponds to the maximum energy savings.
+ 
+ 		In order to change the EPB value for the CPU, write either
+ 		a number in the 0 - 15 sliding scale above, or one of the
+ 		strings: "performance", "balance-performance", "normal",
+ 		"balance-power", "power" (that represent values reflected by
+ 		their meaning), to this attribute.
+ 
+ 		This attribute is present for all online CPUs supporting the
+ 		Intel EPB feature.
++>>>>>>> b9c273babce7 (PM / arch: x86: MSR_IA32_ENERGY_PERF_BIAS sysfs interface)
* Unmerged path Documentation/admin-guide/pm/intel_epb.rst
* Unmerged path arch/x86/kernel/cpu/intel_epb.c
* Unmerged path Documentation/ABI/testing/sysfs-devices-system-cpu
* Unmerged path Documentation/admin-guide/pm/intel_epb.rst
* Unmerged path arch/x86/kernel/cpu/intel_epb.c
