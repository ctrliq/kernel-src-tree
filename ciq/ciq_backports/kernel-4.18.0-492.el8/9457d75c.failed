iommu/amd: Introduce struct amd_ir_data.iommu

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-492.el8
commit-author Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
commit 9457d75c056ad52b6c33693c87500e38fdd41c6f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-492.el8/9457d75c.failed

Add a pointer to struct amd_iommu to amd_ir_data structure, which
can be used to correlate interrupt remapping data to a per-PCI-segment
interrupt remapping table.

Co-developed-by: Vasant Hegde <vasant.hegde@amd.com>
	Signed-off-by: Vasant Hegde <vasant.hegde@amd.com>
	Signed-off-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Link: https://lore.kernel.org/r/20220706113825.25582-18-vasant.hegde@amd.com
	Signed-off-by: Joerg Roedel <jroedel@suse.de>
(cherry picked from commit 9457d75c056ad52b6c33693c87500e38fdd41c6f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/iommu/amd/iommu.c
diff --cc drivers/iommu/amd/iommu.c
index ac3701a8e645,9f373b164762..000000000000
--- a/drivers/iommu/amd/iommu.c
+++ b/drivers/iommu/amd/iommu.c
@@@ -3212,8 -3190,7 +3207,12 @@@ static void irq_remapping_prepare_irte(
  				       int devid, int index, int sub_handle)
  {
  	struct irq_2_irte *irte_info = &data->irq_2_irte;
++<<<<<<< HEAD
 +	struct IO_APIC_route_entry *entry;
 +	struct amd_iommu *iommu = amd_iommu_rlookup_table[devid];
++=======
+ 	struct amd_iommu *iommu = data->iommu;
++>>>>>>> 9457d75c056a (iommu/amd: Introduce struct amd_ir_data.iommu)
  
  	if (!iommu)
  		return;
diff --git a/drivers/iommu/amd/amd_iommu_types.h b/drivers/iommu/amd/amd_iommu_types.h
index d95ef26bdf2a..b7812310728f 100644
--- a/drivers/iommu/amd/amd_iommu_types.h
+++ b/drivers/iommu/amd/amd_iommu_types.h
@@ -995,6 +995,7 @@ struct irq_2_irte {
 
 struct amd_ir_data {
 	u32 cached_ga_tag;
+	struct amd_iommu *iommu;
 	struct irq_2_irte irq_2_irte;
 	struct msi_msg msi_entry;
 	void *entry;    /* Pointer to union irte or struct irte_ga */
* Unmerged path drivers/iommu/amd/iommu.c
