net/mlx5e: Add Ethernet driver debugfs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Gal Pressman <gal@nvidia.com>
commit 288eca60cc31471670dcd351cc42c03a38e11983
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/288eca60.failed

Similar to the mlx5_core debugfs, lay the groundwork for mlx5e debugfs
files under /sys/kernel/debug/mlx5/<pci>/nic/..

	Signed-off-by: Gal Pressman <gal@nvidia.com>
	Reviewed-by: Tariq Toukan <tariqt@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 288eca60cc31471670dcd351cc42c03a38e11983)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index ae689404b54c,16c8bbad5b33..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -5746,6 -5931,16 +5747,19 @@@ static int mlx5e_probe(struct auxiliary
  
  	priv->profile = profile;
  	priv->ppriv = NULL;
++<<<<<<< HEAD
++=======
+ 
+ 	priv->dfs_root = debugfs_create_dir("nic",
+ 					    mlx5_debugfs_get_dev_root(priv->mdev));
+ 
+ 	err = mlx5e_devlink_port_register(priv);
+ 	if (err) {
+ 		mlx5_core_err(mdev, "mlx5e_devlink_port_register failed, %d\n", err);
+ 		goto err_destroy_netdev;
+ 	}
+ 
++>>>>>>> 288eca60cc31 (net/mlx5e: Add Ethernet driver debugfs)
  	err = profile->init(mdev, netdev);
  	if (err) {
  		mlx5_core_err(mdev, "mlx5e_nic_profile init failed, %d\n", err);
@@@ -5774,7 -5969,10 +5788,8 @@@ err_resume
  	mlx5e_suspend(adev, state);
  err_profile_cleanup:
  	profile->cleanup(priv);
 -err_devlink_cleanup:
 -	mlx5e_devlink_port_unregister(priv);
  err_destroy_netdev:
+ 	debugfs_remove_recursive(priv->dfs_root);
  	mlx5e_destroy_netdev(priv);
  	return err;
  }
@@@ -5788,6 -5986,8 +5803,11 @@@ static void mlx5e_remove(struct auxilia
  	unregister_netdev(priv->netdev);
  	mlx5e_suspend(adev, state);
  	priv->profile->cleanup(priv);
++<<<<<<< HEAD
++=======
+ 	mlx5e_devlink_port_unregister(priv);
+ 	debugfs_remove_recursive(priv->dfs_root);
++>>>>>>> 288eca60cc31 (net/mlx5e: Add Ethernet driver debugfs)
  	mlx5e_destroy_netdev(priv);
  }
  
diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en.h b/drivers/net/ethernet/mellanox/mlx5/core/en.h
index a145335b4763..3530a409df86 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en.h
@@ -975,6 +975,7 @@ struct mlx5e_priv {
 	struct mlx5e_scratchpad    scratchpad;
 	struct mlx5e_htb          *htb;
 	struct mlx5e_mqprio_rl    *mqprio_rl;
+	struct dentry             *dfs_root;
 };
 
 struct mlx5e_rx_handlers {
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
