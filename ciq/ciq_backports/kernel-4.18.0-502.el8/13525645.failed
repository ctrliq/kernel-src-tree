drm/dsc: fix drm_edp_dsc_sink_output_bpp() DPCD high byte usage

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Jani Nikula <jani.nikula@intel.com>
commit 13525645e2246ebc8a21bd656248d86022a6ee8f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/13525645.failed

The operator precedence between << and & is wrong, leading to the high
byte being completely ignored. For example, with the 6.4 format, 32
becomes 0 and 24 becomes 8. Fix it, and remove the slightly confusing
and unnecessary DP_DSC_MAX_BITS_PER_PIXEL_HI_SHIFT macro while at it.

Fixes: 0575650077ea ("drm/dp: DRM DP helper/macros to get DP sink DSC parameters")
	Cc: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
	Cc: Manasi Navare <navaremanasi@google.com>
	Cc: Anusha Srivatsa <anusha.srivatsa@intel.com>
	Cc: <stable@vger.kernel.org> # v5.0+
	Signed-off-by: Jani Nikula <jani.nikula@intel.com>
	Reviewed-by: Ankit Nautiyal <ankit.k.nautiyal@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20230406134615.1422509-1-jani.nikula@intel.com
(cherry picked from commit 13525645e2246ebc8a21bd656248d86022a6ee8f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/drm/display/drm_dp.h
diff --cc include/drm/display/drm_dp.h
index 9e3aff7e68bb,4545ed610958..000000000000
--- a/include/drm/display/drm_dp.h
+++ b/include/drm/display/drm_dp.h
@@@ -282,7 -286,8 +282,12 @@@
  
  #define DP_DSC_MAX_BITS_PER_PIXEL_HI        0x068   /* eDP 1.4 */
  # define DP_DSC_MAX_BITS_PER_PIXEL_HI_MASK  (0x3 << 0)
++<<<<<<< HEAD
 +# define DP_DSC_MAX_BITS_PER_PIXEL_HI_SHIFT 8
++=======
+ # define DP_DSC_MAX_BPP_DELTA_VERSION_MASK  0x06
+ # define DP_DSC_MAX_BPP_DELTA_AVAILABILITY  0x08
++>>>>>>> 13525645e224 (drm/dsc: fix drm_edp_dsc_sink_output_bpp() DPCD high byte usage)
  
  #define DP_DSC_DEC_COLOR_FORMAT_CAP         0x069
  # define DP_DSC_RGB                         (1 << 0)
* Unmerged path include/drm/display/drm_dp.h
diff --git a/include/drm/display/drm_dp_helper.h b/include/drm/display/drm_dp_helper.h
index db0fe9f8a612..e255c379f715 100644
--- a/include/drm/display/drm_dp_helper.h
+++ b/include/drm/display/drm_dp_helper.h
@@ -179,9 +179,8 @@ static inline u16
 drm_edp_dsc_sink_output_bpp(const u8 dsc_dpcd[DP_DSC_RECEIVER_CAP_SIZE])
 {
 	return dsc_dpcd[DP_DSC_MAX_BITS_PER_PIXEL_LOW - DP_DSC_SUPPORT] |
-		(dsc_dpcd[DP_DSC_MAX_BITS_PER_PIXEL_HI - DP_DSC_SUPPORT] &
-		 DP_DSC_MAX_BITS_PER_PIXEL_HI_MASK <<
-		 DP_DSC_MAX_BITS_PER_PIXEL_HI_SHIFT);
+		((dsc_dpcd[DP_DSC_MAX_BITS_PER_PIXEL_HI - DP_DSC_SUPPORT] &
+		  DP_DSC_MAX_BITS_PER_PIXEL_HI_MASK) << 8);
 }
 
 static inline u32
