x86/resctrl: Pass the schema in info dir's private pointer

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author James Morse <james.morse@arm.com>
commit f2594492308d2a950c9f765eb719480f3b881f0a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/f2594492.failed

Many of resctrl's per-schema files return a value from struct
rdt_resource, which they take as their 'priv' pointer.

Moving properties that resctrl exposes to user-space into the core 'fs'
code, (e.g. the name of the schema), means some of the functions that
back the filesystem need the schema struct (to where the properties are
moved), but currently take struct rdt_resource. For example, once the
CDP resources are merged, struct rdt_resource no longer reflects all the
properties of the schema.

For the info dirs that represent a control, the information needed
will be accessed via struct resctrl_schema, as this is how the resource
is being used. For the monitors, its still struct rdt_resource as the
monitors aren't described as schema.

This difference means the type of the private pointers varies between
control and monitor info dirs.

Change the 'priv' pointer to point to struct resctrl_schema for
the per-schema files that represent a control. The type can be
determined from the fflags field. If the flags are RF_MON_INFO, its
a struct rdt_resource. If the flags are RF_CTRL_INFO, its a struct
resctrl_schema. No entry in res_common_files[] has both flags.

	Signed-off-by: James Morse <james.morse@arm.com>
	Signed-off-by: Borislav Petkov <bp@suse.de>
	Reviewed-by: Jamie Iles <jamie@nuviainc.com>
	Reviewed-by: Reinette Chatre <reinette.chatre@intel.com>
	Tested-by: Babu Moger <babu.moger@amd.com>
Link: https://lkml.kernel.org/r/20210728170637.25610-5-james.morse@arm.com
(cherry picked from commit f2594492308d2a950c9f765eb719480f3b881f0a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/resctrl/rdtgroup.c
diff --cc arch/x86/kernel/cpu/resctrl/rdtgroup.c
index fc8061800ae6,1fc40dbce85d..000000000000
--- a/arch/x86/kernel/cpu/resctrl/rdtgroup.c
+++ b/arch/x86/kernel/cpu/resctrl/rdtgroup.c
@@@ -869,9 -848,12 +869,15 @@@ static int rdt_last_cmd_status_show(str
  static int rdt_num_closids_show(struct kernfs_open_file *of,
  				struct seq_file *seq, void *v)
  {
++<<<<<<< HEAD
 +	struct rdt_resource *r = of->kn->parent->priv;
++=======
+ 	struct resctrl_schema *s = of->kn->parent->priv;
+ 	struct rdt_resource *r = s->res;
+ 	struct rdt_hw_resource *hw_res;
++>>>>>>> f2594492308d (x86/resctrl: Pass the schema in info dir's private pointer)
  
 -	hw_res = resctrl_to_arch_res(r);
 -	seq_printf(seq, "%d\n", hw_res->num_closid);
 +	seq_printf(seq, "%d\n", r->num_closid);
  	return 0;
  }
  
* Unmerged path arch/x86/kernel/cpu/resctrl/rdtgroup.c
