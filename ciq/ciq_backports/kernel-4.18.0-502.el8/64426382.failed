net/mlx5e: TC, validate action list per attribute

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Oz Shlomo <ozsh@nvidia.com>
commit 6442638251f3679a05a75e69d5096680c14a210e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/64426382.failed

Currently the entire flow action list is validate for offload limitations.
For example, flow with both forward and drop actions are declared invalid
due to hardware restrictions.
However, a multi-table hardware model changes the limitations from a flow
scope to a single flow attribute scope.

Apply offload limitations to flow attributes instead of the entire flow.

	Signed-off-by: Oz Shlomo <ozsh@nvidia.com>
	Reviewed-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Link: https://lore.kernel.org/r/20221203221337.29267-6-saeed@kernel.org
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 6442638251f3679a05a75e69d5096680c14a210e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
index 722fcb41d143,7eaf6c73b091..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
@@@ -3527,36 -3560,6 +3555,39 @@@ actions_match_supported(struct mlx5e_pr
  	ct_clear = flow->attr->ct_attr.ct_action & TCA_CT_ACT_CLEAR;
  	ct_flow = flow_flag_test(flow, CT) && !ct_clear;
  
++<<<<<<< HEAD
 +	if (!(actions &
 +	      (MLX5_FLOW_CONTEXT_ACTION_FWD_DEST | MLX5_FLOW_CONTEXT_ACTION_DROP))) {
 +		NL_SET_ERR_MSG_MOD(extack, "Rule must have at least one forward/drop action");
 +		return false;
 +	}
 +
 +	if (!(~actions &
 +	      (MLX5_FLOW_CONTEXT_ACTION_FWD_DEST | MLX5_FLOW_CONTEXT_ACTION_DROP))) {
 +		NL_SET_ERR_MSG_MOD(extack, "Rule cannot support forward+drop action");
 +		return false;
 +	}
 +
 +	if (!(~actions &
 +	      (MLX5_FLOW_CONTEXT_ACTION_FWD_DEST | MLX5_FLOW_CONTEXT_ACTION_DROP))) {
 +		NL_SET_ERR_MSG_MOD(extack, "Rule cannot support forward+drop action");
 +		return false;
 +	}
 +
 +	if (actions & MLX5_FLOW_CONTEXT_ACTION_MOD_HDR &&
 +	    actions & MLX5_FLOW_CONTEXT_ACTION_DROP) {
 +		NL_SET_ERR_MSG_MOD(extack, "Drop with modify header action is not supported");
 +		return false;
 +	}
 +
++=======
++>>>>>>> 6442638251f3 (net/mlx5e: TC, validate action list per attribute)
 +	if (actions & MLX5_FLOW_CONTEXT_ACTION_MOD_HDR &&
 +	    actions & MLX5_FLOW_CONTEXT_ACTION_DROP) {
 +		NL_SET_ERR_MSG_MOD(extack, "Drop with modify header action is not supported");
 +		return false;
 +	}
 +
  	if (actions & MLX5_FLOW_CONTEXT_ACTION_MOD_HDR &&
  	    !modify_header_match_supported(priv, &parse_attr->spec, flow_action,
  					   actions, ct_flow, ct_clear, extack))
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_tc.c
