drm/amd/display: Enforce 60us prefetch for 200Mhz DCFCLK modes

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Alvin Lee <Alvin.Lee2@amd.com>
commit b504f99ccaa64da364443431e388ecf30b604e38
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/b504f99c.failed

[Description]
- Due to bandwidth / arbitration issues at 200Mhz DCFCLK,
  we want to enforce minimum 60us of prefetch to avoid
  intermittent underflow issues
- Since 60us prefetch is already enforced for UCLK DPM0,
  and many DCFCLK's > 200Mhz are mapped to UCLK DPM1, in
  theory there should not be any UCLK DPM regressions by
  enforcing greater prefetch

	Reviewed-by: Nevenko Stupar <Nevenko.Stupar@amd.com>
	Reviewed-by: Jun Lei <Jun.Lei@amd.com>
	Cc: Mario Limonciello <mario.limonciello@amd.com>
	Cc: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
	Acked-by: Alex Hung <alex.hung@amd.com>
	Signed-off-by: Alvin Lee <Alvin.Lee2@amd.com>
	Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit b504f99ccaa64da364443431e388ecf30b604e38)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.c
#	drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.h
diff --cc drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.c
index 042f9a62c4c5,d75248b6cae9..000000000000
--- a/drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.c
+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.c
@@@ -788,6 -810,9 +788,12 @@@ static void DISPCLKDPPCLKDCFCLKDeepSlee
  					v->SwathHeightY[k],
  					v->SwathHeightC[k],
  					TWait,
++<<<<<<< HEAD
++=======
+ 					(v->DRAMSpeedPerState[mode_lib->vba.VoltageLevel] <= MEM_STROBE_FREQ_MHZ ||
+ 						v->DCFCLKPerState[mode_lib->vba.VoltageLevel] <= MIN_DCFCLK_FREQ_MHZ) ?
+ 							mode_lib->vba.ip.min_prefetch_in_strobe_us : 0,
++>>>>>>> b504f99ccaa6 (drm/amd/display: Enforce 60us prefetch for 200Mhz DCFCLK modes)
  					/* Output */
  					&v->DSTXAfterScaler[k],
  					&v->DSTYAfterScaler[k],
@@@ -3250,6 -3311,8 +3256,11 @@@ void dml32_ModeSupportAndSystemConfigur
  							v->swath_width_chroma_ub_this_state[k],
  							v->SwathHeightYThisState[k],
  							v->SwathHeightCThisState[k], v->TWait,
++<<<<<<< HEAD
++=======
+ 							(v->DRAMSpeedPerState[i] <= MEM_STROBE_FREQ_MHZ || v->DCFCLKState[i][j] <= MIN_DCFCLK_FREQ_MHZ) ?
+ 									mode_lib->vba.ip.min_prefetch_in_strobe_us : 0,
++>>>>>>> b504f99ccaa6 (drm/amd/display: Enforce 60us prefetch for 200Mhz DCFCLK modes)
  
  							/* Output */
  							&v->dummy_vars.dml32_ModeSupportAndSystemConfigurationFull.DSTXAfterScaler[k],
diff --cc drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.h
index c62e0991358b,d98e36a9a09c..000000000000
--- a/drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.h
+++ b/drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.h
@@@ -49,6 -52,10 +49,13 @@@
  #define BPP_INVALID 0
  #define BPP_BLENDED_PIPE 0xffffffff
  
++<<<<<<< HEAD
++=======
+ #define MEM_STROBE_FREQ_MHZ 1600
+ #define MIN_DCFCLK_FREQ_MHZ 200
+ #define MEM_STROBE_MAX_DELIVERY_TIME_US 60.0
+ 
++>>>>>>> b504f99ccaa6 (drm/amd/display: Enforce 60us prefetch for 200Mhz DCFCLK modes)
  struct display_mode_lib;
  
  void dml32_ModeSupportAndSystemConfigurationFull(struct display_mode_lib *mode_lib);
* Unmerged path drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.c
* Unmerged path drivers/gpu/drm/amd/display/dc/dml/dcn32/display_mode_vba_32.h
