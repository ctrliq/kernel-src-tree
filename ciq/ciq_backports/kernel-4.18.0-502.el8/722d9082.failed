dm thin: fix issue_discard to pass GFP_NOIO to __blkdev_issue_discard

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Mike Snitzer <snitzer@kernel.org>
commit 722d90822321497e2837cfc9000202e256e6b32f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/722d9082.failed

issue_discard() passes GFP_NOWAIT to __blkdev_issue_discard() despite
its code assuming bio_alloc() always succeeds.

Commit 3dba53a958a75 ("dm thin: use __blkdev_issue_discard for async
discard support") clearly shows where things went bad:

Before commit 3dba53a958a75, dm-thin.c's open-coded
__blkdev_issue_discard_async() properly handled using GFP_NOWAIT.
Unfortunately __blkdev_issue_discard() doesn't and it was missed
during review.

	Cc: stable@vger.kernel.org
	Signed-off-by: Mike Snitzer <snitzer@kernel.org>
(cherry picked from commit 722d90822321497e2837cfc9000202e256e6b32f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/md/dm-thin.c
diff --cc drivers/md/dm-thin.c
index 76e4c19abff1,39410bf186cf..000000000000
--- a/drivers/md/dm-thin.c
+++ b/drivers/md/dm-thin.c
@@@ -401,8 -401,7 +401,12 @@@ static int issue_discard(struct discard
  	sector_t s = block_to_sectors(tc->pool, data_b);
  	sector_t len = block_to_sectors(tc->pool, data_e - data_b);
  
++<<<<<<< HEAD
 +	return __blkdev_issue_discard(tc->pool_dev->bdev, s, len,
 +				      GFP_NOWAIT, 0, &op->bio);
++=======
+ 	return __blkdev_issue_discard(tc->pool_dev->bdev, s, len, GFP_NOIO, &op->bio);
++>>>>>>> 722d90822321 (dm thin: fix issue_discard to pass GFP_NOIO to __blkdev_issue_discard)
  }
  
  static void end_discard(struct discard_op *op, int r)
* Unmerged path drivers/md/dm-thin.c
