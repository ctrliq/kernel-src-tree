net/smc: Introduce a sysctl for setting SMC-R buffer type

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Wen Gu <guwen@linux.alibaba.com>
commit 4bc5008e4387106215b50ae1a4ac2467455725ca
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/4bc5008e.failed

This patch introduces the sysctl smcr_buf_type for setting
the type of SMC-R sndbufs and RMBs.

Valid values includes:

- SMCR_PHYS_CONT_BUFS, which means use physically contiguous
  buffers for better performance and is the default value.

- SMCR_VIRT_CONT_BUFS, which means use virtually contiguous
  buffers in case of physically contiguous memory is scarce.

- SMCR_MIXED_BUFS, which means first try to use physically
  contiguous buffers. If not available, then use virtually
  contiguous buffers.

	Signed-off-by: Wen Gu <guwen@linux.alibaba.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 4bc5008e4387106215b50ae1a4ac2467455725ca)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/networking/smc-sysctl.rst
#	include/net/netns/smc.h
#	net/smc/smc_sysctl.c
diff --cc include/net/netns/smc.h
index 47b166684fd8,2adbe2b245df..000000000000
--- a/include/net/netns/smc.h
+++ b/include/net/netns/smc.h
@@@ -14,5 -14,10 +14,13 @@@ struct netns_smc 
  	struct smc_stats_rsn		*fback_rsn;
  
  	bool				limit_smc_hs;	/* constraint on handshake */
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_SYSCTL
+ 	struct ctl_table_header		*smc_hdr;
+ #endif
+ 	unsigned int			sysctl_autocorking_size;
+ 	unsigned int			sysctl_smcr_buf_type;
++>>>>>>> 4bc5008e4387 (net/smc: Introduce a sysctl for setting SMC-R buffer type)
  };
  #endif
* Unmerged path Documentation/networking/smc-sysctl.rst
* Unmerged path net/smc/smc_sysctl.c
* Unmerged path Documentation/networking/smc-sysctl.rst
* Unmerged path include/net/netns/smc.h
diff --git a/net/smc/smc_core.h b/net/smc/smc_core.h
index 22b175bc0117..b5524055bc5f 100644
--- a/net/smc/smc_core.h
+++ b/net/smc/smc_core.h
@@ -217,6 +217,12 @@ enum smc_lgr_type {				/* redundancy state of lgr */
 	SMC_LGR_ASYMMETRIC_LOCAL,	/* local has 1, peer 2 active RNICs */
 };
 
+enum smcr_buf_type {		/* types of SMC-R sndbufs and RMBs */
+	SMCR_PHYS_CONT_BUFS	= 0,
+	SMCR_VIRT_CONT_BUFS	= 1,
+	SMCR_MIXED_BUFS		= 2,
+};
+
 enum smc_llc_flowtype {
 	SMC_LLC_FLOW_NONE	= 0,
 	SMC_LLC_FLOW_ADD_LINK	= 2,
* Unmerged path net/smc/smc_sysctl.c
