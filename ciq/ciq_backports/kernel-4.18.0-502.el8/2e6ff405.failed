x86/microcode: Do some minor fixups

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-502.el8
commit-author Borislav Petkov <bp@suse.de>
commit 2e6ff4052d89ff9eeaddece14ba88c40bf8b2721
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-502.el8/2e6ff405.failed

Improve debugging printks and fixup formatting.

	Signed-off-by: Borislav Petkov <bp@suse.de>
	Reviewed-by: Ashok Raj <ashok.raj@intel.com>
Link: https://lore.kernel.org/r/20221028142638.28498-5-bp@alien8.de
(cherry picked from commit 2e6ff4052d89ff9eeaddece14ba88c40bf8b2721)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/microcode/core.c
diff --cc arch/x86/kernel/cpu/microcode/core.c
index 689767956c19,ffb249c29f30..000000000000
--- a/arch/x86/kernel/cpu/microcode/core.c
+++ b/arch/x86/kernel/cpu/microcode/core.c
@@@ -802,9 -566,11 +802,17 @@@ static struct syscore_ops mc_syscore_op
  
  static int mc_cpu_starting(unsigned int cpu)
  {
++<<<<<<< HEAD
 +	microcode_update_cpu(cpu);
 +	pr_debug("CPU%d added\n", cpu);
 +	return 0;
++=======
+ 	enum ucode_state err = microcode_ops->apply_microcode(cpu);
+ 
+ 	pr_debug("%s: CPU%d, err: %d\n", __func__, cpu, err);
+ 
+ 	return err == UCODE_ERROR;
++>>>>>>> 2e6ff4052d89 (x86/microcode: Do some minor fixups)
  }
  
  static int mc_cpu_online(unsigned int cpu)
@@@ -821,9 -587,12 +829,9 @@@ static int mc_cpu_down_prep(unsigned in
  	struct device *dev;
  
  	dev = get_cpu_device(cpu);
 -
 -	microcode_fini_cpu(cpu);
 -
  	/* Suspend is in progress, only remove the interface */
  	sysfs_remove_group(&dev->kobj, &mc_attr_group);
- 	pr_debug("CPU%d removed\n", cpu);
+ 	pr_debug("%s: CPU%d\n", __func__, cpu);
  
  	return 0;
  }
@@@ -861,26 -645,14 +868,30 @@@ static int __init microcode_init(void
  	if (IS_ERR(microcode_pdev))
  		return PTR_ERR(microcode_pdev);
  
++<<<<<<< HEAD
 +	cpus_read_lock();
 +	mutex_lock(&microcode_mutex);
 +	error = subsys_interface_register(&mc_cpu_interface);
 +	mutex_unlock(&microcode_mutex);
 +	cpus_read_unlock();
 +
 +	if (error)
 +		goto out_pdev;
 +
 +	error = sysfs_create_group(&cpu_subsys.dev_root->kobj,
 +				   &cpu_root_microcode_group);
 +
++=======
+ 	error = sysfs_create_group(&cpu_subsys.dev_root->kobj, &cpu_root_microcode_group);
++>>>>>>> 2e6ff4052d89 (x86/microcode: Do some minor fixups)
  	if (error) {
  		pr_err("Error creating microcode group!\n");
 -		goto out_pdev;
 +		goto out_driver;
  	}
  
 -	/* Do per-CPU setup */
 -	schedule_on_each_cpu(setup_online_cpu);
 +	error = microcode_dev_init();
 +	if (error)
 +		goto out_ucode_group;
  
  	register_syscore_ops(&mc_syscore_ops);
  	cpuhp_setup_state_nocalls(CPUHP_AP_MICROCODE_LOADER, "x86/microcode:starting",
* Unmerged path arch/x86/kernel/cpu/microcode/core.c
