x86: Sanitize linker script

jira LE-1907
cve CVE-2023-20569
Rebuild_History Non-Buildable kernel-4.18.0-521.el8
commit-author Thomas Gleixner <tglx@linutronix.de>
commit 24a9c543d2114d416f84e386c2fa90089bd97e4c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-521.el8/24a9c543.failed

The section ordering in the text section is more than suboptimal:

    ALIGN_ENTRY_TEXT_BEGIN
    ENTRY_TEXT
    ALIGN_ENTRY_TEXT_END
    SOFTIRQENTRY_TEXT
    STATIC_CALL_TEXT
    INDIRECT_THUNK_TEXT

ENTRY_TEXT is in a seperate PMD so it can be mapped into the cpu entry area
when KPTI is enabled. That means the sections after it are also in a
seperate PMD. That's wasteful especially as the indirect thunk text is a
hotpath on retpoline enabled systems and the static call text is fairly hot
on 32bit.

Move the entry text section last so that the other sections share a PMD
with the text before it. This is obviously just best effort and not
guaranteed when the previous text is just at a PMD boundary.

The text section placement needs an overhaul in general. There is e.g. no
point to have debugfs, sysfs, cpuhotplug and other rarely used functions
next to hot path text.

	Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
Link: https://lore.kernel.org/r/20220915111143.614728935@infradead.org
(cherry picked from commit 24a9c543d2114d416f84e386c2fa90089bd97e4c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/vmlinux.lds.S
diff --cc arch/x86/kernel/vmlinux.lds.S
index 6df2973aa8ce,0e9fc080c417..000000000000
--- a/arch/x86/kernel/vmlinux.lds.S
+++ b/arch/x86/kernel/vmlinux.lds.S
@@@ -125,33 -132,28 +125,48 @@@ SECTION
  		CPUIDLE_TEXT
  		LOCK_TEXT
  		KPROBES_TEXT
++<<<<<<< HEAD
 +		ALIGN_ENTRY_TEXT_BEGIN
 +		ENTRY_TEXT
 +		IRQENTRY_TEXT
 +		ALIGN_ENTRY_TEXT_END
 +		SOFTIRQENTRY_TEXT
 +		*(.fixup)
 +		*(.gnu.warning)
 +
++=======
+ 		SOFTIRQENTRY_TEXT
++>>>>>>> 24a9c543d211 (x86: Sanitize linker script)
  #ifdef CONFIG_RETPOLINE
  		__indirect_thunk_start = .;
  		*(.text.__x86.*)
  		__indirect_thunk_end = .;
  #endif
++<<<<<<< HEAD
++=======
+ 		STATIC_CALL_TEXT
+ 
+ 		ALIGN_ENTRY_TEXT_BEGIN
+ 		ENTRY_TEXT
+ 		ALIGN_ENTRY_TEXT_END
+ 		*(.gnu.warning)
+ 
+ 	} :text =0xcccc
++>>>>>>> 24a9c543d211 (x86: Sanitize linker script)
  
 -	/* End of text section, which should occupy whole number of pages */
 -	_etext = .;
 -	. = ALIGN(PAGE_SIZE);
 +		/* End of text section */
 +		_etext = .;
 +	} :text = 0x9090
 +
 +	NOTES :text :note
  
 -	X86_ALIGN_RODATA_BEGIN
 +	EXCEPTION_TABLE(16) :text = 0x9090
 +
 +	/* .text should occupy whole number of pages */
 +	. = ALIGN(PAGE_SIZE);
 +	X64_ALIGN_RODATA_BEGIN
  	RO_DATA(PAGE_SIZE)
 -	X86_ALIGN_RODATA_END
 +	X64_ALIGN_RODATA_END
  
  	/* Data */
  	.data : AT(ADDR(.data) - LOAD_OFFSET) {
* Unmerged path arch/x86/kernel/vmlinux.lds.S
