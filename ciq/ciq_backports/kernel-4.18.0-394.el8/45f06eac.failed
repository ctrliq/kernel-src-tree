powerpc/pseries/vas: Add 'update_total_credits' entry for QoS capabilities

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Haren Myneni <haren@linux.ibm.com>
commit 45f06eac30e5abebecc66e41e7c89d5b4413bac1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/45f06eac.failed

pseries supports two types of credits - Default (uses normal priority
FIFO) and Qality of service (QoS uses high priority FIFO). The user
decides the number of QoS credits and sets this value with HMC
interface. The total credits for QoS capabilities can be changed
dynamically with HMC interface which invokes drmgr to communicate
to the kernel.

This patch creats 'update_total_credits' entry for QoS capabilities
so that drmgr command can write the new target QoS credits in sysfs.
Instead of using this value, the kernel gets the new QoS capabilities
from the hypervisor whenever update_total_credits is updated to make
sure sync with the QoS target credits in the hypervisor.

	Signed-off-by: Haren Myneni <haren@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/b01ef31a0f964686d00243e7de7f09c73c07e69e.camel@linux.ibm.com

(cherry picked from commit 45f06eac30e5abebecc66e41e7c89d5b4413bac1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/vas-sysfs.c
#	arch/powerpc/platforms/pseries/vas.h
diff --cc arch/powerpc/platforms/pseries/vas.h
index 701363cfd7c1,4ddb1001a0aa..000000000000
--- a/arch/powerpc/platforms/pseries/vas.h
+++ b/arch/powerpc/platforms/pseries/vas.h
@@@ -125,4 -128,8 +125,11 @@@ struct pseries_vas_window 
  	char *name;
  	int fault_virq;
  };
++<<<<<<< HEAD
++=======
+ 
+ int sysfs_add_vas_caps(struct vas_cop_feat_caps *caps);
+ int vas_reconfig_capabilties(u8 type);
+ int __init sysfs_pseries_vas_init(struct vas_all_caps *vas_caps);
++>>>>>>> 45f06eac30e5 (powerpc/pseries/vas: Add 'update_total_credits' entry for QoS capabilities)
  #endif /* _VAS_H */
* Unmerged path arch/powerpc/platforms/pseries/vas-sysfs.c
* Unmerged path arch/powerpc/platforms/pseries/vas-sysfs.c
diff --git a/arch/powerpc/platforms/pseries/vas.c b/arch/powerpc/platforms/pseries/vas.c
index 129611a3402e..31963814c081 100644
--- a/arch/powerpc/platforms/pseries/vas.c
+++ b/arch/powerpc/platforms/pseries/vas.c
@@ -710,7 +710,7 @@ static int reconfig_close_windows(struct vas_caps *vcap, int excess_creds)
  * changes. Reconfig window configurations based on the credits
  * availability from this new capabilities.
  */
-static int vas_reconfig_capabilties(u8 type)
+int vas_reconfig_capabilties(u8 type)
 {
 	struct hv_vas_cop_feat_caps *hv_caps;
 	struct vas_cop_feat_caps *caps;
* Unmerged path arch/powerpc/platforms/pseries/vas.h
