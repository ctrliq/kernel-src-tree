RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Bob Pearson <rpearsonhpe@gmail.com>
commit 02e3524474b857d52f9005cd33717670dc966e8b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/02e35244.failed

Rename rxe_mc_grp to rxe_mcg. Rename rxe_mc_elem to rxe_mca.
These can be read 'multicast group' and 'multicast attachment'.
'elem' collided with the use of elem in rxe pools and was a little
confusing.

Link: https://lore.kernel.org/r/20220127213755.31697-4-rpearsonhpe@gmail.com
	Signed-off-by: Bob Pearson <rpearsonhpe@gmail.com>
	Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>
(cherry picked from commit 02e3524474b857d52f9005cd33717670dc966e8b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/sw/rxe/rxe_mcast.c
#	drivers/infiniband/sw/rxe/rxe_pool.c
#	drivers/infiniband/sw/rxe/rxe_verbs.h
diff --cc drivers/infiniband/sw/rxe/rxe_mcast.c
index 5f1c72c1473c,949784198d80..000000000000
--- a/drivers/infiniband/sw/rxe/rxe_mcast.c
+++ b/drivers/infiniband/sw/rxe/rxe_mcast.c
@@@ -52,13 -52,12 +52,18 @@@ static struct rxe_mcg *create_grp(struc
  	return grp;
  }
  
++<<<<<<< HEAD
 +int rxe_mcast_get_grp(struct rxe_dev *rxe, union ib_gid *mgid,
 +		      struct rxe_mc_grp **grp_p)
++=======
+ static int rxe_mcast_get_grp(struct rxe_dev *rxe, union ib_gid *mgid,
+ 			     struct rxe_mcg **grp_p)
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  {
  	int err;
- 	struct rxe_mc_grp *grp;
+ 	struct rxe_mcg *grp;
  	struct rxe_pool *pool = &rxe->mc_grp_pool;
 +	unsigned long flags;
  
  	if (rxe->attr.max_mcast_qp_attach == 0)
  		return -EINVAL;
@@@ -82,11 -81,11 +87,16 @@@ done
  	return 0;
  }
  
++<<<<<<< HEAD
 +int rxe_mcast_add_grp_elem(struct rxe_dev *rxe, struct rxe_qp *qp,
 +			   struct rxe_mc_grp *grp)
++=======
+ static int rxe_mcast_add_grp_elem(struct rxe_dev *rxe, struct rxe_qp *qp,
+ 			   struct rxe_mcg *grp)
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  {
  	int err;
- 	struct rxe_mc_elem *elem;
+ 	struct rxe_mca *elem;
  
  	/* check to see of the qp is already a member of the group */
  	spin_lock_bh(&qp->grp_lock);
@@@ -126,11 -125,11 +136,11 @@@ out
  	return err;
  }
  
 -static int rxe_mcast_drop_grp_elem(struct rxe_dev *rxe, struct rxe_qp *qp,
 -				   union ib_gid *mgid)
 +int rxe_mcast_drop_grp_elem(struct rxe_dev *rxe, struct rxe_qp *qp,
 +			    union ib_gid *mgid)
  {
- 	struct rxe_mc_grp *grp;
- 	struct rxe_mc_elem *elem, *tmp;
+ 	struct rxe_mcg *grp;
+ 	struct rxe_mca *elem, *tmp;
  
  	grp = rxe_pool_get_key(&rxe->mc_grp_pool, mgid);
  	if (!grp)
@@@ -187,11 -186,37 +197,44 @@@ void rxe_drop_all_mcast_groups(struct r
  	}
  }
  
 -void rxe_mc_cleanup(struct rxe_pool_elem *elem)
 +void rxe_mc_cleanup(struct rxe_pool_entry *arg)
  {
++<<<<<<< HEAD
 +	struct rxe_mc_grp *grp = container_of(arg, typeof(*grp), pelem);
++=======
+ 	struct rxe_mcg *grp = container_of(elem, typeof(*grp), elem);
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  	struct rxe_dev *rxe = grp->rxe;
  
  	rxe_drop_key(grp);
  	rxe_mcast_delete(rxe, &grp->mgid);
  }
++<<<<<<< HEAD
++=======
+ 
+ int rxe_attach_mcast(struct ib_qp *ibqp, union ib_gid *mgid, u16 mlid)
+ {
+ 	int err;
+ 	struct rxe_dev *rxe = to_rdev(ibqp->device);
+ 	struct rxe_qp *qp = to_rqp(ibqp);
+ 	struct rxe_mcg *grp;
+ 
+ 	/* takes a ref on grp if successful */
+ 	err = rxe_mcast_get_grp(rxe, mgid, &grp);
+ 	if (err)
+ 		return err;
+ 
+ 	err = rxe_mcast_add_grp_elem(rxe, qp, grp);
+ 
+ 	rxe_drop_ref(grp);
+ 	return err;
+ }
+ 
+ int rxe_detach_mcast(struct ib_qp *ibqp, union ib_gid *mgid, u16 mlid)
+ {
+ 	struct rxe_dev *rxe = to_rdev(ibqp->device);
+ 	struct rxe_qp *qp = to_rqp(ibqp);
+ 
+ 	return rxe_mcast_drop_grp_elem(rxe, qp, mgid);
+ }
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
diff --cc drivers/infiniband/sw/rxe/rxe_pool.c
index e7b233608b61,63c594173565..000000000000
--- a/drivers/infiniband/sw/rxe/rxe_pool.c
+++ b/drivers/infiniband/sw/rxe/rxe_pool.c
@@@ -83,17 -83,17 +83,27 @@@ static const struct rxe_type_info 
  	},
  	[RXE_TYPE_MC_GRP] = {
  		.name		= "rxe-mc_grp",
++<<<<<<< HEAD
 +		.size		= sizeof(struct rxe_mc_grp),
 +		.elem_offset	= offsetof(struct rxe_mc_grp, pelem),
++=======
+ 		.size		= sizeof(struct rxe_mcg),
+ 		.elem_offset	= offsetof(struct rxe_mcg, elem),
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  		.cleanup	= rxe_mc_cleanup,
  		.flags		= RXE_POOL_KEY,
- 		.key_offset	= offsetof(struct rxe_mc_grp, mgid),
+ 		.key_offset	= offsetof(struct rxe_mcg, mgid),
  		.key_size	= sizeof(union ib_gid),
  	},
  	[RXE_TYPE_MC_ELEM] = {
  		.name		= "rxe-mc_elem",
++<<<<<<< HEAD
 +		.size		= sizeof(struct rxe_mc_elem),
 +		.elem_offset	= offsetof(struct rxe_mc_elem, pelem),
++=======
+ 		.size		= sizeof(struct rxe_mca),
+ 		.elem_offset	= offsetof(struct rxe_mca, elem),
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  	},
  };
  
diff --cc drivers/infiniband/sw/rxe/rxe_verbs.h
index 2fd73c878e17,388b7dc23dd7..000000000000
--- a/drivers/infiniband/sw/rxe/rxe_verbs.h
+++ b/drivers/infiniband/sw/rxe/rxe_verbs.h
@@@ -354,8 -353,8 +354,13 @@@ struct rxe_mw 
  	u64			length;
  };
  
++<<<<<<< HEAD
 +struct rxe_mc_grp {
 +	struct rxe_pool_entry	pelem;
++=======
+ struct rxe_mcg {
+ 	struct rxe_pool_elem	elem;
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  	spinlock_t		mcg_lock; /* guard group */
  	struct rxe_dev		*rxe;
  	struct list_head	qp_list;
@@@ -365,8 -364,8 +370,13 @@@
  	u16			pkey;
  };
  
++<<<<<<< HEAD
 +struct rxe_mc_elem {
 +	struct rxe_pool_entry	pelem;
++=======
+ struct rxe_mca {
+ 	struct rxe_pool_elem	elem;
++>>>>>>> 02e3524474b8 (RDMA/rxe: Rename rxe_mc_grp and rxe_mc_elem)
  	struct list_head	qp_list;
  	struct list_head	grp_list;
  	struct rxe_qp		*qp;
* Unmerged path drivers/infiniband/sw/rxe/rxe_mcast.c
* Unmerged path drivers/infiniband/sw/rxe/rxe_pool.c
diff --git a/drivers/infiniband/sw/rxe/rxe_recv.c b/drivers/infiniband/sw/rxe/rxe_recv.c
index 6a6cc1fa90e4..7ff6b53555f4 100644
--- a/drivers/infiniband/sw/rxe/rxe_recv.c
+++ b/drivers/infiniband/sw/rxe/rxe_recv.c
@@ -233,8 +233,8 @@ static inline void rxe_rcv_pkt(struct rxe_pkt_info *pkt, struct sk_buff *skb)
 static void rxe_rcv_mcast_pkt(struct rxe_dev *rxe, struct sk_buff *skb)
 {
 	struct rxe_pkt_info *pkt = SKB_TO_PKT(skb);
-	struct rxe_mc_grp *mcg;
-	struct rxe_mc_elem *mce;
+	struct rxe_mcg *mcg;
+	struct rxe_mca *mce;
 	struct rxe_qp *qp;
 	union ib_gid dgid;
 	int err;
* Unmerged path drivers/infiniband/sw/rxe/rxe_verbs.h
