arm64: don't reload GPRs after apply_ssbd

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Mark Rutland <mark.rutland@arm.com>
commit 99ed3ed08d629eb0db6866d266e2bbe35efa5f9d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/99ed3ed0.failed

Now that all of the syscall logic works on the saved pt_regs, apply_ssbd
can safely corrupt x0-x3 in the entry paths, and we no longer need to
restore them. So let's remove the logic doing so.

With that logic gone, we can fold the branch target into the macro, so
that callers need not deal with this. GAS provides \@, which provides a
unique value per macro invocation, which we can use to create a unique
label.

	Signed-off-by: Mark Rutland <mark.rutland@arm.com>
	Acked-by: Marc Zyngier <marc.zyngier@arm.com>
	Acked-by: Catalin Marinas <catalin.marinas@arm.com>
	Cc: Will Deacon <will.deacon@arm.com>
	Signed-off-by: Will Deacon <will.deacon@arm.com>
(cherry picked from commit 99ed3ed08d629eb0db6866d266e2bbe35efa5f9d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/entry.S
diff --cc arch/arm64/kernel/entry.S
index 8defa0bdd30f,22b240da949b..000000000000
--- a/arch/arm64/kernel/entry.S
+++ b/arch/arm64/kernel/entry.S
@@@ -338,23 -316,7 +333,27 @@@ alternative_if ARM64_WORKAROUND_84571
  alternative_else_nop_endif
  #endif
  3:
++<<<<<<< HEAD
 +#ifdef CONFIG_ARM64_ERRATUM_1418040
 +alternative_if_not ARM64_WORKAROUND_1418040
 +	b	4f
 +alternative_else_nop_endif
 +	/*
 +	 * if (x22.mode32 == cntkctl_el1.el0vcten)
 +	 *     cntkctl_el1.el0vcten = ~cntkctl_el1.el0vcten
 +	 */
 +	mrs	x1, cntkctl_el1
 +	eon	x0, x1, x22, lsr #3
 +	tbz	x0, #1, 4f
 +	eor	x1, x1, #2	// ARCH_TIMER_USR_VCT_ACCESS_EN
 +	msr	cntkctl_el1, x1
 +4:
 +#endif
 +	apply_ssbd 0, 5f, x0, x1
 +5:
++=======
+ 	apply_ssbd 0, x0, x1
++>>>>>>> 99ed3ed08d62 (arm64: don't reload GPRs after apply_ssbd)
  	.endif
  
  	msr	elr_el1, x21			// set up the return data
* Unmerged path arch/arm64/kernel/entry.S
