arm64: apply ARM64_ERRATUM_845719 workaround for Brahma-B53 core

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Doug Berger <opendmb@gmail.com>
commit bfc97f9f199cb041cf897af3af096540948cc705
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/bfc97f9f.failed

The Broadcom Brahma-B53 core is susceptible to the issue described by
ARM64_ERRATUM_845719 so this commit enables the workaround to be applied
when executing on that core.

Since there are now multiple entries to match, we must convert the
existing ARM64_ERRATUM_845719 into an erratum list.

	Signed-off-by: Doug Berger <opendmb@gmail.com>
	Signed-off-by: Florian Fainelli <f.fainelli@gmail.com>
	Signed-off-by: Will Deacon <will@kernel.org>
(cherry picked from commit bfc97f9f199cb041cf897af3af096540948cc705)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/cpu_errata.c
diff --cc arch/arm64/kernel/cpu_errata.c
index 147f1d09b6c5,b5eeba7f5d84..000000000000
--- a/arch/arm64/kernel/cpu_errata.c
+++ b/arch/arm64/kernel/cpu_errata.c
@@@ -739,20 -743,12 +739,29 @@@ static const struct midr_range erratum_
  };
  #endif
  
++<<<<<<< HEAD
 +#ifdef CONFIG_ARM64_WORKAROUND_SPECULATIVE_AT
 +static const struct midr_range erratum_speculative_at_list[] = {
 +#ifdef CONFIG_ARM64_ERRATUM_1165522
 +	/* Cortex A76 r0p0 to r2p0 */
 +	MIDR_RANGE(MIDR_CORTEX_A76, 0, 0, 2, 0),
 +#endif
 +#ifdef CONFIG_ARM64_ERRATUM_1319367
 +	MIDR_ALL_VERSIONS(MIDR_CORTEX_A57),
 +	MIDR_ALL_VERSIONS(MIDR_CORTEX_A72),
 +#endif
 +#ifdef CONFIG_ARM64_ERRATUM_1530923
 +	/* Cortex A55 r0p0 to r2p0 */
 +	MIDR_RANGE(MIDR_CORTEX_A55, 0, 0, 2, 0),
 +#endif
++=======
+ #ifdef CONFIG_ARM64_ERRATUM_845719
+ static const struct midr_range erratum_845719_list[] = {
+ 	/* Cortex-A53 r0p[01234] */
+ 	MIDR_REV_RANGE(MIDR_CORTEX_A53, 0, 0, 4),
+ 	/* Brahma-B53 r0p[0] */
+ 	MIDR_REV(MIDR_BRAHMA_B53, 0, 0),
++>>>>>>> bfc97f9f199c (arm64: apply ARM64_ERRATUM_845719 workaround for Brahma-B53 core)
  	{},
  };
  #endif
diff --git a/Documentation/arm64/silicon-errata.rst b/Documentation/arm64/silicon-errata.rst
index 646de9dd5b5d..ec8eb06d17db 100644
--- a/Documentation/arm64/silicon-errata.rst
+++ b/Documentation/arm64/silicon-errata.rst
@@ -98,6 +98,9 @@ stable kernels.
 | ARM            | MMU-500         | #841119,826419  | N/A                         |
 +----------------+-----------------+-----------------+-----------------------------+
 +----------------+-----------------+-----------------+-----------------------------+
+| Broadcom       | Brahma-B53      | N/A             | ARM64_ERRATUM_845719        |
++----------------+-----------------+-----------------+-----------------------------+
++----------------+-----------------+-----------------+-----------------------------+
 | Cavium         | ThunderX ITS    | #22375,24313    | CAVIUM_ERRATUM_22375        |
 +----------------+-----------------+-----------------+-----------------------------+
 | Cavium         | ThunderX ITS    | #23144          | CAVIUM_ERRATUM_23144        |
diff --git a/arch/arm64/include/asm/cputype.h b/arch/arm64/include/asm/cputype.h
index 3b3fcf74ac70..44638caa4b5c 100644
--- a/arch/arm64/include/asm/cputype.h
+++ b/arch/arm64/include/asm/cputype.h
@@ -90,6 +90,7 @@
 #define CAVIUM_CPU_PART_THUNDERX_83XX	0x0A3
 #define CAVIUM_CPU_PART_THUNDERX2	0x0AF
 
+#define BRCM_CPU_PART_BRAHMA_B53	0x100
 #define BRCM_CPU_PART_VULCAN		0x516
 
 #define QCOM_CPU_PART_FALKOR_V1		0x800
@@ -116,6 +117,7 @@
 #define MIDR_THUNDERX_81XX MIDR_CPU_MODEL(ARM_CPU_IMP_CAVIUM, CAVIUM_CPU_PART_THUNDERX_81XX)
 #define MIDR_THUNDERX_83XX MIDR_CPU_MODEL(ARM_CPU_IMP_CAVIUM, CAVIUM_CPU_PART_THUNDERX_83XX)
 #define MIDR_CAVIUM_THUNDERX2 MIDR_CPU_MODEL(ARM_CPU_IMP_CAVIUM, CAVIUM_CPU_PART_THUNDERX2)
+#define MIDR_BRAHMA_B53 MIDR_CPU_MODEL(ARM_CPU_IMP_BRCM, BRCM_CPU_PART_BRAHMA_B53)
 #define MIDR_BRCM_VULCAN MIDR_CPU_MODEL(ARM_CPU_IMP_BRCM, BRCM_CPU_PART_VULCAN)
 #define MIDR_QCOM_FALKOR_V1 MIDR_CPU_MODEL(ARM_CPU_IMP_QCOM, QCOM_CPU_PART_FALKOR_V1)
 #define MIDR_QCOM_FALKOR MIDR_CPU_MODEL(ARM_CPU_IMP_QCOM, QCOM_CPU_PART_FALKOR)
* Unmerged path arch/arm64/kernel/cpu_errata.c
