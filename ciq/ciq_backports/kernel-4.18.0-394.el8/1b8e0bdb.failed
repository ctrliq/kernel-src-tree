qed: Move devlink registration to be last devlink command

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Leon Romanovsky <leonro@nvidia.com>
commit 1b8e0bdbea654bd11d285e4e01e68b3bdab196b4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/1b8e0bdb.failed

This change prevents from users to access device before devlink is
fully configured.

	Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1b8e0bdbea654bd11d285e4e01e68b3bdab196b4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/qlogic/qed/qed_devlink.c
diff --cc drivers/net/ethernet/qlogic/qed/qed_devlink.c
index 61349b8adf75,6bb4e165b592..000000000000
--- a/drivers/net/ethernet/qlogic/qed/qed_devlink.c
+++ b/drivers/net/ethernet/qlogic/qed/qed_devlink.c
@@@ -214,10 -215,6 +214,13 @@@ struct devlink *qed_devlink_register(st
  	qdevlink = devlink_priv(dl);
  	qdevlink->cdev = cdev;
  
++<<<<<<< HEAD
 +	rc = devlink_register(dl, &cdev->pdev->dev);
 +	if (rc)
 +		goto err_free;
 +
++=======
++>>>>>>> 1b8e0bdbea65 (qed: Move devlink registration to be last devlink command)
  	rc = devlink_params_register(dl, qed_devlink_params,
  				     ARRAY_SIZE(qed_devlink_params));
  	if (rc)
@@@ -236,9 -232,6 +238,12 @@@
  	return dl;
  
  err_unregister:
++<<<<<<< HEAD
 +	devlink_unregister(dl);
 +
 +err_free:
++=======
++>>>>>>> 1b8e0bdbea65 (qed: Move devlink registration to be last devlink command)
  	devlink_free(dl);
  
  	return ERR_PTR(rc);
* Unmerged path drivers/net/ethernet/qlogic/qed/qed_devlink.c
