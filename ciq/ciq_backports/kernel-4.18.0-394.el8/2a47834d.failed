scsi: smartpqi: Enable SATA NCQ priority in sysfs

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Gilbert Wu <Gilbert.Wu@microchip.com>
commit 2a47834d9452812f68c8894994e95adad56e4b60
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/2a47834d.failed

Add device attribute 'sas_ncq_prio_enable' to enable SATA NCQ priority
support and provide I/O priority in SCSI command and pass priority
information to controller firmware.

This device attribute works only when device has NCQ priority support and
controller firmware can handle I/Os with NCQ priority attribute.

Link: https://lore.kernel.org/r/164375208306.440833.7392577382127815362.stgit@brunhilda.pdev.net
	Reviewed-by: Mike McGowen <mike.mcgowen@microchip.com>
	Reviewed-by: Scott Teel <scott.teel@microchip.com>
	Signed-off-by: Gilbert Wu <Gilbert.Wu@microchip.com>
	Signed-off-by: Don Brace <don.brace@microchip.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 2a47834d9452812f68c8894994e95adad56e4b60)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/smartpqi/smartpqi_init.c
diff --cc drivers/scsi/smartpqi/smartpqi_init.c
index 63ef91b042c7,ad9fa1628a69..000000000000
--- a/drivers/scsi/smartpqi/smartpqi_init.c
+++ b/drivers/scsi/smartpqi/smartpqi_init.c
@@@ -7128,15 -7236,18 +7236,29 @@@ static DEVICE_ATTR(sas_address, 0444, p
  static DEVICE_ATTR(ssd_smart_path_enabled, 0444, pqi_ssd_smart_path_enabled_show, NULL);
  static DEVICE_ATTR(raid_level, 0444, pqi_raid_level_show, NULL);
  static DEVICE_ATTR(raid_bypass_cnt, 0444, pqi_raid_bypass_cnt_show, NULL);
+ static DEVICE_ATTR(sas_ncq_prio_enable, 0644,
+ 		pqi_sas_ncq_prio_enable_show, pqi_sas_ncq_prio_enable_store);
  
++<<<<<<< HEAD
 +static struct device_attribute *pqi_sdev_attrs[] = {
 +	&dev_attr_lunid,
 +	&dev_attr_unique_id,
 +	&dev_attr_path_info,
 +	&dev_attr_sas_address,
 +	&dev_attr_ssd_smart_path_enabled,
 +	&dev_attr_raid_level,
 +	&dev_attr_raid_bypass_cnt,
++=======
+ static struct attribute *pqi_sdev_attrs[] = {
+ 	&dev_attr_lunid.attr,
+ 	&dev_attr_unique_id.attr,
+ 	&dev_attr_path_info.attr,
+ 	&dev_attr_sas_address.attr,
+ 	&dev_attr_ssd_smart_path_enabled.attr,
+ 	&dev_attr_raid_level.attr,
+ 	&dev_attr_raid_bypass_cnt.attr,
+ 	&dev_attr_sas_ncq_prio_enable.attr,
++>>>>>>> 2a47834d9452 (scsi: smartpqi: Enable SATA NCQ priority in sysfs)
  	NULL
  };
  
diff --git a/drivers/scsi/smartpqi/smartpqi.h b/drivers/scsi/smartpqi/smartpqi.h
index aac88ac0a0b7..f192745ee488 100644
--- a/drivers/scsi/smartpqi/smartpqi.h
+++ b/drivers/scsi/smartpqi/smartpqi.h
@@ -1127,6 +1127,8 @@ struct pqi_scsi_dev {
 	u8	box[8];
 	u16	phys_connector[8];
 	u8	phy_id;
+	u8	ncq_prio_enable;
+	u8	ncq_prio_support;
 	bool	raid_bypass_configured;	/* RAID bypass configured */
 	bool	raid_bypass_enabled;	/* RAID bypass enabled */
 	u32	next_bypass_group;
* Unmerged path drivers/scsi/smartpqi/smartpqi_init.c
