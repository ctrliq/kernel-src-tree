arm64: force_signal_inject: WARN if called from kernel context

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Will Deacon <will.deacon@arm.com>
commit 8a60419d36762a1131c2b29f7bd14371db4df1b5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/8a60419d.failed

force_signal_inject() is designed to send a fatal signal to userspace,
so WARN if the current pt_regs indicates a kernel context. This can
currently happen for the undefined instruction trap, so patch that up so
we always BUG() if we didn't have a handler.

	Signed-off-by: Will Deacon <will.deacon@arm.com>
	Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
(cherry picked from commit 8a60419d36762a1131c2b29f7bd14371db4df1b5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/traps.c
diff --cc arch/arm64/kernel/traps.c
index 1a20a6df55b8,539b470f9526..000000000000
--- a/arch/arm64/kernel/traps.c
+++ b/arch/arm64/kernel/traps.c
@@@ -371,6 -353,12 +371,14 @@@ void force_signal_inject(int signal, in
  	const char *desc;
  	struct pt_regs *regs = current_pt_regs();
  
++<<<<<<< HEAD
++=======
+ 	if (WARN_ON(!user_mode(regs)))
+ 		return;
+ 
+ 	clear_siginfo(&info);
+ 
++>>>>>>> 8a60419d3676 (arm64: force_signal_inject: WARN if called from kernel context)
  	switch (signal) {
  	case SIGILL:
  		desc = "undefined instruction";
* Unmerged path arch/arm64/kernel/traps.c
