NFSD: Add nfsd_clid_confirmed tracepoint

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Chuck Lever <chuck.lever@oracle.com>
commit 7e3b32ace6094aadfa2e1e54ca4c6bbfd07646af
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/7e3b32ac.failed

This replaces a dprintk call site in order to get greater visibility
on when client IDs are confirmed or re-used. Simple example:

            nfsd-995   [000]   126.622975: nfsd_compound:        xid=0x3a34e2b1 opcnt=1
            nfsd-995   [000]   126.623005: nfsd_cb_args:         addr=192.168.2.51:45901 client 60958e3b:9213ef0e prog=1073741824 ident=1
            nfsd-995   [000]   126.623007: nfsd_compound_status: op=1/1 OP_SETCLIENTID status=0
            nfsd-996   [001]   126.623142: nfsd_compound:        xid=0x3b34e2b1 opcnt=1
  >>>>      nfsd-996   [001]   126.623146: nfsd_clid_confirmed:  client 60958e3b:9213ef0e
            nfsd-996   [001]   126.623148: nfsd_cb_probe:        addr=192.168.2.51:45901 client 60958e3b:9213ef0e state=UNKNOWN
            nfsd-996   [001]   126.623154: nfsd_compound_status: op=1/1 OP_SETCLIENTID_CONFIRM status=0

	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
	Signed-off-by: J. Bruce Fields <bfields@redhat.com>
(cherry picked from commit 7e3b32ace6094aadfa2e1e54ca4c6bbfd07646af)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfsd/nfs4state.c
diff --cc fs/nfsd/nfs4state.c
index 968845cb8307,37cef1f498e1..000000000000
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@@ -2777,8 -2819,11 +2777,15 @@@ move_to_confirmed(struct nfs4_client *c
  	list_move(&clp->cl_idhash, &nn->conf_id_hashtbl[idhashval]);
  	rb_erase(&clp->cl_namenode, &nn->unconf_name_tree);
  	add_clp_to_name_tree(clp, &nn->conf_name_tree);
++<<<<<<< HEAD
 +	set_bit(NFSD4_CLIENT_CONFIRMED, &clp->cl_flags);
++=======
+ 	if (!test_and_set_bit(NFSD4_CLIENT_CONFIRMED, &clp->cl_flags)) {
+ 		trace_nfsd_clid_confirmed(&clp->cl_clientid);
+ 		if (clp->cl_nfsd_dentry && clp->cl_nfsd_info_dentry)
+ 			fsnotify_dentry(clp->cl_nfsd_info_dentry, FS_MODIFY);
+ 	}
++>>>>>>> 7e3b32ace609 (NFSD: Add nfsd_clid_confirmed tracepoint)
  	renew_client_locked(clp);
  }
  
* Unmerged path fs/nfsd/nfs4state.c
diff --git a/fs/nfsd/trace.h b/fs/nfsd/trace.h
index 2c7ada5dbc70..ee94700b372e 100644
--- a/fs/nfsd/trace.h
+++ b/fs/nfsd/trace.h
@@ -492,6 +492,7 @@ DEFINE_EVENT(nfsd_clientid_class, nfsd_clid_##name, \
 	TP_PROTO(const clientid_t *clid), \
 	TP_ARGS(clid))
 
+DEFINE_CLIENTID_EVENT(confirmed);
 DEFINE_CLIENTID_EVENT(expired);
 DEFINE_CLIENTID_EVENT(purged);
 DEFINE_CLIENTID_EVENT(renew);
