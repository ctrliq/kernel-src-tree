NFS: Remove unnecessary page cache invalidations

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Trond Myklebust <trond.myklebust@hammerspace.com>
commit 36a10a3c4cb6ea7c8bd895c16b3f59e1f0db2f6a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/36a10a3c.failed

Remove cache invalidations that are already covered by change attribute
updates.

	Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
(cherry picked from commit 36a10a3c4cb6ea7c8bd895c16b3f59e1f0db2f6a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfs/inode.c
diff --cc fs/nfs/inode.c
index a0989d931520,3bd0ae438663..000000000000
--- a/fs/nfs/inode.c
+++ b/fs/nfs/inode.c
@@@ -2168,25 -2155,16 +2166,29 @@@ static int nfs_update_inode(struct inod
  				| NFS_INO_INVALID_ACL;
  			inode->i_gid = fattr->gid;
  		}
 -	} else if (fattr_supported & NFS_ATTR_FATTR_GROUP)
 -		nfsi->cache_validity |=
 -			save_cache_validity & NFS_INO_INVALID_OTHER;
 +	} else if (server->caps & NFS_CAP_OWNER_GROUP) {
 +		nfsi->cache_validity |= save_cache_validity &
 +				(NFS_INO_INVALID_OTHER
 +				| NFS_INO_REVAL_FORCED);
 +		cache_revalidated = false;
 +	}
  
  	if (fattr->valid & NFS_ATTR_FATTR_NLINK) {
- 		if (inode->i_nlink != fattr->nlink) {
- 			if (S_ISDIR(inode->i_mode))
- 				invalid |= NFS_INO_INVALID_DATA;
+ 		if (inode->i_nlink != fattr->nlink)
  			set_nlink(inode, fattr->nlink);
++<<<<<<< HEAD
 +		}
 +	} else if (server->caps & NFS_CAP_NLINK) {
 +		nfsi->cache_validity |= save_cache_validity &
 +				(NFS_INO_INVALID_OTHER
 +				| NFS_INO_REVAL_FORCED);
 +		cache_revalidated = false;
 +	}
++=======
+ 	} else if (fattr_supported & NFS_ATTR_FATTR_NLINK)
+ 		nfsi->cache_validity |=
+ 			save_cache_validity & NFS_INO_INVALID_NLINK;
++>>>>>>> 36a10a3c4cb6 (NFS: Remove unnecessary page cache invalidations)
  
  	if (fattr->valid & NFS_ATTR_FATTR_SPACE_USED) {
  		/*
* Unmerged path fs/nfs/inode.c
