netdevsim: Move devlink registration to be last devlink command

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Leon Romanovsky <leonro@nvidia.com>
commit 71c1b525934d5a50b404457d9eb7aa2c6d6b21a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/71c1b525.failed

This change prevents from users to access device before devlink is
fully configured.

	Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 71c1b525934d5a50b404457d9eb7aa2c6d6b21a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/netdevsim/dev.c
diff --cc drivers/net/netdevsim/dev.c
index a3dd545b2aec,cb6645012a30..000000000000
--- a/drivers/net/netdevsim/dev.c
+++ b/drivers/net/netdevsim/dev.c
@@@ -1466,10 -1470,6 +1466,13 @@@ int nsim_dev_probe(struct nsim_bus_dev 
  	if (err)
  		goto err_devlink_free;
  
++<<<<<<< HEAD
 +	err = devlink_register(devlink, &nsim_bus_dev->dev);
 +	if (err)
 +		goto err_resources_unregister;
 +
++=======
++>>>>>>> 71c1b525934d (netdevsim: Move devlink registration to be last devlink command)
  	err = devlink_params_register(devlink, nsim_devlink_params,
  				      ARRAY_SIZE(nsim_devlink_params));
  	if (err)
@@@ -1533,8 -1533,6 +1536,11 @@@ err_params_unregister
  	devlink_params_unregister(devlink, nsim_devlink_params,
  				  ARRAY_SIZE(nsim_devlink_params));
  err_dl_unregister:
++<<<<<<< HEAD
 +	devlink_unregister(devlink);
 +err_resources_unregister:
++=======
++>>>>>>> 71c1b525934d (netdevsim: Move devlink registration to be last devlink command)
  	devlink_resources_unregister(devlink, NULL);
  err_devlink_free:
  	devlink_free(devlink);
* Unmerged path drivers/net/netdevsim/dev.c
