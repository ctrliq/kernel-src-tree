net/mlx4: Move devlink_register to be the last initialization command

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Leon Romanovsky <leonro@nvidia.com>
commit 1e726859167cdeaedc9af412242c3b53fd6fd811
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/1e726859.failed

Refactor the code to make sure that devlink_register() is the last
command during initialization stage.

	Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 1e726859167cdeaedc9af412242c3b53fd6fd811)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx4/main.c
diff --cc drivers/net/ethernet/mellanox/mlx4/main.c
index 28ac4693da3c,9541f3a920c8..000000000000
--- a/drivers/net/ethernet/mellanox/mlx4/main.c
+++ b/drivers/net/ethernet/mellanox/mlx4/main.c
@@@ -4024,9 -4015,6 +4024,12 @@@ static int mlx4_init_one(struct pci_de
  	mutex_init(&dev->persist->interface_state_mutex);
  	mutex_init(&dev->persist->pci_status_mutex);
  
++<<<<<<< HEAD
 +	ret = devlink_register(devlink, &pdev->dev);
 +	if (ret)
 +		goto err_persist_free;
++=======
++>>>>>>> 1e726859167c (net/mlx4: Move devlink_register to be the last initialization command)
  	ret = devlink_params_register(devlink, mlx4_devlink_params,
  				      ARRAY_SIZE(mlx4_devlink_params));
  	if (ret)
@@@ -4045,8 -4033,6 +4048,11 @@@ err_params_unregister
  	devlink_params_unregister(devlink, mlx4_devlink_params,
  				  ARRAY_SIZE(mlx4_devlink_params));
  err_devlink_unregister:
++<<<<<<< HEAD
 +	devlink_unregister(devlink);
 +err_persist_free:
++=======
++>>>>>>> 1e726859167c (net/mlx4: Move devlink_register to be the last initialization command)
  	kfree(dev->persist);
  err_devlink_free:
  	devlink_free(devlink);
* Unmerged path drivers/net/ethernet/mellanox/mlx4/main.c
