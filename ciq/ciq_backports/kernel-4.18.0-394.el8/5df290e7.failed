bnxt_en: Register devlink instance at the end devlink configuration

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Leon Romanovsky <leonro@nvidia.com>
commit 5df290e7a70367d476406420d19c4dea14d45dd1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/5df290e7.failed

Move devlink_register() to be last command in devlink configuration
sequence, so no user space access will be possible till devlink instance
is fully operable. As part of this change, the devlink_params_publish
call is removed as not needed.

This change fixes forgotten devlink_params_unpublish() too.

	Signed-off-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 5df290e7a70367d476406420d19c4dea14d45dd1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
diff --cc drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
index adde635f3759,951c0c00cc95..000000000000
--- a/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
+++ b/drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
@@@ -789,14 -788,8 +785,17 @@@ int bnxt_dl_register(struct bnxt *bp
  	    bp->hwrm_spec_code > 0x10803)
  		bp->eswitch_mode = DEVLINK_ESWITCH_MODE_LEGACY;
  
++<<<<<<< HEAD
 +	rc = devlink_register(dl, &bp->pdev->dev);
 +	if (rc) {
 +		netdev_warn(bp->dev, "devlink_register failed. rc=%d\n", rc);
 +		goto err_dl_free;
 +	}
 +
++=======
++>>>>>>> 5df290e7a703 (bnxt_en: Register devlink instance at the end devlink configuration)
  	if (!BNXT_PF(bp))
- 		return 0;
+ 		goto out;
  
  	attrs.flavour = DEVLINK_PORT_FLAVOUR_PHYSICAL;
  	attrs.phys.port_number = bp->pf.port_id;
* Unmerged path drivers/net/ethernet/broadcom/bnxt/bnxt_devlink.c
