udp6: allow SO_MARK ctrl msg to affect routing

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Jakub Kicinski <kuba@kernel.org>
commit 42dcfd850e514b229d616a53dec06d0f2533217c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/42dcfd85.failed

Commit c6af0c227a22 ("ip: support SO_MARK cmsg")
added propagation of SO_MARK from cmsg to skb->mark.
For IPv4 and raw sockets the mark also affects route
lookup, but in case of IPv6 the flow info is
initialized before cmsg is parsed.

Fixes: c6af0c227a22 ("ip: support SO_MARK cmsg")
Reported-and-tested-by: Xintong Hu <huxintong@fb.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
	Reviewed-by: David Ahern <dsahern@kernel.org>
	Reviewed-by: Willem de Bruijn <willemb@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 42dcfd850e514b229d616a53dec06d0f2533217c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv6/udp.c
diff --cc net/ipv6/udp.c
index 90eaa68c0c2c,be6dc64ece29..000000000000
--- a/net/ipv6/udp.c
+++ b/net/ipv6/udp.c
@@@ -1456,7 -1435,6 +1456,10 @@@ do_udp_sendmsg
  	if (!fl6.flowi6_oif)
  		fl6.flowi6_oif = np->sticky_pktinfo.ipi6_ifindex;
  
++<<<<<<< HEAD
 +	fl6.flowi6_mark = sk->sk_mark;
++=======
++>>>>>>> 42dcfd850e51 (udp6: allow SO_MARK ctrl msg to affect routing)
  	fl6.flowi6_uid = sk->sk_uid;
  
  	if (msg->msg_controllen) {
* Unmerged path net/ipv6/udp.c
