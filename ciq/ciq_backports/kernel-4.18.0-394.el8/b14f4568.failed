tracing/osnoise: Remove STACKTRACE ifdefs from inside functions

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Daniel Bristot de Oliveira <bristot@kernel.org>
commit b14f4568d391c3b9bda9c078a32977e3f939f020
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/b14f4568.failed

Remove CONFIG_STACKTRACE from inside functions, avoiding
compilation problems in the future.

Link: https://lkml.kernel.org/r/3465cca2f28e1ba602a1fc8bdb28d12950b5226e.1635702894.git.bristot@kernel.org

	Cc: Ingo Molnar <mingo@redhat.com>
	Cc: Tom Zanussi <zanussi@kernel.org>
	Cc: Masami Hiramatsu <mhiramat@kernel.org>
	Cc: Juri Lelli <juri.lelli@redhat.com>
	Cc: Clark Williams <williams@redhat.com>
	Cc: John Kacur <jkacur@redhat.com>
	Cc: Peter Zijlstra <peterz@infradead.org>
	Cc: Thomas Gleixner <tglx@linutronix.de>
	Cc: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
	Cc: Daniel Bristot de Oliveira <bristot@kernel.org>
	Cc: linux-rt-users@vger.kernel.org
	Cc: linux-trace-devel@vger.kernel.org
	Cc: linux-kernel@vger.kernel.org
	Suggested-by: Steven Rostedt <rostedt@goodmis.org>
	Signed-off-by: Daniel Bristot de Oliveira <bristot@kernel.org>
	Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
(cherry picked from commit b14f4568d391c3b9bda9c078a32977e3f939f020)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/trace/trace_osnoise.c
diff --cc kernel/trace/trace_osnoise.c
index 60adf8c7f9ff,a7dadf4bfc5f..000000000000
--- a/kernel/trace/trace_osnoise.c
+++ b/kernel/trace/trace_osnoise.c
@@@ -497,12 -641,39 +497,42 @@@ static void timerlat_dump_stack(void
  
  	if (!call_filter_check_discard(call, entry, buffer, event))
  		trace_buffer_unlock_commit_nostack(buffer, event);
 -}
  
++<<<<<<< HEAD
 +out:
++=======
+ /*
+  * timerlat_dump_stack - dump a stack trace previously saved
+  */
+ static void timerlat_dump_stack(u64 latency)
+ {
+ 	struct osnoise_instance *inst;
+ 	struct trace_buffer *buffer;
+ 	struct trace_stack *fstack;
+ 	unsigned int size;
+ 
+ 	/*
+ 	 * trace only if latency > print_stack config, if enabled.
+ 	 */
+ 	if (!osnoise_data.print_stack || osnoise_data.print_stack > latency)
+ 		return;
+ 
+ 	preempt_disable_notrace();
+ 	fstack = this_cpu_ptr(&trace_stack);
+ 	size = fstack->stack_size;
+ 
+ 	rcu_read_lock();
+ 	list_for_each_entry_rcu(inst, &osnoise_instances, list) {
+ 		buffer = inst->tr->array_buffer.buffer;
+ 		__timerlat_dump_stack(buffer, fstack, size);
+ 
+ 	}
+ 	rcu_read_unlock();
++>>>>>>> b14f4568d391 (tracing/osnoise: Remove STACKTRACE ifdefs from inside functions)
  	preempt_enable_notrace();
  }
- #else
- #define timerlat_dump_stack() do {} while (0)
+ #else /* CONFIG_STACKTRACE */
+ #define timerlat_dump_stack(u64 latency) do {} while (0)
  #define timerlat_save_stack(a) do {} while (0)
  #endif /* CONFIG_STACKTRACE */
  #endif /* CONFIG_TIMERLAT_TRACER */
@@@ -1831,6 -1998,47 +1857,50 @@@ static const struct file_operations cpu
  	.llseek		= generic_file_llseek,
  };
  
++<<<<<<< HEAD
++=======
+ #ifdef CONFIG_TIMERLAT_TRACER
+ #ifdef CONFIG_STACKTRACE
+ static int init_timerlat_stack_tracefs(struct dentry *top_dir)
+ {
+ 	struct dentry *tmp;
+ 
+ 	tmp = tracefs_create_file("print_stack", TRACE_MODE_WRITE, top_dir,
+ 				  &osnoise_print_stack, &trace_min_max_fops);
+ 	if (!tmp)
+ 		return -ENOMEM;
+ 
+ 	return 0;
+ }
+ #else /* CONFIG_STACKTRACE */
+ static int init_timerlat_stack_tracefs(struct dentry *top_dir)
+ {
+ 	return 0;
+ }
+ #endif /* CONFIG_STACKTRACE */
+ 
+ /*
+  * init_timerlat_tracefs - A function to initialize the timerlat interface files
+  */
+ static int init_timerlat_tracefs(struct dentry *top_dir)
+ {
+ 	struct dentry *tmp;
+ 
+ 	tmp = tracefs_create_file("timerlat_period_us", TRACE_MODE_WRITE, top_dir,
+ 				  &timerlat_period, &trace_min_max_fops);
+ 	if (!tmp)
+ 		return -ENOMEM;
+ 
+ 	return init_timerlat_stack_tracefs(top_dir);
+ }
+ #else /* CONFIG_TIMERLAT_TRACER */
+ static int init_timerlat_tracefs(struct dentry *top_dir)
+ {
+ 	return 0;
+ }
+ #endif /* CONFIG_TIMERLAT_TRACER */
+ 
++>>>>>>> b14f4568d391 (tracing/osnoise: Remove STACKTRACE ifdefs from inside functions)
  /*
   * init_tracefs - A function to initialize the tracefs interface files
   *
* Unmerged path kernel/trace/trace_osnoise.c
