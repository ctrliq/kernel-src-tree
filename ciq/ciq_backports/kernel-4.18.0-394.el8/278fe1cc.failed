powerpc/pseries/vas: Define global hv_cop_caps struct

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Haren Myneni <haren@linux.ibm.com>
commit 278fe1cc2205a05bfd92c794be3d207372b17289
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/278fe1cc.failed

The coprocessor capabilities struct is used to get default and
QoS capabilities from the hypervisor during init, DLPAR event and
migration. So instead of allocating this struct for each event,
define global struct and reuse it which allows the migration code
to avoid adding an error path.

Also disable copy/paste feature flag if any capabilities HCALL
is failed.

	Signed-off-by: Haren Myneni <haren@linux.ibm.com>
	Reviewed-by: Nicholas Piggin <npiggin@gmail.com>
	Acked-by: Nathan Lynch <nathanl@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/57da6a270fcb9308cd57be7c88037029343080f7.camel@linux.ibm.com

(cherry picked from commit 278fe1cc2205a05bfd92c794be3d207372b17289)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/platforms/pseries/vas.c
diff --cc arch/powerpc/platforms/pseries/vas.c
index 129611a3402e,3bb219f54806..000000000000
--- a/arch/powerpc/platforms/pseries/vas.c
+++ b/arch/powerpc/platforms/pseries/vas.c
@@@ -710,9 -723,8 +711,8 @@@ static int reconfig_close_windows(struc
   * changes. Reconfig window configurations based on the credits
   * availability from this new capabilities.
   */
 -int vas_reconfig_capabilties(u8 type)
 +static int vas_reconfig_capabilties(u8 type)
  {
- 	struct hv_vas_cop_feat_caps *hv_caps;
  	struct vas_cop_feat_caps *caps;
  	int old_nr_creds, new_nr_creds;
  	struct vas_caps *vcaps;
@@@ -836,11 -842,8 +830,16 @@@ static int __init pseries_vas_init(void
  	caps_all.descriptor = be64_to_cpu(hv_caps->descriptor);
  	caps_all.feat_type = be64_to_cpu(hv_caps->feat_type);
  
++<<<<<<< HEAD
 +	hv_cop_caps = kmalloc(sizeof(*hv_cop_caps), GFP_KERNEL);
 +	if (!hv_cop_caps) {
 +		rc = -ENOMEM;
 +		goto out;
 +	}
++=======
+ 	sysfs_pseries_vas_init(&caps_all);
+ 
++>>>>>>> 278fe1cc2205 (powerpc/pseries/vas: Define global hv_cop_caps struct)
  	/*
  	 * QOS capabilities available
  	 */
* Unmerged path arch/powerpc/platforms/pseries/vas.c
