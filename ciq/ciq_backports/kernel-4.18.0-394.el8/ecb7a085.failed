NFSD: Update the NFSv3 WRITE3res encoder to use struct xdr_stream

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-394.el8
commit-author Chuck Lever <chuck.lever@oracle.com>
commit ecb7a085ac15a8844ebf12fca6ae51ce71ac9b3b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-394.el8/ecb7a085.failed

	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
(cherry picked from commit ecb7a085ac15a8844ebf12fca6ae51ce71ac9b3b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/nfsd/nfs3xdr.c
diff --cc fs/nfsd/nfs3xdr.c
index 82108a9af2e0,0191cbfc486b..000000000000
--- a/fs/nfsd/nfs3xdr.c
+++ b/fs/nfsd/nfs3xdr.c
@@@ -1012,21 -1051,28 +1025,42 @@@ nfs3svc_encode_readres(struct svc_rqst 
  int
  nfs3svc_encode_writeres(struct svc_rqst *rqstp, __be32 *p)
  {
+ 	struct xdr_stream *xdr = &rqstp->rq_res_stream;
  	struct nfsd3_writeres *resp = rqstp->rq_resp;
 +	struct nfsd_net *nn = net_generic(SVC_NET(rqstp), nfsd_net_id);
 +	__be32 verf[2];
  
++<<<<<<< HEAD
 +	*p++ = resp->status;
 +	p = encode_wcc_data(rqstp, p, &resp->fh);
 +	if (resp->status == 0) {
 +		*p++ = htonl(resp->count);
 +		*p++ = htonl(resp->committed);
 +		/* unique identifier, y2038 overflow can be ignored */
 +		nfsd_copy_boot_verifier(verf, nn);
 +		*p++ = verf[0];
 +		*p++ = verf[1];
++=======
+ 	if (!svcxdr_encode_nfsstat3(xdr, resp->status))
+ 		return 0;
+ 	switch (resp->status) {
+ 	case nfs_ok:
+ 		if (!svcxdr_encode_wcc_data(rqstp, xdr, &resp->fh))
+ 			return 0;
+ 		if (xdr_stream_encode_u32(xdr, resp->count) < 0)
+ 			return 0;
+ 		if (xdr_stream_encode_u32(xdr, resp->committed) < 0)
+ 			return 0;
+ 		if (!svcxdr_encode_writeverf3(xdr, resp->verf))
+ 			return 0;
+ 		break;
+ 	default:
+ 		if (!svcxdr_encode_wcc_data(rqstp, xdr, &resp->fh))
+ 			return 0;
++>>>>>>> ecb7a085ac15 (NFSD: Update the NFSv3 WRITE3res encoder to use struct xdr_stream)
  	}
- 	return xdr_ressize_check(rqstp, p);
+ 
+ 	return 1;
  }
  
  /* CREATE, MKDIR, SYMLINK, MKNOD */
* Unmerged path fs/nfsd/nfs3xdr.c
