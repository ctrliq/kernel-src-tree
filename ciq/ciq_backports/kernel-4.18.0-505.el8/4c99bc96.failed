ice: Add support for ip TTL & ToS offload

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-505.el8
commit-author Marcin Szycik <marcin.szycik@linux.intel.com>
commit 4c99bc96e05012008cc0069eb6f5f915db530158
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-505.el8/4c99bc96.failed

Add support for parsing TTL and ToS (Hop Limit and Traffic Class) tc fields
and matching on those fields in filters. Incomplete part of implementation
was already in place (getting enc_ip and enc_tos from flow_match_ip and
writing them to filter header).

Note: matching on ipv6 ip_ttl, enc_ttl and enc_tos is currently not
supported by the DDP package.

	Signed-off-by: Marcin Szycik <marcin.szycik@linux.intel.com>
	Reviewed-by: Michal Swiatkowski <michal.swiatkowski@linux.intel.com>
	Tested-by: Sujai Buvaneswaran <sujai.buvaneswaran@intel.com>
	Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
(cherry picked from commit 4c99bc96e05012008cc0069eb6f5f915db530158)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ice/ice_tc_lib.c
diff --cc drivers/net/ethernet/intel/ice/ice_tc_lib.c
index 256836c52bfe,42df686e0215..000000000000
--- a/drivers/net/ethernet/intel/ice/ice_tc_lib.c
+++ b/drivers/net/ethernet/intel/ice/ice_tc_lib.c
@@@ -940,6 -1164,8 +1066,11 @@@ ice_parse_cls_flower(struct net_device 
  	      BIT(FLOW_DISSECTOR_KEY_ENC_IPV4_ADDRS) |
  	      BIT(FLOW_DISSECTOR_KEY_ENC_IPV6_ADDRS) |
  	      BIT(FLOW_DISSECTOR_KEY_ENC_PORTS) |
++<<<<<<< HEAD
++=======
+ 	      BIT(FLOW_DISSECTOR_KEY_ENC_OPTS) |
+ 	      BIT(FLOW_DISSECTOR_KEY_IP) |
++>>>>>>> 4c99bc96e050 (ice: Add support for ip TTL & ToS offload)
  	      BIT(FLOW_DISSECTOR_KEY_ENC_IP) |
  	      BIT(FLOW_DISSECTOR_KEY_PORTS) |
  	      BIT(FLOW_DISSECTOR_KEY_PPPOE))) {
* Unmerged path drivers/net/ethernet/intel/ice/ice_tc_lib.c
diff --git a/drivers/net/ethernet/intel/ice/ice_tc_lib.h b/drivers/net/ethernet/intel/ice/ice_tc_lib.h
index 77d6b3536b9c..d8dfb93d3162 100644
--- a/drivers/net/ethernet/intel/ice/ice_tc_lib.h
+++ b/drivers/net/ethernet/intel/ice/ice_tc_lib.h
@@ -25,9 +25,15 @@
 #define ICE_TC_FLWR_FIELD_CVLAN			BIT(19)
 #define ICE_TC_FLWR_FIELD_PPPOE_SESSID		BIT(20)
 #define ICE_TC_FLWR_FIELD_PPP_PROTO		BIT(21)
+#define ICE_TC_FLWR_FIELD_IP_TOS		BIT(22)
+#define ICE_TC_FLWR_FIELD_IP_TTL		BIT(23)
+#define ICE_TC_FLWR_FIELD_ENC_IP_TOS		BIT(24)
+#define ICE_TC_FLWR_FIELD_ENC_IP_TTL		BIT(25)
 
 #define ICE_TC_FLOWER_MASK_32   0xFFFFFFFF
 
+#define ICE_IPV6_HDR_TC_MASK 0xFF00000
+
 struct ice_indr_block_priv {
 	struct net_device *netdev;
 	struct ice_netdev_priv *np;
