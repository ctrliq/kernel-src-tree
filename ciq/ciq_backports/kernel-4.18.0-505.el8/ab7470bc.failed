ice: Fix stats after PF reset

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-505.el8
commit-author Ahmed Zaki <ahmed.zaki@intel.com>
commit ab7470bc6d8fb5f3004ccc8e4dfd49aab0f27561
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-505.el8/ab7470bc.failed

After a core PF reset, the VFs were showing wrong Rx/Tx stats. This is a
regression in commit 6624e780a577 ("ice: split ice_vsi_setup into smaller
functions") caused by missing to set "stat_offsets_loaded = false" in the
ice_vsi_rebuild() path.

Fixes: 6624e780a577 ("ice: split ice_vsi_setup into smaller functions")
	Signed-off-by: Ahmed Zaki <ahmed.zaki@intel.com>
	Reviewed-by: Alexander Lobakin <aleksander.lobakin@intel.com>
	Tested-by: Rafal Romanowski <rafal.romanowski@intel.com>
	Reviewed-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
(cherry picked from commit ab7470bc6d8fb5f3004ccc8e4dfd49aab0f27561)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/intel/ice/ice_lib.c
diff --cc drivers/net/ethernet/intel/ice/ice_lib.c
index dc99c12b0643,11ae0e41f518..000000000000
--- a/drivers/net/ethernet/intel/ice/ice_lib.c
+++ b/drivers/net/ethernet/intel/ice/ice_lib.c
@@@ -2580,7 -2740,21 +2580,20 @@@ ice_vsi_setup(struct ice_pf *pf, struc
  		if (ret)
  			goto unroll_vector_base;
  
 -		ret = ice_vsi_alloc_ring_stats(vsi);
 -		if (ret)
 -			goto unroll_vector_base;
 -
  		ice_vsi_map_rings_to_vectors(vsi);
++<<<<<<< HEAD
++=======
+ 		vsi->stat_offsets_loaded = false;
+ 
+ 		if (ice_is_xdp_ena_vsi(vsi)) {
+ 			ret = ice_vsi_determine_xdp_res(vsi);
+ 			if (ret)
+ 				goto unroll_vector_base;
+ 			ret = ice_prepare_xdp_rings(vsi, vsi->xdp_prog);
+ 			if (ret)
+ 				goto unroll_vector_base;
+ 		}
++>>>>>>> ab7470bc6d8f (ice: Fix stats after PF reset)
  
  		/* ICE_VSI_CTRL does not need RSS so skip RSS processing */
  		if (vsi->type != ICE_VSI_CTRL)
@@@ -2618,6 -2792,12 +2631,15 @@@
  		if (ret)
  			goto unroll_vector_base;
  
++<<<<<<< HEAD
++=======
+ 		ret = ice_vsi_alloc_ring_stats(vsi);
+ 		if (ret)
+ 			goto unroll_vector_base;
+ 
+ 		vsi->stat_offsets_loaded = false;
+ 
++>>>>>>> ab7470bc6d8f (ice: Fix stats after PF reset)
  		/* Do not exit if configuring RSS had an issue, at least
  		 * receive traffic on first queue. Hence no need to capture
  		 * return value
* Unmerged path drivers/net/ethernet/intel/ice/ice_lib.c
