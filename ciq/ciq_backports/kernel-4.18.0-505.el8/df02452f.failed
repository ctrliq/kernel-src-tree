cgroup: cgroup_get_from_id() must check the looked-up kn is a directory

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-505.el8
commit-author Ming Lei <ming.lei@redhat.com>
commit df02452f3df069a59bc9e69c84435bf115cb6e37
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-505.el8/df02452f.failed

cgroup has to be one kernfs dir, otherwise kernel panic is caused,
especially cgroup id is provide from userspace.

	Reported-by: Marco Patalano <mpatalan@redhat.com>
Fixes: 6b658c4863c1 ("scsi: cgroup: Add cgroup_get_from_id()")
	Cc: Muneendra <muneendra.kumar@broadcom.com>
	Signed-off-by: Ming Lei <ming.lei@redhat.com>
	Acked-by: Mukesh Ojha <quic_mojha@quicinc.com>
	Cc: stable@vger.kernel.org # v5.14+
	Signed-off-by: Tejun Heo <tj@kernel.org>
(cherry picked from commit df02452f3df069a59bc9e69c84435bf115cb6e37)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	kernel/cgroup/cgroup.c
diff --cc kernel/cgroup/cgroup.c
index 04055fa1ab28,5f2090d051ac..000000000000
--- a/kernel/cgroup/cgroup.c
+++ b/kernel/cgroup/cgroup.c
@@@ -5954,18 -6059,8 +5957,22 @@@ struct cgroup *cgroup_get_from_id(u64 i
  		cgrp = NULL;
  
  	rcu_read_unlock();
++<<<<<<< HEAD
++=======
+ put:
++>>>>>>> df02452f3df0 (cgroup: cgroup_get_from_id() must check the looked-up kn is a directory)
  	kernfs_put(kn);
 +
 +	if (!cgrp)
 +		goto out;
 +
 +	spin_lock_irq(&css_set_lock);
 +	root_cgrp = current_cgns_cgroup_from_root(&cgrp_dfl_root);
 +	spin_unlock_irq(&css_set_lock);
 +	if (!cgroup_is_descendant(cgrp, root_cgrp)) {
 +		cgroup_put(cgrp);
 +		cgrp = NULL;
 +	}
  out:
  	return cgrp;
  }
* Unmerged path kernel/cgroup/cgroup.c
