SUNRPC: fix a memleak in gss_import_v2_context

jira LE-1907
cve CVE-2023-52653
Rebuild_History Non-Buildable kernel-rt-4.18.0-553.16.1.rt7.357.el8_10
commit-author Zhipeng Lu <alexious@zju.edu.cn>
commit e67b652d8e8591d3b1e569dbcdfcee15993e91fa
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-553.16.1.rt7.357.el8_10/e67b652d.failed

The ctx->mech_used.data allocated by kmemdup is not freed in neither
gss_import_v2_context nor it only caller gss_krb5_import_sec_context,
which frees ctx on error.

Thus, this patch reform the last call of gss_import_v2_context to the
gss_krb5_import_ctx_v2, preventing the memleak while keepping the return
formation.

Fixes: 47d848077629 ("gss_krb5: handle new context format from gssd")
	Signed-off-by: Zhipeng Lu <alexious@zju.edu.cn>
	Reviewed-by: Jeff Layton <jlayton@kernel.org>
	Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
(cherry picked from commit e67b652d8e8591d3b1e569dbcdfcee15993e91fa)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sunrpc/auth_gss/gss_krb5_mech.c
diff --cc net/sunrpc/auth_gss/gss_krb5_mech.c
index 1603f633a6c8,3366505bc669..000000000000
--- a/net/sunrpc/auth_gss/gss_krb5_mech.c
+++ b/net/sunrpc/auth_gss/gss_krb5_mech.c
@@@ -648,18 -451,16 +649,29 @@@ gss_import_v2_context(const void *p, co
  	}
  	ctx->mech_used.len = gss_kerberos_mech.gm_oid.len;
  
++<<<<<<< HEAD
 +	switch (ctx->enctype) {
 +	case ENCTYPE_DES3_CBC_RAW:
 +		return context_derive_keys_des3(ctx, gfp_mask);
 +	case ENCTYPE_ARCFOUR_HMAC:
 +		return context_derive_keys_rc4(ctx);
 +	case ENCTYPE_AES128_CTS_HMAC_SHA1_96:
 +	case ENCTYPE_AES256_CTS_HMAC_SHA1_96:
 +		return context_derive_keys_new(ctx, gfp_mask);
 +	default:
 +		return -EINVAL;
++=======
+ 	ret = gss_krb5_import_ctx_v2(ctx, gfp_mask);
+ 	if (ret) {
+ 		p = ERR_PTR(ret);
+ 		goto out_free;
++>>>>>>> e67b652d8e85 (SUNRPC: fix a memleak in gss_import_v2_context)
  	}
  
+ 	return 0;
+ 
+ out_free:
+ 	kfree(ctx->mech_used.data);
  out_err:
  	return PTR_ERR(p);
  }
* Unmerged path net/sunrpc/auth_gss/gss_krb5_mech.c
