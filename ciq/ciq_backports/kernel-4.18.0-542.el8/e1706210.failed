selftests/mm: optionally pass duration to transhuge-stress

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-542.el8
commit-author Ryan Roberts <ryan.roberts@arm.com>
commit e170621027161a8cd00132a55fe92b41e37a9203
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-542.el8/e1706210.failed

Until now, transhuge-stress runs until its explicitly killed, so when
invoked by run_kselftest.sh, it would run until the test timeout, then it
would be killed and the test would be marked as failed.

Add a new, optional command line parameter that allows the user to specify
the duration in seconds that the program should run.  The program exits
after this duration with a success (0) exit code.  If the argument is
omitted the old behacvior remains.

On it's own, this doesn't quite solve our problem because run_kselftest.sh
does not allow passing parameters to the program under test.  But we will
shortly move this to run_vmtests.sh, which does allow parameter passing.

Link: https://lkml.kernel.org/r/20230724082522.1202616-8-ryan.roberts@arm.com
	Signed-off-by: Ryan Roberts <ryan.roberts@arm.com>
	Acked-by: David Hildenbrand <david@redhat.com>
	Cc: Florent Revest <revest@chromium.org>
	Cc: Jérôme Glisse <jglisse@redhat.com>
	Cc: John Hubbard <jhubbard@nvidia.com>
	Cc: Mark Brown <broonie@kernel.org>
	Cc: Peter Xu <peterx@redhat.com>
	Cc: Shuah Khan <shuah@kernel.org>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
(cherry picked from commit e170621027161a8cd00132a55fe92b41e37a9203)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/vm/transhuge-stress.c
diff --cc tools/testing/selftests/vm/transhuge-stress.c
index a03cb3fce1f6,c61fb9350b8c..000000000000
--- a/tools/testing/selftests/vm/transhuge-stress.c
+++ b/tools/testing/selftests/vm/transhuge-stress.c
@@@ -67,12 -31,14 +67,17 @@@ int main(int argc, char **argv
  	double s;
  	uint8_t *map;
  	size_t map_len;
++<<<<<<< HEAD:tools/testing/selftests/vm/transhuge-stress.c
++=======
+ 	int pagemap_fd;
+ 	int duration = 0;
++>>>>>>> e17062102716 (selftests/mm: optionally pass duration to transhuge-stress):tools/testing/selftests/mm/transhuge-stress.c
  
  	ram = sysconf(_SC_PHYS_PAGES);
 -	if (ram > SIZE_MAX / psize() / 4)
 +	if (ram > SIZE_MAX / sysconf(_SC_PAGESIZE) / 4)
  		ram = SIZE_MAX / 4;
  	else
 -		ram *= psize();
 +		ram *= sysconf(_SC_PAGESIZE);
  	len = ram;
  
  	while (++i < argc) {
* Unmerged path tools/testing/selftests/vm/transhuge-stress.c
