selftests/mm: configure nr_hugepages for arm64

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-542.el8
commit-author Chaitanya S Prakash <chaitanyas.prakash@arm.com>
commit 2f489e2e69463729eefc77da22c163ae63b48b74
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-542.el8/2f489e2e.failed

Arm64 has a default hugepage size of 512MB when CONFIG_ARM64_64K_PAGES=y
is enabled.  While testing on arm64 platforms having up to 4PB of virtual
address space, a minimum of 6 hugepages were required for all test cases
to pass.  Support for this requirement has been added.

Link: https://lkml.kernel.org/r/20230323105243.2807166-5-chaitanyas.prakash@arm.com
	Signed-off-by: Chaitanya S Prakash <chaitanyas.prakash@arm.com>
	Cc: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
	Cc: Kirill A. Shutemov <kirill.shutemov@linux.intel.com>
	Cc: Shuah Khan <shuah@kernel.org>
	Cc: Mark Rutland <mark.rutland@arm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
(cherry picked from commit 2f489e2e69463729eefc77da22c163ae63b48b74)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/vm/run_vmtests.sh
diff --cc tools/testing/selftests/vm/run_vmtests.sh
index e8a1591aca37,83c438a18aa7..000000000000
mode 100755,100644..100755
--- a/tools/testing/selftests/vm/run_vmtests.sh
+++ b/tools/testing/selftests/vm/run_vmtests.sh
@@@ -212,8 -236,16 +212,21 @@@ if [ $VADDR64 -ne 0 ]; the
  	CATEGORY="hugevm" run_test ./virtual_address_range
  	echo $prev_policy > /proc/sys/vm/overcommit_memory
  
++<<<<<<< HEAD:tools/testing/selftests/vm/run_vmtests.sh
 +	# virtual address 128TB switch test
 +	CATEGORY="hugevm" run_test ./va_128TBswitch
++=======
+ 	# va high address boundary switch test
+ 	ARCH_ARM64="arm64"
+ 	prev_nr_hugepages=$(cat /proc/sys/vm/nr_hugepages)
+ 	if [ "$ARCH" == "$ARCH_ARM64" ]; then
+ 		echo 6 > /proc/sys/vm/nr_hugepages
+ 	fi
+ 	CATEGORY="hugevm" run_test ./va_high_addr_switch.sh
+ 	if [ "$ARCH" == "$ARCH_ARM64" ]; then
+ 		echo $prev_nr_hugepages > /proc/sys/vm/nr_hugepages
+ 	fi
++>>>>>>> 2f489e2e6946 (selftests/mm: configure nr_hugepages for arm64):tools/testing/selftests/mm/run_vmtests.sh
  fi # VADDR64
  
  # vmalloc stability smoke test
* Unmerged path tools/testing/selftests/vm/run_vmtests.sh
