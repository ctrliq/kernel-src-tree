net/smc: Fix dependency of SMC on ISM

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-524.el8
commit-author Gerd Bayer <gbayer@linux.ibm.com>
commit a72178cfe855c283224f393d94a1332b90d1483e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-524.el8/a72178cf.failed

When the SMC protocol is built into the kernel proper while ISM is
configured to be built as module, linking the kernel fails due to
unresolved dependencies out of net/smc/smc_ism.o to
ism_get_smcd_ops, ism_register_client, and ism_unregister_client
as reported via the linux-next test automation (see link).
This however is a bug introduced a while ago.

Correct the dependency list in ISM's and SMC's Kconfig to reflect the
dependencies that are actually inverted. With this you cannot build a
kernel with CONFIG_SMC=y and CONFIG_ISM=m. Either ISM needs to be 'y',
too - or a 'n'. That way, SMC can still be configured on non-s390
architectures that do not have (nor need) an ISM driver.

Fixes: 89e7d2ba61b7 ("net/ism: Add new API for client registration")
	Reported-by: Randy Dunlap <rdunlap@infradead.org>
Closes: https://lore.kernel.org/linux-next/d53b5b50-d894-4df8-8969-fd39e63440ae@infradead.org/
Co-developed-by: Wenjia Zhang <wenjia@linux.ibm.com>
	Signed-off-by: Wenjia Zhang <wenjia@linux.ibm.com>
	Signed-off-by: Gerd Bayer <gbayer@linux.ibm.com>
	Reviewed-by: Simon Horman <horms@kernel.org>
	Tested-by: Simon Horman <horms@kernel.org> # build-tested
	Acked-by: Randy Dunlap <rdunlap@infradead.org>
	Tested-by: Randy Dunlap <rdunlap@infradead.org> # build-tested
Link: https://lore.kernel.org/r/20231006125847.1517840-1-gbayer@linux.ibm.com
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
(cherry picked from commit a72178cfe855c283224f393d94a1332b90d1483e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/smc/Kconfig
diff --cc net/smc/Kconfig
index c717ef0896aa,746be3996768..000000000000
--- a/net/smc/Kconfig
+++ b/net/smc/Kconfig
@@@ -1,7 -1,9 +1,12 @@@
  config SMC
  	tristate "SMC socket protocol family"
  	depends on INET && INFINIBAND
++<<<<<<< HEAD
 +	---help---
++=======
+ 	depends on m || ISM != m
+ 	help
++>>>>>>> a72178cfe855 (net/smc: Fix dependency of SMC on ISM)
  	  SMC-R provides a "sockets over RDMA" solution making use of
  	  RDMA over Converged Ethernet (RoCE) technology to upgrade
  	  AF_INET TCP connections transparently.
diff --git a/drivers/s390/net/Kconfig b/drivers/s390/net/Kconfig
index fc1227149543..e4cd1ee65cde 100644
--- a/drivers/s390/net/Kconfig
+++ b/drivers/s390/net/Kconfig
@@ -111,7 +111,7 @@ config CCWGROUP
 
 config ISM
 	tristate "Support for ISM vPCI Adapter"
-	depends on PCI && SMC
+	depends on PCI
 	default n
 	help
 	  Select this option if you want to use the Internal Shared Memory
* Unmerged path net/smc/Kconfig
