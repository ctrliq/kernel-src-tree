ASoC: SOF: ipc4-topology: Update the basecfg for copier earlier

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-536.el8
commit-author Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
commit e6475ce253187d2e68867102fddd57341ebbf8eb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-536.el8/e6475ce2.failed

The sof_ipc4_update_resource_usage() call updates the CPC value in basecfg
and it must be done prior to making a copy of the copier configuration
for the init message.
Other module types do the resource update as last step or in case of a
process module at the correct time, before the memcpy.

Fixes: d8a2c9879349 ("ASoC: SOF: ipc4-loader/topology: Query the CPC value from manifest")
	Signed-off-by: Peter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: Adrian Bonislawski <adrian.bonislawski@intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
	Reviewed-by: Bard Liao <yung-chuan.liao@linux.intel.com>
	Reviewed-by: Chao Song <chao.song@linux.intel.com>
Link: https://lore.kernel.org/r/20230809125656.27585-1-peter.ujfalusi@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit e6475ce253187d2e68867102fddd57341ebbf8eb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/ipc4-topology.c
diff --cc sound/soc/sof/ipc4-topology.c
index 0196cbfc0998,11361e1cd688..000000000000
--- a/sound/soc/sof/ipc4-topology.c
+++ b/sound/soc/sof/ipc4-topology.c
@@@ -1743,15 -1746,6 +1746,18 @@@ sof_ipc4_prepare_copier_module(struct s
  		       gtw_cfg_config_length,
  		       &ipc4_copier->dma_config_tlv, dma_config_tlv_size);
  
++<<<<<<< HEAD
 +	/* update pipeline memory usage */
 +	sof_ipc4_update_resource_usage(sdev, swidget, &copier_data->base_config);
 +
 +	/*
 +	 * Restore gateway config length now that IPC payload is prepared. This avoids
 +	 * counting the DMA CONFIG TLV multiple times
 +	 */
 +	copier_data->gtw_cfg.config_length = gtw_cfg_config_length / 4;
 +
++=======
++>>>>>>> e6475ce25318 (ASoC: SOF: ipc4-topology: Update the basecfg for copier earlier)
  	return 0;
  }
  
* Unmerged path sound/soc/sof/ipc4-topology.c
