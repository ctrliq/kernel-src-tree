ALSA: hda/realtek - Fixed ASUS platform headset Mic issue

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-536.el8
commit-author Kailang Yang <kailang@realtek.com>
commit c8c0a03ec1be6b3f3ec1ce91685351235212db19
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-536.el8/c8c0a03e.failed

ASUS platform Headset Mic was disable by default.
Assigned verb table for Mic pin will enable it.

	Signed-off-by: Kailang Yang <kailang@realtek.com>
	Cc: <stable@vger.kernel.org>
Link: https://lore.kernel.org/r/1155d914c20c40569f56d36c79254879@realtek.com
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit c8c0a03ec1be6b3f3ec1ce91685351235212db19)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/patch_realtek.c
diff --cc sound/pci/hda/patch_realtek.c
index 608a1ba060b6,9677c09cf7a9..000000000000
--- a/sound/pci/hda/patch_realtek.c
+++ b/sound/pci/hda/patch_realtek.c
@@@ -7061,6 -7057,47 +7061,50 @@@ static void alc295_fixup_dell_inspiron_
  	}
  }
  
++<<<<<<< HEAD
++=======
+ /* Forcibly assign NID 0x03 to HP while NID 0x02 to SPK */
+ static void alc287_fixup_bind_dacs(struct hda_codec *codec,
+ 				    const struct hda_fixup *fix, int action)
+ {
+ 	struct alc_spec *spec = codec->spec;
+ 	static const hda_nid_t conn[] = { 0x02, 0x03 }; /* exclude 0x06 */
+ 	static const hda_nid_t preferred_pairs[] = {
+ 		0x17, 0x02, 0x21, 0x03, 0
+ 	};
+ 
+ 	if (action != HDA_FIXUP_ACT_PRE_PROBE)
+ 		return;
+ 
+ 	snd_hda_override_conn_list(codec, 0x17, ARRAY_SIZE(conn), conn);
+ 	spec->gen.preferred_dacs = preferred_pairs;
+ 	spec->gen.auto_mute_via_amp = 1;
+ 	if (spec->gen.autocfg.speaker_pins[0] != 0x14) {
+ 		snd_hda_codec_write_cache(codec, 0x14, 0, AC_VERB_SET_PIN_WIDGET_CONTROL,
+ 					0x0); /* Make sure 0x14 was disable */
+ 	}
+ }
+ /* Fix none verb table of Headset Mic pin */
+ static void alc_fixup_headset_mic(struct hda_codec *codec,
+ 				   const struct hda_fixup *fix, int action)
+ {
+ 	struct alc_spec *spec = codec->spec;
+ 	static const struct hda_pintbl pincfgs[] = {
+ 		{ 0x19, 0x03a1103c },
+ 		{ }
+ 	};
+ 
+ 	switch (action) {
+ 	case HDA_FIXUP_ACT_PRE_PROBE:
+ 		snd_hda_apply_pincfgs(codec, pincfgs);
+ 		alc_update_coef_idx(codec, 0x45, 0xf<<12 | 1<<10, 5<<12);
+ 		spec->parse_flags |= HDA_PINCFG_HEADSET_MIC;
+ 		break;
+ 	}
+ }
+ 
+ 
++>>>>>>> c8c0a03ec1be (ALSA: hda/realtek - Fixed ASUS platform headset Mic issue)
  enum {
  	ALC269_FIXUP_GPIO2,
  	ALC269_FIXUP_SONY_VAIO,
@@@ -7320,6 -7357,12 +7364,15 @@@
  	ALC295_FIXUP_DELL_INSPIRON_TOP_SPEAKERS,
  	ALC236_FIXUP_DELL_DUAL_CODECS,
  	ALC287_FIXUP_CS35L41_I2C_2_THINKPAD_ACPI,
++<<<<<<< HEAD
++=======
+ 	ALC287_FIXUP_TAS2781_I2C,
+ 	ALC245_FIXUP_HP_MUTE_LED_COEFBIT,
+ 	ALC245_FIXUP_HP_X360_MUTE_LEDS,
+ 	ALC287_FIXUP_THINKPAD_I2S_SPK,
+ 	ALC287_FIXUP_MG_RTKC_CSAMP_CS35L41_I2C_THINKPAD,
+ 	ALC2XX_FIXUP_HEADSET_MIC,
++>>>>>>> c8c0a03ec1be (ALSA: hda/realtek - Fixed ASUS platform headset Mic issue)
  };
  
  /* A special fixup for Lenovo C940 and Yoga Duet 7;
@@@ -9398,6 -9441,36 +9451,39 @@@ static const struct hda_fixup alc269_fi
  		.chained = true,
  		.chain_id = ALC269_FIXUP_THINKPAD_ACPI,
  	},
++<<<<<<< HEAD
++=======
+ 	[ALC287_FIXUP_TAS2781_I2C] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = tas2781_fixup_i2c,
+ 		.chained = true,
+ 		.chain_id = ALC269_FIXUP_THINKPAD_ACPI,
+ 	},
+ 	[ALC245_FIXUP_HP_MUTE_LED_COEFBIT] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc245_fixup_hp_mute_led_coefbit,
+ 	},
+ 	[ALC245_FIXUP_HP_X360_MUTE_LEDS] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc245_fixup_hp_mute_led_coefbit,
+ 		.chained = true,
+ 		.chain_id = ALC245_FIXUP_HP_GPIO_LED
+ 	},
+ 	[ALC287_FIXUP_THINKPAD_I2S_SPK] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc287_fixup_bind_dacs,
+ 	},
+ 	[ALC287_FIXUP_MG_RTKC_CSAMP_CS35L41_I2C_THINKPAD] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc287_fixup_bind_dacs,
+ 		.chained = true,
+ 		.chain_id = ALC287_FIXUP_CS35L41_I2C_2_THINKPAD_ACPI,
+ 	},
+ 	[ALC2XX_FIXUP_HEADSET_MIC] = {
+ 		.type = HDA_FIXUP_FUNC,
+ 		.v.func = alc_fixup_headset_mic,
+ 	},
++>>>>>>> c8c0a03ec1be (ALSA: hda/realtek - Fixed ASUS platform headset Mic issue)
  };
  
  static const struct snd_pci_quirk alc269_fixup_tbl[] = {
* Unmerged path sound/pci/hda/patch_realtek.c
