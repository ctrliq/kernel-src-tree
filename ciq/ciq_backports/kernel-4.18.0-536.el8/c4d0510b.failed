ALSA: hda: cs35l41: Rework System Suspend to ensure correct call separation

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-536.el8
commit-author Stefan Binding <sbinding@opensource.cirrus.com>
commit c4d0510b81c430249ee69c0554bb7ce4fa3d539e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-536.el8/c4d0510b.failed

In order to correctly pause audio on suspend, amps using external boost
require parts of the pause sequence to be called for all amps before moving
on to the next steps.
For example, as part of pausing the audio, the VSPK GPIO must be disabled,
but since this GPIO is controlled by one amp, but controls the boost for
all amps, it is required to separate the calls.
During playback this is achieved by using the pre and post playback hooks,
however during system suspend, this is not possible, so to separate the
calls, we use both the .prepare and .suspend calls to pause the audio.

Currently, for this reason, we do not restart audio on system resume.
However, we can support this by relying on the playback hook to resume
playback after system suspend.

	Signed-off-by: Stefan Binding <sbinding@opensource.cirrus.com>
Link: https://lore.kernel.org/r/20230721151816.2080453-10-sbinding@opensource.cirrus.com
	Signed-off-by: Takashi Iwai <tiwai@suse.de>
(cherry picked from commit c4d0510b81c430249ee69c0554bb7ce4fa3d539e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/pci/hda/cs35l41_hda.c
diff --cc sound/pci/hda/cs35l41_hda.c
index c6bef5b2f6b8,70aa819cfbd6..000000000000
--- a/sound/pci/hda/cs35l41_hda.c
+++ b/sound/pci/hda/cs35l41_hda.c
@@@ -1637,15 -1665,18 +1666,22 @@@ void cs35l41_hda_remove(struct device *
  	gpiod_put(cs35l41->reset_gpio);
  	kfree(cs35l41->acpi_subsystem_id);
  }
 -EXPORT_SYMBOL_NS_GPL(cs35l41_hda_remove, SND_HDA_SCODEC_CS35L41);
 +EXPORT_SYMBOL_GPL(cs35l41_hda_remove);
  
  const struct dev_pm_ops cs35l41_hda_pm_ops = {
++<<<<<<< HEAD
 +	SET_RUNTIME_PM_OPS(cs35l41_runtime_suspend, cs35l41_runtime_resume,
 +			   cs35l41_runtime_idle)
 +	SET_SYSTEM_SLEEP_PM_OPS(cs35l41_system_suspend, cs35l41_system_resume)
++=======
+ 	RUNTIME_PM_OPS(cs35l41_runtime_suspend, cs35l41_runtime_resume,
+ 		       cs35l41_runtime_idle)
+ 	.prepare = cs35l41_system_suspend_prep,
+ 	SYSTEM_SLEEP_PM_OPS(cs35l41_system_suspend, cs35l41_system_resume)
++>>>>>>> c4d0510b81c4 (ALSA: hda: cs35l41: Rework System Suspend to ensure correct call separation)
  };
 -EXPORT_SYMBOL_NS_GPL(cs35l41_hda_pm_ops, SND_HDA_SCODEC_CS35L41);
 +EXPORT_SYMBOL_GPL(cs35l41_hda_pm_ops);
  
  MODULE_DESCRIPTION("CS35L41 HDA Driver");
 -MODULE_IMPORT_NS(SND_HDA_CS_DSP_CONTROLS);
  MODULE_AUTHOR("Lucas Tanure, Cirrus Logic Inc, <tanureal@opensource.cirrus.com>");
  MODULE_LICENSE("GPL");
 -MODULE_IMPORT_NS(FW_CS_DSP);
* Unmerged path sound/pci/hda/cs35l41_hda.c
