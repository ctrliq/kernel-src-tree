rtnetlink: verify rate parameters for calls to ndo_set_vf_rate

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-484.el8
commit-author Bin Chen <bin.chen@corigine.com>
commit a14857c27a505bc7ebcef6311424274b2f42f846
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-484.el8/a14857c2.failed

When calling ndo_set_vf_rate() the max_tx_rate parameter may be zero,
in which case the setting is cleared, or it must be greater or equal to
min_tx_rate.

Enforce this requirement on all calls to ndo_set_vf_rate via a wrapper
which also only calls ndo_set_vf_rate() if defined by the driver.

Based on work by Jakub Kicinski <kuba@kernel.org>

	Signed-off-by: Bin Chen <bin.chen@corigine.com>
	Signed-off-by: Baowen Zheng <baowen.zheng@corigine.com>
	Signed-off-by: Simon Horman <simon.horman@corigine.com>
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
(cherry picked from commit a14857c27a505bc7ebcef6311424274b2f42f846)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/rtnetlink.c
diff --cc net/core/rtnetlink.c
index d0aefd7e7660,bdc891326102..000000000000
--- a/net/core/rtnetlink.c
+++ b/net/core/rtnetlink.c
@@@ -2243,7 -2306,21 +2243,25 @@@ invalid_attr
  	return -EINVAL;
  }
  
++<<<<<<< HEAD
 +static int validate_linkmsg(struct net_device *dev, struct nlattr *tb[])
++=======
+ static	int rtnl_set_vf_rate(struct net_device *dev, int vf, int min_tx_rate,
+ 			     int max_tx_rate)
+ {
+ 	const struct net_device_ops *ops = dev->netdev_ops;
+ 
+ 	if (!ops->ndo_set_vf_rate)
+ 		return -EOPNOTSUPP;
+ 	if (max_tx_rate && max_tx_rate < min_tx_rate)
+ 		return -EINVAL;
+ 
+ 	return ops->ndo_set_vf_rate(dev, vf, min_tx_rate, max_tx_rate);
+ }
+ 
+ static int validate_linkmsg(struct net_device *dev, struct nlattr *tb[],
+ 			    struct netlink_ext_ack *extack)
++>>>>>>> a14857c27a50 (rtnetlink: verify rate parameters for calls to ndo_set_vf_rate)
  {
  	if (dev) {
  		if (tb[IFLA_ADDRESS] &&
* Unmerged path net/core/rtnetlink.c
