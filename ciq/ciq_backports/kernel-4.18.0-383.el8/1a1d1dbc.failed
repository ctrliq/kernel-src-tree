kvm: selftests: conditionally build vm_xsave_req_perm()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-383.el8
commit-author Wei Wang <wei.w.wang@intel.com>
commit 1a1d1dbce6d5477e2bb08ce1ef0d77caa838cc8e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-383.el8/1a1d1dbc.failed

vm_xsave_req_perm() is currently defined and used by x86_64 only.
Make it compiled into vm_create_with_vcpus() only when on x86_64
machines. Otherwise, it would cause linkage errors, e.g. on s390x.

Fixes: 415a3c33e8 ("kvm: selftests: Add support for KVM_CAP_XSAVE2")
	Reported-by: Janis Schoetterl-Glausch <scgl@linux.ibm.com>
	Signed-off-by: Wei Wang <wei.w.wang@intel.com>
	Tested-by: Janis Schoetterl-Glausch <scgl@linux.ibm.com>
Message-Id: <20220118014817.30910-1-wei.w.wang@intel.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit 1a1d1dbce6d5477e2bb08ce1ef0d77caa838cc8e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/lib/kvm_util.c
diff --cc tools/testing/selftests/kvm/lib/kvm_util.c
index ae4c94a52301,c22a17aac6b0..000000000000
--- a/tools/testing/selftests/kvm/lib/kvm_util.c
+++ b/tools/testing/selftests/kvm/lib/kvm_util.c
@@@ -355,6 -393,13 +355,16 @@@ struct kvm_vm *vm_create_with_vcpus(enu
  	struct kvm_vm *vm;
  	int i;
  
++<<<<<<< HEAD
++=======
+ #ifdef __x86_64__
+ 	/*
+ 	 * Permission needs to be requested before KVM_SET_CPUID2.
+ 	 */
+ 	vm_xsave_req_perm();
+ #endif
+ 
++>>>>>>> 1a1d1dbce6d5 (kvm: selftests: conditionally build vm_xsave_req_perm())
  	/* Force slot0 memory size not small than DEFAULT_GUEST_PHY_PAGES */
  	if (slot0_mem_pages < DEFAULT_GUEST_PHY_PAGES)
  		slot0_mem_pages = DEFAULT_GUEST_PHY_PAGES;
* Unmerged path tools/testing/selftests/kvm/lib/kvm_util.c
