lib/test: convert test_sort.c to use KUnit

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-383.el8
commit-author Daniel Latypov <dlatypov@google.com>
commit 36f33b562936295a0fb365ea0b1b2afcd8974242
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-383.el8/36f33b56.failed

This follows up commit ebd09577be6c ("lib/test: convert
lib/test_list_sort.c to use KUnit").

Converting this test to KUnit makes the test a bit shorter, standardizes
how it reports pass/fail, and adds an easier way to run the test [1].

Like ebd09577be6c, this leaves the file and Kconfig option name the same,
but slightly changes their dependencies (needs CONFIG_KUNIT).

[1] Can be run via
$ ./tools/testing/kunit/kunit.py run --kunitconfig /dev/stdin <<EOF
CONFIG_KUNIT=y
CONFIG_TEST_SORT=y
EOF

[11:30:27] Starting KUnit Kernel ...
[11:30:30] ============================================================
[11:30:30] ======== [PASSED] lib_sort ========
[11:30:30] [PASSED] test_sort
[11:30:30] ============================================================
[11:30:30] Testing complete. 1 tests run. 0 failed. 0 crashed. 0 skipped.
[11:30:30] Elapsed time: 37.032s total, 0.001s configuring, 34.090s building, 0.000s running

Note: this is the time it took after a `make mrproper`.

With an incremental rebuild, this looks more like:
[11:38:58] Elapsed time: 6.444s total, 0.001s configuring, 3.416s building, 0.000s running

Since the test has no dependencies, it can also be run (with some other
tests) with just:
$ ./tools/testing/kunit/kunit.py run

Link: https://lkml.kernel.org/r/20210715232441.1380885-1-dlatypov@google.com
	Signed-off-by: Daniel Latypov <dlatypov@google.com>
	Cc: Pravin Shedge <pravin.shedge4linux@gmail.com>
	Cc: Brendan Higgins <brendanhiggins@google.com>
	Cc: David Gow <davidgow@google.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 36f33b562936295a0fb365ea0b1b2afcd8974242)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	lib/test_sort.c
diff --cc lib/test_sort.c
index 385c0ed5202f,be02e3a098cf..000000000000
--- a/lib/test_sort.c
+++ b/lib/test_sort.c
@@@ -1,3 -1,7 +1,10 @@@
++<<<<<<< HEAD
++=======
+ // SPDX-License-Identifier: GPL-2.0-only
+ 
+ #include <kunit/test.h>
+ 
++>>>>>>> 36f33b562936 (lib/test: convert test_sort.c to use KUnit)
  #include <linux/sort.h>
  #include <linux/slab.h>
  #include <linux/module.h>
diff --git a/lib/Kconfig.debug b/lib/Kconfig.debug
index ce8e949de93b..acb839e83ffb 100644
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -1844,8 +1844,9 @@ config TEST_MIN_HEAP
 	  If unsure, say N.
 
 config TEST_SORT
-	tristate "Array-based sort test"
-	depends on DEBUG_KERNEL || m
+	tristate "Array-based sort test" if !KUNIT_ALL_TESTS
+	depends on KUNIT
+	default KUNIT_ALL_TESTS
 	help
 	  This option enables the self-test function of 'sort()' at boot,
 	  or at module load time.
* Unmerged path lib/test_sort.c
