powerpc/mm/hash: Handle mmap_min_addr correctly in get_unmapped_area topdown search

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-525.el8
commit-author Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
commit 3b4d07d2674f6b4a9281031f99d1f7efd325b16d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-525.el8/3b4d07d2.failed

When doing top-down search the low_limit is not PAGE_SIZE but rather
max(PAGE_SIZE, mmap_min_addr). This handle cases in which mmap_min_addr >
PAGE_SIZE.

Fixes: fba2369e6ceb ("mm: use vm_unmapped_area() on powerpc architecture")
	Reviewed-by: Laurent Dufour <ldufour@linux.vnet.ibm.com>
	Signed-off-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
(cherry picked from commit 3b4d07d2674f6b4a9281031f99d1f7efd325b16d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/powerpc/mm/slice.c
diff --cc arch/powerpc/mm/slice.c
index 2f47bcbdf710,aec91dbcdc0b..000000000000
--- a/arch/powerpc/mm/slice.c
+++ b/arch/powerpc/mm/slice.c
@@@ -31,6 -31,8 +31,11 @@@
  #include <linux/spinlock.h>
  #include <linux/export.h>
  #include <linux/hugetlb.h>
++<<<<<<< HEAD
++=======
+ #include <linux/sched/mm.h>
+ #include <linux/security.h>
++>>>>>>> 3b4d07d2674f (powerpc/mm/hash: Handle mmap_min_addr correctly in get_unmapped_area topdown search)
  #include <asm/mman.h>
  #include <asm/mmu.h>
  #include <asm/copro.h>
@@@ -517,10 -527,10 +523,10 @@@ unsigned long slice_get_unmapped_area(u
  
  	/* If hint, make sure it matches our alignment restrictions */
  	if (!fixed && addr) {
 -		addr = _ALIGN_UP(addr, page_size);
 +		addr = ALIGN(addr, page_size);
  		slice_dbg(" aligned addr=%lx\n", addr);
  		/* Ignore hint if it's too large or overlaps a VMA */
- 		if (addr > high_limit - len ||
+ 		if (addr > high_limit - len || addr < mmap_min_addr ||
  		    !slice_area_is_free(mm, addr, len))
  			addr = 0;
  	}
* Unmerged path arch/powerpc/mm/slice.c
