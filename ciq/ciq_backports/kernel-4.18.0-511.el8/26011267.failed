mm/memory_hotplug: MEMHP_MERGE_RESOURCE -> MHP_MERGE_RESOURCE

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-511.el8
commit-author David Hildenbrand <david@redhat.com>
commit 26011267e1a7ddaab50b5f81b402ca3e7fc2887c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-511.el8/26011267.failed

Let's make "MEMHP_MERGE_RESOURCE" consistent with "MHP_NONE", "mhp_t" and
"mhp_flags".  As discussed recently [1], "mhp" is our internal acronym for
memory hotplug now.

[1] https://lore.kernel.org/linux-mm/c37de2d0-28a1-4f7d-f944-cfd7d81c334d@redhat.com/

Link: https://lkml.kernel.org/r/20210126115829.10909-1-david@redhat.com
	Signed-off-by: David Hildenbrand <david@redhat.com>
	Reviewed-by: Miaohe Lin <linmiaohe@huawei.com>
	Acked-by: Michael S. Tsirkin <mst@redhat.com>
	Reviewed-by: Oscar Salvador <osalvador@suse.de>
	Acked-by: Wei Liu <wei.liu@kernel.org>
	Reviewed-by: Pankaj Gupta <pankaj.gupta@cloud.ionos.com>
	Cc: "K. Y. Srinivasan" <kys@microsoft.com>
	Cc: Haiyang Zhang <haiyangz@microsoft.com>
	Cc: Stephen Hemminger <sthemmin@microsoft.com>
	Cc: Jason Wang <jasowang@redhat.com>
	Cc: Boris Ostrovsky <boris.ostrovsky@oracle.com>
	Cc: Juergen Gross <jgross@suse.com>
	Cc: Stefano Stabellini <sstabellini@kernel.org>
	Cc: Michal Hocko <mhocko@kernel.org>
	Cc: Anshuman Khandual <anshuman.khandual@arm.com>
	Cc: Wei Yang <richard.weiyang@linux.alibaba.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 26011267e1a7ddaab50b5f81b402ca3e7fc2887c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/hv/hv_balloon.c
#	drivers/virtio/virtio_mem.c
#	drivers/xen/balloon.c
#	include/linux/memory_hotplug.h
#	mm/memory_hotplug.c
diff --cc drivers/hv/hv_balloon.c
index ca15067d41ec,2f776d78e3c1..000000000000
--- a/drivers/hv/hv_balloon.c
+++ b/drivers/hv/hv_balloon.c
@@@ -746,7 -726,7 +746,11 @@@ static void hv_mem_hot_add(unsigned lon
  
  		nid = memory_add_physaddr_to_nid(PFN_PHYS(start_pfn));
  		ret = add_memory(nid, PFN_PHYS((start_pfn)),
++<<<<<<< HEAD
 +				(HA_CHUNK << PAGE_SHIFT));
++=======
+ 				(HA_CHUNK << PAGE_SHIFT), MHP_MERGE_RESOURCE);
++>>>>>>> 26011267e1a7 (mm/memory_hotplug: MEMHP_MERGE_RESOURCE -> MHP_MERGE_RESOURCE)
  
  		if (ret) {
  			pr_err("hot_add memory failed error is %d\n", ret);
diff --cc drivers/xen/balloon.c
index b32d3f322e0d,671c71245a7b..000000000000
--- a/drivers/xen/balloon.c
+++ b/drivers/xen/balloon.c
@@@ -397,7 -331,7 +397,11 @@@ static enum bp_state reserve_additional
  	mutex_unlock(&balloon_mutex);
  	/* add_memory_resource() requires the device_hotplug lock */
  	lock_device_hotplug();
++<<<<<<< HEAD
 +	rc = add_memory_resource(nid, resource);
++=======
+ 	rc = add_memory_resource(nid, resource, MHP_MERGE_RESOURCE);
++>>>>>>> 26011267e1a7 (mm/memory_hotplug: MEMHP_MERGE_RESOURCE -> MHP_MERGE_RESOURCE)
  	unlock_device_hotplug();
  	mutex_lock(&balloon_mutex);
  
diff --cc include/linux/memory_hotplug.h
index 9f9deec9dd0c,08eeef679ab7..000000000000
--- a/include/linux/memory_hotplug.h
+++ b/include/linux/memory_hotplug.h
@@@ -103,6 -42,19 +103,22 @@@ enum 
  	MMOP_ONLINE_MOVABLE,
  };
  
++<<<<<<< HEAD
++=======
+ /* Flags for add_memory() and friends to specify memory hotplug details. */
+ typedef int __bitwise mhp_t;
+ 
+ /* No special request */
+ #define MHP_NONE		((__force mhp_t)0)
+ /*
+  * Allow merging of the added System RAM resource with adjacent,
+  * mergeable resources. After a successful call to add_memory_resource()
+  * with this flag set, the resource pointer must no longer be used as it
+  * might be stale, or the resource might have changed.
+  */
+ #define MHP_MERGE_RESOURCE	((__force mhp_t)BIT(0))
+ 
++>>>>>>> 26011267e1a7 (mm/memory_hotplug: MEMHP_MERGE_RESOURCE -> MHP_MERGE_RESOURCE)
  /*
   * Extended parameters for memory hotplug:
   * altmap: alternative allocator for memmap array (optional)
diff --cc mm/memory_hotplug.c
index 8ef83f8f699e,6a02c3f42717..000000000000
--- a/mm/memory_hotplug.c
+++ b/mm/memory_hotplug.c
@@@ -1093,8 -1149,15 +1093,18 @@@ int __ref add_memory_resource(int nid, 
  	/* device_online() will take the lock when calling online_pages() */
  	mem_hotplug_done();
  
++<<<<<<< HEAD
++=======
+ 	/*
+ 	 * In case we're allowed to merge the resource, flag it and trigger
+ 	 * merging now that adding succeeded.
+ 	 */
+ 	if (mhp_flags & MHP_MERGE_RESOURCE)
+ 		merge_system_ram_resource(res);
+ 
++>>>>>>> 26011267e1a7 (mm/memory_hotplug: MEMHP_MERGE_RESOURCE -> MHP_MERGE_RESOURCE)
  	/* online pages if requested */
 -	if (mhp_default_online_type != MMOP_OFFLINE)
 +	if (memhp_default_online_type != MMOP_OFFLINE)
  		walk_memory_blocks(start, size, NULL, online_memory_block);
  
  	return ret;
* Unmerged path drivers/virtio/virtio_mem.c
* Unmerged path drivers/hv/hv_balloon.c
* Unmerged path drivers/virtio/virtio_mem.c
* Unmerged path drivers/xen/balloon.c
* Unmerged path include/linux/memory_hotplug.h
* Unmerged path mm/memory_hotplug.c
