virtio-mem: check against mhp_get_pluggable_range() which memory we can hotplug

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-511.el8
commit-author David Hildenbrand <david@redhat.com>
commit 94c8945376d44b37aa3ab5b58669a2a86326968e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-511.el8/94c89453.failed

Right now, we only check against MAX_PHYSMEM_BITS - but turns out there
are more restrictions of which memory we can actually hotplug, especially
om arm64 or s390x once we support them: we might receive something like
-E2BIG or -ERANGE from add_memory_driver_managed(), stopping device
operation.

So, check right when initializing the device which memory we can add,
warning the user.  Try only adding actually pluggable ranges: in the worst
case, no memory provided by our device is pluggable.

In the usual case, we expect all device memory to be pluggable, and in
corner cases only some memory at the end of the device-managed memory
region to not be pluggable.

Link: https://lkml.kernel.org/r/1612149902-7867-5-git-send-email-anshuman.khandual@arm.com
	Signed-off-by: David Hildenbrand <david@redhat.com>
	Signed-off-by: Anshuman Khandual <anshuman.khandual@arm.com>
	Cc: "Michael S. Tsirkin" <mst@redhat.com>
	Cc: Jason Wang <jasowang@redhat.com>
	Cc: Pankaj Gupta <pankaj.gupta.linux@gmail.com>
	Cc: Oscar Salvador <osalvador@suse.de>
	Cc: Wei Yang <richard.weiyang@linux.alibaba.com>
	Cc: teawater <teawaterz@linux.alibaba.com>
	Cc: Anshuman Khandual <anshuman.khandual@arm.com>
	Cc: Pankaj Gupta <pankaj.gupta@cloud.ionos.com>
	Cc: Jonathan Cameron <Jonathan.Cameron@huawei.com>
	Cc: Vasily Gorbik <gor@linux.ibm.com>
	Cc: Will Deacon <will@kernel.org>
	Cc: Ard Biesheuvel <ardb@kernel.org>
	Cc: Mark Rutland <mark.rutland@arm.com>
	Cc: Heiko Carstens <hca@linux.ibm.com>
	Cc: Michal Hocko <mhocko@kernel.org>
	Cc: Catalin Marinas <catalin.marinas@arm.com>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 94c8945376d44b37aa3ab5b58669a2a86326968e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/virtio/virtio_mem.c
* Unmerged path drivers/virtio/virtio_mem.c
* Unmerged path drivers/virtio/virtio_mem.c
