drm/amdgpu: add RAS POISON interrupt funcs for jpeg_v4_0

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-511.el8
commit-author Horatio Zhang <Hongkun.Zhang@amd.com>
commit bc3e1d60f933f823599376f830eb99451afb995a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-511.el8/bc3e1d60.failed

Add ras_poison_irq and functions. And fix the amdgpu_irq_put
call trace in jpeg_v4_0_hw_fini.

[   50.497562] RIP: 0010:amdgpu_irq_put+0xa4/0xc0 [amdgpu]
[   50.497619] RSP: 0018:ffffaa2400fcfcb0 EFLAGS: 00010246
[   50.497620] RAX: 0000000000000000 RBX: 0000000000000001 RCX: 0000000000000000
[   50.497621] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000
[   50.497621] RBP: ffffaa2400fcfcd0 R08: 0000000000000000 R09: 0000000000000000
[   50.497622] R10: 0000000000000000 R11: 0000000000000000 R12: ffff99b2105242d8
[   50.497622] R13: 0000000000000000 R14: ffff99b210500000 R15: ffff99b210500000
[   50.497623] FS:  0000000000000000(0000) GS:ffff99b518480000(0000) knlGS:0000000000000000
[   50.497623] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   50.497624] CR2: 00007f9d32aa91e8 CR3: 00000001ba210000 CR4: 0000000000750ee0
[   50.497624] PKRU: 55555554
[   50.497625] Call Trace:
[   50.497625]  <TASK>
[   50.497627]  jpeg_v4_0_hw_fini+0x43/0xc0 [amdgpu]
[   50.497693]  jpeg_v4_0_suspend+0x13/0x30 [amdgpu]
[   50.497751]  amdgpu_device_ip_suspend_phase2+0x240/0x470 [amdgpu]
[   50.497802]  amdgpu_device_ip_suspend+0x41/0x80 [amdgpu]
[   50.497854]  amdgpu_device_pre_asic_reset+0xd9/0x4a0 [amdgpu]
[   50.497905]  amdgpu_device_gpu_recover.cold+0x548/0xcf1 [amdgpu]
[   50.498005]  amdgpu_debugfs_reset_work+0x4c/0x80 [amdgpu]
[   50.498060]  process_one_work+0x21f/0x400
[   50.498063]  worker_thread+0x200/0x3f0
[   50.498064]  ? process_one_work+0x400/0x400
[   50.498065]  kthread+0xee/0x120
[   50.498067]  ? kthread_complete_and_exit+0x20/0x20
[   50.498068]  ret_from_fork+0x22/0x30

	Suggested-by: Hawking Zhang <Hawking.Zhang@amd.com>
	Signed-off-by: Horatio Zhang <Hongkun.Zhang@amd.com>
	Reviewed-by: Tao Zhou <tao.zhou1@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit bc3e1d60f933f823599376f830eb99451afb995a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c
diff --cc drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c
index 3129094baccc,a3d83c9f2c9a..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c
@@@ -181,12 -197,13 +181,22 @@@ static int jpeg_v4_0_hw_fini(void *hand
  	struct amdgpu_device *adev = (struct amdgpu_device *)handle;
  
  	cancel_delayed_work_sync(&adev->vcn.idle_work);
++<<<<<<< HEAD
 +
 +	if (adev->jpeg.cur_state != AMD_PG_STATE_GATE &&
 +	      RREG32_SOC15(JPEG, 0, regUVD_JRBC_STATUS))
 +		jpeg_v4_0_set_powergating_state(adev, AMD_PG_STATE_GATE);
 +
 +	amdgpu_irq_put(adev, &adev->jpeg.inst->irq, 0);
++=======
+ 	if (!amdgpu_sriov_vf(adev)) {
+ 		if (adev->jpeg.cur_state != AMD_PG_STATE_GATE &&
+ 			RREG32_SOC15(JPEG, 0, regUVD_JRBC_STATUS))
+ 			jpeg_v4_0_set_powergating_state(adev, AMD_PG_STATE_GATE);
+ 	}
+ 	if (amdgpu_ras_is_supported(adev, AMDGPU_RAS_BLOCK__JPEG))
+ 		amdgpu_irq_put(adev, &adev->jpeg.inst->ras_poison_irq, 0);
++>>>>>>> bc3e1d60f933 (drm/amdgpu: add RAS POISON interrupt funcs for jpeg_v4_0)
  
  	return 0;
  }
* Unmerged path drivers/gpu/drm/amd/amdgpu/jpeg_v4_0.c
