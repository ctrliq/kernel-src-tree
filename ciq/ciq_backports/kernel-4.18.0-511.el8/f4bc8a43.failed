Revert "drm/amd/display: reallocate DET for dual displays with high pixel rate ratio"

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-511.el8
commit-author Samson Tam <samson.tam@amd.com>
commit f4bc8a43069c6268a49f064fdbf85ead5cc2bf04
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-511.el8/f4bc8a43.failed

Revert commit 5f3401eeb064 ("drm/amd/display: reallocate DET for dual displays with high pixel rate ratio")

[Why]
Previously had modified DET allocation algorithm to allocate less DET
segments for lower pixel rate display and more DET segments for higher
pixel rate display.  But noticed it is causing underflow when higher
pixel rate display is not displaying at higher mode

[How]
Roll back change

	Acked-by: Stylon Wang <stylon.wang@amd.com>
	Signed-off-by: Samson Tam <samson.tam@amd.com>
	Reviewed-by: Alvin Lee <Alvin.Lee2@amd.com>
	Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
(cherry picked from commit f4bc8a43069c6268a49f064fdbf85ead5cc2bf04)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/display/dc/dcn32/dcn32_resource_helpers.c
diff --cc drivers/gpu/drm/amd/display/dc/dcn32/dcn32_resource_helpers.c
index 8310bcf65172,4882c3684b82..000000000000
--- a/drivers/gpu/drm/amd/display/dc/dcn32/dcn32_resource_helpers.c
+++ b/drivers/gpu/drm/amd/display/dc/dcn32/dcn32_resource_helpers.c
@@@ -261,11 -255,8 +261,9 @@@ bool dcn32_is_psr_capable(struct pipe_c
  	return psr_capable;
  }
  
- #define DCN3_2_NEW_DET_OVERRIDE_MIN_MULTIPLIER 7
- 
  /**
 - * dcn32_determine_det_override(): Determine DET allocation for each pipe
 + * *******************************************************************************************
 + * dcn32_determine_det_override: Determine DET allocation for each pipe
   *
   * This function determines how much DET to allocate for each pipe. The total number of
   * DET segments will be split equally among each of the streams, and after that the DET
@@@ -281,18 -273,6 +280,21 @@@
   *    among those pipes.
   * 4. Assign the DET override to the DML pipes.
   *
++<<<<<<< HEAD
 + * Special cases:
 + *
 + * For two displays that have a large difference in pixel rate, we may experience
 + *  underflow on the larger display when we divide the DET equally. For this, we
 + *  will implement a modified algorithm to assign more DET to larger display.
 + *
 + * 1. Calculate difference in pixel rates ( multiplier ) between two displays
 + * 2. If the multiplier exceeds DCN3_2_NEW_DET_OVERRIDE_MIN_MULTIPLIER, then
 + *    implement the modified DET override algorithm.
 + * 3. Assign smaller DET size for lower pixel display and higher DET size for
 + *    higher pixel display
 + *
++=======
++>>>>>>> f4bc8a43069c (Revert "drm/amd/display: reallocate DET for dual displays with high pixel rate ratio")
   * @param [in]: dc: Current DC state
   * @param [in]: context: New DC state to be programmed
   * @param [in]: pipes: Array of DML pipes
@@@ -312,31 -290,10 +314,29 @@@ void dcn32_determine_det_override(struc
  	struct dc_plane_state *current_plane = NULL;
  	uint8_t stream_count = 0;
  
- 	int phy_pix_clk_mult, lower_mode_stream_index;
- 	int phy_pix_clk[MAX_PIPES] = {0};
- 	bool use_new_det_override_algorithm = false;
- 
  	for (i = 0; i < context->stream_count; i++) {
  		/* Don't count SubVP streams for DET allocation */
- 		if (context->streams[i]->mall_stream_config.type != SUBVP_PHANTOM) {
- 			phy_pix_clk[i] = context->streams[i]->phy_pix_clk;
+ 		if (context->streams[i]->mall_stream_config.type != SUBVP_PHANTOM)
  			stream_count++;
++<<<<<<< HEAD
 +		}
 +	}
 +
 +	/* Check for special case with two displays, one with much higher pixel rate */
 +	if (stream_count == 2) {
 +		ASSERT(!phy_pix_clk[0] || !phy_pix_clk[1]);
 +		if (phy_pix_clk[0] < phy_pix_clk[1]) {
 +			lower_mode_stream_index = 0;
 +			phy_pix_clk_mult = phy_pix_clk[1] / phy_pix_clk[0];
 +		} else {
 +			lower_mode_stream_index = 1;
 +			phy_pix_clk_mult = phy_pix_clk[0] / phy_pix_clk[1];
 +		}
 +
 +		if (phy_pix_clk_mult >= DCN3_2_NEW_DET_OVERRIDE_MIN_MULTIPLIER)
 +			use_new_det_override_algorithm = true;
++=======
++>>>>>>> f4bc8a43069c (Revert "drm/amd/display: reallocate DET for dual displays with high pixel rate ratio")
  	}
  
  	if (stream_count > 0) {
* Unmerged path drivers/gpu/drm/amd/display/dc/dcn32/dcn32_resource_helpers.c
