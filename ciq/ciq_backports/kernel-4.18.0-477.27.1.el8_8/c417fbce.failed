kbuild: move bin2c back to scripts/ from scripts/basic/

jira LE-1907
cve CVE-2023-20593
Rebuild_History Non-Buildable kernel-4.18.0-477.27.1.el8_8
commit-author Masahiro Yamada <yamada.masahiro@socionext.com>
commit c417fbce98722ad7e384caa8ba6f2e7c5f8672d9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-477.27.1.el8_8/c417fbce.failed

Commit 8370edea81e3 ("bin2c: move bin2c in scripts/basic") moved bin2c
to the scripts/basic/ directory, incorrectly stating "Kexec wants to
use bin2c and it wants to use it really early in the build process.
See arch/x86/purgatory/ code in later patches."

Commit bdab125c9301 ("Revert "kexec/purgatory: Add clean-up for
purgatory directory"") and commit d6605b6bbee8 ("x86/build: Remove
unnecessary preparation for purgatory") removed the redundant
purgatory build magic entirely.

That means that the move of bin2c was unnecessary in the first place.

fixdep is the only host program that deserves to sit in the
scripts/basic/ directory.

	Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
(cherry picked from commit c417fbce98722ad7e384caa8ba6f2e7c5f8672d9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/s390/purgatory/Makefile
diff --cc arch/s390/purgatory/Makefile
index 20dc217576d2,445c4603ce02..000000000000
--- a/arch/s390/purgatory/Makefile
+++ b/arch/s390/purgatory/Makefile
@@@ -23,22 -19,18 +23,27 @@@ KASAN_SANITIZE := 
  KBUILD_CFLAGS := -fno-strict-aliasing -Wall -Wstrict-prototypes
  KBUILD_CFLAGS += -Wno-pointer-sign -Wno-sign-compare
  KBUILD_CFLAGS += -fno-zero-initialized-in-bss -fno-builtin -ffreestanding
 -KBUILD_CFLAGS += -c -MD -Os -m64 -msoft-float
 +KBUILD_CFLAGS += -c -MD -Os -m64 -msoft-float -fno-common
  KBUILD_CFLAGS += $(call cc-option,-fno-PIE)
 +KBUILD_AFLAGS := $(filter-out -DCC_USING_EXPOLINE,$(KBUILD_AFLAGS))
  
 -$(obj)/purgatory.ro: $(PURGATORY_OBJS) FORCE
 +LDFLAGS_purgatory := -r --no-undefined -nostdlib -z nodefaultlib -T
 +$(obj)/purgatory: $(obj)/purgatory.lds $(PURGATORY_OBJS) FORCE
  		$(call if_changed,ld)
  
++<<<<<<< HEAD
 +OBJCOPYFLAGS_purgatory.ro := -O elf64-s390
 +OBJCOPYFLAGS_purgatory.ro += --remove-section='*debug*'
 +OBJCOPYFLAGS_purgatory.ro += --remove-section='.comment'
 +OBJCOPYFLAGS_purgatory.ro += --remove-section='.note.*'
 +$(obj)/purgatory.ro: $(obj)/purgatory FORCE
 +		$(call if_changed,objcopy)
++=======
+ quiet_cmd_bin2c = BIN2C   $@
+       cmd_bin2c = $(objtree)/scripts/bin2c kexec_purgatory < $< > $@
++>>>>>>> c417fbce9872 (kbuild: move bin2c back to scripts/ from scripts/basic/)
  
 -$(obj)/kexec-purgatory.c: $(obj)/purgatory.ro FORCE
 -	$(call if_changed,bin2c)
 +$(obj)/kexec-purgatory.o: $(obj)/kexec-purgatory.S $(obj)/purgatory.ro FORCE
 +	$(call if_changed_rule,as_o_S)
  
  obj-$(CONFIG_ARCH_HAS_KEXEC_PURGATORY) += kexec-purgatory.o
diff --git a/arch/powerpc/purgatory/Makefile b/arch/powerpc/purgatory/Makefile
index 1289be89cd5b..7d23ce36c8a7 100644
--- a/arch/powerpc/purgatory/Makefile
+++ b/arch/powerpc/purgatory/Makefile
@@ -6,9 +6,8 @@ LDFLAGS_purgatory.ro := -e purgatory_start -r --no-undefined
 $(obj)/purgatory.ro: $(obj)/trampoline_$(BITS).o FORCE
 		$(call if_changed,ld)
 
-CMD_BIN2C = $(objtree)/scripts/basic/bin2c
 quiet_cmd_bin2c = BIN2C   $@
-      cmd_bin2c = $(CMD_BIN2C) kexec_purgatory < $< > $@
+      cmd_bin2c = $(objtree)/scripts/bin2c kexec_purgatory < $< > $@
 
 $(obj)/kexec-purgatory.c: $(obj)/purgatory.ro FORCE
 	$(call if_changed,bin2c)
* Unmerged path arch/s390/purgatory/Makefile
diff --git a/arch/x86/purgatory/Makefile b/arch/x86/purgatory/Makefile
index 7bd26499c243..332481bdd120 100644
--- a/arch/x86/purgatory/Makefile
+++ b/arch/x86/purgatory/Makefile
@@ -46,9 +46,8 @@ $(obj)/purgatory.chk: $(obj)/purgatory.ro FORCE
 
 targets += kexec-purgatory.c
 
-CMD_BIN2C = $(objtree)/scripts/basic/bin2c
 quiet_cmd_bin2c = BIN2C   $@
-      cmd_bin2c = $(CMD_BIN2C) kexec_purgatory < $< > $@
+      cmd_bin2c = $(objtree)/scripts/bin2c kexec_purgatory < $< > $@
 
 $(obj)/kexec-purgatory.c: $(obj)/purgatory.ro $(obj)/purgatory.chk FORCE
 	$(call if_changed,bin2c)
diff --git a/kernel/Makefile b/kernel/Makefile
index 74eec1255a60..75d271bbd496 100644
--- a/kernel/Makefile
+++ b/kernel/Makefile
@@ -133,7 +133,7 @@ targets += config_data.gz
 $(obj)/config_data.gz: $(KCONFIG_CONFIG) FORCE
 	$(call if_changed,gzip)
 
-      filechk_ikconfiggz = (echo "static const char kernel_config_data[] __used = MAGIC_START"; cat $< | scripts/basic/bin2c; echo "MAGIC_END;")
+      filechk_ikconfiggz = (echo "static const char kernel_config_data[] __used = MAGIC_START"; cat $< | scripts/bin2c; echo "MAGIC_END;")
 targets += config_data.h
 $(obj)/config_data.h: $(obj)/config_data.gz FORCE
 	$(call filechk,ikconfiggz)
diff --git a/scripts/.gitignore b/scripts/.gitignore
index 0442c06eefcb..12d302d70128 100644
--- a/scripts/.gitignore
+++ b/scripts/.gitignore
@@ -1,6 +1,7 @@
 #
 # Generated files
 #
+bin2c
 conmakehash
 kallsyms
 pnmtologo
diff --git a/scripts/Makefile b/scripts/Makefile
index 77c371b9e295..575f42316725 100644
--- a/scripts/Makefile
+++ b/scripts/Makefile
@@ -10,6 +10,7 @@
 
 HOST_EXTRACFLAGS += -I$(srctree)/tools/include
 
+hostprogs-$(CONFIG_BUILD_BIN2C)  += bin2c
 hostprogs-$(CONFIG_KALLSYMS)     += kallsyms
 hostprogs-$(CONFIG_LOGO)         += pnmtologo
 hostprogs-$(CONFIG_VT)           += conmakehash
diff --git a/scripts/basic/.gitignore b/scripts/basic/.gitignore
index 9528ec9e5adc..a776371a3502 100644
--- a/scripts/basic/.gitignore
+++ b/scripts/basic/.gitignore
@@ -1,2 +1 @@
 fixdep
-bin2c
diff --git a/scripts/basic/Makefile b/scripts/basic/Makefile
index 0372b33febe5..af49b446f17d 100644
--- a/scripts/basic/Makefile
+++ b/scripts/basic/Makefile
@@ -9,7 +9,6 @@
 # fixdep: 	 Used to generate dependency information during build process
 
 hostprogs-y	:= fixdep
-hostprogs-$(CONFIG_BUILD_BIN2C)     += bin2c
 always		:= $(hostprogs-y)
 
 # fixdep is needed to compile other host programs
diff --git a/scripts/basic/bin2c.c b/scripts/bin2c.c
similarity index 100%
rename from scripts/basic/bin2c.c
rename to scripts/bin2c.c
diff --git a/security/tomoyo/Makefile b/security/tomoyo/Makefile
index b7c6a7ffc058..cca5a3012fee 100644
--- a/security/tomoyo/Makefile
+++ b/security/tomoyo/Makefile
@@ -4,7 +4,7 @@ obj-y = audit.o common.o condition.o domain.o environ.o file.o gc.o group.o load
 targets += builtin-policy.h
 define do_policy
 echo "static char tomoyo_builtin_$(1)[] __initdata ="; \
-$(objtree)/scripts/basic/bin2c <$(firstword $(wildcard $(obj)/policy/$(1).conf $(srctree)/$(src)/policy/$(1).conf.default) /dev/null); \
+$(objtree)/scripts/bin2c <$(firstword $(wildcard $(obj)/policy/$(1).conf $(srctree)/$(src)/policy/$(1).conf.default) /dev/null); \
 echo ";"
 endef
 quiet_cmd_policy  = POLICY  $@
