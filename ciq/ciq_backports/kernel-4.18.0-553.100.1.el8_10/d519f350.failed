tcp: minor optimization in tcp_add_backlog()

jira KERNEL-579
cve CVE-2022-50865
Rebuild_History Non-Buildable kernel-4.18.0-553.100.1.el8_10
commit-author Eric Dumazet <edumazet@google.com>
commit d519f350967a60b85a574ad8aeac43f2b4384746
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.100.1.el8_10/d519f350.failed

If packet is going to be coalesced, sk_sndbuf/sk_rcvbuf values
are not used. Defer their access to the point we need them.

	Signed-off-by: Eric Dumazet <edumazet@google.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit d519f350967a60b85a574ad8aeac43f2b4384746)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/ipv4/tcp_ipv4.c
diff --cc net/ipv4/tcp_ipv4.c
index 6e5d755f14b4,82a9e1b75405..000000000000
--- a/net/ipv4/tcp_ipv4.c
+++ b/net/ipv4/tcp_ipv4.c
@@@ -1654,11 -1798,9 +1654,15 @@@ int tcp_v4_early_demux(struct sk_buff *
  	return 0;
  }
  
 -bool tcp_add_backlog(struct sock *sk, struct sk_buff *skb)
 +bool tcp_add_backlog(struct sock *sk, struct sk_buff *skb,
 +		     enum skb_drop_reason *reason)
  {
++<<<<<<< HEAD
 +	u32 limit = sk->sk_rcvbuf + sk->sk_sndbuf;
 +	u32 tail_gso_size, tail_gso_segs;
++=======
+ 	u32 limit, tail_gso_size, tail_gso_segs;
++>>>>>>> d519f350967a (tcp: minor optimization in tcp_add_backlog())
  	struct skb_shared_info *shinfo;
  	const struct tcphdr *th;
  	struct tcphdr *thtail;
* Unmerged path net/ipv4/tcp_ipv4.c
