scsi: mpi3mr: Return error if dma_alloc_coherent() fails

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Dan Carpenter <dan.carpenter@oracle.com>
commit bc7896d31a922ee9caabb10dc07509f65d41dc0e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/bc7896d3.failed

Return -ENOMEM instead of success if dma_alloc_coherent() fails.

Link: https://lore.kernel.org/r/YnOmMGHqCOtUCYQ1@kili
Fixes: 43ca11005098 ("scsi: mpi3mr: Add support for PEL commands")
	Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit bc7896d31a922ee9caabb10dc07509f65d41dc0e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/mpi3mr/mpi3mr_fw.c
diff --cc drivers/scsi/mpi3mr/mpi3mr_fw.c
index dd27bae528b9,f1d4ea8ba989..000000000000
--- a/drivers/scsi/mpi3mr/mpi3mr_fw.c
+++ b/drivers/scsi/mpi3mr/mpi3mr_fw.c
@@@ -3592,6 -3748,18 +3592,21 @@@ retry_init
  		goto out_failed;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (!mrioc->pel_seqnum_virt) {
+ 		dprint_init(mrioc, "allocating memory for pel_seqnum_virt\n");
+ 		mrioc->pel_seqnum_sz = sizeof(struct mpi3_pel_seq);
+ 		mrioc->pel_seqnum_virt = dma_alloc_coherent(&mrioc->pdev->dev,
+ 		    mrioc->pel_seqnum_sz, &mrioc->pel_seqnum_dma,
+ 		    GFP_KERNEL);
+ 		if (!mrioc->pel_seqnum_virt) {
+ 			retval = -ENOMEM;
+ 			goto out_failed_noretry;
+ 		}
+ 	}
+ 
++>>>>>>> bc7896d31a92 (scsi: mpi3mr: Return error if dma_alloc_coherent() fails)
  	retval = mpi3mr_enable_events(mrioc);
  	if (retval) {
  		ioc_err(mrioc, "failed to enable events %d\n",
@@@ -3701,9 -3869,21 +3716,24 @@@ retry_init
  		goto out_failed;
  	}
  
++<<<<<<< HEAD
++=======
+ 	if (!mrioc->pel_seqnum_virt) {
+ 		dprint_reset(mrioc, "allocating memory for pel_seqnum_virt\n");
+ 		mrioc->pel_seqnum_sz = sizeof(struct mpi3_pel_seq);
+ 		mrioc->pel_seqnum_virt = dma_alloc_coherent(&mrioc->pdev->dev,
+ 		    mrioc->pel_seqnum_sz, &mrioc->pel_seqnum_dma,
+ 		    GFP_KERNEL);
+ 		if (!mrioc->pel_seqnum_virt) {
+ 			retval = -ENOMEM;
+ 			goto out_failed_noretry;
+ 		}
+ 	}
+ 
++>>>>>>> bc7896d31a92 (scsi: mpi3mr: Return error if dma_alloc_coherent() fails)
  	if (mrioc->shost->nr_hw_queues > mrioc->num_op_reply_q) {
  		ioc_err(mrioc,
 -		    "cannot create minimum number of operational queues expected:%d created:%d\n",
 +		    "cannot create minimum number of operatioanl queues expected:%d created:%d\n",
  		    mrioc->shost->nr_hw_queues, mrioc->num_op_reply_q);
  		goto out_failed_noretry;
  	}
* Unmerged path drivers/scsi/mpi3mr/mpi3mr_fw.c
