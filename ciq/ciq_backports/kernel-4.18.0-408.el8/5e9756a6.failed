s390/qeth: simplify qeth_receive_skb()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Julian Wiedmann <jwi@linux.ibm.com>
commit 5e9756a66fb5741f46b9c1d9ad50e4e57c8d6816
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/5e9756a6.failed

Now that the OSN code is gone, we don't need the second switch statement
in the RX path. And getting rid of its (unreachable) default case is a
nice simplification.

Also don't pass in the full HW header, all we still need is a flag to
indicate whether the skb can use CSO. This we can already obtain during
the first peek at the HW header.

	Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
	Reviewed-by: Alexandra Winter <wintera@linux.ibm.com>
	Reviewed-by: Wenjia Zhang <wenjia@linux.ibm.com>
	Signed-off-by: Alexandra Winter <wintera@linux.ibm.com>
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit 5e9756a66fb5741f46b9c1d9ad50e4e57c8d6816)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/net/qeth_core_main.c
diff --cc drivers/s390/net/qeth_core_main.c
index 97d4bb154094,629a7f5c4d71..000000000000
--- a/drivers/s390/net/qeth_core_main.c
+++ b/drivers/s390/net/qeth_core_main.c
@@@ -5603,37 -5575,9 +5603,40 @@@ static void qeth_l3_rebuild_skb(struct 
  #endif
  
  static void qeth_receive_skb(struct qeth_card *card, struct sk_buff *skb,
- 			     struct qeth_hdr *hdr, bool uses_frags)
+ 			     bool uses_frags, bool is_cso)
  {
  	struct napi_struct *napi = &card->napi;
++<<<<<<< HEAD
 +	bool is_cso;
 +
 +	switch (hdr->hdr.l2.id) {
 +	case QETH_HEADER_TYPE_OSN:
 +		skb_push(skb, sizeof(*hdr));
 +		skb_copy_to_linear_data(skb, hdr, sizeof(*hdr));
 +		QETH_CARD_STAT_ADD(card, rx_bytes, skb->len);
 +		QETH_CARD_STAT_INC(card, rx_packets);
 +
 +		card->osn_info.data_cb(skb);
 +		return;
 +#if IS_ENABLED(CONFIG_QETH_L3)
 +	case QETH_HEADER_TYPE_LAYER3:
 +		qeth_l3_rebuild_skb(card, skb, hdr);
 +		is_cso = hdr->hdr.l3.ext_flags & QETH_HDR_EXT_CSUM_TRANSP_REQ;
 +		break;
 +#endif
 +	case QETH_HEADER_TYPE_LAYER2:
 +		is_cso = hdr->hdr.l2.flags[1] & QETH_HDR_EXT_CSUM_TRANSP_REQ;
 +		break;
 +	default:
 +		/* never happens */
 +		if (uses_frags)
 +			napi_free_frags(napi);
 +		else
 +			kfree_skb(skb);
 +		return;
 +	}
++=======
++>>>>>>> 5e9756a66fb5 (s390/qeth: simplify qeth_receive_skb())
  
  	if (is_cso && (card->dev->features & NETIF_F_RXCSUM)) {
  		skb->ip_summed = CHECKSUM_UNNECESSARY;
* Unmerged path drivers/s390/net/qeth_core_main.c
