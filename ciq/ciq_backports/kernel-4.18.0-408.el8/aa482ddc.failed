drm/amdgpu: vi: disable ASPM on Intel Alder Lake based systems

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Richard Gong <richard.gong@amd.com>
commit aa482ddca85a3485be0e7b83a0789dc4d987670b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/aa482ddc.failed

Active State Power Management (ASPM) feature is enabled since kernel 5.14.
There are some AMD Volcanic Islands (VI) GFX cards, such as the WX3200 and
RX640, that do not work with ASPM-enabled Intel Alder Lake based systems.
Using these GFX cards as video/display output, Intel Alder Lake based
systems will freeze after suspend/resume.

The issue was originally reported on one system (Dell Precision 3660 with
BIOS version 0.14.81), but was later confirmed to affect at least 4
pre-production Alder Lake based systems.

Add an extra check to disable ASPM on Intel Alder Lake based systems with
the problematic AMD Volcanic Islands GFX cards.

Fixes: 0064b0ce85bb ("drm/amd/pm: enable ASPM by default")
Link: https://gitlab.freedesktop.org/drm/amd/-/issues/1885
	Signed-off-by: Richard Gong <richard.gong@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit aa482ddca85a3485be0e7b83a0789dc4d987670b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/vi.c
diff --cc drivers/gpu/drm/amd/amdgpu/vi.c
index 3d21c0799037,45f0188c4273..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/vi.c
+++ b/drivers/gpu/drm/amd/amdgpu/vi.c
@@@ -1136,7 -1155,7 +1151,11 @@@ static void vi_program_aspm(struct amdg
  	bool bL1SS = false;
  	bool bClkReqSupport = true;
  
++<<<<<<< HEAD
 +	if (!amdgpu_aspm)
++=======
+ 	if (!amdgpu_device_should_use_aspm(adev) || !aspm_support_quirk_check())
++>>>>>>> aa482ddca85a (drm/amdgpu: vi: disable ASPM on Intel Alder Lake based systems)
  		return;
  
  	if (adev->flags & AMD_IS_APU ||
* Unmerged path drivers/gpu/drm/amd/amdgpu/vi.c
