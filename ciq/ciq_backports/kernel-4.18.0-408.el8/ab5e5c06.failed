netfilter: nf_tables: use kfree_rcu(ptr, rcu) to release hooks in clean_net path

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Pablo Neira Ayuso <pablo@netfilter.org>
commit ab5e5c062f67c5ae8cd07f0632ffa62dc0e7d169
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/ab5e5c06.failed

Use kfree_rcu(ptr, rcu) variant instead as described by ae089831ff28
("netfilter: nf_tables: prefer kfree_rcu(ptr, rcu) variant").

Fixes: f9a43007d3f7 ("netfilter: nf_tables: double hook unregistration in netns path")
	Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
(cherry picked from commit ab5e5c062f67c5ae8cd07f0632ffa62dc0e7d169)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/netfilter/nf_tables_api.c
diff --cc net/netfilter/nf_tables_api.c
index 89cd36631acc,129d3ebd6ce5..000000000000
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@@ -6555,13 -7322,25 +6555,31 @@@ static void nft_unregister_flowtable_ho
  				    FLOW_BLOCK_UNBIND);
  }
  
++<<<<<<< HEAD
++=======
+ static void __nft_unregister_flowtable_net_hooks(struct net *net,
+ 						 struct list_head *hook_list,
+ 					         bool release_netdev)
+ {
+ 	struct nft_hook *hook, *next;
+ 
+ 	list_for_each_entry_safe(hook, next, hook_list, list) {
+ 		nf_unregister_net_hook(net, &hook->ops);
+ 		if (release_netdev) {
+ 			list_del(&hook->list);
+ 			kfree_rcu(hook, rcu);
+ 		}
+ 	}
+ }
+ 
++>>>>>>> ab5e5c062f67 (netfilter: nf_tables: use kfree_rcu(ptr, rcu) to release hooks in clean_net path)
  static void nft_unregister_flowtable_net_hooks(struct net *net,
 -					       struct list_head *hook_list)
 +					       struct nft_flowtable *flowtable)
  {
 -	__nft_unregister_flowtable_net_hooks(net, hook_list, false);
 +	struct nft_hook *hook;
 +
 +	list_for_each_entry(hook, &flowtable->hook_list, list)
 +		nf_unregister_net_hook(net, &hook->ops);
  }
  
  static int nft_register_flowtable_net_hooks(struct net *net,
* Unmerged path net/netfilter/nf_tables_api.c
