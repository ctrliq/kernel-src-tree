s390/zcrypt: change reply buffer size offering

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Harald Freudenberger <freude@linux.ibm.com>
commit 252a1ff777639ad13978a614f2cde1f0c43a7c2f
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/252a1ff7.failed

Instead of offering the user space given receive buffer size to
the crypto card firmware as limit for the reply message offer
the internal per queue reply buffer size. As the queue's reply
buffer is always adjusted to the max message size possible for
this card this may offer more buffer space. However, now it is
important to check the user space reply buffer on pushing back
the reply. If the reply does not fit into the user space provided
buffer the ioctl will fail with errno EMSGSIZE.

	Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
	Reviewed-by: JÃ¼rgen Christ <jchrist@linux.ibm.com>
	Signed-off-by: Vasily Gorbik <gor@linux.ibm.com>
(cherry picked from commit 252a1ff777639ad13978a614f2cde1f0c43a7c2f)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/s390/crypto/zcrypt_msgtype6.c
diff --cc drivers/s390/crypto/zcrypt_msgtype6.c
index ac841d50e557,be3f46a014f4..000000000000
--- a/drivers/s390/crypto/zcrypt_msgtype6.c
+++ b/drivers/s390/crypto/zcrypt_msgtype6.c
@@@ -1249,8 -1292,7 +1264,12 @@@ static long zcrypt_msgtype6_send_ep11_c
  		unsigned int	dom_val;	/* domain id	   */
  	} __packed * payload_hdr = NULL;
  
++<<<<<<< HEAD
 +
 +	/**
++=======
+ 	/*
++>>>>>>> 252a1ff77763 (s390/zcrypt: change reply buffer size offering)
  	 * The target domain field within the cprb body/payload block will be
  	 * replaced by the usage domain for non-management commands only.
  	 * Therefore we check the first bit of the 'flags' parameter for
* Unmerged path drivers/s390/crypto/zcrypt_msgtype6.c
