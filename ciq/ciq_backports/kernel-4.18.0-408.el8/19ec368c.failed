selftests/vm: fix out-of-tree build

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Rong Chen <rong.a.chen@intel.com>
commit 19ec368cbc7ee1915e78c120b7a49c7f14734192
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/19ec368c.failed

When building out-of-tree, attempting to make target from $(OUTPUT) directory:

  make[1]: *** No rule to make target '$(OUTPUT)/protection_keys.c', needed by '$(OUTPUT)/protection_keys_32'.

Link: https://lkml.kernel.org/r/20210315094700.522753-1-rong.a.chen@intel.com
	Signed-off-by: Rong Chen <rong.a.chen@intel.com>
	Reported-by: kernel test robot <lkp@intel.com>
	Cc: Shuah Khan <shuah@kernel.org>
	Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
	Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
(cherry picked from commit 19ec368cbc7ee1915e78c120b7a49c7f14734192)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/vm/Makefile
diff --cc tools/testing/selftests/vm/Makefile
index af96f445fd87,8b0cd421ebd3..000000000000
--- a/tools/testing/selftests/vm/Makefile
+++ b/tools/testing/selftests/vm/Makefile
@@@ -45,6 -84,74 +45,57 @@@ TEST_FILES := test_vmalloc.s
  KSFT_KHDR_INSTALL := 1
  include ../lib.mk
  
++<<<<<<< HEAD
 +$(OUTPUT)/userfaultfd: LDLIBS += -lpthread
++=======
+ ifeq ($(MACHINE),x86_64)
+ BINARIES_32 := $(patsubst %,$(OUTPUT)/%,$(BINARIES_32))
+ BINARIES_64 := $(patsubst %,$(OUTPUT)/%,$(BINARIES_64))
+ 
+ define gen-target-rule-32
+ $(1) $(1)_32: $(OUTPUT)/$(1)_32
+ .PHONY: $(1) $(1)_32
+ endef
+ 
+ define gen-target-rule-64
+ $(1) $(1)_64: $(OUTPUT)/$(1)_64
+ .PHONY: $(1) $(1)_64
+ endef
+ 
+ ifeq ($(CAN_BUILD_I386),1)
+ $(BINARIES_32): CFLAGS += -m32
+ $(BINARIES_32): LDLIBS += -lrt -ldl -lm
+ $(BINARIES_32): $(OUTPUT)/%_32: %.c
+ 	$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(notdir $^) $(LDLIBS) -o $@
+ $(foreach t,$(TARGETS),$(eval $(call gen-target-rule-32,$(t))))
+ endif
+ 
+ ifeq ($(CAN_BUILD_X86_64),1)
+ $(BINARIES_64): CFLAGS += -m64
+ $(BINARIES_64): LDLIBS += -lrt -ldl
+ $(BINARIES_64): $(OUTPUT)/%_64: %.c
+ 	$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(notdir $^) $(LDLIBS) -o $@
+ $(foreach t,$(TARGETS),$(eval $(call gen-target-rule-64,$(t))))
+ endif
+ 
+ # x86_64 users should be encouraged to install 32-bit libraries
+ ifeq ($(CAN_BUILD_I386)$(CAN_BUILD_X86_64),01)
+ all: warn_32bit_failure
+ 
+ warn_32bit_failure:
+ 	@echo "Warning: you seem to have a broken 32-bit build" 2>&1;		\
+ 	echo  "environment. This will reduce test coverage of 64-bit" 2>&1;	\
+ 	echo  "kernels. If you are using a Debian-like distribution," 2>&1;	\
+ 	echo  "try:"; 2>&1;							\
+ 	echo  "";								\
+ 	echo  "  apt-get install gcc-multilib libc6-i386 libc6-dev-i386";	\
+ 	echo  "";								\
+ 	echo  "If you are using a Fedora-like distribution, try:";		\
+ 	echo  "";								\
+ 	echo  "  yum install glibc-devel.*i686";				\
+ 	exit 0;
+ endif
+ endif
++>>>>>>> 19ec368cbc7e (selftests/vm: fix out-of-tree build)
  
  $(OUTPUT)/mlock-random-test: LDLIBS += -lcap
 -
 -$(OUTPUT)/gup_test: ../../../../mm/gup_test.h
 -
 -$(OUTPUT)/hmm-tests: local_config.h
 -
 -# HMM_EXTRA_LIBS may get set in local_config.mk, or it may be left empty.
 -$(OUTPUT)/hmm-tests: LDLIBS += $(HMM_EXTRA_LIBS)
 -
 -local_config.mk local_config.h: check_config.sh
 -	/bin/sh ./check_config.sh $(CC)
 -
 -EXTRA_CLEAN += local_config.mk local_config.h
 -
 -ifeq ($(HMM_EXTRA_LIBS),)
 -all: warn_missing_hugelibs
 -
 -warn_missing_hugelibs:
 -	@echo ; \
 -	echo "Warning: missing libhugetlbfs support. Some HMM tests will be skipped." ; \
 -	echo
 -endif
* Unmerged path tools/testing/selftests/vm/Makefile
