thermal: intel: hfi: Notify user space for HFI events

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
commit bd30cdfd9bd73b68e4977ce7c5540aa7b14c25cd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/bd30cdfd.failed

When the hardware issues an HFI event, relay a notification to user space.
This allows user space to respond by reading performance and efficiency of
each CPU and take appropriate action.

For example, when the performance and efficiency of a CPU is 0, user space
can either offline the CPU or inject idle. Also, if user space notices a
downward trend in performance, it may proactively adjust power limits to
avoid future situations in which performance drops to 0.

To avoid excessive notifications, the rate is limited by one HZ per event.
To limit the netlink message size, send parameters for up to 16 CPUs in a
single message. If there are more than 16 CPUs, issue as many messages as
needed to notify the status of all CPUs.

In the HFI specification, both performance and efficiency capabilities are
defined in the [0, 255] range. The existing implementations of HFI hardware
do not scale the maximum values to 255. Since userspace cares about
capability values that are either 0 or show a downward/upward trend, this
fact does not matter much. Relative changes in capabilities are enough. To
comply with the thermal netlink ABI, scale both performance and efficiency
capabilities to the [0, 1023] interval.

	Reviewed-by: Len Brown <len.brown@intel.com>
	Signed-off-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
	Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
(cherry picked from commit bd30cdfd9bd73b68e4977ce7c5540aa7b14c25cd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/thermal/intel/Kconfig
#	drivers/thermal/intel/intel_hfi.c
diff --cc drivers/thermal/intel/Kconfig
index ba3c1c5fe76d,6cf3fe36a4ae..000000000000
--- a/drivers/thermal/intel/Kconfig
+++ b/drivers/thermal/intel/Kconfig
@@@ -76,3 -79,36 +76,39 @@@ config INTEL_PCH_THERMA
  	  Enable this to support thermal reporting on certain intel PCHs.
  	  Thermal reporting device will provide temperature reading,
  	  programmable trip points and other information.
++<<<<<<< HEAD
++=======
+ 
+ config INTEL_TCC_COOLING
+ 	tristate "Intel TCC offset cooling Driver"
+ 	depends on X86
+ 	help
+ 	  Enable this to support system cooling by adjusting the effective TCC
+ 	  activation temperature via the TCC Offset register, which is widely
+ 	  supported on modern Intel platforms.
+ 	  Note that, on different platforms, the behavior might be different
+ 	  on how fast the setting takes effect, and how much the CPU frequency
+ 	  is reduced.
+ 
+ config INTEL_MENLOW
+ 	tristate "Thermal Management driver for Intel menlow platform"
+ 	depends on ACPI_THERMAL
+ 	help
+ 	  ACPI thermal management enhancement driver on
+ 	  Intel Menlow platform.
+ 
+ 	  If unsure, say N.
+ 
+ config INTEL_HFI_THERMAL
+ 	bool "Intel Hardware Feedback Interface"
+ 	depends on CPU_SUP_INTEL
+ 	depends on X86_THERMAL_VECTOR
+ 	select THERMAL_NETLINK
+ 	help
+ 	  Select this option to enable the Hardware Feedback Interface. If
+ 	  selected, hardware provides guidance to the operating system on
+ 	  the performance and energy efficiency capabilities of each CPU.
+ 	  These capabilities may change as a result of changes in the operating
+ 	  conditions of the system such power and thermal limits. If selected,
+ 	  the kernel relays updates in CPUs' capabilities to userspace.
++>>>>>>> bd30cdfd9bd7 (thermal: intel: hfi: Notify user space for HFI events)
* Unmerged path drivers/thermal/intel/intel_hfi.c
* Unmerged path drivers/thermal/intel/Kconfig
* Unmerged path drivers/thermal/intel/intel_hfi.c
