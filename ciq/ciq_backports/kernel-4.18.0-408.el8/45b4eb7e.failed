Revert "ath10k: drop beacon and probe response which leak from other channel"

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Kalle Valo <quic_kvalo@quicinc.com>
commit 45b4eb7ee6aa1a55a50831b328aa5f46ac3a7187
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/45b4eb7e.failed

This reverts commit 3bf2537ec2e33310b431b53fd84be8833736c256.

I was reported privately that this commit breaks AP and mesh mode on QCA9984
(firmware 10.4-3.9.0.2-00156). So revert the commit to fix the regression.

There was a conflict due to cfg80211 API changes but that was easy to fix.

Fixes: 3bf2537ec2e3 ("ath10k: drop beacon and probe response which leak from other channel")
	Signed-off-by: Kalle Valo <quic_kvalo@quicinc.com>
Link: https://lore.kernel.org/r/20220315155455.20446-1-kvalo@kernel.org
(cherry picked from commit 45b4eb7ee6aa1a55a50831b328aa5f46ac3a7187)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/ath/ath10k/wmi.c
diff --cc drivers/net/wireless/ath/ath10k/wmi.c
index 4733fd7fb169,7c1c2658cb5f..000000000000
--- a/drivers/net/wireless/ath/ath10k/wmi.c
+++ b/drivers/net/wireless/ath/ath10k/wmi.c
@@@ -2611,30 -2611,9 +2611,36 @@@ int ath10k_wmi_event_mgmt_rx(struct ath
  		ath10k_mac_handle_beacon(ar, skb);
  
  	if (ieee80211_is_beacon(hdr->frame_control) ||
++<<<<<<< HEAD
 +	    ieee80211_is_probe_resp(hdr->frame_control)) {
 +		struct ieee80211_mgmt *mgmt = (void *)skb->data;
 +		u8 *ies;
 +		int ies_ch;
 +
 +		status->boottime_ns = ktime_get_boottime_ns();
 +
 +		if (!ar->scan_channel)
 +			goto drop;
 +
 +		ies = mgmt->u.beacon.variable;
 +
 +		ies_ch = cfg80211_get_ies_channel_number(mgmt->u.beacon.variable,
 +							 skb_tail_pointer(skb) - ies,
 +							 sband->band);
 +
 +		if (ies_ch > 0 && ies_ch != channel) {
 +			ath10k_dbg(ar, ATH10K_DBG_MGMT,
 +				   "channel mismatched ds channel %d scan channel %d\n",
 +				   ies_ch, channel);
 +			goto drop;
 +		}
 +	}
 +
++=======
+ 	    ieee80211_is_probe_resp(hdr->frame_control))
+ 		status->boottime_ns = ktime_get_boottime_ns();
+ 
++>>>>>>> 45b4eb7ee6aa (Revert "ath10k: drop beacon and probe response which leak from other channel")
  	ath10k_dbg(ar, ATH10K_DBG_MGMT,
  		   "event mgmt rx skb %pK len %d ftype %02x stype %02x\n",
  		   skb, skb->len,
* Unmerged path drivers/net/wireless/ath/ath10k/wmi.c
