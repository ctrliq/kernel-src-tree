selftests/powerpc/pmu: Add utility functions to post process the mmap buffer

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Kajol Jain <kjain@linux.ibm.com>
commit 5f6c3061af7ca3b0f9f8a20ec7a445671f7e6b5a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/5f6c3061.failed

Add couple of basic utility functions to post process the mmap buffer.
It includes function to read the total number of samples present in the
mmap buffer and function to get the address of the first sample.

Add function "get_intr_regs" which will return pointer to interrupt
registers present in the sample, incase sample type
PERF_SAMPLE_REGS_INTR is set.

Add functions "get_reg_value" which can be used to read any interrupt
register value from a given sample.

	Signed-off-by: Kajol Jain <kjain@linux.ibm.com>
	Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20220127072012.662451-5-kjain@linux.ibm.com

(cherry picked from commit 5f6c3061af7ca3b0f9f8a20ec7a445671f7e6b5a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/powerpc/pmu/sampling_tests/misc.c
#	tools/testing/selftests/powerpc/pmu/sampling_tests/misc.h
diff --cc tools/testing/selftests/powerpc/pmu/sampling_tests/misc.c
index 4779b107f43b,fca054bbc094..000000000000
--- a/tools/testing/selftests/powerpc/pmu/sampling_tests/misc.c
+++ b/tools/testing/selftests/powerpc/pmu/sampling_tests/misc.c
@@@ -1,6 -1,8 +1,11 @@@
  // SPDX-License-Identifier: GPL-2.0-only
  /*
   * Copyright 2022, Athira Rajeev, IBM Corp.
++<<<<<<< HEAD
++=======
+  * Copyright 2022, Madhavan Srinivasan, IBM Corp.
+  * Copyright 2022, Kajol Jain, IBM Corp.
++>>>>>>> 5f6c3061af7c (selftests/powerpc/pmu: Add utility functions to post process the mmap buffer)
   */
  
  #include <unistd.h>
diff --cc tools/testing/selftests/powerpc/pmu/sampling_tests/misc.h
index 291f9adba817,a8d67fcad9ae..000000000000
--- a/tools/testing/selftests/powerpc/pmu/sampling_tests/misc.h
+++ b/tools/testing/selftests/powerpc/pmu/sampling_tests/misc.h
@@@ -1,9 -1,49 +1,17 @@@
  /* SPDX-License-Identifier: GPL-2.0-only */
  /*
   * Copyright 2022, Athira Rajeev, IBM Corp.
++<<<<<<< HEAD
++=======
+  * Copyright 2022, Madhavan Srinivasan, IBM Corp.
+  * Copyright 2022, Kajol Jain, IBM Corp.
++>>>>>>> 5f6c3061af7c (selftests/powerpc/pmu: Add utility functions to post process the mmap buffer)
   */
  
  #include "../event.h"
  
 -#define POWER10 0x80
 -#define POWER9  0x4e
 -#define PERF_POWER9_MASK        0x7f8ffffffffffff
 -#define PERF_POWER10_MASK       0x7ffffffffffffff
 -
 -extern int ev_mask_pmcxsel, ev_shift_pmcxsel;
 -extern int ev_mask_marked, ev_shift_marked;
 -extern int ev_mask_comb, ev_shift_comb;
 -extern int ev_mask_unit, ev_shift_unit;
 -extern int ev_mask_pmc, ev_shift_pmc;
 -extern int ev_mask_cache, ev_shift_cache;
 -extern int ev_mask_sample, ev_shift_sample;
 -extern int ev_mask_thd_sel, ev_shift_thd_sel;
 -extern int ev_mask_thd_start, ev_shift_thd_start;
 -extern int ev_mask_thd_stop, ev_shift_thd_stop;
 -extern int ev_mask_thd_cmp, ev_shift_thd_cmp;
 -extern int ev_mask_sm, ev_shift_sm;
 -extern int ev_mask_rsq, ev_shift_rsq;
 -extern int ev_mask_l2l3, ev_shift_l2l3;
 -extern int ev_mask_mmcr3_src, ev_shift_mmcr3_src;
 -extern int pvr;
 -extern u64 platform_extended_mask;
 -extern int check_pvr_for_sampling_tests(void);
 -
 -/*
 - * Event code field extraction macro.
 - * Raw event code is combination of multiple
 - * fields. Macro to extract individual fields
 - *
 - * x - Raw event code value
 - * y - Field to extract
 - */
 -#define EV_CODE_EXTRACT(x, y)   \
 -	((x >> ev_shift_##y) & ev_mask_##y)
 -
  void *event_sample_buf_mmap(int fd, int mmap_pages);
  void *__event_read_samples(void *sample_buff, size_t *size, u64 *sample_count);
+ int collect_samples(void *sample_buff);
+ u64 *get_intr_regs(struct event *event, void *sample_buff);
+ u64 get_reg_value(u64 *intr_regs, char *register_name);
* Unmerged path tools/testing/selftests/powerpc/pmu/sampling_tests/misc.c
* Unmerged path tools/testing/selftests/powerpc/pmu/sampling_tests/misc.h
