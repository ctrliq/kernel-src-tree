KVM: selftests: Use perf_test_destroy_vm in memslot_modification_stress_test

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author David Matlack <dmatlack@google.com>
commit e2bd936581038f3107c45e8ae32309a567b54bf4
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/e2bd9365.failed

Change memslot_modification_stress_test to use perf_test_destroy_vm
instead of manually calling ucall_uninit and kvm_vm_free.

No functional change intended.

	Signed-off-by: David Matlack <dmatlack@google.com>
	Reviewed-by: Ben Gardon <bgardon@google.com>
Message-Id: <20211111001257.1446428-5-dmatlack@google.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit e2bd936581038f3107c45e8ae32309a567b54bf4)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/memslot_modification_stress_test.c
diff --cc tools/testing/selftests/kvm/memslot_modification_stress_test.c
index 4cfcafea9f5a,1410d0a9141a..000000000000
--- a/tools/testing/selftests/kvm/memslot_modification_stress_test.c
+++ b/tools/testing/selftests/kvm/memslot_modification_stress_test.c
@@@ -131,16 -113,10 +131,20 @@@ static void run_test(enum vm_guest_mod
  
  	run_vcpus = false;
  
 -	perf_test_join_vcpu_threads(nr_vcpus);
 +	/* Wait for the vcpu threads to quit */
 +	for (vcpu_id = 0; vcpu_id < nr_vcpus; vcpu_id++)
 +		pthread_join(vcpu_threads[vcpu_id], NULL);
 +
  	pr_info("All vCPU threads joined\n");
  
++<<<<<<< HEAD
 +	ucall_uninit(vm);
 +	kvm_vm_free(vm);
 +
 +	free(vcpu_threads);
++=======
+ 	perf_test_destroy_vm(vm);
++>>>>>>> e2bd93658103 (KVM: selftests: Use perf_test_destroy_vm in memslot_modification_stress_test)
  }
  
  static void help(char *name)
* Unmerged path tools/testing/selftests/kvm/memslot_modification_stress_test.c
