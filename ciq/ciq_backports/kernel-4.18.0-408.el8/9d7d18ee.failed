KVM: x86: Use "new" memslot instead of userspace memory region

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Sean Christopherson <seanjc@google.com>
commit 9d7d18ee3f48903f7b9bbf6305d690078c67271b
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/9d7d18ee.failed

Get the number of pages directly from the new memslot instead of
computing the same from the userspace memory region when allocating
memslot metadata.  This will allow a future patch to drop @mem.

No functional change intended.

	Signed-off-by: Sean Christopherson <seanjc@google.com>
	Reviewed-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
	Signed-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
Message-Id: <ef44892eb615f5c28e682bbe06af96aff9ce2a9f.1638817639.git.maciej.szmigiero@oracle.com>
(cherry picked from commit 9d7d18ee3f48903f7b9bbf6305d690078c67271b)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kvm/x86.c
diff --cc arch/x86/kvm/x86.c
index 91e139cea33b,2a7567adb799..000000000000
--- a/arch/x86/kvm/x86.c
+++ b/arch/x86/kvm/x86.c
@@@ -11825,13 -11674,19 +11825,23 @@@ void kvm_arch_memslots_updated(struct k
  }
  
  int kvm_arch_prepare_memory_region(struct kvm *kvm,
 -				   const struct kvm_userspace_memory_region *mem,
 -				   const struct kvm_memory_slot *old,
 -				   struct kvm_memory_slot *new,
 -				   enum kvm_mr_change change)
 +				struct kvm_memory_slot *memslot,
 +				const struct kvm_userspace_memory_region *mem,
 +				enum kvm_mr_change change)
  {
  	if (change == KVM_MR_CREATE || change == KVM_MR_MOVE)
++<<<<<<< HEAD
 +		return kvm_alloc_memslot_metadata(kvm, memslot,
 +						  mem->memory_size >> PAGE_SHIFT);
++=======
+ 		return kvm_alloc_memslot_metadata(kvm, new);
+ 
+ 	if (change == KVM_MR_FLAGS_ONLY)
+ 		memcpy(&new->arch, &old->arch, sizeof(old->arch));
+ 	else if (WARN_ON_ONCE(change != KVM_MR_DELETE))
+ 		return -EIO;
+ 
++>>>>>>> 9d7d18ee3f48 (KVM: x86: Use "new" memslot instead of userspace memory region)
  	return 0;
  }
  
* Unmerged path arch/x86/kvm/x86.c
