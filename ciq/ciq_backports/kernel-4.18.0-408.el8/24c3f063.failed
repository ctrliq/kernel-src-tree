selftests: vm: Do not override definition of ARCH

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Sandipan Das <sandipan@linux.ibm.com>
commit 24c3f063c57b2a8ae21b259bcfa7690e2eb56dd9
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/24c3f063.failed

Independent builds of the vm selftests is currently broken because
commit 7549b3364201 ("selftests: vm: Build/Run 64bit tests only on
64bit arch") overrides the value of ARCH with the machine name from
uname. This does not always match the architecture names used for
tasks like header installation.

E.g. for building tests on powerpc64, we need ARCH=powerpc
and not ARCH=ppc64 or ARCH=ppc64le. Otherwise, the build
fails as shown below.

  $ uname -m
  ppc64le

  $ make -C tools/testing/selftests/vm
  make: Entering directory '/home/sandipan/linux/tools/testing/selftests/vm'
  make --no-builtin-rules ARCH=ppc64le -C ../../../.. headers_install
  make[1]: Entering directory '/home/sandipan/linux'
  Makefile:653: arch/ppc64le/Makefile: No such file or directory
  make[1]: *** No rule to make target 'arch/ppc64le/Makefile'.  Stop.
  make[1]: Leaving directory '/home/sandipan/linux'
  ../lib.mk:50: recipe for target 'khdr' failed
  make: *** [khdr] Error 2
  make: Leaving directory '/home/sandipan/linux/tools/testing/selftests/vm'

Fixes: 7549b3364201 ("selftests: vm: Build/Run 64bit tests only on 64bit arch")
	Signed-off-by: Sandipan Das <sandipan@linux.ibm.com>
	Tested-by: Michael Ellerman <mpe@ellerman.id.au>
	Signed-off-by: Shuah Khan <skhan@linuxfoundation.org>
(cherry picked from commit 24c3f063c57b2a8ae21b259bcfa7690e2eb56dd9)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/vm/Makefile
diff --cc tools/testing/selftests/vm/Makefile
index fd931bcaaa4a,7f34a1d9ce80..000000000000
--- a/tools/testing/selftests/vm/Makefile
+++ b/tools/testing/selftests/vm/Makefile
@@@ -1,5 -1,7 +1,10 @@@
  # SPDX-License-Identifier: GPL-2.0
  # Makefile for vm selftests
++<<<<<<< HEAD
++=======
+ uname_M := $(shell uname -m 2>/dev/null || echo not)
+ MACHINE ?= $(shell echo $(uname_M) | sed -e 's/aarch64.*/arm64/')
++>>>>>>> 24c3f063c57b (selftests: vm: Do not override definition of ARCH)
  
  CFLAGS = -Wall -I ../../../../usr/include $(EXTRA_CFLAGS)
  LDLIBS = -lrt
@@@ -16,7 -19,8 +21,12 @@@ TEST_GEN_FILES += on-fault-limi
  TEST_GEN_FILES += thuge-gen
  TEST_GEN_FILES += transhuge-stress
  TEST_GEN_FILES += userfaultfd
++<<<<<<< HEAD
 +TEST_GEN_FILES += khugepaged
++=======
+ 
+ ifneq (,$(filter $(MACHINE),arm64 ia64 mips64 parisc64 ppc64 riscv64 s390x sh64 sparc64 x86_64))
++>>>>>>> 24c3f063c57b (selftests: vm: Do not override definition of ARCH)
  TEST_GEN_FILES += va_128TBswitch
  TEST_GEN_FILES += virtual_address_range
  TEST_GEN_FILES += write_to_hugetlbfs
* Unmerged path tools/testing/selftests/vm/Makefile
