mm: Change CONFIG option for mm->pasid field

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Fenghua Yu <fenghua.yu@intel.com>
commit 7a853c2d5951419fdf3c1c9d2b6f5a38f6a6857d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/7a853c2d.failed

This currently depends on CONFIG_IOMMU_SUPPORT. But it is only
needed when CONFIG_IOMMU_SVA option is enabled.

Change the CONFIG guards around definition and initialization
of mm->pasid field.

	Suggested-by: Jacob Pan <jacob.jun.pan@linux.intel.com>
	Signed-off-by: Fenghua Yu <fenghua.yu@intel.com>
	Signed-off-by: Borislav Petkov <bp@suse.de>
	Reviewed-by: Tony Luck <tony.luck@intel.com>
	Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
	Reviewed-by: Lu Baolu <baolu.lu@linux.intel.com>
Link: https://lore.kernel.org/r/20220207230254.3342514-3-fenghua.yu@intel.com
(cherry picked from commit 7a853c2d5951419fdf3c1c9d2b6f5a38f6a6857d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/linux/mm_types.h
#	kernel/fork.c
diff --cc include/linux/mm_types.h
index 7ebd22569b35,c5cbfd7915ad..000000000000
--- a/include/linux/mm_types.h
+++ b/include/linux/mm_types.h
@@@ -564,10 -630,9 +564,16 @@@ struct mm_struct 
  		atomic_long_t hugetlb_usage;
  #endif
  		struct work_struct async_put_work;
++<<<<<<< HEAD
 +#ifdef CONFIG_HMM_MIRROR
 +#ifdef __GENKSYMS__
 +		RH_KABI_DEPRECATE(struct hmm *, hmm)
 +#endif
++=======
+ 
+ #ifdef CONFIG_IOMMU_SVA
+ 		u32 pasid;
++>>>>>>> 7a853c2d5951 (mm: Change CONFIG option for mm->pasid field)
  #endif
  	} __randomize_layout;
  
diff --cc kernel/fork.c
index 3a201a1bb372,6ee7551d3bd2..000000000000
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@@ -1010,6 -1019,13 +1010,16 @@@ static void mm_init_owner(struct mm_str
  #endif
  }
  
++<<<<<<< HEAD
++=======
+ static void mm_init_pasid(struct mm_struct *mm)
+ {
+ #ifdef CONFIG_IOMMU_SVA
+ 	mm->pasid = INIT_PASID;
+ #endif
+ }
+ 
++>>>>>>> 7a853c2d5951 (mm: Change CONFIG option for mm->pasid field)
  static void mm_init_uprobes_state(struct mm_struct *mm)
  {
  #ifdef CONFIG_UPROBES
* Unmerged path include/linux/mm_types.h
* Unmerged path kernel/fork.c
