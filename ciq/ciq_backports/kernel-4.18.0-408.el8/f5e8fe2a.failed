KVM: selftests: Create VM with adjusted number of guest pages for perf tests

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Sean Christopherson <seanjc@google.com>
commit f5e8fe2a92e4923b63d1edd6ed53d9856b6515ce
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/f5e8fe2a.failed

Use the already computed guest_num_pages when creating the so called
extra VM pages for a perf test, and add a comment explaining why the
pages are allocated as extra pages.

	Signed-off-by: Sean Christopherson <seanjc@google.com>
	Reviewed-by: Ben Gardon <bgardon@google.com>
	Signed-off-by: David Matlack <dmatlack@google.com>
Message-Id: <20211111000310.1435032-11-dmatlack@google.com>
	Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
(cherry picked from commit f5e8fe2a92e4923b63d1edd6ed53d9856b6515ce)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/lib/perf_test_util.c
diff --cc tools/testing/selftests/kvm/lib/perf_test_util.c
index 0ef80dbdc116,b3154b5b0cfd..000000000000
--- a/tools/testing/selftests/kvm/lib/perf_test_util.c
+++ b/tools/testing/selftests/kvm/lib/perf_test_util.c
@@@ -73,11 -77,15 +73,20 @@@ struct kvm_vm *perf_test_create_vm(enu
  		    "Guest memory cannot be evenly divided into %d slots.",
  		    slots);
  
+ 	/*
+ 	 * Pass guest_num_pages to populate the page tables for test memory.
+ 	 * The memory is also added to memslot 0, but that's a benign side
+ 	 * effect as KVM allows aliasing HVAs in meslots.
+ 	 */
  	vm = vm_create_with_vcpus(mode, vcpus, DEFAULT_GUEST_PHY_PAGES,
++<<<<<<< HEAD
 +				  (vcpus * vcpu_memory_bytes) / perf_test_args.guest_page_size,
 +				  0, guest_code, NULL);
++=======
+ 				  guest_num_pages, 0, guest_code, NULL);
++>>>>>>> f5e8fe2a92e4 (KVM: selftests: Create VM with adjusted number of guest pages for perf tests)
  
 -	pta->vm = vm;
 +	perf_test_args.vm = vm;
  
  	/*
  	 * If there should be more memory in the guest test region than there
* Unmerged path tools/testing/selftests/kvm/lib/perf_test_util.c
