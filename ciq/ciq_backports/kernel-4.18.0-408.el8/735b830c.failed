scsi: core: Add scsi_msg_to_host_byte()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-408.el8
commit-author Hannes Reinecke <hare@suse.de>
commit 735b830c6104af6f4ec0e9a22822cd4067ac0bf5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-408.el8/735b830c.failed

Add helper to convert message byte into a host byte code.

Link: https://lore.kernel.org/r/20210427083046.31620-18-hare@suse.de
	Reviewed-by: Bart Van Assche <bvanassche@acm.org>
	Signed-off-by: Hannes Reinecke <hare@suse.de>
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 735b830c6104af6f4ec0e9a22822cd4067ac0bf5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	include/scsi/scsi_cmnd.h
diff --cc include/scsi/scsi_cmnd.h
index c795b3a27123,efcf33c29efa..000000000000
--- a/include/scsi/scsi_cmnd.h
+++ b/include/scsi/scsi_cmnd.h
@@@ -348,11 -330,38 +348,41 @@@ static inline void set_host_byte(struc
  	cmd->result = (cmd->result & 0xff00ffff) | (status << 16);
  }
  
 -static inline u8 get_host_byte(struct scsi_cmnd *cmd)
 +static inline void set_driver_byte(struct scsi_cmnd *cmd, char status)
  {
 -	return (cmd->result >> 16) & 0xff;
 +	cmd->result = (cmd->result & 0x00ffffff) | (status << 24);
  }
  
++<<<<<<< HEAD
++=======
+ /**
+  * scsi_msg_to_host_byte() - translate message byte
+  *
+  * Translate the SCSI parallel message byte to a matching
+  * host byte setting. A message of COMMAND_COMPLETE indicates
+  * a successful command execution, any other message indicate
+  * an error. As the messages themselves only have a meaning
+  * for the SCSI parallel protocol this function translates
+  * them into a matching host byte value for SCSI EH.
+  */
+ static inline void scsi_msg_to_host_byte(struct scsi_cmnd *cmd, u8 msg)
+ {
+ 	switch (msg) {
+ 	case COMMAND_COMPLETE:
+ 		break;
+ 	case ABORT_TASK_SET:
+ 		set_host_byte(cmd, DID_ABORT);
+ 		break;
+ 	case TARGET_RESET:
+ 		set_host_byte(cmd, DID_RESET);
+ 		break;
+ 	default:
+ 		set_host_byte(cmd, DID_ERROR);
+ 		break;
+ 	}
+ }
+ 
++>>>>>>> 735b830c6104 (scsi: core: Add scsi_msg_to_host_byte())
  static inline unsigned scsi_transfer_length(struct scsi_cmnd *scmd)
  {
  	unsigned int xfer_len = scmd->sdb.length;
* Unmerged path include/scsi/scsi_cmnd.h
