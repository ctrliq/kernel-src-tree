perf/x86/amd/uncore: Pass through error code for initialization failures, instead of -ENODEV

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-531.el8
commit-author Sandipan Das <sandipan.das@amd.com>
commit 744940f1921c8feb90e3c4bcc1e153fdd6e10fe2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-531.el8/744940f1.failed

Pass through the appropriate error code when the registration of hotplug
callbacks fail during initialization, instead of returning a blanket -ENODEV.

[ mingo: Updated the changelog. ]

	Reported-by: Dan Carpenter <dan.carpenter@linaro.org>
	Signed-off-by: Sandipan Das <sandipan.das@amd.com>
	Signed-off-by: Ingo Molnar <mingo@kernel.org>
Link: https://lore.kernel.org/r/20231016060743.332051-1-sandipan.das@amd.com
(cherry picked from commit 744940f1921c8feb90e3c4bcc1e153fdd6e10fe2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/events/amd/uncore.c
diff --cc arch/x86/events/amd/uncore.c
index 63fc97aecaf4,4429eac00185..000000000000
--- a/arch/x86/events/amd/uncore.c
+++ b/arch/x86/events/amd/uncore.c
@@@ -729,20 -1040,25 +729,32 @@@ static int __init amd_uncore_init(void
  	/*
  	 * Install callbacks. Core will call them for each online cpu.
  	 */
++<<<<<<< HEAD
 +	if (cpuhp_setup_state(CPUHP_PERF_X86_AMD_UNCORE_PREP,
 +			      "perf/x86/amd/uncore:prepare",
 +			      amd_uncore_cpu_up_prepare, amd_uncore_cpu_dead))
 +		goto fail_llc;
- 
- 	if (cpuhp_setup_state(CPUHP_AP_PERF_X86_AMD_UNCORE_STARTING,
- 			      "perf/x86/amd/uncore:starting",
- 			      amd_uncore_cpu_starting, NULL))
++=======
+ 	ret = cpuhp_setup_state(CPUHP_PERF_X86_AMD_UNCORE_PREP,
+ 				"perf/x86/amd/uncore:prepare",
+ 				NULL, amd_uncore_cpu_dead);
+ 	if (ret)
+ 		goto fail;
++>>>>>>> 744940f1921c (perf/x86/amd/uncore: Pass through error code for initialization failures, instead of -ENODEV)
+ 
+ 	ret = cpuhp_setup_state(CPUHP_AP_PERF_X86_AMD_UNCORE_STARTING,
+ 				"perf/x86/amd/uncore:starting",
+ 				amd_uncore_cpu_starting, NULL);
+ 	if (ret)
  		goto fail_prep;
- 	if (cpuhp_setup_state(CPUHP_AP_PERF_X86_AMD_UNCORE_ONLINE,
- 			      "perf/x86/amd/uncore:online",
- 			      amd_uncore_cpu_online,
- 			      amd_uncore_cpu_down_prepare))
+ 
+ 	ret = cpuhp_setup_state(CPUHP_AP_PERF_X86_AMD_UNCORE_ONLINE,
+ 				"perf/x86/amd/uncore:online",
+ 				amd_uncore_cpu_online,
+ 				amd_uncore_cpu_down_prepare);
+ 	if (ret)
  		goto fail_start;
+ 
  	return 0;
  
  fail_start:
* Unmerged path arch/x86/events/amd/uncore.c
