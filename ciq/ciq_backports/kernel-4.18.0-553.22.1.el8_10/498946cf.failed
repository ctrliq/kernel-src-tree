media: cec-adap.c: don't unconfigure if already unconfigured

jira LE-1907
cve CVE-2024-23848
Rebuild_History Non-Buildable kernel-4.18.0-553.22.1.el8_10
commit-author Hans Verkuil <hverkuil-cisco@xs4all.nl>
commit 498946cf6b85b5eafb142132a11351814f578535
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.22.1.el8_10/498946cf.failed

The __cec_s_log_addrs() function can configure or unconfigure the
adapter. The ioctl handler in cec-api.c will prevent it from being
called to configure the adapter if it was already configured (or in
the process of configuring). But it can still be called to unconfigure
an already unconfigured adapter, and it didn't check for that.

This can cause cec_activate_cnt_dec() to be called too often, causing
a WARN_ON.

Instead first check if adap->log_addrs.num_log_addrs == 0 and return
since in that case the adapter is already unconfigured.

	Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
	Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
(cherry picked from commit 498946cf6b85b5eafb142132a11351814f578535)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/cec/core/cec-adap.c
diff --cc drivers/media/cec/core/cec-adap.c
index e0e9d4808c3d,b47280fa3b87..000000000000
--- a/drivers/media/cec/core/cec-adap.c
+++ b/drivers/media/cec/core/cec-adap.c
@@@ -1672,7 -1709,10 +1672,14 @@@ int __cec_s_log_addrs(struct cec_adapte
  		return -ENODEV;
  
  	if (!log_addrs || log_addrs->num_log_addrs == 0) {
++<<<<<<< HEAD
 +		cec_adap_unconfigure(adap);
++=======
+ 		if (!adap->log_addrs.num_log_addrs)
+ 			return 0;
+ 		if (adap->is_configuring || adap->is_configured)
+ 			cec_adap_unconfigure(adap);
++>>>>>>> 498946cf6b85 (media: cec-adap.c: don't unconfigure if already unconfigured)
  		adap->log_addrs.num_log_addrs = 0;
  		for (i = 0; i < CEC_MAX_LOG_ADDRS; i++)
  			adap->log_addrs.log_addr[i] = CEC_LOG_ADDR_INVALID;
* Unmerged path drivers/media/cec/core/cec-adap.c
