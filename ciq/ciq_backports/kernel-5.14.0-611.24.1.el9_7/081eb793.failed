arm64: errata: Expand speculative SSBS workaround once more

jira KERNEL-474
Rebuild_History Non-Buildable kernel-5.14.0-611.24.1.el9_7
commit-author Mark Rutland <mark.rutland@arm.com>
commit 081eb7932c2b244f63317a982c5e3990e2c7fbdd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-611.24.1.el9_7/081eb793.failed

A number of Arm Ltd CPUs suffer from errata whereby an MSR to the SSBS
special-purpose register does not affect subsequent speculative
instructions, permitting speculative store bypassing for a window of
time.

We worked around this for a number of CPUs in commits:

* 7187bb7d0b5c7dfa ("arm64: errata: Add workaround for Arm errata 3194386 and 3312417")
* 75b3c43eab594bfb ("arm64: errata: Expand speculative SSBS workaround")
* 145502cac7ea70b5 ("arm64: errata: Expand speculative SSBS workaround (again)")

Since then, a (hopefully final) batch of updates have been published,
with two more affected CPUs. For the affected CPUs the existing
mitigation is sufficient, as described in their respective Software
Developer Errata Notice (SDEN) documents:

* Cortex-A715 (MP148) SDEN v15.0, erratum 3456084
  https://developer.arm.com/documentation/SDEN-2148827/1500/

* Neoverse-N3 (MP195) SDEN v5.0, erratum 3456111
  https://developer.arm.com/documentation/SDEN-3050973/0500/

Enable the existing mitigation by adding the relevant MIDRs to
erratum_spec_ssbs_list, and update silicon-errata.rst and the
Kconfig text accordingly.

	Signed-off-by: Mark Rutland <mark.rutland@arm.com>
	Cc: James Morse <james.morse@arm.com>
	Cc: Will Deacon <will@kernel.org>
Link: https://lore.kernel.org/r/20240930111705.3352047-3-mark.rutland@arm.com
	Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
(cherry picked from commit 081eb7932c2b244f63317a982c5e3990e2c7fbdd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/arm64/silicon-errata.rst
#	arch/arm64/Kconfig
#	arch/arm64/kernel/cpu_errata.c
diff --cc Documentation/arm64/silicon-errata.rst
index adba677e357a,ae45a409f76f..000000000000
--- a/Documentation/arm64/silicon-errata.rst
+++ b/Documentation/arm64/silicon-errata.rst
@@@ -148,10 -146,18 +148,12 @@@ stable kernels
  +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A715     | #2645198        | ARM64_ERRATUM_2645198       |
  +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Cortex-A715     | #3456084        | ARM64_ERRATUM_3194386       |
+ +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-A720     | #3456091        | ARM64_ERRATUM_3194386       |
  +----------------+-----------------+-----------------+-----------------------------+
 -| ARM            | Cortex-A725     | #3456106        | ARM64_ERRATUM_3194386       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-X1       | #1502854        | N/A                         |
  +----------------+-----------------+-----------------+-----------------------------+
 -| ARM            | Cortex-X1       | #3324344        | ARM64_ERRATUM_3194386       |
 -+----------------+-----------------+-----------------+-----------------------------+
 -| ARM            | Cortex-X1C      | #3324346        | ARM64_ERRATUM_3194386       |
 -+----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-X2       | #2119858        | ARM64_ERRATUM_2119858       |
  +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Cortex-X2       | #2224489        | ARM64_ERRATUM_2224489       |
@@@ -180,6 -188,12 +182,15 @@@
  +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Neoverse-N2     | #3324339        | ARM64_ERRATUM_3194386       |
  +----------------+-----------------+-----------------+-----------------------------+
++<<<<<<< HEAD:Documentation/arm64/silicon-errata.rst
++=======
+ | ARM            | Neoverse-N3     | #3456111        | ARM64_ERRATUM_3194386       |
+ +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Neoverse-V1     | #1619801        | N/A                         |
+ +----------------+-----------------+-----------------+-----------------------------+
+ | ARM            | Neoverse-V1     | #3324341        | ARM64_ERRATUM_3194386       |
+ +----------------+-----------------+-----------------+-----------------------------+
++>>>>>>> 081eb7932c2b (arm64: errata: Expand speculative SSBS workaround once more):Documentation/arch/arm64/silicon-errata.rst
  | ARM            | Neoverse-V2     | #3324336        | ARM64_ERRATUM_3194386       |
  +----------------+-----------------+-----------------+-----------------------------+
  | ARM            | Neoverse-V3     | #3312417        | ARM64_ERRATUM_3194386       |
diff --cc arch/arm64/Kconfig
index 0cec5d8a9854,ae495cc848c5..000000000000
--- a/arch/arm64/Kconfig
+++ b/arch/arm64/Kconfig
@@@ -1063,13 -1091,25 +1063,19 @@@ config ARM64_ERRATUM_319438
  	help
  	  This option adds the workaround for the following errata:
  
 -	  * ARM Cortex-A76 erratum 3324349
 -	  * ARM Cortex-A77 erratum 3324348
 -	  * ARM Cortex-A78 erratum 3324344
 -	  * ARM Cortex-A78C erratum 3324346
 -	  * ARM Cortex-A78C erratum 3324347
  	  * ARM Cortex-A710 erratam 3324338
+ 	  * ARM Cortex-A715 errartum 3456084
  	  * ARM Cortex-A720 erratum 3456091
 -	  * ARM Cortex-A725 erratum 3456106
 -	  * ARM Cortex-X1 erratum 3324344
 -	  * ARM Cortex-X1C erratum 3324346
  	  * ARM Cortex-X2 erratum 3324338
  	  * ARM Cortex-X3 erratum 3324335
  	  * ARM Cortex-X4 erratum 3194386
  	  * ARM Cortex-X925 erratum 3324334
 -	  * ARM Neoverse-N1 erratum 3324349
  	  * ARM Neoverse N2 erratum 3324339
++<<<<<<< HEAD
++=======
+ 	  * ARM Neoverse-N3 erratum 3456111
+ 	  * ARM Neoverse-V1 erratum 3324341
++>>>>>>> 081eb7932c2b (arm64: errata: Expand speculative SSBS workaround once more)
  	  * ARM Neoverse V2 erratum 3324336
  	  * ARM Neoverse-V3 erratum 3312417
  
diff --cc arch/arm64/kernel/cpu_errata.c
index ed5f411551e5,d9b9ec2bd6ff..000000000000
--- a/arch/arm64/kernel/cpu_errata.c
+++ b/arch/arm64/kernel/cpu_errata.c
@@@ -434,15 -434,26 +434,22 @@@ static const struct midr_range erratum_
  
  #ifdef CONFIG_ARM64_ERRATUM_3194386
  static const struct midr_range erratum_spec_ssbs_list[] = {
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_A76),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_A77),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_A78),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_A78C),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_A710),
+ 	MIDR_ALL_VERSIONS(MIDR_CORTEX_A715),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_A720),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_A725),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_X1),
 -	MIDR_ALL_VERSIONS(MIDR_CORTEX_X1C),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_X2),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_X3),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_X4),
  	MIDR_ALL_VERSIONS(MIDR_CORTEX_X925),
 -	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_N1),
  	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_N2),
++<<<<<<< HEAD
++=======
+ 	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_N3),
+ 	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_V1),
+ 	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_V2),
++>>>>>>> 081eb7932c2b (arm64: errata: Expand speculative SSBS workaround once more)
  	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_V3),
 +	MIDR_ALL_VERSIONS(MIDR_NEOVERSE_V2),
  	{}
  };
  #endif
* Unmerged path Documentation/arm64/silicon-errata.rst
* Unmerged path arch/arm64/Kconfig
* Unmerged path arch/arm64/kernel/cpu_errata.c
