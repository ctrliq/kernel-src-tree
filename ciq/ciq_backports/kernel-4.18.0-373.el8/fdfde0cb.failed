iwlwifi: fix Bz NMI behaviour

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-373.el8
commit-author Johannes Berg <johannes.berg@intel.com>
commit fdfde0cb79264f88992e72b5a056a3a3284fcaad
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-373.el8/fdfde0cb.failed

Contrary to what was stated before, the hardware hasn't changed
the bits here yet. In any case, the new CSR is also directly
(lower 16 bits) connected to UREG_DOORBELL_TO_ISR6, so if it
still changes the changes would be there. Adjust the code and
comments accordingly.

	Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Fixes: 6c0795f1a524 ("iwlwifi: implement Bz NMI behaviour")
	Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
Link: https://lore.kernel.org/r/iwlwifi.20211210090244.75b6207536e3.I7d170a48a9096e6b7269c3a9f447c326f929b171@changeid
	Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
(cherry picked from commit fdfde0cb79264f88992e72b5a056a3a3284fcaad)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/wireless/intel/iwlwifi/iwl-csr.h
diff --cc drivers/net/wireless/intel/iwlwifi/iwl-csr.h
index ff79a2ecb242,f90d4662c164..000000000000
--- a/drivers/net/wireless/intel/iwlwifi/iwl-csr.h
+++ b/drivers/net/wireless/intel/iwlwifi/iwl-csr.h
@@@ -105,9 -105,14 +105,18 @@@
  /* GIO Chicken Bits (PCI Express bus link power management) */
  #define CSR_GIO_CHICKEN_BITS    (CSR_BASE+0x100)
  
++<<<<<<< HEAD
 +/* Doorbell NMI (since Bz) */
++=======
+ #define CSR_IPC_SLEEP_CONTROL	(CSR_BASE + 0x114)
+ #define CSR_IPC_SLEEP_CONTROL_SUSPEND	0x3
+ #define CSR_IPC_SLEEP_CONTROL_RESUME	0
+ 
+ /* Doorbell - since Bz
+  * connected to UREG_DOORBELL_TO_ISR6 (lower 16 bits only)
+  */
++>>>>>>> fdfde0cb7926 (iwlwifi: fix Bz NMI behaviour)
  #define CSR_DOORBELL_VECTOR	(CSR_BASE + 0x130)
- #define CSR_DOORBELL_VECTOR_NMI	BIT(1)
  
  /* host chicken bits */
  #define CSR_HOST_CHICKEN	(CSR_BASE + 0x204)
* Unmerged path drivers/net/wireless/intel/iwlwifi/iwl-csr.h
diff --git a/drivers/net/wireless/intel/iwlwifi/iwl-io.c b/drivers/net/wireless/intel/iwlwifi/iwl-io.c
index 46917b4216b3..253eac4cbf59 100644
--- a/drivers/net/wireless/intel/iwlwifi/iwl-io.c
+++ b/drivers/net/wireless/intel/iwlwifi/iwl-io.c
@@ -218,7 +218,7 @@ void iwl_force_nmi(struct iwl_trans *trans)
 				    UREG_DOORBELL_TO_ISR6_NMI_BIT);
 	else
 		iwl_write32(trans, CSR_DOORBELL_VECTOR,
-			    CSR_DOORBELL_VECTOR_NMI);
+			    UREG_DOORBELL_TO_ISR6_NMI_BIT);
 }
 IWL_EXPORT_SYMBOL(iwl_force_nmi);
 
