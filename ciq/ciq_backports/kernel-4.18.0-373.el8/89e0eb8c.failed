xfs: restore speculative_cow_prealloc_lifetime sysctl

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-373.el8
commit-author Darrick J. Wong <djwong@kernel.org>
commit 89e0eb8c13bb842e224b27d7e071262cd84717cb
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-373.el8/89e0eb8c.failed

In commit 9669f51de5c0 I tried to get rid of the undocumented cow gc
lifetime knob.  The knob's function was never documented and it now
doesn't really have a function since eof and cow gc have been
consolidated.

Regrettably, xfs/231 relies on it and regresses on for-next.  I did not
succeed at getting far enough through fstests patch review for the fixup
to land in time.

Restore the sysctl knob, document what it did (does?), put it on the
deprecation schedule, and rip out a redundant function.

Fixes: 9669f51de5c0 ("xfs: consolidate the eofblocks and cowblocks workers")
	Signed-off-by: Darrick J. Wong <djwong@kernel.org>
	Reviewed-by: Dave Chinner <dchinner@redhat.com>
	Reviewed-by: Christoph Hellwig <hch@lst.de>
(cherry picked from commit 89e0eb8c13bb842e224b27d7e071262cd84717cb)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	Documentation/filesystems/xfs.txt
#	fs/xfs/xfs_sysctl.c
diff --cc Documentation/filesystems/xfs.txt
index 20c6aa2c7752,5422407a96d7..000000000000
--- a/Documentation/filesystems/xfs.txt
+++ b/Documentation/filesystems/xfs.txt
@@@ -335,7 -359,13 +338,17 @@@ The following sysctls are available fo
  Deprecated Sysctls
  ==================
  
++<<<<<<< HEAD:Documentation/filesystems/xfs.txt
 +None at present.
++=======
+ ===========================================     ================
+   Name                                          Removal Schedule
+ ===========================================     ================
+ fs.xfs.irix_sgid_inherit                        September 2025
+ fs.xfs.irix_symlink_mode                        September 2025
+ fs.xfs.speculative_cow_prealloc_lifetime        September 2025
+ ===========================================     ================
++>>>>>>> 89e0eb8c13bb (xfs: restore speculative_cow_prealloc_lifetime sysctl):Documentation/admin-guide/xfs.rst
  
  
  Removed Sysctls
diff --cc fs/xfs/xfs_sysctl.c
index 4e9474095421,546a6cd96729..000000000000
--- a/fs/xfs/xfs_sysctl.c
+++ b/fs/xfs/xfs_sysctl.c
@@@ -50,13 -50,29 +50,36 @@@ xfs_panic_mask_proc_handler
  }
  #endif /* CONFIG_PROC_FS */
  
++<<<<<<< HEAD
++=======
+ STATIC int
+ xfs_deprecated_dointvec_minmax(
+ 	struct ctl_table	*ctl,
+ 	int			write,
+ 	void			*buffer,
+ 	size_t			*lenp,
+ 	loff_t			*ppos)
+ {
+ 	if (write) {
+ 		printk_ratelimited(KERN_WARNING
+ 				"XFS: %s sysctl option is deprecated.\n",
+ 				ctl->procname);
+ 	}
+ 	return proc_dointvec_minmax(ctl, write, buffer, lenp, ppos);
+ }
+ 
++>>>>>>> 89e0eb8c13bb (xfs: restore speculative_cow_prealloc_lifetime sysctl)
  static struct ctl_table xfs_table[] = {
  	{
  		.procname	= "irix_sgid_inherit",
  		.data		= &xfs_params.sgid_inherit.val,
  		.maxlen		= sizeof(int),
  		.mode		= 0644,
++<<<<<<< HEAD
 +		.proc_handler	= proc_dointvec_minmax,
++=======
+ 		.proc_handler	= xfs_deprecated_dointvec_minmax,
++>>>>>>> 89e0eb8c13bb (xfs: restore speculative_cow_prealloc_lifetime sysctl)
  		.extra1		= &xfs_params.sgid_inherit.min,
  		.extra2		= &xfs_params.sgid_inherit.max
  	},
@@@ -65,7 -81,7 +88,11 @@@
  		.data		= &xfs_params.symlink_mode.val,
  		.maxlen		= sizeof(int),
  		.mode		= 0644,
++<<<<<<< HEAD
 +		.proc_handler	= proc_dointvec_minmax,
++=======
+ 		.proc_handler	= xfs_deprecated_dointvec_minmax,
++>>>>>>> 89e0eb8c13bb (xfs: restore speculative_cow_prealloc_lifetime sysctl)
  		.extra1		= &xfs_params.symlink_mode.min,
  		.extra2		= &xfs_params.symlink_mode.max
  	},
* Unmerged path Documentation/filesystems/xfs.txt
* Unmerged path fs/xfs/xfs_sysctl.c
