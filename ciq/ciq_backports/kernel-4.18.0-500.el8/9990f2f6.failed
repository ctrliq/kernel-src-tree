usb: typec: tipd: Enable event interrupts by default

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-500.el8
commit-author Saranya Gopal <saranya.gopal@intel.com>
commit 9990f2f6264cd19cb6ba12d9f9c1c30ae8351096
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-500.el8/9990f2f6.failed

TI PD controller comes with notification mechanism to inform
the host on activity in the PD controller. In the current
driver, the required masks are not set. This patch enables
the following events in the interrupt mask register:
PowerStatusUpdate - Set whenever contents of the power status reg changes
DataStatusUpdate - Set whenever contents of the data status reg changes
PlugInsertOrRemoval - Set whenever USB plug status has changed

With this change, the interrupt flooding issue is not seen anymore.

	Suggested-by: Rajaram Regupathy <rajaram.regupathy@intel.com>
	Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
	Reviewed-by: Heikki Krogerus <heikki.krogerus@linux.intel.com>
	Acked-by: Hans de Goede <hdegoede@redhat.com>
	Signed-off-by: Saranya Gopal <saranya.gopal@intel.com>
Datasheet: https://www.ti.com/lit/ug/slvuan1a/slvuan1a.pdf
Link: https://lore.kernel.org/r/20211020022620.21012-2-saranya.gopal@intel.com
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 9990f2f6264cd19cb6ba12d9f9c1c30ae8351096)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/typec/tipd/core.c
diff --cc drivers/usb/typec/tipd/core.c
index 7c364e1f355e,fb8ef12bbe9c..000000000000
--- a/drivers/usb/typec/tipd/core.c
+++ b/drivers/usb/typec/tipd/core.c
@@@ -616,6 -735,31 +616,34 @@@ static int tps6598x_probe(struct i2c_cl
  	if (ret)
  		return ret;
  
++<<<<<<< HEAD
++=======
+ 	if (np && of_device_is_compatible(np, "apple,cd321x")) {
+ 		/* Switch CD321X chips to the correct system power state */
+ 		ret = cd321x_switch_power_state(tps, TPS_SYSTEM_POWER_STATE_S0);
+ 		if (ret)
+ 			return ret;
+ 
+ 		/* CD321X chips have all interrupts masked initially */
+ 		ret = tps6598x_write64(tps, TPS_REG_INT_MASK1,
+ 					APPLE_CD_REG_INT_POWER_STATUS_UPDATE |
+ 					APPLE_CD_REG_INT_DATA_STATUS_UPDATE |
+ 					APPLE_CD_REG_INT_PLUG_EVENT);
+ 		if (ret)
+ 			return ret;
+ 
+ 		irq_handler = cd321x_interrupt;
+ 	} else {
+ 		/* Enable power status, data status and plug event interrupts */
+ 		ret = tps6598x_write64(tps, TPS_REG_INT_MASK1,
+ 				       TPS_REG_INT_POWER_STATUS_UPDATE |
+ 				       TPS_REG_INT_DATA_STATUS_UPDATE |
+ 				       TPS_REG_INT_PLUG_EVENT);
+ 		if (ret)
+ 			return ret;
+ 	}
+ 
++>>>>>>> 9990f2f6264c (usb: typec: tipd: Enable event interrupts by default)
  	ret = tps6598x_read32(tps, TPS_REG_STATUS, &status);
  	if (ret < 0)
  		return ret;
* Unmerged path drivers/usb/typec/tipd/core.c
