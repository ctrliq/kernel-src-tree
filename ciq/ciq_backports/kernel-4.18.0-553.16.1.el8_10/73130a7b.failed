smb3: fix empty netname context on secondary channels

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-553.16.1.el8_10
commit-author Steve French <stfrench@microsoft.com>
commit 73130a7b1ac92c9f30e0a255951129f4851c5794
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.16.1.el8_10/73130a7b.failed

Some servers do not allow null netname contexts, which would cause
multichannel to revert to single channel when mounting to some
servers (e.g. Azure xSMB).

Fixes: 4c14d7043fede ("cifs: populate empty hostnames for extra channels")
	Reviewed-by: Shyam Prasad N <sprasad@microsoft.com>
	Reviewed-by: Paulo Alcantara (SUSE) <pc@cjr.nz>
	Signed-off-by: Steve French <stfrench@microsoft.com>
(cherry picked from commit 73130a7b1ac92c9f30e0a255951129f4851c5794)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	fs/cifs/smb2pdu.c
diff --cc fs/cifs/smb2pdu.c
index 2c2185ee9128,5e8c4737b183..000000000000
--- a/fs/cifs/smb2pdu.c
+++ b/fs/cifs/smb2pdu.c
@@@ -536,6 -570,19 +536,22 @@@ assemble_neg_contexts(struct smb2_negot
  	*total_len += ctxt_len;
  	pneg_ctxt += ctxt_len;
  
++<<<<<<< HEAD
++=======
+ 	build_posix_ctxt((struct smb2_posix_neg_context *)pneg_ctxt);
+ 	*total_len += sizeof(struct smb2_posix_neg_context);
+ 	pneg_ctxt += sizeof(struct smb2_posix_neg_context);
+ 
+ 	if (server->hostname && (server->hostname[0] != 0)) {
+ 		ctxt_len = build_netname_ctxt((struct smb2_netname_neg_context *)pneg_ctxt,
+ 					server->hostname);
+ 		*total_len += ctxt_len;
+ 		pneg_ctxt += ctxt_len;
+ 		neg_context_count = 4;
+ 	} else /* second channels do not have a hostname */
+ 		neg_context_count = 3;
+ 
++>>>>>>> 73130a7b1ac9 (smb3: fix empty netname context on secondary channels)
  	if (server->compress_algorithm) {
  		build_compression_ctxt((struct smb2_compression_capabilities_context *)
  				pneg_ctxt);
* Unmerged path fs/cifs/smb2pdu.c
