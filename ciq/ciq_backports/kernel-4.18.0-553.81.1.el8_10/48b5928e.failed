base/node.c: initialize the accessor list before registering

jira LE-4623
Rebuild_History Non-Buildable kernel-4.18.0-553.81.1.el8_10
commit-author Gregory Price <gourry.memverge@gmail.com>
commit 48b5928e18dc27e05cab3dc4c78cd8a15baaf1e5
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-553.81.1.el8_10/48b5928e.failed

The current code registers the node as available in the node array
before initializing the accessor list.  This makes it so that
anything which might access the accessor list as a result of
allocations will cause an undefined memory access.

In one example, an extension to access hmat data during interleave
caused this undefined access as a result of a bulk allocation
that occurs during node initialization but before the accessor
list is initialized.

Initialize the accessor list before making the node generally
available to the global system.

Fixes: 08d9dbe72b1f ("node: Link memory nodes to their compute nodes")
	Signed-off-by: Gregory Price <gregory.price@memverge.com>
Link: https://lore.kernel.org/r/20231030044239.971756-1-gregory.price@memverge.com
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 48b5928e18dc27e05cab3dc4c78cd8a15baaf1e5)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/base/node.c
diff --cc drivers/base/node.c
index fb1d56f977ea,4d588f4658c8..000000000000
--- a/drivers/base/node.c
+++ b/drivers/base/node.c
@@@ -989,9 -885,6 +993,12 @@@ int __register_one_node(int nid
  			register_cpu_under_node(cpu, nid);
  	}
  
++<<<<<<< HEAD
 +	INIT_LIST_HEAD(&node_devices[nid]->access_list);
 +	/* initialize work queue for memory hot plug */
 +	init_node_hugetlb_work(nid);
++=======
++>>>>>>> 48b5928e18dc (base/node.c: initialize the accessor list before registering)
  	node_init_caches(nid);
  
  	return error;
* Unmerged path drivers/base/node.c
