net/mlx5e: Verify dev is present for fix features ndo

jira LE-1907
Rebuild_History Non-Buildable kernel-rt-4.18.0-477.10.1.rt7.274.el8_8
commit-author Roy Novich <royno@nvidia.com>
commit ab4b01bfdaa69492fb36484026b0a0f0af02d75a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-477.10.1.rt7.274.el8_8/ab4b01bf.failed

The native NIC port net device instance is being used as Uplink
representor.  While changing profiles private resources are not
available, fix features ndo does not check if the netdev is present.
Add driver protection to verify private resources are ready.

Fixes: 7a9fb35e8c3a ("net/mlx5e: Do not reload ethernet ports when changing eswitch mode")
	Signed-off-by: Roy Novich <royno@nvidia.com>
	Reviewed-by: Roi Dayan <roid@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit ab4b01bfdaa69492fb36484026b0a0f0af02d75a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_main.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index ae15595a7b69,abcc614b6191..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@@ -3835,12 -4081,17 +3835,19 @@@ static netdev_features_t mlx5e_fix_feat
  					    netdev_features_t features)
  {
  	struct mlx5e_priv *priv = netdev_priv(netdev);
 -	struct mlx5e_vlan_table *vlan;
  	struct mlx5e_params *params;
  
++<<<<<<< HEAD
++=======
+ 	if (!netif_device_present(netdev))
+ 		return features;
+ 
+ 	vlan = mlx5e_fs_get_vlan(priv->fs);
++>>>>>>> ab4b01bfdaa6 (net/mlx5e: Verify dev is present for fix features ndo)
  	mutex_lock(&priv->state_lock);
  	params = &priv->channels.params;
 -	if (!vlan ||
 -	    !bitmap_empty(mlx5e_vlan_get_active_svlans(vlan), VLAN_N_VID)) {
 +	if (!priv->fs.vlan ||
 +	    !bitmap_empty(mlx5e_vlan_get_active_svlans(priv->fs.vlan), VLAN_N_VID)) {
  		/* HW strips the outer C-tag header, this is a problem
  		 * for S-tag traffic.
  		 */
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_main.c
