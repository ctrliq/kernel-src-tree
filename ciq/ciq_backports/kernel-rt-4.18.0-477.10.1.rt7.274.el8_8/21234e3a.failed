net/mlx5e: Fix use after free in mlx5e_fs_init()

jira LE-1907
Rebuild_History Non-Buildable kernel-rt-4.18.0-477.10.1.rt7.274.el8_8
commit-author Dan Carpenter <dan.carpenter@oracle.com>
commit 21234e3a84c70f27ea106411bdd5ef7af17508a6
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-477.10.1.rt7.274.el8_8/21234e3a.failed

Call mlx5e_fs_vlan_free(fs) before kvfree(fs).

Fixes: af8bbf730068 ("net/mlx5e: Convert mlx5e_flow_steering member of mlx5e_priv to pointer")
	Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
	Reviewed-by: Tariq Toukan <tariqt@nvidia.com>
	Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
(cherry picked from commit 21234e3a84c70f27ea106411bdd5ef7af17508a6)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
diff --cc drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
index 3f8245301b0a,e0ce5a233d0b..000000000000
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
@@@ -1385,15 -1394,19 +1385,24 @@@ int mlx5e_fs_init(struct mlx5e_priv *pr
  			goto err_free_vlan;
  	}
  
++<<<<<<< HEAD
 +	return 0;
 +err_free_vlan:
 +	mlx5e_fs_vlan_free(&priv->fs);
++=======
+ 	return fs;
+ 
+ err_free_vlan:
+ 	mlx5e_fs_vlan_free(fs);
+ err_free_fs:
+ 	kvfree(fs);
++>>>>>>> 21234e3a84c7 (net/mlx5e: Fix use after free in mlx5e_fs_init())
  err:
 -	return NULL;
 +	return -ENOMEM;
  }
  
 -void mlx5e_fs_cleanup(struct mlx5e_flow_steering *fs)
 +void mlx5e_fs_cleanup(struct mlx5e_priv *priv)
  {
 -	mlx5e_fs_tc_free(fs);
 -	mlx5e_fs_vlan_free(fs);
 -	kvfree(fs);
 +	mlx5e_fs_tc_free(&priv->fs);
 +	mlx5e_fs_vlan_free(&priv->fs);
  }
* Unmerged path drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
