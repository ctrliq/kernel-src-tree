spi: Return deferred probe error when controller isn't yet available

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Andy Shevchenko <andriy.shevchenko@linux.intel.com>
commit 9c22ec4ac27bcc5a54dd406da168f403327a5b55
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/9c22ec4a.failed

If the controller is not available, it might be in the future and
we would like to re-probe the peripheral again. For that purpose
return deferred probe.

BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=215993
Fixes: 87e59b36e5e2 ("spi: Support selection of the index of the ACPI Spi Resource before alloc")
	Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Link: https://lore.kernel.org/r/20220709212956.25530-1-andriy.shevchenko@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 9c22ec4ac27bcc5a54dd406da168f403327a5b55)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/spi/spi.c
diff --cc drivers/spi/spi.c
index 5180a35df0a3,2ec508ad8c2b..000000000000
--- a/drivers/spi/spi.c
+++ b/drivers/spi/spi.c
@@@ -1854,10 -2460,26 +1854,30 @@@ static int acpi_spi_add_resource(struc
  						 sb->resource_source.string_ptr,
  						 &parent_handle);
  
 -			if (ACPI_FAILURE(status))
 +			if (ACPI_FAILURE(status) ||
 +			    ACPI_HANDLE(ctlr->dev.parent) != parent_handle)
  				return -ENODEV;
  
++<<<<<<< HEAD
++=======
+ 			if (ctlr) {
+ 				if (ACPI_HANDLE(ctlr->dev.parent) != parent_handle)
+ 					return -ENODEV;
+ 			} else {
+ 				struct acpi_device *adev;
+ 
+ 				adev = acpi_fetch_acpi_dev(parent_handle);
+ 				if (!adev)
+ 					return -ENODEV;
+ 
+ 				ctlr = acpi_spi_find_controller_by_adev(adev);
+ 				if (!ctlr)
+ 					return -EPROBE_DEFER;
+ 
+ 				lookup->ctlr = ctlr;
+ 			}
+ 
++>>>>>>> 9c22ec4ac27b (spi: Return deferred probe error when controller isn't yet available)
  			/*
  			 * ACPI DeviceSelection numbering is handled by the
  			 * host controller driver in Windows and can vary
* Unmerged path drivers/spi/spi.c
