ethtool: push the rtnl_lock into dev_ethtool()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Jakub Kicinski <kuba@kernel.org>
commit f49deaa64af10276ef0c9a09558152f990b5f3b1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/f49deaa6.failed

Don't take the lock in net/core/dev_ioctl.c,
we'll have things to do outside rtnl_lock soon.

	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
	Reviewed-by: Leon Romanovsky <leonro@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit f49deaa64af10276ef0c9a09558152f990b5f3b1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/core/dev_ioctl.c
#	net/ethtool/ioctl.c
diff --cc net/core/dev_ioctl.c
index 9b44185cd7e6,cbab5fec64b1..000000000000
--- a/net/core/dev_ioctl.c
+++ b/net/core/dev_ioctl.c
@@@ -425,9 -518,7 +425,13 @@@ int dev_ioctl(struct net *net, unsigne
  
  	case SIOCETHTOOL:
  		dev_load(net, ifr->ifr_name);
++<<<<<<< HEAD
 +		rtnl_lock();
 +		ret = dev_ethtool(net, ifr);
 +		rtnl_unlock();
++=======
+ 		ret = dev_ethtool(net, ifr, data);
++>>>>>>> f49deaa64af1 (ethtool: push the rtnl_lock into dev_ethtool())
  		if (colon)
  			*colon = ':';
  		return ret;
diff --cc net/ethtool/ioctl.c
index be7380037e8d,52bfc5b82ec3..000000000000
--- a/net/ethtool/ioctl.c
+++ b/net/ethtool/ioctl.c
@@@ -2689,10 -2700,10 +2689,15 @@@ static int ethtool_set_fecparam(struct 
  
  /* The main entry point in this file.  Called from net/core/dev_ioctl.c */
  
++<<<<<<< HEAD
 +int dev_ethtool(struct net *net, struct ifreq *ifr)
++=======
+ static int
+ __dev_ethtool(struct net *net, struct ifreq *ifr, void __user *useraddr)
++>>>>>>> f49deaa64af1 (ethtool: push the rtnl_lock into dev_ethtool())
  {
  	struct net_device *dev = __dev_get_by_name(net, ifr->ifr_name);
 +	void __user *useraddr = ifr->ifr_data;
  	u32 ethcmd, sub_cmd;
  	int rc;
  	netdev_features_t old_features;
* Unmerged path net/core/dev_ioctl.c
* Unmerged path net/ethtool/ioctl.c
