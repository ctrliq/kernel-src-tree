net/sched: cls_api: Add extack message for unsupported action offload

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Ido Schimmel <idosch@nvidia.com>
commit c440615ffbcb9c06975103e5abbcb094589329d1
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/c440615f.failed

For better error reporting to user space, add an extack message when the
requested action does not support offload.

Example:

 # echo 1 > /sys/kernel/tracing/events/netlink/netlink_extack/enable

 # tc filter add dev dummy0 ingress pref 1 proto all matchall skip_sw action nat ingress 192.0.2.1 198.51.100.1
 Error: cls_matchall: Failed to setup flow action.
 We have an error talking to the kernel

 # cat /sys/kernel/tracing/trace_pipe
       tc-181     [000] b..1.    88.406093: netlink_extack: msg=Action does not support offload
       tc-181     [000] .....    88.406108: netlink_extack: msg=cls_matchall: Failed to setup flow action

	Signed-off-by: Ido Schimmel <idosch@nvidia.com>
	Reviewed-by: Petr Machata <petrm@nvidia.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit c440615ffbcb9c06975103e5abbcb094589329d1)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/sched/cls_api.c
diff --cc net/sched/cls_api.c
index 319c68029e64,d8a22bedd026..000000000000
--- a/net/sched/cls_api.c
+++ b/net/sched/cls_api.c
@@@ -3506,14 -3511,21 +3506,26 @@@ void tc_cleanup_offload_action(struct f
  }
  EXPORT_SYMBOL(tc_cleanup_offload_action);
  
 -static int tc_setup_offload_act(struct tc_action *act,
 -				struct flow_action_entry *entry,
 -				u32 *index_inc,
 -				struct netlink_ext_ack *extack)
 +static void tcf_mirred_get_dev(struct flow_action_entry *entry,
 +			       const struct tc_action *act)
  {
  #ifdef CONFIG_NET_CLS_ACT
++<<<<<<< HEAD
 +	entry->dev = act->ops->get_dev(act, &entry->destructor);
 +	if (!entry->dev)
 +		return;
 +	entry->destructor_priv = entry->dev;
++=======
+ 	if (act->ops->offload_act_setup) {
+ 		return act->ops->offload_act_setup(act, entry, index_inc, true,
+ 						   extack);
+ 	} else {
+ 		NL_SET_ERR_MSG(extack, "Action does not support offload");
+ 		return -EOPNOTSUPP;
+ 	}
+ #else
+ 	return 0;
++>>>>>>> c440615ffbcb (net/sched: cls_api: Add extack message for unsupported action offload)
  #endif
  }
  
* Unmerged path net/sched/cls_api.c
