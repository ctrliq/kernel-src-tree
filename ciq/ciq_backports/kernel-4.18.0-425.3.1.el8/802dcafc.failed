xhci: Fix null pointer dereference in resume if xhci has only one roothub

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Mathias Nyman <mathias.nyman@linux.intel.com>
commit 802dcafc420af536fcde1b44ac51ca211f4ec673
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/802dcafc.failed

In the re-init path xhci_resume() passes 'hcd->primary_hcd' to hci_init(),
however this field isn't initialized by __usb_create_hcd() for a HCD
without secondary controller.

xhci_resume() is called once per xHC device, not per hcd, so the extra
checking for primary hcd can be removed.

Fixes: e0fe986972f5 ("usb: host: xhci-plat: prepare operation w/o shared hcd")
	Reported-by: Matthias Kaehlcke <mka@chromium.org>
	Tested-by: Matthias Kaehlcke <mka@chromium.org>
	Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
Link: https://lore.kernel.org/r/20220610115338.863152-2-mathias.nyman@linux.intel.com
	Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
(cherry picked from commit 802dcafc420af536fcde1b44ac51ca211f4ec673)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/usb/host/xhci.c
diff --cc drivers/usb/host/xhci.c
index d881c1d1ae8f,9ac56e9ffc64..000000000000
--- a/drivers/usb/host/xhci.c
+++ b/drivers/usb/host/xhci.c
@@@ -1217,13 -1220,15 +1211,19 @@@ int xhci_resume(struct xhci_hcd *xhci, 
  		comp_timer_running = true;
  
  		xhci_dbg(xhci, "Start the primary HCD\n");
++<<<<<<< HEAD
 +		retval = xhci_run(hcd->primary_hcd);
 +		if (!retval) {
++=======
+ 		retval = xhci_run(hcd);
+ 		if (!retval && xhci->shared_hcd) {
++>>>>>>> 802dcafc420a (xhci: Fix null pointer dereference in resume if xhci has only one roothub)
  			xhci_dbg(xhci, "Start the secondary HCD\n");
- 			retval = xhci_run(secondary_hcd);
+ 			retval = xhci_run(xhci->shared_hcd);
  		}
+ 
  		hcd->state = HC_STATE_SUSPENDED;
 -		if (xhci->shared_hcd)
 -			xhci->shared_hcd->state = HC_STATE_SUSPENDED;
 +		xhci->shared_hcd->state = HC_STATE_SUSPENDED;
  		goto done;
  	}
  
* Unmerged path drivers/usb/host/xhci.c
