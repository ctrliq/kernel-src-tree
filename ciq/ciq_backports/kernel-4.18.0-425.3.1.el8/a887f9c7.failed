ASoC: wm_adsp: Correct control read size when parsing compressed buffer

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Charles Keepax <ckeepax@opensource.cirrus.com>
commit a887f9c7a4d37a8e874ba8415a42a92a1b5139fc
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/a887f9c7.failed

When parsing the compressed stream the whole buffer descriptor is
now read in a single cs_dsp_coeff_read_ctrl; on older firmwares
this descriptor is just 4 bytes but on more modern firmwares it is
24 bytes. The current code reads the full 24 bytes regardless, this
was working but reading junk for the last 20 bytes. However commit
f444da38ac92 ("firmware: cs_dsp: Add offset to cs_dsp read/write")
added a size check into cs_dsp_coeff_read_ctrl, causing the older
firmwares to now return an error.

Update the code to only read the amount of data appropriate for
the firmware loaded.

Fixes: 04ae08596737 ("ASoC: wm_adsp: Switch to using wm_coeff_read_ctrl for compressed buffers")
	Signed-off-by: Charles Keepax <ckeepax@opensource.cirrus.com>
Link: https://lore.kernel.org/r/20220210172053.22782-1-ckeepax@opensource.cirrus.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit a887f9c7a4d37a8e874ba8415a42a92a1b5139fc)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/codecs/wm_adsp.c
diff --cc sound/soc/codecs/wm_adsp.c
index c1b5ea3b5718,0582585236a2..000000000000
--- a/sound/soc/codecs/wm_adsp.c
+++ b/sound/soc/codecs/wm_adsp.c
@@@ -3857,7 -1441,8 +3857,12 @@@ static int wm_adsp_buffer_parse_coeff(s
  	int ret, i;
  
  	for (i = 0; i < 5; ++i) {
++<<<<<<< HEAD
 +		ret = wm_coeff_read_ctrl(ctl, &coeff_v1, sizeof(coeff_v1));
++=======
+ 		ret = cs_dsp_coeff_read_ctrl(cs_ctl, 0, &coeff_v1,
+ 					     min(cs_ctl->len, sizeof(coeff_v1)));
++>>>>>>> a887f9c7a4d3 (ASoC: wm_adsp: Correct control read size when parsing compressed buffer)
  		if (ret < 0)
  			return ret;
  
* Unmerged path sound/soc/codecs/wm_adsp.c
