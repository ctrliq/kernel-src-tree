arm64: entry.S: Add ventry overflow sanity checks

jira LE-1907
cve CVE-2022-23960
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author James Morse <james.morse@arm.com>
commit 4330e2c5c04c27bebf89d34e0bc14e6943413067
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/4330e2c5.failed

Subsequent patches add even more code to the ventry slots.
Ensure kernels that overflow a ventry slot don't get built.

	Reviewed-by: Russell King (Oracle) <rmk+kernel@armlinux.org.uk>
	Reviewed-by: Catalin Marinas <catalin.marinas@arm.com>
	Signed-off-by: James Morse <james.morse@arm.com>
(cherry picked from commit 4330e2c5c04c27bebf89d34e0bc14e6943413067)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kernel/entry.S
diff --cc arch/arm64/kernel/entry.S
index 5e486b1be9b7,bd940b2254da..000000000000
--- a/arch/arm64/kernel/entry.S
+++ b/arch/arm64/kernel/entry.S
@@@ -60,17 -35,9 +60,18 @@@
  	.endr
  	.endm
  
 -	.macro kernel_ventry, el:req, ht:req, regsize:req, label:req
 +/*
 + * Bad Abort numbers
 + *-----------------
 + */
 +#define BAD_SYNC	0
 +#define BAD_IRQ		1
 +#define BAD_FIQ		2
 +#define BAD_ERROR	3
 +
 +	.macro kernel_ventry, el, label, regsize = 64
  	.align 7
+ .Lventry_start\@:
  #ifdef CONFIG_UNMAP_KERNEL_AT_EL0
  	.if	\el == 0
  alternative_if ARM64_UNMAP_KERNEL_AT_EL0
@@@ -128,7 -95,8 +129,12 @@@ alternative_else_nop_endi
  	sub	sp, sp, x0
  	mrs	x0, tpidrro_el0
  #endif
++<<<<<<< HEAD
 +	b	el\()\el\()_\label
++=======
+ 	b	el\el\ht\()_\regsize\()_\label
+ .org .Lventry_start\@ + 128	// Did we overflow the ventry slot?
++>>>>>>> 4330e2c5c04c (arm64: entry.S: Add ventry overflow sanity checks)
  	.endm
  
  	.macro tramp_alias, dst, sym
* Unmerged path arch/arm64/kernel/entry.S
