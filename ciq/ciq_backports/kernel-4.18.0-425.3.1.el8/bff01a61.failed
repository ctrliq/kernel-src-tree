KVM: arm64: Move SVE state mapping at HYP to finalize-time

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Marc Zyngier <maz@kernel.org>
commit bff01a61af3c8b9756940c2fb0be2af570cdb5bf
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/bff01a61.failed

We currently map the SVE state to HYP on detection of a PID change.
Although this matches what we do for FPSIMD, this is pretty pointless
for SVE, as the buffer is per-vcpu and has nothing to do with the
thread that is being run.

Move the mapping of the SVE state to finalize-time, which is where
we allocate the state memory, and thus the most logical place to
do this.

	Reviewed-by: Andrew Jones <drjones@redhat.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
(cherry picked from commit bff01a61af3c8b9756940c2fb0be2af570cdb5bf)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/arm64/kvm/reset.c
diff --cc arch/arm64/kvm/reset.c
index b2e6499949da,c7a0249df840..000000000000
--- a/arch/arm64/kvm/reset.c
+++ b/arch/arm64/kvm/reset.c
@@@ -170,7 -108,8 +172,12 @@@ static int kvm_vcpu_finalize_sve(struc
  		    vl > SVE_VL_ARCH_MAX))
  		return -EIO;
  
++<<<<<<< HEAD
 +	buf = kzalloc(SVE_SIG_REGS_SIZE(sve_vq_from_vl(vl)), GFP_KERNEL);
++=======
+ 	reg_sz = vcpu_sve_state_size(vcpu);
+ 	buf = kzalloc(reg_sz, GFP_KERNEL_ACCOUNT);
++>>>>>>> bff01a61af3c (KVM: arm64: Move SVE state mapping at HYP to finalize-time)
  	if (!buf)
  		return -ENOMEM;
  
* Unmerged path arch/arm64/kvm/reset.c
