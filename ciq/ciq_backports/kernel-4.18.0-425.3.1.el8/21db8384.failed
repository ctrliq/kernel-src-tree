selftests: KVM: Free the GIC FD when cleaning up in arch_timer

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Oliver Upton <oupton@google.com>
commit 21db83846683d3987666505a3ec38f367708199a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/21db8384.failed

In order to correctly destroy a VM, all references to the VM must be
freed. The arch_timer selftest creates a VGIC for the guest, which
itself holds a reference to the VM.

Close the GIC FD when cleaning up a VM.

	Signed-off-by: Oliver Upton <oupton@google.com>
	Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: https://lore.kernel.org/r/20220406235615.1447180-4-oupton@google.com
(cherry picked from commit 21db83846683d3987666505a3ec38f367708199a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	tools/testing/selftests/kvm/aarch64/arch_timer.c
diff --cc tools/testing/selftests/kvm/aarch64/arch_timer.c
index bf6a45b0b8dc,3b940a101bc0..000000000000
--- a/tools/testing/selftests/kvm/aarch64/arch_timer.c
+++ b/tools/testing/selftests/kvm/aarch64/arch_timer.c
@@@ -382,7 -384,11 +384,15 @@@ static struct kvm_vm *test_vm_create(vo
  
  	ucall_init(vm, NULL);
  	test_init_timer_irq(vm);
++<<<<<<< HEAD
 +	vgic_v3_setup(vm, nr_vcpus, GICD_BASE_GPA, GICR_BASE_GPA);
++=======
+ 	gic_fd = vgic_v3_setup(vm, nr_vcpus, 64, GICD_BASE_GPA, GICR_BASE_GPA);
+ 	if (gic_fd < 0) {
+ 		print_skip("Failed to create vgic-v3");
+ 		exit(KSFT_SKIP);
+ 	}
++>>>>>>> 21db83846683 (selftests: KVM: Free the GIC FD when cleaning up in arch_timer)
  
  	/* Make all the test's cmdline args visible to the guest */
  	sync_global_to_guest(vm, test_args);
* Unmerged path tools/testing/selftests/kvm/aarch64/arch_timer.c
