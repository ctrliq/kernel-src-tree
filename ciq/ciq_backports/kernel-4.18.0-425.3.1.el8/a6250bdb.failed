drm/amdgpu: Only disable prefer_shadow on hawaii

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Alex Deucher <alexander.deucher@amd.com>
commit a6250bdb6c4677ee77d699b338e077b900f94c0c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/a6250bdb.failed

We changed it for all asics due to a hibernation regression
on hawaii, but the workaround breaks suspend on a polaris12.
Just disable it for hawaii.

Link: https://bugzilla.kernel.org/show_bug.cgi?id=216119
Fixes: 3a4b1cc28fbd ("drm/amdgpu/display: disable prefer_shadow for generic fb helpers")
Reviewed-and-tested-by: Mario Limonciello <mario.limonciello@amd.com>
	Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
	Cc: stable@vger.kernel.org
(cherry picked from commit a6250bdb6c4677ee77d699b338e077b900f94c0c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/gpu/drm/amd/amdgpu/amdgpu_vkms.c
#	drivers/gpu/drm/amd/amdgpu/dce_v10_0.c
#	drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
#	drivers/gpu/drm/amd/amdgpu/dce_v6_0.c
#	drivers/gpu/drm/amd/amdgpu/dce_v8_0.c
#	drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
diff --cc drivers/gpu/drm/amd/amdgpu/dce_v10_0.c
index d1570a462a51,288fce7dc0ed..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/dce_v10_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/dce_v10_0.c
@@@ -2797,6 -2797,8 +2797,11 @@@ static int dce_v10_0_sw_init(void *hand
  
  	adev_to_drm(adev)->mode_config.preferred_depth = 24;
  	adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++<<<<<<< HEAD
++=======
+ 
+ 	adev_to_drm(adev)->mode_config.fb_modifiers_not_supported = true;
++>>>>>>> a6250bdb6c46 (drm/amdgpu: Only disable prefer_shadow on hawaii)
  
  	adev_to_drm(adev)->mode_config.fb_base = adev->gmc.aper_base;
  
diff --cc drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
index 18a7b3bd633b,cbe5250b31cb..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
@@@ -2915,6 -2915,8 +2915,11 @@@ static int dce_v11_0_sw_init(void *hand
  
  	adev_to_drm(adev)->mode_config.preferred_depth = 24;
  	adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++<<<<<<< HEAD
++=======
+ 
+ 	adev_to_drm(adev)->mode_config.fb_modifiers_not_supported = true;
++>>>>>>> a6250bdb6c46 (drm/amdgpu: Only disable prefer_shadow on hawaii)
  
  	adev_to_drm(adev)->mode_config.fb_base = adev->gmc.aper_base;
  
diff --cc drivers/gpu/drm/amd/amdgpu/dce_v6_0.c
index c7803dc2b2d5,b1c44fab074f..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/dce_v6_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/dce_v6_0.c
@@@ -2674,6 -2674,7 +2674,10 @@@ static int dce_v6_0_sw_init(void *handl
  	adev_to_drm(adev)->mode_config.max_height = 16384;
  	adev_to_drm(adev)->mode_config.preferred_depth = 24;
  	adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++<<<<<<< HEAD
++=======
+ 	adev_to_drm(adev)->mode_config.fb_modifiers_not_supported = true;
++>>>>>>> a6250bdb6c46 (drm/amdgpu: Only disable prefer_shadow on hawaii)
  	adev_to_drm(adev)->mode_config.fb_base = adev->gmc.aper_base;
  
  	r = amdgpu_display_modeset_create_props(adev);
diff --cc drivers/gpu/drm/amd/amdgpu/dce_v8_0.c
index b200b9e722d9,a22b45c92792..000000000000
--- a/drivers/gpu/drm/amd/amdgpu/dce_v8_0.c
+++ b/drivers/gpu/drm/amd/amdgpu/dce_v8_0.c
@@@ -2697,7 -2693,13 +2697,17 @@@ static int dce_v8_0_sw_init(void *handl
  	adev_to_drm(adev)->mode_config.max_height = 16384;
  
  	adev_to_drm(adev)->mode_config.preferred_depth = 24;
++<<<<<<< HEAD
 +	adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++=======
+ 	if (adev->asic_type == CHIP_HAWAII)
+ 		/* disable prefer shadow for now due to hibernation issues */
+ 		adev_to_drm(adev)->mode_config.prefer_shadow = 0;
+ 	else
+ 		adev_to_drm(adev)->mode_config.prefer_shadow = 1;
+ 
+ 	adev_to_drm(adev)->mode_config.fb_modifiers_not_supported = true;
++>>>>>>> a6250bdb6c46 (drm/amdgpu: Only disable prefer_shadow on hawaii)
  
  	adev_to_drm(adev)->mode_config.fb_base = adev->gmc.aper_base;
  
diff --cc drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
index 8ed81042b9a5,5140d9c2bf3b..000000000000
--- a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
+++ b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
@@@ -3441,7 -3825,11 +3441,15 @@@ static int amdgpu_dm_mode_config_init(s
  	adev_to_drm(adev)->mode_config.max_height = 16384;
  
  	adev_to_drm(adev)->mode_config.preferred_depth = 24;
++<<<<<<< HEAD
 +	adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++=======
+ 	if (adev->asic_type == CHIP_HAWAII)
+ 		/* disable prefer shadow for now due to hibernation issues */
+ 		adev_to_drm(adev)->mode_config.prefer_shadow = 0;
+ 	else
+ 		adev_to_drm(adev)->mode_config.prefer_shadow = 1;
++>>>>>>> a6250bdb6c46 (drm/amdgpu: Only disable prefer_shadow on hawaii)
  	/* indicates support for immediate flip */
  	adev_to_drm(adev)->mode_config.async_page_flip = true;
  
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_vkms.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/amdgpu_vkms.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/dce_v10_0.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/dce_v11_0.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/dce_v6_0.c
* Unmerged path drivers/gpu/drm/amd/amdgpu/dce_v8_0.c
* Unmerged path drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c
