x86/bugs: Warn when "ibrs" mitigation is selected on Enhanced IBRS parts

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Pawan Gupta <pawan.kumar.gupta@linux.intel.com>
commit eb23b5ef9131e6d65011de349a4d25ef1b3d4314
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/eb23b5ef.failed

IBRS mitigation for spectre_v2 forces write to MSR_IA32_SPEC_CTRL at
every kernel entry/exit. On Enhanced IBRS parts setting
MSR_IA32_SPEC_CTRL[IBRS] only once at boot is sufficient. MSR writes at
every kernel entry/exit incur unnecessary performance loss.

When Enhanced IBRS feature is present, print a warning about this
unnecessary performance loss.

	Signed-off-by: Pawan Gupta <pawan.kumar.gupta@linux.intel.com>
	Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
	Reviewed-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
	Cc: stable@vger.kernel.org
Link: https://lore.kernel.org/r/2a5eaf54583c2bfe0edc4fea64006656256cca17.1657814857.git.pawan.kumar.gupta@linux.intel.com
(cherry picked from commit eb23b5ef9131e6d65011de349a4d25ef1b3d4314)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	arch/x86/kernel/cpu/bugs.c
diff --cc arch/x86/kernel/cpu/bugs.c
index 951579a17911,6454bc767f0f..000000000000
--- a/arch/x86/kernel/cpu/bugs.c
+++ b/arch/x86/kernel/cpu/bugs.c
@@@ -1071,7 -1412,12 +1072,16 @@@ static void __init spectre_v2_select_mi
  	switch (mode) {
  	case SPECTRE_V2_NONE:
  	case SPECTRE_V2_EIBRS:
++<<<<<<< HEAD
 +	default:
++=======
+ 		break;
+ 
+ 	case SPECTRE_V2_IBRS:
+ 		setup_force_cpu_cap(X86_FEATURE_KERNEL_IBRS);
+ 		if (boot_cpu_has(X86_FEATURE_IBRS_ENHANCED))
+ 			pr_warn(SPECTRE_V2_IBRS_PERF_MSG);
++>>>>>>> eb23b5ef9131 (x86/bugs: Warn when "ibrs" mitigation is selected on Enhanced IBRS parts)
  		break;
  
  	case SPECTRE_V2_LFENCE:
* Unmerged path arch/x86/kernel/cpu/bugs.c
