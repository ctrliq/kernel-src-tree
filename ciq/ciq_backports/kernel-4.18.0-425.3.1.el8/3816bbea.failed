ASoC: SOF: expose sof_route_setup()

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
commit 3816bbea644202fd0a8410e54dbc30bd93f3292c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/3816bbea.failed

This will be used in IPC3-specific code.

	Signed-off-by: Ranjani Sridharan <ranjani.sridharan@linux.intel.com>
	Reviewed-by: PÃ©ter Ujfalusi <peter.ujfalusi@linux.intel.com>
	Reviewed-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20220317175044.1752400-18-ranjani.sridharan@linux.intel.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 3816bbea644202fd0a8410e54dbc30bd93f3292c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/sof/sof-audio.c
diff --cc sound/soc/sof/sof-audio.c
index 59867de987af,8885709f40df..000000000000
--- a/sound/soc/sof/sof-audio.c
+++ b/sound/soc/sof/sof-audio.c
@@@ -296,41 -204,10 +296,46 @@@ use_count_dec
  }
  EXPORT_SYMBOL(sof_widget_setup);
  
++<<<<<<< HEAD
 +static int sof_route_setup_ipc(struct snd_sof_dev *sdev, struct snd_sof_route *sroute)
 +{
 +	struct sof_ipc_pipe_comp_connect connect;
 +	struct sof_ipc_reply reply;
 +	int ret;
 +
 +	/* nothing to do if route is already set up */
 +	if (sroute->setup)
 +		return 0;
 +
 +	connect.hdr.size = sizeof(connect);
 +	connect.hdr.cmd = SOF_IPC_GLB_TPLG_MSG | SOF_IPC_TPLG_COMP_CONNECT;
 +	connect.source_id = sroute->src_widget->comp_id;
 +	connect.sink_id = sroute->sink_widget->comp_id;
 +
 +	dev_dbg(sdev->dev, "setting up route %s -> %s\n",
 +		sroute->src_widget->widget->name,
 +		sroute->sink_widget->widget->name);
 +
 +	/* send ipc */
 +	ret = sof_ipc_tx_message(sdev->ipc, connect.hdr.cmd, &connect, sizeof(connect),
 +				 &reply, sizeof(reply));
 +	if (ret < 0) {
 +		dev_err(sdev->dev, "%s: route setup failed %d\n", __func__, ret);
 +		return ret;
 +	}
 +
 +	sroute->setup = true;
 +
 +	return 0;
 +}
 +
 +static int sof_route_setup(struct snd_sof_dev *sdev, struct snd_soc_dapm_widget *wsource,
 +			   struct snd_soc_dapm_widget *wsink)
++=======
+ int sof_route_setup(struct snd_sof_dev *sdev, struct snd_soc_dapm_widget *wsource,
+ 		    struct snd_soc_dapm_widget *wsink)
++>>>>>>> 3816bbea6442 (ASoC: SOF: expose sof_route_setup())
  {
 -	const struct sof_ipc_tplg_ops *ipc_tplg_ops = sdev->ipc->ops->tplg;
  	struct snd_sof_widget *src_widget = wsource->dobj.private;
  	struct snd_sof_widget *sink_widget = wsink->dobj.private;
  	struct snd_sof_route *sroute;
* Unmerged path sound/soc/sof/sof-audio.c
diff --git a/sound/soc/sof/sof-audio.h b/sound/soc/sof/sof-audio.h
index d620c73a2a23..e0a80bcc2457 100644
--- a/sound/soc/sof/sof-audio.h
+++ b/sound/soc/sof/sof-audio.h
@@ -395,6 +395,8 @@ void sof_machine_unregister(struct snd_sof_dev *sdev, void *pdata);
 
 int sof_widget_setup(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);
 int sof_widget_free(struct snd_sof_dev *sdev, struct snd_sof_widget *swidget);
+int sof_route_setup(struct snd_sof_dev *sdev, struct snd_soc_dapm_widget *wsource,
+		    struct snd_soc_dapm_widget *wsink);
 
 /* PCM */
 int sof_widget_list_setup(struct snd_sof_dev *sdev, struct snd_sof_pcm *spcm, int dir);
