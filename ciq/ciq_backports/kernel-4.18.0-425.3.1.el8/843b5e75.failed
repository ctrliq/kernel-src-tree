mptcp: fix local endpoint accounting

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Paolo Abeni <pabeni@redhat.com>
commit 843b5e75efff04db34fcf9856de53c9e415530a2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/843b5e75.failed

In mptcp_pm_nl_rm_addr_or_subflow() we always mark as available
the id corresponding to the just removed address.

The used bitmap actually tracks only the local IDs: we must
restrict the operation when a (local) subflow is removed.

Fixes: a88c9e496937 ("mptcp: do not block subflows creation on errors")
	Signed-off-by: Paolo Abeni <pabeni@redhat.com>
	Signed-off-by: Mat Martineau <mathew.j.martineau@linux.intel.com>
	Signed-off-by: David S. Miller <davem@davemloft.net>
(cherry picked from commit 843b5e75efff04db34fcf9856de53c9e415530a2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	net/mptcp/pm_netlink.c
diff --cc net/mptcp/pm_netlink.c
index 87eeec0654b8,7c7395b58944..000000000000
--- a/net/mptcp/pm_netlink.c
+++ b/net/mptcp/pm_netlink.c
@@@ -699,9 -805,10 +699,14 @@@ static void mptcp_pm_nl_rm_addr_or_subf
  			spin_lock_bh(&msk->pm.lock);
  
  			removed = true;
 +			msk->pm.subflows--;
  			__MPTCP_INC_STATS(sock_net(sk), rm_type);
  		}
++<<<<<<< HEAD
++=======
+ 		if (rm_type == MPTCP_MIB_RMSUBFLOW)
+ 			__set_bit(rm_list->ids[i], msk->pm.id_avail_bitmap);
++>>>>>>> 843b5e75efff (mptcp: fix local endpoint accounting)
  		if (!removed)
  			continue;
  
* Unmerged path net/mptcp/pm_netlink.c
