of: fdt: Add generic support for handling elf core headers property

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-425.3.1.el8
commit-author Geert Uytterhoeven <geert+renesas@glider.be>
commit f7e7ce93aac13118281bcef8407b5df1a6b16822
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-425.3.1.el8/f7e7ce93.failed

There are two methods to specify the location of the elf core headers:
using the "elfcorehdr=" kernel parameter, as handled by generic code in
kernel/crash_dump.c, or using the "linux,elfcorehdr" property under the
"/chosen" node in the Device Tree, as handled by architecture-specific
code in arch/arm64/mm/init.c.

Extend support for "linux,elfcorehdr" to all platforms supporting DT by
adding platform-agnostic handling for handling this property to the FDT
core code.  This can co-exist safely with the architecture-specific
handling, until the latter has been removed.

This requires moving the call to of_scan_flat_dt() up, as the code
scanning the "/chosen" node now needs to be aware of the values of
"#address-cells" and "#size-cells".

	Signed-off-by: Geert Uytterhoeven <geert+renesas@glider.be>
	Signed-off-by: Rob Herring <robh@kernel.org>
Link: https://lore.kernel.org/r/c7e46e50aaf87ef49bdaa61358d25b122f32b7df.1628670468.git.geert+renesas@glider.be
(cherry picked from commit f7e7ce93aac13118281bcef8407b5df1a6b16822)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/of/fdt.c
diff --cc drivers/of/fdt.c
index 5f804b7f0a7a,a421c90c83fb..000000000000
--- a/drivers/of/fdt.c
+++ b/drivers/of/fdt.c
@@@ -1212,12 -1241,16 +1265,17 @@@ bool __init early_init_dt_verify(void *
  
  void __init early_init_dt_scan_nodes(void)
  {
- 	/* Retrieve various information from the /chosen node */
- 	of_scan_flat_dt(early_init_dt_scan_chosen, boot_command_line);
++<<<<<<< HEAD
++=======
+ 	int rc = 0;
  
  	/* Initialize {size,address}-cells info */
  	of_scan_flat_dt(early_init_dt_scan_root, NULL);
  
++>>>>>>> f7e7ce93aac1 (of: fdt: Add generic support for handling elf core headers property)
+ 	/* Retrieve various information from the /chosen node */
 -	rc = of_scan_flat_dt(early_init_dt_scan_chosen, boot_command_line);
 -	if (!rc)
 -		pr_warn("No chosen node found, continuing without\n");
++	of_scan_flat_dt(early_init_dt_scan_chosen, boot_command_line);
+ 
  	/* Setup memory, calling early_init_dt_add_memory_arch */
  	of_scan_flat_dt(early_init_dt_scan_memory, NULL);
  }
diff --git a/Documentation/devicetree/bindings/chosen.txt b/Documentation/devicetree/bindings/chosen.txt
index 45e79172a646..5b0b94eb2d04 100644
--- a/Documentation/devicetree/bindings/chosen.txt
+++ b/Documentation/devicetree/bindings/chosen.txt
@@ -106,9 +106,9 @@ respectively, of the root node.
 linux,elfcorehdr
 ----------------
 
-This property (currently used only on arm64) holds the memory range,
-the address and the size, of the elf core header which mainly describes
-the panicked kernel's memory layout as PT_LOAD segments of elf format.
+This property holds the memory range, the address and the size, of the elf
+core header which mainly describes the panicked kernel's memory layout as
+PT_LOAD segments of elf format.
 e.g.
 
 / {
* Unmerged path drivers/of/fdt.c
