IB/core: Destroy QP if XRC QP fails

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Yuval Avnery <yuvalav@mellanox.com>
commit 535005ca8e5e71918d64074032f4b9d4fef8981e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/535005ca.failed

The open-coded variant missed destroy of SELinux created QP, reuse already
existing ib_detroy_qp() call and use this opportunity to clean
ib_create_qp() from double prints and unclear exit paths.

	Reported-by: Parav Pandit <parav@mellanox.com>
Fixes: d291f1a65232 ("IB/core: Enforce PKey security on QPs")
	Signed-off-by: Yuval Avnery <yuvalav@mellanox.com>
	Reviewed-by: Parav Pandit <parav@mellanox.com>
	Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
	Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit 535005ca8e5e71918d64074032f4b9d4fef8981e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/verbs.c
diff --cc drivers/infiniband/core/verbs.c
index 515376e87764,3220fb42ecce..000000000000
--- a/drivers/infiniband/core/verbs.c
+++ b/drivers/infiniband/core/verbs.c
@@@ -1115,10 -1122,10 +1115,17 @@@ static struct ib_qp *create_xrc_qp(stru
  
  	qp = __ib_open_qp(real_qp, qp_init_attr->event_handler,
  			  qp_init_attr->qp_context);
++<<<<<<< HEAD
 +	if (!IS_ERR(qp))
 +		__ib_insert_xrcd_qp(qp_init_attr->xrcd, real_qp);
 +	else
 +		real_qp->device->destroy_qp(real_qp);
++=======
+ 	if (IS_ERR(qp))
+ 		return qp;
+ 
+ 	__ib_insert_xrcd_qp(qp_init_attr->xrcd, real_qp);
++>>>>>>> 535005ca8e5e (IB/core: Destroy QP if XRC QP fails)
  	return qp;
  }
  
* Unmerged path drivers/infiniband/core/verbs.c
