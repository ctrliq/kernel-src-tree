RDMA/iwcm: Don't copy past the end of dev_name() string

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Steve Wise <swise@opengridcomputing.com>
commit d53ec8af56d5163f8a42e961ece3aeb5c560e79d
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/d53ec8af.failed

We now use dev_name(&ib_device->dev) instead of ib_device->name in iwpm
messages.  The name field in struct device is a const char *, where as
ib_device->name is a char array of size IB_DEVICE_NAME_MAX, and it is
pre-initialized to zeros.

Since iw_cm_map() was using memcpy() to copy in the device name, and
copying IWPM_DEVNAME_SIZE bytes, it ends up copying past the end of the
source device name string and copying random bytes.  This results in iwpmd
failing the REGISTER_PID request from iwcm.  Thus port mapping is broken.

Validate the device and if names, and use strncpy() to inialize the entire
message field.

Fixes: 896de0090a85 ("RDMA/core: Use dev_name instead of ibdev->name")
	Cc: stable@vger.kernel.org
	Signed-off-by: Steve Wise <swise@opengridcomputing.com>
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
(cherry picked from commit d53ec8af56d5163f8a42e961ece3aeb5c560e79d)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/iwcm.c
diff --cc drivers/infiniband/core/iwcm.c
index 5d676cff41f4,476abc74178e..000000000000
--- a/drivers/infiniband/core/iwcm.c
+++ b/drivers/infiniband/core/iwcm.c
@@@ -509,10 -515,8 +515,15 @@@ static int iw_cm_map(struct iw_cm_id *c
  	cm_id->m_local_addr = cm_id->local_addr;
  	cm_id->m_remote_addr = cm_id->remote_addr;
  
++<<<<<<< HEAD
 +	memcpy(pm_reg_msg.dev_name, cm_id->device->name,
 +	       sizeof(pm_reg_msg.dev_name));
 +	memcpy(pm_reg_msg.if_name, cm_id->device->iwcm->ifname,
 +	       sizeof(pm_reg_msg.if_name));
++=======
+ 	strncpy(pm_reg_msg.dev_name, devname, sizeof(pm_reg_msg.dev_name));
+ 	strncpy(pm_reg_msg.if_name, ifname, sizeof(pm_reg_msg.if_name));
++>>>>>>> d53ec8af56d5 (RDMA/iwcm: Don't copy past the end of dev_name() string)
  
  	if (iwpm_register_pid(&pm_reg_msg, RDMA_NL_IWCM) ||
  	    !iwpm_valid_pid())
* Unmerged path drivers/infiniband/core/iwcm.c
