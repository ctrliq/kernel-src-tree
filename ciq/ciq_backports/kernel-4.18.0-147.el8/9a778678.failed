RDMA/uverbs: Fix an error flow in ib_uverbs_poll_cq

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-147.el8
commit-author Jason Gunthorpe <jgg@ziepe.ca>
commit 9a7786784dcbec2f6ad52fd98a8d076f808e59f2
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-147.el8/9a778678.failed

The new output_written block was wrongly placed before the ret=0, causing
the error code to be lost. uverbs_output_written is not expected to fail,
and even if it does fail it has no significant impact on the userspace
flow.

	Reported-by: Bart Van Assche <bvanassche@acm.org>
Fixes: d6f4a21f309d ("RDMA/uverbs: Mark ioctl responses with UVERBS_ATTR_F_VALID_OUTPUT")
	Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
	Reviewed-by: Leon Romanovsky <leonro@mellanox.com>
(cherry picked from commit 9a7786784dcbec2f6ad52fd98a8d076f808e59f2)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/infiniband/core/uverbs_cmd.c
diff --cc drivers/infiniband/core/uverbs_cmd.c
index 300532a4cde8,4947d1480c6d..000000000000
--- a/drivers/infiniband/core/uverbs_cmd.c
+++ b/drivers/infiniband/core/uverbs_cmd.c
@@@ -1267,8 -1186,10 +1267,14 @@@ ssize_t ib_uverbs_poll_cq(struct ib_uve
  		ret = -EFAULT;
  		goto out_put;
  	}
+ 	ret = 0;
  
++<<<<<<< HEAD
 +	ret = in_len;
++=======
+ 	if (uverbs_attr_is_valid(attrs, UVERBS_ATTR_CORE_OUT))
+ 		ret = uverbs_output_written(attrs, UVERBS_ATTR_CORE_OUT);
++>>>>>>> 9a7786784dcb (RDMA/uverbs: Fix an error flow in ib_uverbs_poll_cq)
  
  out_put:
  	uobj_put_obj_read(cq);
* Unmerged path drivers/infiniband/core/uverbs_cmd.c
