crypto: ccp - Use lower 8 bytes to communicate with doorbell command register

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-504.el8
commit-author Mario Limonciello <mario.limonciello@amd.com>
commit 6699e1431e1567d1bae9cdccb4a849ca029eb861
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-504.el8/6699e143.failed

Unlike other command registers used by the PSP, only the lower 8 bytes are
used for communication for both command and status of the command.

	Suggested-by: Mark Hasemeyer <markhas@chromium.org>
	Signed-off-by: Mario Limonciello <mario.limonciello@amd.com>
	Reviewed-by: Mark Hasemeyer <markhas@chromium.org>
	Tested-by: Mark Hasemeyer <markhas@chromium.org>
	Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 6699e1431e1567d1bae9cdccb4a849ca029eb861)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/crypto/ccp/platform-access.c
diff --cc drivers/crypto/ccp/platform-access.c
index 9cc0c60bbf7b,939c924fc383..000000000000
--- a/drivers/crypto/ccp/platform-access.c
+++ b/drivers/crypto/ccp/platform-access.c
@@@ -132,6 -133,52 +133,55 @@@ unlock
  }
  EXPORT_SYMBOL_GPL(psp_send_platform_access_msg);
  
++<<<<<<< HEAD
++=======
+ int psp_ring_platform_doorbell(int msg, u32 *result)
+ {
+ 	struct psp_device *psp = psp_get_master_device();
+ 	struct psp_platform_access_device *pa_dev;
+ 	u32 __iomem *button, *cmd;
+ 	int ret, val;
+ 
+ 	if (!psp || !psp->platform_access_data)
+ 		return -ENODEV;
+ 
+ 	pa_dev = psp->platform_access_data;
+ 	button = psp->io_regs + pa_dev->vdata->doorbell_button_reg;
+ 	cmd = psp->io_regs + pa_dev->vdata->doorbell_cmd_reg;
+ 
+ 	mutex_lock(&pa_dev->doorbell_mutex);
+ 
+ 	if (wait_cmd(cmd)) {
+ 		dev_err(psp->dev, "doorbell command not done processing\n");
+ 		ret = -EBUSY;
+ 		goto unlock;
+ 	}
+ 
+ 	iowrite32(FIELD_PREP(DOORBELL_CMDRESP_STS, msg), cmd);
+ 	iowrite32(PSP_DRBL_RING, button);
+ 
+ 	if (wait_cmd(cmd)) {
+ 		ret = -ETIMEDOUT;
+ 		goto unlock;
+ 	}
+ 
+ 	val = FIELD_GET(DOORBELL_CMDRESP_STS, ioread32(cmd));
+ 	if (val) {
+ 		if (result)
+ 			*result = val;
+ 		ret = -EIO;
+ 		goto unlock;
+ 	}
+ 
+ 	ret = 0;
+ unlock:
+ 	mutex_unlock(&pa_dev->doorbell_mutex);
+ 
+ 	return ret;
+ }
+ EXPORT_SYMBOL_GPL(psp_ring_platform_doorbell);
+ 
++>>>>>>> 6699e1431e15 (crypto: ccp - Use lower 8 bytes to communicate with doorbell command register)
  void platform_access_dev_destroy(struct psp_device *psp)
  {
  	struct psp_platform_access_device *pa_dev = psp->platform_access_data;
* Unmerged path drivers/crypto/ccp/platform-access.c
