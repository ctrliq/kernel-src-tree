media: uvcvideo: Add a quirk to force GEO GC6500 Camera bits-per-pixel value

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-504.el8
commit-author Sergey Zakharchenko <szakharchenko@digital-loggers.com>
commit 1dd2e8f942574e2be18374ebb81751082d8d467c
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-504.el8/1dd2e8f9.failed

This device does not function correctly in raw mode in kernel
versions validating buffer sizes in bulk mode. It erroneously
announces 16 bits per pixel instead of 12 for NV12 format, so it
needs this quirk to fix computed frame size and avoid legitimate
frames getting discarded.

[Move info and div variables to local scope]

	Signed-off-by: Sergey Zakharchenko <szakharchenko@digital-loggers.com>
	Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
	Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
(cherry picked from commit 1dd2e8f942574e2be18374ebb81751082d8d467c)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/usb/uvc/uvc_driver.c
diff --cc drivers/media/usb/uvc/uvc_driver.c
index 6131530110b2,99883550375e..000000000000
--- a/drivers/media/usb/uvc/uvc_driver.c
+++ b/drivers/media/usb/uvc/uvc_driver.c
@@@ -2915,24 -2890,15 +2931,36 @@@ static const struct usb_device_id uvc_i
  	  .bInterfaceSubClass	= 1,
  	  .bInterfaceProtocol	= 0,
  	  .driver_info		= (kernel_ulong_t)&uvc_quirk_force_y8 },
++<<<<<<< HEAD
 +	/* Sonix Technology USB 2.0 Camera */
 +	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
 +				| USB_DEVICE_ID_MATCH_INT_INFO,
 +	  .idVendor		= 0x3277,
 +	  .idProduct		= 0x0072,
 +	  .bInterfaceClass	= USB_CLASS_VIDEO,
 +	  .bInterfaceSubClass	= 1,
 +	  .bInterfaceProtocol	= 0,
 +	  .driver_info		= (kernel_ulong_t)&uvc_ctrl_power_line_limited },
 +	/* Acer EasyCamera */
 +	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
 +				| USB_DEVICE_ID_MATCH_INT_INFO,
 +	  .idVendor		= 0x5986,
 +	  .idProduct		= 0x1172,
 +	  .bInterfaceClass	= USB_CLASS_VIDEO,
 +	  .bInterfaceSubClass	= 1,
 +	  .bInterfaceProtocol	= 0,
 +	  .driver_info		= (kernel_ulong_t)&uvc_ctrl_power_line_limited },
++=======
+ 	/* GEO Semiconductor GC6500 */
+ 	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
+ 				| USB_DEVICE_ID_MATCH_INT_INFO,
+ 	  .idVendor		= 0x29fe,
+ 	  .idProduct		= 0x4d53,
+ 	  .bInterfaceClass	= USB_CLASS_VIDEO,
+ 	  .bInterfaceSubClass	= 1,
+ 	  .bInterfaceProtocol	= 0,
+ 	  .driver_info		= UVC_INFO_QUIRK(UVC_QUIRK_FORCE_BPP) },
++>>>>>>> 1dd2e8f94257 (media: uvcvideo: Add a quirk to force GEO GC6500 Camera bits-per-pixel value)
  	/* Intel RealSense D4M */
  	{ .match_flags		= USB_DEVICE_ID_MATCH_DEVICE
  				| USB_DEVICE_ID_MATCH_INT_INFO,
* Unmerged path drivers/media/usb/uvc/uvc_driver.c
diff --git a/drivers/media/usb/uvc/uvcvideo.h b/drivers/media/usb/uvc/uvcvideo.h
index ef01fe44dd3b..4d01de0cc294 100644
--- a/drivers/media/usb/uvc/uvcvideo.h
+++ b/drivers/media/usb/uvc/uvcvideo.h
@@ -71,6 +71,7 @@
 #define UVC_QUIRK_RESTRICT_FRAME_RATE	0x00000200
 #define UVC_QUIRK_RESTORE_CTRLS_ON_INIT	0x00000400
 #define UVC_QUIRK_FORCE_Y8		0x00000800
+#define UVC_QUIRK_FORCE_BPP		0x00001000
 
 /* Format flags */
 #define UVC_FMT_FLAG_COMPRESSED		0x00000001
