media: uvcvideo: Use control names from framework

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-504.el8
commit-author Ricardo Ribalda <ribalda@chromium.org>
commit 70fa906d6fceb07a49198d2f31cadecc76787419
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-504.el8/70fa906d.failed

The framework already contains a map of IDs to names, lets use it when
possible.

	Reviewed-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
	Suggested-by: Hans Verkuil <hverkuil@xs4all.nl>
	Signed-off-by: Ricardo Ribalda <ribalda@chromium.org>
	Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
	Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
(cherry picked from commit 70fa906d6fceb07a49198d2f31cadecc76787419)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/usb/uvc/uvc_ctrl.c
diff --cc drivers/media/usb/uvc/uvc_ctrl.c
index 0b5a224748c7,2cc2ff0d0cae..000000000000
--- a/drivers/media/usb/uvc/uvc_ctrl.c
+++ b/drivers/media/usb/uvc/uvc_ctrl.c
@@@ -515,8 -505,18 +507,21 @@@ static const struct uvc_control_mappin
  		.data_type	= UVC_CTRL_DATA_TYPE_UNSIGNED,
  	},
  	{
++<<<<<<< HEAD
++=======
+ 		.id		= V4L2_CID_POWER_LINE_FREQUENCY,
+ 		.entity		= UVC_GUID_UVC_PROCESSING,
+ 		.selector	= UVC_PU_POWER_LINE_FREQUENCY_CONTROL,
+ 		.size		= 2,
+ 		.offset		= 0,
+ 		.v4l2_type	= V4L2_CTRL_TYPE_MENU,
+ 		.data_type	= UVC_CTRL_DATA_TYPE_ENUM,
+ 		.menu_info	= power_line_frequency_controls,
+ 		.menu_count	= ARRAY_SIZE(power_line_frequency_controls),
+ 	},
+ 	{
++>>>>>>> 70fa906d6fce (media: uvcvideo: Use control names from framework)
  		.id		= V4L2_CID_HUE_AUTO,
- 		.name		= "Hue, Auto",
  		.entity		= UVC_GUID_UVC_PROCESSING,
  		.selector	= UVC_PU_HUE_AUTO_CONTROL,
  		.size		= 1,
* Unmerged path drivers/media/usb/uvc/uvc_ctrl.c
diff --git a/drivers/media/usb/uvc/uvc_v4l2.c b/drivers/media/usb/uvc/uvc_v4l2.c
index 02c3ade4105b..c8841ccdf804 100644
--- a/drivers/media/usb/uvc/uvc_v4l2.c
+++ b/drivers/media/usb/uvc/uvc_v4l2.c
@@ -40,7 +40,13 @@ static int uvc_ioctl_ctrl_map(struct uvc_video_chain *chain,
 		return -ENOMEM;
 
 	map->id = xmap->id;
-	memcpy(map->name, xmap->name, sizeof(map->name));
+	/* Non standard control id. */
+	if (v4l2_ctrl_get_name(map->id) == NULL) {
+		map->name = kmemdup(xmap->name, sizeof(xmap->name),
+				    GFP_KERNEL);
+		if (!map->name)
+			return -ENOMEM;
+	}
 	memcpy(map->entity, xmap->entity, sizeof(map->entity));
 	map->selector = xmap->selector;
 	map->size = xmap->size;
diff --git a/drivers/media/usb/uvc/uvcvideo.h b/drivers/media/usb/uvc/uvcvideo.h
index 993f50d8f954..6a33328256c5 100644
--- a/drivers/media/usb/uvc/uvcvideo.h
+++ b/drivers/media/usb/uvc/uvcvideo.h
@@ -106,7 +106,7 @@ struct uvc_control_mapping {
 	struct list_head ev_subs;
 
 	u32 id;
-	u8 name[32];
+	char *name;
 	u8 entity[16];
 	u8 selector;
 
