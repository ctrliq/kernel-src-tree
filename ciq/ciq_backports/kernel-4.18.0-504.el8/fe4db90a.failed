efi: Add support for EFI_RT_PROPERTIES table

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-504.el8
commit-author Ard Biesheuvel <ardb@kernel.org>
commit fe4db90a80cd12ebe4efe385d40d6636330149ed
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-504.el8/fe4db90a.failed

Take the newly introduced EFI_RT_PROPERTIES_TABLE configuration table
into account, which carries a mask of which EFI runtime services are
still functional after ExitBootServices() has been called by the OS.

	Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
(cherry picked from commit fe4db90a80cd12ebe4efe385d40d6636330149ed)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/firmware/efi/efi.c
#	include/linux/efi.h
diff --cc drivers/firmware/efi/efi.c
index a1fa5481d2f5,a35230517f9c..000000000000
--- a/drivers/firmware/efi/efi.c
+++ b/drivers/firmware/efi/efi.c
@@@ -62,6 -45,10 +62,13 @@@ struct efi __read_mostly efi = 
  };
  EXPORT_SYMBOL(efi);
  
++<<<<<<< HEAD
++=======
+ static unsigned long __ro_after_init rng_seed = EFI_INVALID_TABLE_ADDR;
+ static unsigned long __initdata mem_reserve = EFI_INVALID_TABLE_ADDR;
+ static unsigned long __initdata rt_prop = EFI_INVALID_TABLE_ADDR;
+ 
++>>>>>>> fe4db90a80cd (efi: Add support for EFI_RT_PROPERTIES table)
  struct mm_struct efi_mm = {
  	.mm_rb			= RB_ROOT,
  	.mm_users		= ATOMIC_INIT(2),
@@@ -477,27 -439,20 +484,32 @@@ void __init efi_mem_reserve(phys_addr_
  	efi_arch_mem_reserve(addr, size);
  }
  
 -static const efi_config_table_type_t common_tables[] __initconst = {
 +static __initdata efi_config_table_type_t common_tables[] = {
  	{ACPI_20_TABLE_GUID, "ACPI 2.0", &efi.acpi20},
  	{ACPI_TABLE_GUID, "ACPI", &efi.acpi},
 +	{HCDP_TABLE_GUID, "HCDP", &efi.hcdp},
 +	{MPS_TABLE_GUID, "MPS", &efi.mps},
 +	{SAL_SYSTEM_TABLE_GUID, "SALsystab", &efi.sal_systab},
  	{SMBIOS_TABLE_GUID, "SMBIOS", &efi.smbios},
  	{SMBIOS3_TABLE_GUID, "SMBIOS 3.0", &efi.smbios3},
 +	{UGA_IO_PROTOCOL_GUID, "UGA", &efi.uga},
  	{EFI_SYSTEM_RESOURCE_TABLE_GUID, "ESRT", &efi.esrt},
 -	{EFI_MEMORY_ATTRIBUTES_TABLE_GUID, "MEMATTR", &efi_mem_attr_table},
 -	{LINUX_EFI_RANDOM_SEED_TABLE_GUID, "RNG", &rng_seed},
 +	{EFI_PROPERTIES_TABLE_GUID, "PROP", &efi.properties_table},
 +	{EFI_MEMORY_ATTRIBUTES_TABLE_GUID, "MEMATTR", &efi.mem_attr_table},
 +	{LINUX_EFI_RANDOM_SEED_TABLE_GUID, "RNG", &efi.rng_seed},
  	{LINUX_EFI_TPM_EVENT_LOG_GUID, "TPMEventLog", &efi.tpm_log},
  	{LINUX_EFI_TPM_FINAL_LOG_GUID, "TPMFinalLog", &efi.tpm_final_log},
++<<<<<<< HEAD
 +	{LINUX_EFI_MEMRESERVE_TABLE_GUID, "MEMRESERVE", &efi.mem_reserve},
++=======
+ 	{LINUX_EFI_MEMRESERVE_TABLE_GUID, "MEMRESERVE", &mem_reserve},
+ 	{EFI_RT_PROPERTIES_TABLE_GUID, "RTPROP", &rt_prop},
++>>>>>>> fe4db90a80cd (efi: Add support for EFI_RT_PROPERTIES table)
  #ifdef CONFIG_EFI_RCI2_TABLE
  	{DELLEMC_EFI_RCI2_TABLE_GUID, NULL, &rci2_table_phys},
 +#endif
 +#ifdef CONFIG_LOAD_UEFI_KEYS
 +	{LINUX_EFI_MOK_VARIABLE_TABLE_GUID, "MOKvar", &efi.mokvar_table},
  #endif
  	{NULL_GUID, NULL, NULL},
  };
diff --cc include/linux/efi.h
index e2fbef660b6e,2ab33d5d6ca5..000000000000
--- a/include/linux/efi.h
+++ b/include/linux/efi.h
@@@ -833,6 -332,9 +833,12 @@@ void efi_native_runtime_setup(void)
  #define EFI_CONSOLE_OUT_DEVICE_GUID		EFI_GUID(0xd3b36f2c, 0xd551, 0x11d4,  0x9a, 0x46, 0x00, 0x90, 0x27, 0x3f, 0xc1, 0x4d)
  #define APPLE_PROPERTIES_PROTOCOL_GUID		EFI_GUID(0x91bd12fe, 0xf6c3, 0x44fb,  0xa5, 0xb7, 0x51, 0x22, 0xab, 0x30, 0x3a, 0xe0)
  #define EFI_TCG2_PROTOCOL_GUID			EFI_GUID(0x607f766c, 0x7455, 0x42be,  0x93, 0x0b, 0xe4, 0xd7, 0x6d, 0xb2, 0x72, 0x0f)
++<<<<<<< HEAD
++=======
+ #define EFI_LOAD_FILE_PROTOCOL_GUID		EFI_GUID(0x56ec3091, 0x954c, 0x11d2,  0x8e, 0x3f, 0x00, 0xa0, 0xc9, 0x69, 0x72, 0x3b)
+ #define EFI_LOAD_FILE2_PROTOCOL_GUID		EFI_GUID(0x4006c0c1, 0xfcb3, 0x403e,  0x99, 0x6d, 0x4a, 0x6c, 0x87, 0x24, 0xe0, 0x6d)
+ #define EFI_RT_PROPERTIES_TABLE_GUID		EFI_GUID(0xeb66918a, 0x7eef, 0x402a,  0x84, 0x2e, 0x93, 0x1d, 0x21, 0xc3, 0x8a, 0xe9)
++>>>>>>> fe4db90a80cd (efi: Add support for EFI_RT_PROPERTIES table)
  
  #define EFI_IMAGE_SECURITY_DATABASE_GUID	EFI_GUID(0xd719b2cb, 0x3d3a, 0x4596,  0xa3, 0xbc, 0xda, 0xd0, 0x0e, 0x67, 0x65, 0x6f)
  #define EFI_SHIM_LOCK_GUID			EFI_GUID(0x605dab50, 0xe046, 0x4300,  0xab, 0xb6, 0x3d, 0xd8, 0x10, 0xdd, 0x8b, 0x23)
* Unmerged path drivers/firmware/efi/efi.c
* Unmerged path include/linux/efi.h
