media: uvcvideo: Fix memory leak of object map on error exit path

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-504.el8
commit-author Colin Ian King <colin.king@canonical.com>
commit 4b065060555b14c7a9b86c013a1c9bee8e8b6fbd
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-504.el8/4b065060.failed

Currently when the allocation of map->name fails the error exit path
does not kfree the previously allocated object map. Fix this by
setting ret to -ENOMEM and taking the free_map exit error path to
ensure map is kfree'd.

Addresses-Coverity: ("Resource leak")

Fixes: 70fa906d6fce ("media: uvcvideo: Use control names from framework")
	Signed-off-by: Colin Ian King <colin.king@canonical.com>
	Reviewed-by: Ricardo Ribalda <ribalda@chromium.org>
	Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
	Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
(cherry picked from commit 4b065060555b14c7a9b86c013a1c9bee8e8b6fbd)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/usb/uvc/uvc_v4l2.c
diff --cc drivers/media/usb/uvc/uvc_v4l2.c
index 858db1c4a9be,711556d13d03..000000000000
--- a/drivers/media/usb/uvc/uvc_v4l2.c
+++ b/drivers/media/usb/uvc/uvc_v4l2.c
@@@ -40,7 -40,15 +40,19 @@@ static int uvc_ioctl_ctrl_map(struct uv
  		return -ENOMEM;
  
  	map->id = xmap->id;
++<<<<<<< HEAD
 +	memcpy(map->name, xmap->name, sizeof(map->name));
++=======
+ 	/* Non standard control id. */
+ 	if (v4l2_ctrl_get_name(map->id) == NULL) {
+ 		map->name = kmemdup(xmap->name, sizeof(xmap->name),
+ 				    GFP_KERNEL);
+ 		if (!map->name) {
+ 			ret = -ENOMEM;
+ 			goto free_map;
+ 		}
+ 	}
++>>>>>>> 4b065060555b (media: uvcvideo: Fix memory leak of object map on error exit path)
  	memcpy(map->entity, xmap->entity, sizeof(map->entity));
  	map->selector = xmap->selector;
  	map->size = xmap->size;
* Unmerged path drivers/media/usb/uvc/uvc_v4l2.c
