ASoC: Intel: bytcr_rt5640: Add support for HP Elite Pad 1000G2 jack-detect

jira LE-1907
Rebuild_History Non-Buildable kernel-rt-4.18.0-372.9.1.rt7.166.el8
commit-author Hans de Goede <hdegoede@redhat.com>
commit 9ba00856686ade106afee2884b5e8ac1e09d137a
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-rt-4.18.0-372.9.1.rt7.166.el8/9ba00856.failed

The HP Elitepad 1000 G2 tablet has 2 headset jacks:

1. on the dock which uses the output of the codecs built-in HP-amp +
the standard IN2 input which is always used with the headset-jack.

2. on the tablet itself, this uses the line-out of the codec + an external
HP-amp, which gets enabled by the ALC5642 codec's GPIO1 pin; and IN1 for
the headset-mic.

The codec's GPIO1 is also its only IRQ output pin, so this means that
the codec's IRQ cannot be used on this tablet. Instead the jack-detect
is connected directly to GPIOs on the main SoC. The dock has a helper
chip which also detects if a headset-mic is present or not, so there
are 2 GPIOs for the jack-detect status of the dock. The tablet jack
uses a single GPIO which indicates if a jack is present or not.

Differentiating between headphones vs a headset on the tablet jack
is done by using the usual mic-bias over-current-detection mechanism.

Add support for this unique setup, this support gets enabled on this
tablet through a new BYT_RT5640_JD_HP_ELITEP_1000G2 quirk.

BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=213415
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
	Acked-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Link: https://lore.kernel.org/r/20210819190543.784415-7-hdegoede@redhat.com
	Signed-off-by: Mark Brown <broonie@kernel.org>
(cherry picked from commit 9ba00856686ade106afee2884b5e8ac1e09d137a)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	sound/soc/intel/boards/bytcr_rt5640.c
diff --cc sound/soc/intel/boards/bytcr_rt5640.c
index f869edae71c4,2f151ba80be5..000000000000
--- a/sound/soc/intel/boards/bytcr_rt5640.c
+++ b/sound/soc/intel/boards/bytcr_rt5640.c
@@@ -1489,7 -1637,7 +1625,11 @@@ static int snd_byt_rt5640_mc_probe(stru
  	/* Must be called before register_card, also see declaration comment. */
  	ret_val = byt_rt5640_add_codec_device_props(codec_dev, priv);
  	if (ret_val)
++<<<<<<< HEAD
 +		goto err;
++=======
+ 		goto err_remove_gpios;
++>>>>>>> 9ba00856686a (ASoC: Intel: bytcr_rt5640: Add support for HP Elite Pad 1000G2 jack-detect)
  
  	log_quirks(&pdev->dev);
  
@@@ -1592,6 -1740,11 +1732,14 @@@
  	return ret_val;
  
  err:
++<<<<<<< HEAD
++=======
+ 	device_remove_software_node(priv->codec_dev);
+ err_remove_gpios:
+ 	if (byt_rt5640_quirk & BYT_RT5640_JD_HP_ELITEP_1000G2)
+ 		acpi_dev_remove_driver_gpios(ACPI_COMPANION(priv->codec_dev));
+ err_device:
++>>>>>>> 9ba00856686a (ASoC: Intel: bytcr_rt5640: Add support for HP Elite Pad 1000G2 jack-detect)
  	put_device(priv->codec_dev);
  	return ret_val;
  }
@@@ -1601,6 -1754,10 +1749,13 @@@ static int snd_byt_rt5640_mc_remove(str
  	struct snd_soc_card *card = platform_get_drvdata(pdev);
  	struct byt_rt5640_private *priv = snd_soc_card_get_drvdata(card);
  
++<<<<<<< HEAD
++=======
+ 	if (byt_rt5640_quirk & BYT_RT5640_JD_HP_ELITEP_1000G2)
+ 		acpi_dev_remove_driver_gpios(ACPI_COMPANION(priv->codec_dev));
+ 
+ 	device_remove_software_node(priv->codec_dev);
++>>>>>>> 9ba00856686a (ASoC: Intel: bytcr_rt5640: Add support for HP Elite Pad 1000G2 jack-detect)
  	put_device(priv->codec_dev);
  	return 0;
  }
* Unmerged path sound/soc/intel/boards/bytcr_rt5640.c
