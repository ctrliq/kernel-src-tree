platform/x86: asus-wmi: Move acpi_backlight=native quirks to ACPI video_detect.c

jira LE-1907
Rebuild_History Non-Buildable kernel-4.18.0-529.el8
commit-author Hans de Goede <hdegoede@redhat.com>
commit 1e3344d6f2b329ca064b3016bc33d7f33ed7ba0e
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-4.18.0-529.el8/1e3344d6.failed

Remove the asus-wmi quirk_entry.wmi_backlight_native quirk-flag, which
called acpi_video_set_dmi_backlight_type(acpi_backlight_native) and replace
it with acpi/video_detect.c video_detect_dmi_table[] entries using the
video_detect_force_native callback.

acpi_video_set_dmi_backlight_type() is troublesome because it may end up
getting called after other backlight drivers have already called
acpi_video_get_backlight_type() resulting in the other drivers
already being registered even though they should not.

	Acked-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
	Signed-off-by: Hans de Goede <hdegoede@redhat.com>
(cherry picked from commit 1e3344d6f2b329ca064b3016bc33d7f33ed7ba0e)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/platform/x86/asus-nb-wmi.c
#	drivers/platform/x86/asus-wmi.c
#	drivers/platform/x86/asus-wmi.h
diff --cc drivers/platform/x86/asus-nb-wmi.c
index 136ff2b4cce5,bbfed85051ee..000000000000
--- a/drivers/platform/x86/asus-nb-wmi.c
+++ b/drivers/platform/x86/asus-nb-wmi.c
@@@ -101,13 -94,11 +101,16 @@@ static struct quirk_entry quirk_asus_wa
  
  static struct quirk_entry quirk_asus_x200ca = {
  	.wapf = 2,
 -	.wmi_backlight_set_devstate = true,
  };
  
++<<<<<<< HEAD
 +static struct quirk_entry quirk_asus_ux303ub = {
 +	.wmi_backlight_native = true,
 +};
 +
++=======
++>>>>>>> 1e3344d6f2b3 (platform/x86: asus-wmi: Move acpi_backlight=native quirks to ACPI video_detect.c)
  static struct quirk_entry quirk_asus_x550lb = {
 -	.wmi_backlight_set_devstate = true,
  	.xusb2pr = 0x01D9,
  };
  
diff --cc drivers/platform/x86/asus-wmi.c
index 5dac33474aea,434249ac47a5..000000000000
--- a/drivers/platform/x86/asus-wmi.c
+++ b/drivers/platform/x86/asus-wmi.c
@@@ -2167,18 -3634,6 +2167,21 @@@ static int asus_wmi_add(struct platform
  	if (asus->driver->quirks->wmi_force_als_set)
  		asus_wmi_set_als();
  
++<<<<<<< HEAD
 +	/* Some Asus desktop boards export an acpi-video backlight interface,
 +	   stop this from showing up */
 +	chassis_type = dmi_get_system_info(DMI_CHASSIS_TYPE);
 +	if (chassis_type && !strcmp(chassis_type, "3"))
 +		acpi_video_set_dmi_backlight_type(acpi_backlight_vendor);
 +
 +	if (asus->driver->quirks->wmi_backlight_power)
 +		acpi_video_set_dmi_backlight_type(acpi_backlight_vendor);
 +
 +	if (asus->driver->quirks->wmi_backlight_native)
 +		acpi_video_set_dmi_backlight_type(acpi_backlight_native);
 +
++=======
++>>>>>>> 1e3344d6f2b3 (platform/x86: asus-wmi: Move acpi_backlight=native quirks to ACPI video_detect.c)
  	if (asus->driver->quirks->xusb2pr)
  		asus_wmi_set_xusb2pr(asus);
  
diff --cc drivers/platform/x86/asus-wmi.h
index 6c1311f4b04d,f30252efe1db..000000000000
--- a/drivers/platform/x86/asus-wmi.h
+++ b/drivers/platform/x86/asus-wmi.h
@@@ -42,9 -29,10 +42,13 @@@ struct quirk_entry 
  	bool hotplug_wireless;
  	bool scalar_panel_brightness;
  	bool store_backlight_power;
++<<<<<<< HEAD
 +	bool wmi_backlight_power;
 +	bool wmi_backlight_native;
++=======
+ 	bool wmi_backlight_set_devstate;
++>>>>>>> 1e3344d6f2b3 (platform/x86: asus-wmi: Move acpi_backlight=native quirks to ACPI video_detect.c)
  	bool wmi_force_als_set;
 -	bool use_kbd_dock_devid;
 -	bool use_lid_flip_devid;
  	int wapf;
  	/*
  	 * For machines with AMD graphic chips, it will send out WMI event
diff --git a/drivers/acpi/video_detect.c b/drivers/acpi/video_detect.c
index 71fac8806a3e..c6ba4c1cb298 100644
--- a/drivers/acpi/video_detect.c
+++ b/drivers/acpi/video_detect.c
@@ -465,6 +465,14 @@ static const struct dmi_system_id video_detect_dmi_table[] = {
 		DMI_MATCH(DMI_PRODUCT_NAME, "GA503"),
 		},
 	},
+	{
+	 .callback = video_detect_force_native,
+	 /* Asus UX303UB */
+	 .matches = {
+		DMI_MATCH(DMI_SYS_VENDOR, "ASUSTeK COMPUTER INC."),
+		DMI_MATCH(DMI_PRODUCT_NAME, "UX303UB"),
+		},
+	},
 	/*
 	 * Clevo NL5xRU and NL5xNU/TUXEDO Aura 15 Gen1 and Gen2 have both a
 	 * working native and video interface. However the default detection
* Unmerged path drivers/platform/x86/asus-nb-wmi.c
* Unmerged path drivers/platform/x86/asus-wmi.c
* Unmerged path drivers/platform/x86/asus-wmi.h
