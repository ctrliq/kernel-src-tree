scsi: fnic: Add support for multiqueue (MQ) in fnic_main.c

jira LE-4311
Rebuild_History Non-Buildable kernel-5.14.0-570.46.1.el9_6
commit-author Karan Tilak Kumar <kartilak@cisco.com>
commit 52f6e196e52ef834f928aac297d895f4c32276ea
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-570.46.1.el9_6/52f6e196.failed

Set map_queues in the fnic_host_template to fnic_mq_map_queues_cpus.
Define fnic_mq_map_queues_cpus to set cpu assignment to fnic queues.
Refactor code in fnic_probe to enable vnic queues before scsi_add_host.
Modify notify set to the correct index.

	Reviewed-by: Sesidhar Baddela <sebaddel@cisco.com>
	Reviewed-by: Arulprabhu Ponnusamy <arulponn@cisco.com>
	Reviewed-by: Hannes Reinecke <hare@suse.de>
	Reviewed-by: John Garry <john.g.garry@oracle.com>
	Signed-off-by: Karan Tilak Kumar <kartilak@cisco.com>
Link: https://lore.kernel.org/r/20231211173617.932990-11-kartilak@cisco.com
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 52f6e196e52ef834f928aac297d895f4c32276ea)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/fnic/fnic_main.c
diff --cc drivers/scsi/fnic/fnic_main.c
index 85e3a51a16fc,7fee8a024edb..000000000000
--- a/drivers/scsi/fnic/fnic_main.c
+++ b/drivers/scsi/fnic/fnic_main.c
@@@ -123,8 -113,10 +125,13 @@@ static struct scsi_host_template fnic_h
  	.can_queue = FNIC_DFLT_IO_REQ,
  	.sg_tablesize = FNIC_MAX_SG_DESC_CNT,
  	.max_sectors = 0xffff,
 -	.shost_groups = fnic_host_groups,
 +	.shost_attrs = fnic_attrs,
  	.track_queue_depth = 1,
++<<<<<<< HEAD
++=======
+ 	.cmd_size = sizeof(struct fnic_cmd_priv),
+ 	.map_queues = fnic_mq_map_queues_cpus,
++>>>>>>> 52f6e196e52e (scsi: fnic: Add support for multiqueue (MQ) in fnic_main.c)
  };
  
  static void
diff --git a/drivers/scsi/fnic/fnic.h b/drivers/scsi/fnic/fnic.h
index 9ebca3720f82..243f976cebb5 100644
--- a/drivers/scsi/fnic/fnic.h
+++ b/drivers/scsi/fnic/fnic.h
@@ -108,7 +108,7 @@
 #define FNIC_ABT_TERM_DELAY_TIMEOUT  500        /* mSec */
 
 #define FNIC_MAX_FCP_TARGET     256
-
+#define FNIC_PCI_OFFSET		2
 /**
  * state_flags to identify host state along along with fnic's state
  **/
@@ -378,7 +378,7 @@ void fnic_wq_copy_cleanup_handler(struct vnic_wq_copy *wq,
 int fnic_fw_reset_handler(struct fnic *fnic);
 void fnic_terminate_rport_io(struct fc_rport *);
 const char *fnic_state_to_str(unsigned int state);
-
+void fnic_mq_map_queues_cpus(struct Scsi_Host *host);
 void fnic_log_q_error(struct fnic *fnic);
 void fnic_handle_link_event(struct fnic *fnic);
 
* Unmerged path drivers/scsi/fnic/fnic_main.c
