scsi: fnic: Add and integrate support for FDMI

jira LE-4311
Rebuild_History Non-Buildable kernel-5.14.0-570.46.1.el9_6
commit-author Karan Tilak Kumar <kartilak@cisco.com>
commit 09c1e6ab4ab2a107d96f119950dc330e446dc2b0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-570.46.1.el9_6/09c1e6ab.failed

Add support for Fabric-Device Management Interface (FDMI) by introducing
PCI device IDs for Cisco Hardware.

Introduce a module parameter to enable/disable FDMI support.

Integrate support for FDMI.

	Reported-by: kernel test robot <lkp@intel.com>
Closes: https://lore.kernel.org/oe-kbuild-all/202406110734.p2v8dq9v-lkp@intel.com/
	Reviewed-by: Sesidhar Baddela <sebaddel@cisco.com>
Co-developed-by: Gian Carlo Boffa <gcboffa@cisco.com>
	Signed-off-by: Gian Carlo Boffa <gcboffa@cisco.com>
Co-developed-by: Arulprabhu Ponnusamy <arulponn@cisco.com>
	Signed-off-by: Arulprabhu Ponnusamy <arulponn@cisco.com>
Co-developed-by: Arun Easi <aeasi@cisco.com>
	Signed-off-by: Arun Easi <aeasi@cisco.com>
Co-developed-by: Karan Tilak Kumar <kartilak@cisco.com>
	Signed-off-by: Karan Tilak Kumar <kartilak@cisco.com>
Link: https://lore.kernel.org/r/20241212020312.4786-8-kartilak@cisco.com
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 09c1e6ab4ab2a107d96f119950dc330e446dc2b0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/fnic/fdls_disc.c
#	drivers/scsi/fnic/fnic_main.c
diff --cc drivers/scsi/fnic/fnic_main.c
index 06fd7b543b33,c75716856417..000000000000
--- a/drivers/scsi/fnic/fnic_main.c
+++ b/drivers/scsi/fnic/fnic_main.c
@@@ -601,6 -613,9 +604,12 @@@ static int fnic_probe(struct pci_dev *p
  	int fnic_id = 0;
  	int i;
  	unsigned long flags;
++<<<<<<< HEAD
++=======
+ 	int hwq;
+ 	char *desc, *subsys_desc;
+ 	int len;
++>>>>>>> 09c1e6ab4ab2 (scsi: fnic: Add and integrate support for FDMI)
  
  	/*
  	 * Allocate SCSI Host and set up association between host,
@@@ -634,10 -649,22 +643,29 @@@
  	fnic->fnic_num = fnic_id;
  	fnic_stats_debugfs_init(fnic);
  
++<<<<<<< HEAD
 +	/* Setup PCI resources */
 +	pci_set_drvdata(pdev, fnic);
 +
 +	fnic->pdev = pdev;
++=======
+ 	/* Find model name from PCIe subsys ID */
+ 	if (fnic_get_desc_by_devid(pdev, &desc, &subsys_desc) == 0) {
+ 		dev_info(&fnic->pdev->dev, "Model: %s\n", subsys_desc);
+ 
+ 		/* Update FDMI model */
+ 		fnic->subsys_desc_len = strlen(subsys_desc);
+ 		len = ARRAY_SIZE(fnic->subsys_desc);
+ 		if (fnic->subsys_desc_len > len)
+ 			fnic->subsys_desc_len = len;
+ 		memcpy(fnic->subsys_desc, subsys_desc, fnic->subsys_desc_len);
+ 		dev_info(&fnic->pdev->dev, "FDMI Model: %s\n", fnic->subsys_desc);
+ 	} else {
+ 		fnic->subsys_desc_len = 0;
+ 		dev_info(&fnic->pdev->dev, "Model: %s subsys_id: 0x%04x\n", "Unknown",
+ 				pdev->subsystem_device);
+ 	}
++>>>>>>> 09c1e6ab4ab2 (scsi: fnic: Add and integrate support for FDMI)
  
  	err = pci_enable_device(pdev);
  	if (err) {
* Unmerged path drivers/scsi/fnic/fdls_disc.c
* Unmerged path drivers/scsi/fnic/fdls_disc.c
diff --git a/drivers/scsi/fnic/fnic.h b/drivers/scsi/fnic/fnic.h
index 73fb8245c7b7..f3288c3b45cd 100644
--- a/drivers/scsi/fnic/fnic.h
+++ b/drivers/scsi/fnic/fnic.h
@@ -127,6 +127,7 @@
 #define fnic_clear_state_flags(fnicp, st_flags)  \
 	__fnic_set_state_flags(fnicp, st_flags, 1)
 
+extern unsigned int fnic_fdmi_support;
 extern unsigned int fnic_log_level;
 extern unsigned int io_completions;
 
* Unmerged path drivers/scsi/fnic/fnic_main.c
