scsi: fnic: Return appropriate error code for mem alloc failure

jira LE-4311
Rebuild_History Non-Buildable kernel-5.14.0-570.46.1.el9_6
commit-author Karan Tilak Kumar <kartilak@cisco.com>
commit 7dbe3aa2f3f83949174b64860dadfaeec3454cff
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-570.46.1.el9_6/7dbe3aa2.failed

Return appropriate error code from fnic_probe when memory create slab pool
fails. Fix bug report.

	Suggested-by: Dan Carpenter <dan.carpenter@linaro.org>
	Reviewed-by: Sesidhar Baddela <sebaddel@cisco.com>
	Reviewed-by: Arulprabhu Ponnusamy <arulponn@cisco.com>
	Reviewed-by: Gian Carlo Boffa <gcboffa@cisco.com>
	Reviewed-by: Arun Easi <aeasi@cisco.com>
	Signed-off-by: Karan Tilak Kumar <kartilak@cisco.com>
Link: https://lore.kernel.org/r/20250110091746.17671-1-kartilak@cisco.com
	Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
(cherry picked from commit 7dbe3aa2f3f83949174b64860dadfaeec3454cff)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/scsi/fnic/fnic_main.c
diff --cc drivers/scsi/fnic/fnic_main.c
index 06fd7b543b33,2d51adf18501..000000000000
--- a/drivers/scsi/fnic/fnic_main.c
+++ b/drivers/scsi/fnic/fnic_main.c
@@@ -774,24 -887,35 +774,51 @@@ static int fnic_probe(struct pci_dev *p
  		fnic->fw_ack_index[i] = -1;
  	}
  
 +	for (i = 0; i < FNIC_IO_LOCKS; i++)
 +		spin_lock_init(&fnic->io_req_lock[i]);
 +
 +	err = -ENOMEM;
 +	fnic->io_req_pool = mempool_create_slab_pool(2, fnic_io_req_cache);
 +	if (!fnic->io_req_pool)
 +		goto err_out_free_resources;
 +
  	pool = mempool_create_slab_pool(2, fnic_sgl_cache[FNIC_SGL_CACHE_DFLT]);
++<<<<<<< HEAD
 +	if (!pool)
 +		goto err_out_free_ioreq_pool;
++=======
+ 	if (!pool) {
+ 		err = -ENOMEM;
+ 		goto err_out_free_resources;
+ 	}
++>>>>>>> 7dbe3aa2f3f8 (scsi: fnic: Return appropriate error code for mem alloc failure)
  	fnic->io_sgl_pool[FNIC_SGL_CACHE_DFLT] = pool;
  
  	pool = mempool_create_slab_pool(2, fnic_sgl_cache[FNIC_SGL_CACHE_MAX]);
- 	if (!pool)
+ 	if (!pool) {
+ 		err = -ENOMEM;
  		goto err_out_free_dflt_pool;
+ 	}
  	fnic->io_sgl_pool[FNIC_SGL_CACHE_MAX] = pool;
  
++<<<<<<< HEAD
++=======
+ 	pool = mempool_create_slab_pool(FDLS_MIN_FRAMES, fdls_frame_cache);
+ 	if (!pool) {
+ 		err = -ENOMEM;
+ 		goto err_out_fdls_frame_pool;
+ 	}
+ 	fnic->frame_pool = pool;
+ 
+ 	pool = mempool_create_slab_pool(FDLS_MIN_FRAME_ELEM,
+ 						fdls_frame_elem_cache);
+ 	if (!pool) {
+ 		err = -ENOMEM;
+ 		goto err_out_fdls_frame_elem_pool;
+ 	}
+ 	fnic->frame_elem_pool = pool;
+ 
++>>>>>>> 7dbe3aa2f3f8 (scsi: fnic: Return appropriate error code for mem alloc failure)
  	/* setup vlan config, hw inserts vlan header */
  	fnic->vlan_hw_insert = 1;
  	fnic->vlan_id = 0;
* Unmerged path drivers/scsi/fnic/fnic_main.c
