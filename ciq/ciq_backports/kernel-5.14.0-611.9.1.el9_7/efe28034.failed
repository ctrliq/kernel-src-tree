ibmvnic: Use ndo_get_stats64 to fix inaccurate SAR reporting

jira KERNEL-216
Rebuild_History Non-Buildable kernel-5.14.0-611.9.1.el9_7
commit-author Mingming Cao <mmc@linux.ibm.com>
commit efe28034ea27cd621e42c9be9a5af2c5ad0e2198
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-611.9.1.el9_7/efe28034.failed

VNIC testing on multi-core Power systems showed SAR stats drift
and packet rate inconsistencies under load.

Implements ndo_get_stats64 to provide safe aggregation of queue-level
atomic64 counters into rtnl_link_stats64 for use by tools like 'ip -s',
'ifconfig', and 'sar'. Switch to ndo_get_stats64 to align SAR reporting
with the standard kernel interface for retrieving netdev stats.

This removes redundant per-adapter stat updates, reduces overhead,
eliminates cacheline bouncing from hot path updates, and improves
the accuracy of reported packet rates.

	Signed-off-by: Mingming Cao <mmc@linux.ibm.com>
	Reviewed-by: Brian King <bjking1@linux.ibm.com>
	Reviewed-by: Dave Marquardt <davemarq@linux.ibm.com>
	Reviewed-by: Simon Horman <horms@kernel.org>

----
Changes since v3:
link to v3: https://www.spinics.net/lists/netdev/msg1107999.html
-- keep per queue counters as u64 (this patch) and drop off patch 1 in v3

Link: https://patch.msgid.link/20250716152115.61143-1-mmc@linux.ibm.com
	Signed-off-by: Jakub Kicinski <kuba@kernel.org>
(cherry picked from commit efe28034ea27cd621e42c9be9a5af2c5ad0e2198)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/net/ethernet/ibm/ibmvnic.c
diff --cc drivers/net/ethernet/ibm/ibmvnic.c
index 3ffc3a7c0eee,eec971567aac..000000000000
--- a/drivers/net/ethernet/ibm/ibmvnic.c
+++ b/drivers/net/ethernet/ibm/ibmvnic.c
@@@ -2103,9 -2312,7 +2103,13 @@@ static void ibmvnic_tx_scrq_clean_buffe
  					  tx_pool->num_buffers - 1 :
  					  tx_pool->consumer_index - 1;
  		tx_buff = &tx_pool->tx_buff[index];
++<<<<<<< HEAD
 +		adapter->netdev->stats.tx_packets--;
 +		adapter->netdev->stats.tx_bytes -= tx_buff->skb->len;
 +		adapter->tx_stats_buffers[queue_num].packets--;
++=======
+ 		adapter->tx_stats_buffers[queue_num].batched_packets--;
++>>>>>>> efe28034ea27 (ibmvnic: Use ndo_get_stats64 to fix inaccurate SAR reporting)
  		adapter->tx_stats_buffers[queue_num].bytes -=
  						tx_buff->skb->len;
  		dev_kfree_skb_any(tx_buff->skb);
@@@ -2433,12 -2645,10 +2437,15 @@@ tx_err
  	}
  out:
  	rcu_read_unlock();
++<<<<<<< HEAD
 +	netdev->stats.tx_dropped += tx_dropped;
 +	netdev->stats.tx_bytes += tx_bytes;
 +	netdev->stats.tx_packets += tx_packets;
++=======
++>>>>>>> efe28034ea27 (ibmvnic: Use ndo_get_stats64 to fix inaccurate SAR reporting)
  	adapter->tx_send_failed += tx_send_failed;
  	adapter->tx_map_failed += tx_map_failed;
 -	adapter->tx_stats_buffers[queue_num].batched_packets += tx_bpackets;
 -	adapter->tx_stats_buffers[queue_num].direct_packets += tx_dpackets;
 +	adapter->tx_stats_buffers[queue_num].packets += tx_packets;
  	adapter->tx_stats_buffers[queue_num].bytes += tx_bytes;
  	adapter->tx_stats_buffers[queue_num].dropped_packets += tx_dropped;
  
* Unmerged path drivers/net/ethernet/ibm/ibmvnic.c
