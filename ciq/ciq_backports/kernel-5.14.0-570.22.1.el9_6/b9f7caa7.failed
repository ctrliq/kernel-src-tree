media: v4l2-mediabus: Drop V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag

jira LE-3262
Rebuild_History Non-Buildable kernel-5.14.0-570.22.1.el9_6
commit-author Laurent Pinchart <laurent.pinchart+renesas@ideasonboard.com>
commit b9f7caa7753ad185e0dc7afb3ae4bd423d11f5c0
Empty-Commit: Cherry-Pick Conflicts during history rebuild.
Will be included in final tarball splat. Ref for failed cherry-pick at:
ciq/ciq_backports/kernel-5.14.0-570.22.1.el9_6/b9f7caa7.failed

MIPI CSI-2 continuous and non-continuous clock modes are mutually
exclusive. Drop the V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag and use
V4L2_MBUS_CSI2_NONCONTINUOUS_CLOCK only.

	Signed-off-by: Laurent Pinchart <laurent.pinchart+renesas@ideasonboard.com>
	Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
	Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>
(cherry picked from commit b9f7caa7753ad185e0dc7afb3ae4bd423d11f5c0)
	Signed-off-by: Jonathan Maple <jmaple@ciq.com>

# Conflicts:
#	drivers/media/i2c/adv7180.c
#	drivers/media/i2c/tc358743.c
diff --cc drivers/media/i2c/adv7180.c
index 811619651329,4f5db195e66d..000000000000
--- a/drivers/media/i2c/adv7180.c
+++ b/drivers/media/i2c/adv7180.c
@@@ -768,9 -784,8 +768,14 @@@ static int adv7180_get_mbus_config(stru
  
  	if (state->chip_info->flags & ADV7180_FLAG_MIPI_CSI2) {
  		cfg->type = V4L2_MBUS_CSI2_DPHY;
++<<<<<<< HEAD
 +		cfg->flags = V4L2_MBUS_CSI2_1_LANE |
 +				V4L2_MBUS_CSI2_CHANNEL_0 |
 +				V4L2_MBUS_CSI2_CONTINUOUS_CLOCK;
++=======
+ 		cfg->bus.mipi_csi2.num_data_lanes = 1;
+ 		cfg->bus.mipi_csi2.flags = 0;
++>>>>>>> b9f7caa7753a (media: v4l2-mediabus: Drop V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag)
  	} else {
  		/*
  		 * The ADV7180 sensor supports BT.601/656 output modes.
diff --cc drivers/media/i2c/tc358743.c
index 3205cd8298dd,e18b8947ad7e..000000000000
--- a/drivers/media/i2c/tc358743.c
+++ b/drivers/media/i2c/tc358743.c
@@@ -1613,24 -1613,8 +1613,29 @@@ static int tc358743_get_mbus_config(str
  	cfg->type = V4L2_MBUS_CSI2_DPHY;
  
  	/* Support for non-continuous CSI-2 clock is missing in the driver */
++<<<<<<< HEAD
 +	cfg->flags = V4L2_MBUS_CSI2_CONTINUOUS_CLOCK;
 +
 +	switch (state->csi_lanes_in_use) {
 +	case 1:
 +		cfg->flags |= V4L2_MBUS_CSI2_1_LANE;
 +		break;
 +	case 2:
 +		cfg->flags |= V4L2_MBUS_CSI2_2_LANE;
 +		break;
 +	case 3:
 +		cfg->flags |= V4L2_MBUS_CSI2_3_LANE;
 +		break;
 +	case 4:
 +		cfg->flags |= V4L2_MBUS_CSI2_4_LANE;
 +		break;
 +	default:
 +		return -EINVAL;
 +	}
++=======
+ 	cfg->bus.mipi_csi2.flags = 0;
+ 	cfg->bus.mipi_csi2.num_data_lanes = state->csi_lanes_in_use;
++>>>>>>> b9f7caa7753a (media: v4l2-mediabus: Drop V4L2_MBUS_CSI2_CONTINUOUS_CLOCK flag)
  
  	return 0;
  }
* Unmerged path drivers/media/i2c/adv7180.c
* Unmerged path drivers/media/i2c/tc358743.c
diff --git a/drivers/media/v4l2-core/v4l2-fwnode.c b/drivers/media/v4l2-core/v4l2-fwnode.c
index 843259c304bb..d531d8053c76 100644
--- a/drivers/media/v4l2-core/v4l2-fwnode.c
+++ b/drivers/media/v4l2-core/v4l2-fwnode.c
@@ -207,13 +207,11 @@ static int v4l2_fwnode_endpoint_parse_csi2_bus(struct fwnode_handle *fwnode,
 	if (fwnode_property_present(fwnode, "clock-noncontinuous")) {
 		flags |= V4L2_MBUS_CSI2_NONCONTINUOUS_CLOCK;
 		pr_debug("non-continuous clock\n");
-	} else {
-		flags |= V4L2_MBUS_CSI2_CONTINUOUS_CLOCK;
 	}
 
 	if (bus_type == V4L2_MBUS_CSI2_DPHY ||
-	    bus_type == V4L2_MBUS_CSI2_CPHY || lanes_used ||
-	    have_clk_lane || (flags & ~V4L2_MBUS_CSI2_CONTINUOUS_CLOCK)) {
+	    bus_type == V4L2_MBUS_CSI2_CPHY ||
+	    lanes_used || have_clk_lane || flags) {
 		/* Only D-PHY has a clock lane. */
 		unsigned int dfl_data_lane_index =
 			bus_type == V4L2_MBUS_CSI2_DPHY;
diff --git a/include/media/v4l2-mediabus.h b/include/media/v4l2-mediabus.h
index b77871485306..fc30e0a9ca1f 100644
--- a/include/media/v4l2-mediabus.h
+++ b/include/media/v4l2-mediabus.h
@@ -73,8 +73,7 @@
 #define V4L2_MBUS_CSI2_CHANNEL_2		BIT(6)
 #define V4L2_MBUS_CSI2_CHANNEL_3		BIT(7)
 /* Clock non-continuous mode support. */
-#define V4L2_MBUS_CSI2_CONTINUOUS_CLOCK		BIT(8)
-#define V4L2_MBUS_CSI2_NONCONTINUOUS_CLOCK	BIT(9)
+#define V4L2_MBUS_CSI2_NONCONTINUOUS_CLOCK	BIT(0)
 
 #define V4L2_MBUS_CSI2_CHANNELS		(V4L2_MBUS_CSI2_CHANNEL_0 | \
 					 V4L2_MBUS_CSI2_CHANNEL_1 | \
